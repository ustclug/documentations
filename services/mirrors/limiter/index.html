
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for LUG service maintenance">
      
      
        <meta name="author" content="USTC Linux User Group">
      
      
        <link rel="canonical" href="https://docs.ustclug.org/services/mirrors/limiter/">
      
      
        <link rel="prev" href="../monitor/">
      
      
        <link rel="next" href="../rsync/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.47">
    
    
      
        <title>Limiter - LUG @ USTC</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://101.ustclug.org/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="LUG @ USTC" class="md-header__button md-logo" aria-label="LUG @ USTC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M220.8 123.3c1 .5 1.8 1.7 3 1.7 1.1 0 2.8-.4 2.9-1.5.2-1.4-1.9-2.3-3.2-2.9-1.7-.7-3.9-1-5.5-.1-.4.2-.8.7-.6 1.1.3 1.3 2.3 1.1 3.4 1.7m-21.9 1.7c1.2 0 2-1.2 3-1.7 1.1-.6 3.1-.4 3.5-1.6.2-.4-.2-.9-.6-1.1-1.6-.9-3.8-.6-5.5.1-1.3.6-3.4 1.5-3.2 2.9.1 1 1.8 1.5 2.8 1.4M420 403.8c-3.6-4-5.3-11.6-7.2-19.7-1.8-8.1-3.9-16.8-10.5-22.4-1.3-1.1-2.6-2.1-4-2.9-1.3-.8-2.7-1.5-4.1-2 9.2-27.3 5.6-54.5-3.7-79.1-11.4-30.1-31.3-56.4-46.5-74.4-17.1-21.5-33.7-41.9-33.4-72C311.1 85.4 315.7.1 234.8 0 132.4-.2 158 103.4 156.9 135.2c-1.7 23.4-6.4 41.8-22.5 64.7-18.9 22.5-45.5 58.8-58.1 96.7-6 17.9-8.8 36.1-6.2 53.3-6.5 5.8-11.4 14.7-16.6 20.2-4.2 4.3-10.3 5.9-17 8.3s-14 6-18.5 14.5c-2.1 3.9-2.8 8.1-2.8 12.4 0 3.9.6 7.9 1.2 11.8 1.2 8.1 2.5 15.7.8 20.8-5.2 14.4-5.9 24.4-2.2 31.7 3.8 7.3 11.4 10.5 20.1 12.3 17.3 3.6 40.8 2.7 59.3 12.5 19.8 10.4 39.9 14.1 55.9 10.4 11.6-2.6 21.1-9.6 25.9-20.2 12.5-.1 26.3-5.4 48.3-6.6 14.9-1.2 33.6 5.3 55.1 4.1.6 2.3 1.4 4.6 2.5 6.7v.1c8.3 16.7 23.8 24.3 40.3 23 16.6-1.3 34.1-11 48.3-27.9 13.6-16.4 36-23.2 50.9-32.2 7.4-4.5 13.4-10.1 13.9-18.3.4-8.2-4.4-17.3-15.5-29.7M223.7 87.3c9.8-22.2 34.2-21.8 44-.4 6.5 14.2 3.6 30.9-4.3 40.4-1.6-.8-5.9-2.6-12.6-4.9 1.1-1.2 3.1-2.7 3.9-4.6 4.8-11.8-.2-27-9.1-27.3-7.3-.5-13.9 10.8-11.8 23-4.1-2-9.4-3.5-13-4.4-1-6.9-.3-14.6 2.9-21.8M183 75.8c10.1 0 20.8 14.2 19.1 33.5-3.5 1-7.1 2.5-10.2 4.6 1.2-8.9-3.3-20.1-9.6-19.6-8.4.7-9.8 21.2-1.8 28.1 1 .8 1.9-.2-5.9 5.5-15.6-14.6-10.5-52.1 8.4-52.1m-13.6 60.7c6.2-4.6 13.6-10 14.1-10.5 4.7-4.4 13.5-14.2 27.9-14.2 7.1 0 15.6 2.3 25.9 8.9 6.3 4.1 11.3 4.4 22.6 9.3 8.4 3.5 13.7 9.7 10.5 18.2-2.6 7.1-11 14.4-22.7 18.1-11.1 3.6-19.8 16-38.2 14.9-3.9-.2-7-1-9.6-2.1-8-3.5-12.2-10.4-20-15-8.6-4.8-13.2-10.4-14.7-15.3q-2.1-7.35 4.2-12.3m3.3 334c-2.7 35.1-43.9 34.4-75.3 18-29.9-15.8-68.6-6.5-76.5-21.9-2.4-4.7-2.4-12.7 2.6-26.4v-.2c2.4-7.6.6-16-.6-23.9-1.2-7.8-1.8-15 .9-20 3.5-6.7 8.5-9.1 14.8-11.3 10.3-3.7 11.8-3.4 19.6-9.9 5.5-5.7 9.5-12.9 14.3-18 5.1-5.5 10-8.1 17.7-6.9 8.1 1.2 15.1 6.8 21.9 16l19.6 35.6c9.5 19.9 43.1 48.4 41 68.9m-1.4-25.9c-4.1-6.6-9.6-13.6-14.4-19.6 7.1 0 14.2-2.2 16.7-8.9 2.3-6.2 0-14.9-7.4-24.9-13.5-18.2-38.3-32.5-38.3-32.5-13.5-8.4-21.1-18.7-24.6-29.9s-3-23.3-.3-35.2c5.2-22.9 18.6-45.2 27.2-59.2 2.3-1.7.8 3.2-8.7 20.8-8.5 16.1-24.4 53.3-2.6 82.4.6-20.7 5.5-41.8 13.8-61.5 12-27.4 37.3-74.9 39.3-112.7 1.1.8 4.6 3.2 6.2 4.1 4.6 2.7 8.1 6.7 12.6 10.3 12.4 10 28.5 9.2 42.4 1.2 6.2-3.5 11.2-7.5 15.9-9 9.9-3.1 17.8-8.6 22.3-15 7.7 30.4 25.7 74.3 37.2 95.7 6.1 11.4 18.3 35.5 23.6 64.6 3.3-.1 7 .4 10.9 1.4 13.8-35.7-11.7-74.2-23.3-84.9-4.7-4.6-4.9-6.6-2.6-6.5 12.6 11.2 29.2 33.7 35.2 59 2.8 11.6 3.3 23.7.4 35.7 16.4 6.8 35.9 17.9 30.7 34.8-2.2-.1-3.2 0-4.2 0 3.2-10.1-3.9-17.6-22.8-26.1-19.6-8.6-36-8.6-38.3 12.5-12.1 4.2-18.3 14.7-21.4 27.3-2.8 11.2-3.6 24.7-4.4 39.9-.5 7.7-3.6 18-6.8 29-32.1 22.9-76.7 32.9-114.3 7.2m257.4-11.5c-.9 16.8-41.2 19.9-63.2 46.5-13.2 15.7-29.4 24.4-43.6 25.5s-26.5-4.8-33.7-19.3c-4.7-11.1-2.4-23.1 1.1-36.3 3.7-14.2 9.2-28.8 9.9-40.6.8-15.2 1.7-28.5 4.2-38.7 2.6-10.3 6.6-17.2 13.7-21.1.3-.2.7-.3 1-.5.8 13.2 7.3 26.6 18.8 29.5 12.6 3.3 30.7-7.5 38.4-16.3 9-.3 15.7-.9 22.6 5.1 9.9 8.5 7.1 30.3 17.1 41.6 10.6 11.6 14 19.5 13.7 24.6M173.3 148.7c2 1.9 4.7 4.5 8 7.1 6.6 5.2 15.8 10.6 27.3 10.6 11.6 0 22.5-5.9 31.8-10.8 4.9-2.6 10.9-7 14.8-10.4s5.9-6.3 3.1-6.6-2.6 2.6-6 5.1c-4.4 3.2-9.7 7.4-13.9 9.8-7.4 4.2-19.5 10.2-29.9 10.2s-18.7-4.8-24.9-9.7c-3.1-2.5-5.7-5-7.7-6.9-1.5-1.4-1.9-4.6-4.3-4.9-1.4-.1-1.8 3.7 1.7 6.5"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LUG @ USTC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Limiter
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C9.76 2 7.78 3.05 6.5 4.68l1.43 1.43C8.84 4.84 10.32 4 12 4a5 5 0 0 1 5 5c0 1.68-.84 3.16-2.11 4.06l1.42 1.44C17.94 13.21 19 11.24 19 9a7 7 0 0 0-7-7M3.28 4 2 5.27 5.04 8.3C5 8.53 5 8.76 5 9c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h5.73l4 4L20 20.72zm3.95 6.5 5.5 5.5H10v-2.42a5 5 0 0 1-2.77-3.08M9 20v1a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11h3v2h-3zM1 11h3v2H1zM13 1v3h-2V1zM4.92 3.5l2.13 2.14-1.42 1.41L3.5 4.93zm12.03 2.13 2.12-2.13 1.43 1.43-2.13 2.12zM12 6a6 6 0 0 1 6 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-1.8c-1.79-1.04-3-2.98-3-5.2a6 6 0 0 1 6-6m2 15v1a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-1zm-3-3h2v-2.13c1.73-.44 3-2.01 3-3.87a4 4 0 0 0-4-4 4 4 0 0 0-4 4c0 1.86 1.27 3.43 3 3.87z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ustclug/documentations" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.01 8.01 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27s-1.36.09-2 .27c-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8"/></svg>
  </div>
  <div class="md-source__repository">
    ustclug/documentations
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="LUG @ USTC" class="md-nav__button md-logo" aria-label="LUG @ USTC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M220.8 123.3c1 .5 1.8 1.7 3 1.7 1.1 0 2.8-.4 2.9-1.5.2-1.4-1.9-2.3-3.2-2.9-1.7-.7-3.9-1-5.5-.1-.4.2-.8.7-.6 1.1.3 1.3 2.3 1.1 3.4 1.7m-21.9 1.7c1.2 0 2-1.2 3-1.7 1.1-.6 3.1-.4 3.5-1.6.2-.4-.2-.9-.6-1.1-1.6-.9-3.8-.6-5.5.1-1.3.6-3.4 1.5-3.2 2.9.1 1 1.8 1.5 2.8 1.4M420 403.8c-3.6-4-5.3-11.6-7.2-19.7-1.8-8.1-3.9-16.8-10.5-22.4-1.3-1.1-2.6-2.1-4-2.9-1.3-.8-2.7-1.5-4.1-2 9.2-27.3 5.6-54.5-3.7-79.1-11.4-30.1-31.3-56.4-46.5-74.4-17.1-21.5-33.7-41.9-33.4-72C311.1 85.4 315.7.1 234.8 0 132.4-.2 158 103.4 156.9 135.2c-1.7 23.4-6.4 41.8-22.5 64.7-18.9 22.5-45.5 58.8-58.1 96.7-6 17.9-8.8 36.1-6.2 53.3-6.5 5.8-11.4 14.7-16.6 20.2-4.2 4.3-10.3 5.9-17 8.3s-14 6-18.5 14.5c-2.1 3.9-2.8 8.1-2.8 12.4 0 3.9.6 7.9 1.2 11.8 1.2 8.1 2.5 15.7.8 20.8-5.2 14.4-5.9 24.4-2.2 31.7 3.8 7.3 11.4 10.5 20.1 12.3 17.3 3.6 40.8 2.7 59.3 12.5 19.8 10.4 39.9 14.1 55.9 10.4 11.6-2.6 21.1-9.6 25.9-20.2 12.5-.1 26.3-5.4 48.3-6.6 14.9-1.2 33.6 5.3 55.1 4.1.6 2.3 1.4 4.6 2.5 6.7v.1c8.3 16.7 23.8 24.3 40.3 23 16.6-1.3 34.1-11 48.3-27.9 13.6-16.4 36-23.2 50.9-32.2 7.4-4.5 13.4-10.1 13.9-18.3.4-8.2-4.4-17.3-15.5-29.7M223.7 87.3c9.8-22.2 34.2-21.8 44-.4 6.5 14.2 3.6 30.9-4.3 40.4-1.6-.8-5.9-2.6-12.6-4.9 1.1-1.2 3.1-2.7 3.9-4.6 4.8-11.8-.2-27-9.1-27.3-7.3-.5-13.9 10.8-11.8 23-4.1-2-9.4-3.5-13-4.4-1-6.9-.3-14.6 2.9-21.8M183 75.8c10.1 0 20.8 14.2 19.1 33.5-3.5 1-7.1 2.5-10.2 4.6 1.2-8.9-3.3-20.1-9.6-19.6-8.4.7-9.8 21.2-1.8 28.1 1 .8 1.9-.2-5.9 5.5-15.6-14.6-10.5-52.1 8.4-52.1m-13.6 60.7c6.2-4.6 13.6-10 14.1-10.5 4.7-4.4 13.5-14.2 27.9-14.2 7.1 0 15.6 2.3 25.9 8.9 6.3 4.1 11.3 4.4 22.6 9.3 8.4 3.5 13.7 9.7 10.5 18.2-2.6 7.1-11 14.4-22.7 18.1-11.1 3.6-19.8 16-38.2 14.9-3.9-.2-7-1-9.6-2.1-8-3.5-12.2-10.4-20-15-8.6-4.8-13.2-10.4-14.7-15.3q-2.1-7.35 4.2-12.3m3.3 334c-2.7 35.1-43.9 34.4-75.3 18-29.9-15.8-68.6-6.5-76.5-21.9-2.4-4.7-2.4-12.7 2.6-26.4v-.2c2.4-7.6.6-16-.6-23.9-1.2-7.8-1.8-15 .9-20 3.5-6.7 8.5-9.1 14.8-11.3 10.3-3.7 11.8-3.4 19.6-9.9 5.5-5.7 9.5-12.9 14.3-18 5.1-5.5 10-8.1 17.7-6.9 8.1 1.2 15.1 6.8 21.9 16l19.6 35.6c9.5 19.9 43.1 48.4 41 68.9m-1.4-25.9c-4.1-6.6-9.6-13.6-14.4-19.6 7.1 0 14.2-2.2 16.7-8.9 2.3-6.2 0-14.9-7.4-24.9-13.5-18.2-38.3-32.5-38.3-32.5-13.5-8.4-21.1-18.7-24.6-29.9s-3-23.3-.3-35.2c5.2-22.9 18.6-45.2 27.2-59.2 2.3-1.7.8 3.2-8.7 20.8-8.5 16.1-24.4 53.3-2.6 82.4.6-20.7 5.5-41.8 13.8-61.5 12-27.4 37.3-74.9 39.3-112.7 1.1.8 4.6 3.2 6.2 4.1 4.6 2.7 8.1 6.7 12.6 10.3 12.4 10 28.5 9.2 42.4 1.2 6.2-3.5 11.2-7.5 15.9-9 9.9-3.1 17.8-8.6 22.3-15 7.7 30.4 25.7 74.3 37.2 95.7 6.1 11.4 18.3 35.5 23.6 64.6 3.3-.1 7 .4 10.9 1.4 13.8-35.7-11.7-74.2-23.3-84.9-4.7-4.6-4.9-6.6-2.6-6.5 12.6 11.2 29.2 33.7 35.2 59 2.8 11.6 3.3 23.7.4 35.7 16.4 6.8 35.9 17.9 30.7 34.8-2.2-.1-3.2 0-4.2 0 3.2-10.1-3.9-17.6-22.8-26.1-19.6-8.6-36-8.6-38.3 12.5-12.1 4.2-18.3 14.7-21.4 27.3-2.8 11.2-3.6 24.7-4.4 39.9-.5 7.7-3.6 18-6.8 29-32.1 22.9-76.7 32.9-114.3 7.2m257.4-11.5c-.9 16.8-41.2 19.9-63.2 46.5-13.2 15.7-29.4 24.4-43.6 25.5s-26.5-4.8-33.7-19.3c-4.7-11.1-2.4-23.1 1.1-36.3 3.7-14.2 9.2-28.8 9.9-40.6.8-15.2 1.7-28.5 4.2-38.7 2.6-10.3 6.6-17.2 13.7-21.1.3-.2.7-.3 1-.5.8 13.2 7.3 26.6 18.8 29.5 12.6 3.3 30.7-7.5 38.4-16.3 9-.3 15.7-.9 22.6 5.1 9.9 8.5 7.1 30.3 17.1 41.6 10.6 11.6 14 19.5 13.7 24.6M173.3 148.7c2 1.9 4.7 4.5 8 7.1 6.6 5.2 15.8 10.6 27.3 10.6 11.6 0 22.5-5.9 31.8-10.8 4.9-2.6 10.9-7 14.8-10.4s5.9-6.3 3.1-6.6-2.6 2.6-6 5.1c-4.4 3.2-9.7 7.4-13.9 9.8-7.4 4.2-19.5 10.2-29.9 10.2s-18.7-4.8-24.9-9.7c-3.1-2.5-5.7-5-7.7-6.9-1.5-1.4-1.9-4.6-4.3-4.9-1.4-.1-1.8 3.7 1.7 6.5"/></svg>

    </a>
    LUG @ USTC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ustclug/documentations" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.01 8.01 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27s-1.36.09-2 .27c-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8"/></svg>
  </div>
  <div class="md-source__repository">
    ustclug/documentations
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Workflow
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../workflow/new-server/" class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 13c.7 0 1.37.13 2 .35V9l-6-6H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h8.35c-.22-.63-.35-1.3-.35-2 0-3.31 2.69-6 6-6m-5-8.5 5.5 5.5H14zm8.5 12.75L17.75 22 15 19l1.16-1.16 1.59 1.59 3.59-3.59z"/></svg>
  
  <span class="md-ellipsis">
    New Server Setup Checklist
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../workflow/mirrors/maintenance/" class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 7c0-2.21 3.58-4 8-4s8 1.79 8 4-3.58 4-8 4-8-1.79-8-4m8.08 11H12c-4.42 0-8-1.79-8-4v3c0 2.21 3.58 4 8 4h.29a7.4 7.4 0 0 1-.29-2c0-.34.03-.67.08-1M20 12.08V9c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4h.69c1.13-2.37 3.53-4 6.31-4 .34 0 .67.03 1 .08m3.8 8.32c.1 0 .1.1 0 .2l-1 1.7c-.1.1-.2.1-.3.1l-1.2-.4c-.3.2-.5.3-.8.5l-.2 1.3c0 .1-.1.2-.2.2h-2c-.1 0-.2-.1-.3-.2l-.2-1.3c-.3-.1-.6-.3-.8-.5l-1.2.5c-.1 0-.2 0-.3-.1l-1-1.7c-.1-.1 0-.2.1-.3l1.1-.8v-1l-1.1-.8c-.1-.1-.1-.2-.1-.3l1-1.7c.1-.1.2-.1.3-.1l1.2.5c.3-.2.5-.3.8-.5l.2-1.3c0-.1.1-.2.3-.2h2c.1 0 .2.1.2.2l.2 1.3c.3.1.6.3.9.5l1.2-.5c.1 0 .3 0 .3.1l1 1.7c.1.1 0 .2-.1.3l-1.1.8v1zM20.5 19c0-.8-.7-1.5-1.5-1.5s-1.5.7-1.5 1.5.7 1.5 1.5 1.5 1.5-.7 1.5-1.5"/></svg>
  
  <span class="md-ellipsis">
    Mirrors maintenance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../workflow/new-vm/" class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 14h2v3h3v2h-3v3h-2v-3h-3v-2h3zm-6 2L2 9l9-7 9 7zm0 2.54 1-.79V18c0 .71.12 1.39.35 2L11 21.07l-9-7 1.62-1.26z"/></svg>
  
  <span class="md-ellipsis">
    New VM in Proxmox VE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../workflow/ldap/add-new-user/" class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 14c-2.67 0-8 1.33-8 4v2h16v-2c0-2.67-5.33-4-8-4m-9-4V7H4v3H1v2h3v3h2v-3h3v-2m6 2a4 4 0 0 0 4-4 4 4 0 0 0-4-4 4 4 0 0 0-4 4 4 4 0 0 0 4 4"/></svg>
  
  <span class="md-ellipsis">
    Add New User in LDAP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../infrastructure/intranet/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 19h1a1 1 0 0 1 1 1h7v2h-7a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1H2v-2h7a1 1 0 0 1 1-1h1v-2H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-7zM4 3h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m5 4h1V5H9zm0 8h1v-2H9zM5 5v2h2V5zm0 8v2h2v-2z"/></svg>
  
  <span class="md-ellipsis">
    Intranet
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Intranet
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/tinc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tinc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/intranet/lugivpn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LUGi VPN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/intranet/gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gateway
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Proxmox Cluster
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Proxmox Cluster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/proxmox/pve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proxmox VE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/proxmox/pbs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proxmox Backup Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/proxmox/nfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NFS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/ldap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDAP: Servers Unified Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/sshca/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH Certificate Authority
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/auth-dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authoritative DNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/ssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSL Certificates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/office/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Office 365 and Mail
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/dockerhub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Hub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/mail/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mail Agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/raid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RAID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../infrastructure/discontinued/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0M3.965 13.096a6.5 6.5 0 0 0 9.131-9.131ZM1.5 8a6.47 6.47 0 0 0 1.404 4.035l9.131-9.131A6.499 6.499 0 0 0 1.5 8"/></svg>
  
  <span class="md-ellipsis">
    Discontinued Infrastructure
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_13" id="__nav_3_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_13">
            <span class="md-nav__icon md-icon"></span>
            Discontinued Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/google/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    G Suite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_13_3" >
        
          
          <label class="md-nav__link" for="__nav_3_13_3" id="__nav_3_13_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    vSphere Cluster
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_13_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_13_3">
            <span class="md-nav__icon md-icon"></span>
            vSphere Cluster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/discontinued/vsphere/esxi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ESXi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/discontinued/vsphere/vcenter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vCenter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastructure/discontinued/vsphere/vdp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VDP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M211 7.3C205 1 196-1.4 187.6.8s-14.9 8.9-17.1 17.3l-15.8 62.5-62-17.5c-8.4-2.4-17.4 0-23.5 6.1s-8.5 15.1-6.1 23.5l17.5 62-62.5 15.9c-8.4 2.1-15 8.7-17.3 17.1S1 205 7.3 211l46.2 45-46.2 45c-6.3 6-8.7 15-6.5 23.4s8.9 14.9 17.3 17.1l62.5 15.8-17.5 62c-2.4 8.4 0 17.4 6.1 23.5s15.1 8.5 23.5 6.1l62-17.5 15.8 62.5c2.1 8.4 8.7 15 17.1 17.3s17.3-.2 23.4-6.4l45-46.2 45 46.2c6.1 6.2 15 8.7 23.4 6.4s14.9-8.9 17.1-17.3l15.8-62.5 62 17.5c8.4 2.4 17.4 0 23.5-6.1s8.5-15.1 6.1-23.5l-17.5-62 62.5-15.8c8.4-2.1 15-8.7 17.3-17.1s-.2-17.4-6.4-23.4l-46.2-45 46.2-45c6.2-6.1 8.7-15 6.4-23.4s-8.9-14.9-17.3-17.1l-62.5-15.8 17.5-62c2.4-8.4 0-17.4-6.1-23.5s-15.1-8.5-23.5-6.1l-62 17.5-15.9-62.5c-2.1-8.4-8.7-15-17.1-17.3S307 1 301 7.3l-45 46.2z"/></svg>
  
  <span class="md-ellipsis">
    Services
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m8.29 10.28 3.24-3.25 1.06 1.06-3.24 3.25zm.41 4.33 5.66-5.66L15.42 10l-5.66 5.67zM18 3v18H6V3zm2-2H4v22h16z"/></svg>
  
  <span class="md-ellipsis">
    Mirrors
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Mirrors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
          
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../4/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Current (4)
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            Current (4)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4/volumes-old/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Volumes (Old)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4/networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4/networking/route/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networking - Routing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4/networking/misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networking - Misc
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../3/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Auxiliary (3)
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            Auxiliary (3)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../2/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Auxiliary (2)
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4">
            <span class="md-nav__icon md-icon"></span>
            Auxiliary (2)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Obsolete (1)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ipmi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IPMI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repositories
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Limiter
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Limiter
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#whitelists" class="md-nav__link">
    <span class="md-ellipsis">
      白名单
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span class="md-ellipsis">
      防火墙级别限制
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application" class="md-nav__link">
    <span class="md-ellipsis">
      应用级别限制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="应用级别限制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-mod-lua" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx Lua 组件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#large-files" class="md-nav__link">
    <span class="md-ellipsis">
      大文件下载速度限制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-js-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx JavaScript 挑战
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#robots" class="md-nav__link">
    <span class="md-ellipsis">
      爬虫限制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsync-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Rsync 总连接数限制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interface-limit" class="md-nav__link">
    <span class="md-ellipsis">
      网络接口级别限制
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blacklists" class="md-nav__link">
    <span class="md-ellipsis">
      IP 黑名单限制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IP 黑名单限制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipset-persistent" class="md-nav__link">
    <span class="md-ellipsis">
      ipset 持久化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#403" class="md-nav__link">
    <span class="md-ellipsis">
      403 页面
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rsync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rsync
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway-el/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gateway EL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway-nic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gateway NIC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway-jp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gateway JP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../neat-dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Neat DNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gitlab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vpn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LUG VPN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../light/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Light
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../pxe/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    PXE
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            PXE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pxe/images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Images
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pxe/liims/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LIIMS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ftp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../generate-204/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generate 204
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mirrorz/" class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 7v2h4l-4 6v2h6v-2h-4l4-6V7zm3-5a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"/></svg>
  
  <span class="md-ellipsis">
    MirrorZ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../discontinued/" class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2c5.5 0 10 4.5 10 10s-4.5 10-10 10S2 17.5 2 12 6.5 2 12 2m0 2c-1.9 0-3.6.6-4.9 1.7l11.2 11.2c1-1.4 1.7-3.1 1.7-4.9 0-4.4-3.6-8-8-8m4.9 14.3L5.7 7.1C4.6 8.4 4 10.1 4 12c0 4.4 3.6 8 8 8 1.9 0 3.6-.6 4.9-1.7"/></svg>
  
  <span class="md-ellipsis">
    Discontinued Services
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Common Issues
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Common Issues
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/ldap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDAP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/systemd-timer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    systemd-timer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/vm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/ssd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSD Firmware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/apparmor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AppArmor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#whitelists" class="md-nav__link">
    <span class="md-ellipsis">
      白名单
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span class="md-ellipsis">
      防火墙级别限制
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application" class="md-nav__link">
    <span class="md-ellipsis">
      应用级别限制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="应用级别限制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-mod-lua" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx Lua 组件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#large-files" class="md-nav__link">
    <span class="md-ellipsis">
      大文件下载速度限制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-js-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx JavaScript 挑战
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#robots" class="md-nav__link">
    <span class="md-ellipsis">
      爬虫限制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsync-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Rsync 总连接数限制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interface-limit" class="md-nav__link">
    <span class="md-ellipsis">
      网络接口级别限制
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blacklists" class="md-nav__link">
    <span class="md-ellipsis">
      IP 黑名单限制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IP 黑名单限制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipset-persistent" class="md-nav__link">
    <span class="md-ellipsis">
      ipset 持久化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#403" class="md-nav__link">
    <span class="md-ellipsis">
      403 页面
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="_1">限制策略<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>由于 mirrors 属于 I/O、网络密集型服务，在部分的负载场景下极易出现 I/O 或网络过载。限制策略主要是为了减弱以下几类请求对 mirrors 整体服务质量的影响：</p>
<ol>
<li>突发性的高并发请求</li>
<li>爬虫类流量</li>
<li>不合理的请求（如：极少数用户的大量请求）</li>
</ol>
<h2 id="whitelists">白名单<a class="headerlink" href="#whitelists" title="Permanent link">&para;</a></h2>
<p>一般而言，科大校内的地址位于限制规则的白名单中，不受到限制策略的影响。如果没有特殊说明，科大地址默认不受限制。</p>
<p>白名单位于：</p>
<ul>
<li><code>/usr/local/network_config/iptables/ipset</code></li>
<li><code>/etc/nginx/conf.d/geo-ustcnet.conf</code></li>
</ul>
<h2 id="firewall">防火墙级别限制<a class="headerlink" href="#firewall" title="Permanent link">&para;</a></h2>
<p>防火墙 (iptables) 目前只负责限制单 IP 的并发链接数。这是为了防止同时涌入大量并发连接，导致后端应用耗费大量 CPU 和 I/O 资源处理这些不合常理的请求。</p>
<table>
<thead>
<tr>
<th style="text-align: center;">序号</th>
<th style="text-align: center;">端口</th>
<th style="text-align: center;">服务</th>
<th style="text-align: center;">最大连接数</th>
<th style="text-align: center;">IPv4 CIDR</th>
<th style="text-align: center;">IPv6 CIDR</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">80,443</td>
<td style="text-align: center;">HTTP/HTTPS</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">64</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: center;">20,21,50100:50200</td>
<td style="text-align: center;">FTP</td>
<td style="text-align: center;">4*</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">64</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: center;">873</td>
<td style="text-align: center;">Rsync</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">64</td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: center;">9418</td>
<td style="text-align: center;">Git</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">64</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">注意事项</p>
<p>连接数限制仅限制瞬时并发（connlimit）。</p>
</div>
<p>请注意，同组内的连接共享连接数配额。如：</p>
<ul>
<li>10.0.0.1 与 10.0.0.2 共享 HTTP 限额</li>
<li>1.1.1.1 发起的 HTTP 与 HTTPS 连接共享 12 个连接数限额</li>
</ul>
<p>超过配额的连接会返回 TCP Reset。</p>
<p>* FTP 服务已停止提供。</p>
<h2 id="application">应用级别限制<a class="headerlink" href="#application" title="Permanent link">&para;</a></h2>
<p>此类限制规则位于应用程序内。由于在用户态程序中实现，因此更加灵活。</p>
<h3 id="nginx-mod-lua">Nginx Lua 组件<a class="headerlink" href="#nginx-mod-lua" title="Permanent link">&para;</a></h3>
<p>代码位于 <a href="https://git.lug.ustc.edu.cn/mirrors/nginx-config/blob/master/lua/module/access_limiter.lua">/etc/nginx/lua/module/access_limiter.lua</a></p>
<p>目前使用了 Nginx 的 Lua 语言扩展实现对请求的限制。主要有以下三类限制方式：</p>
<ol>
<li>按连接数限制（即：并发请求数）</li>
<li>按请求速率限制</li>
<li>按累计请求数限制（周期性重置计数器）</li>
</ol>
<p>目前，镜像站配置了以下几种功能的限制器：</p>
<ol>
<li>全局请求速率限制器：对所有请求，限制单 IP 的请求速率。</li>
<li>全局请求数限制器：对于所有请求，<strong>检测</strong>单 IP 在一天内的累计请求数。超过阈值后，降低该 IP 的<em>全局请求速率限制器</em>的阈值。</li>
<li><del>HEAD 请求数限制器：对于 HTTP Method = HEAD 类型的请求，<strong>检测</strong>单 IP 在一天内的累计请求数。超过阈值后，开启 <em>HEAD 请求速率限制器</em>。</del></li>
<li><del>HEAD 请求速率限制器：对于 HTTP Method = HEAD 类型的请求，限制单 IP 的请求速率。<strong>该限制器默认关闭。</strong></del></li>
<li>断点续传请求速率限制器：对于断点续传类型的请求，限制单 IP 的请求速率。</li>
<li>断点续传连接数限制器：对于断点续传类型的请求，限制单 IP <strong>单 URI</strong> 的连接数。</li>
<li>目录请求速率限制器：对于列目录类型的请求，限制单 IP 请求速率。</li>
<li>文件请求速率限制器：对于非目录类型的请求，限制<strong>单文件</strong>请求速率。即：所有用户之间共享同一个配额。</li>
</ol>
<p>例外：</p>
<ol>
<li>apt/yum 仓库的索引文件不受限制。</li>
<li>AOSP 仓库不限制全局请求数（git objects 太多了，用户反馈见 <a href="https://github.com/ustclug/discussions/issues/397"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.01 8.01 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27s-1.36.09-2 .27c-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8"/></svg></span> Issue 397</a>）；nix-channels 也不限制全局请求数（nix 包管理器默认开启 16 并发）。</li>
<li>
<p>对返回 403 的恶意请求（<a href="#robots">见下</a>），仅应用全局请求速率/请求数限制器（Main-Req 和 Main-Count），且在这两个限制器里按双倍计数；同时跳过断点续传/目录/文件限制器，避免因为恶意请求刷满了目录/文件的限额导致正常用户的访问受限。</p>
<p>例外文件的定义参考 <code>/etc/nginx/conf.d/access_limiter.conf</code>。</p>
</li>
</ol>
<p>案例：曾遇到过攻击者分布式请求同一个大文件，导致 IO、网络同时过载。基于 IP 地址的限制措施对于源地址池很大的攻击往往没有效果，限制单文件的请求速率能够有效缓解这类攻击。</p>
<p>具体参数参考下表：</p>
<table>
<thead>
<tr>
<th style="text-align: center;">限制器名称与代号</th>
<th style="text-align: center;">阈值单位</th>
<th style="text-align: center;">阈值</th>
<th style="text-align: center;">突发量</th>
<th style="text-align: center;">计数器重置周期</th>
<th style="text-align: center;">动作</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">全局请求速率限制器<br><code>Main-Req</code></td>
<td style="text-align: center;">次/秒</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;">/</td>
<td style="text-align: center;">返回 429 错误</td>
</tr>
<tr>
<td style="text-align: center;">全局请求数限制器<br><code>Main-Count</code></td>
<td style="text-align: center;">次</td>
<td style="text-align: center;">15000</td>
<td style="text-align: center;">/</td>
<td style="text-align: center;">1 天</td>
<td style="text-align: center;">设置全局请求速率限制器阈值为 0.2 次/秒</td>
</tr>
<tr>
<td style="text-align: center;">HEAD 请求数限制器<br><code>Head-Count</code></td>
<td style="text-align: center;">次</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;">/</td>
<td style="text-align: center;">1 天</td>
<td style="text-align: center;">开启 HEAD 请求速率限制器</td>
</tr>
<tr>
<td style="text-align: center;">HEAD 请求速率限制器<br><code>Head-Req</code></td>
<td style="text-align: center;">次/秒</td>
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">/</td>
<td style="text-align: center;">返回 429 错误</td>
</tr>
<tr>
<td style="text-align: center;">断点续传请求速率限制器<br><code>Partial-Req</code></td>
<td style="text-align: center;">次/秒</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">/</td>
<td style="text-align: center;">返回 429 错误</td>
</tr>
<tr>
<td style="text-align: center;">断点续传连接数限制器<br><code>Partial-Conn</code></td>
<td style="text-align: center;">条</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">/</td>
<td style="text-align: center;">返回 429 错误</td>
</tr>
<tr>
<td style="text-align: center;">目录请求速率限制器<br><code>Ls-Req</code></td>
<td style="text-align: center;">次/秒</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">/</td>
<td style="text-align: center;">返回 429 错误</td>
</tr>
<tr>
<td style="text-align: center;">文件请求速率限制器<br><code>File-Req</code></td>
<td style="text-align: center;">次/秒</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">/</td>
<td style="text-align: center;">返回 429 错误</td>
</tr>
<tr>
<td style="text-align: center;">文件请求连接数限制器<br><code>File-Conn</code></td>
<td style="text-align: center;">条</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">/</td>
<td style="text-align: center;">返回 429 错误</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">HEAD 限制器已关闭</p>
<p>考虑到 ZFS 对 dnode 的缓存非常有效，在接到 AOSC 社区的反馈后，我们完全关闭了 HEAD 请求数限制器。</p>
</div>
<details class="note">
<summary>How lua-resty-limit-traffic works</summary>
<p>限制器逻辑使用 <a href="https://github.com/openresty/lua-resty-limit-traffic">https://github.com/openresty/lua-resty-limit-traffic</a> 实现，其中上表代号分别对应其 <code>req</code>, <code>count</code>, <code>conn</code> 三种实现，<code>traffic</code> 则 aggregate 了 <code>count</code> 之外的限制器，返回最大的延迟。</p>
<p><code>req</code> 的核心公式是：<code>excess = max(excess - rate * elapsed / 1000 + 1000, 0)</code>，其中时间单位是毫秒（<code>rate</code> 和 <code>burst</code> 参数计算时都需要乘以 1000）。<code>excess</code> 会先和 <code>burst</code> 比较（如果超出，则 reject），如果没有超出，则 delay <code>excess / rate</code> 秒。</p>
<p>当 elapsed = 1000/rate 时，恰好不会增加 <code>excess</code> 的值，此时 1 秒内恰好可以容纳 rate 个请求；当 elapsed = 1000/(rate+burst) 时，<code>excess</code> 增量为 1000(1-r/(r+b))，此时 1 秒内恰好有 (rate+burst) 个请求不会被 reject。</p>
<p>理想情况下的例子：如果 rate = 40r/s = 40 * 1000 r/ms，则 elapsed 需要至少为 1/40 秒（25 毫秒），才能和后面的 <code>+ 1000</code> 抵消，否则 <code>excess</code> 会一直增加。如果 burst = 100r/s = 100 * 1000 r/ms，那么假设有用户每 1/140 秒（7.1 毫秒）访问一次，那么 <code>excess</code> 每次会增加 714.28，如果有 140 个这样的请求，那么 <code>excess</code> 的值则恰好是 <code>burst</code> 的值。</p>
<p><code>count</code> 的逻辑简单很多，使用 lua-nginx-module 带的 https://github.com/openresty/lua-nginx-module?tab=readme-ov-file#ngxshareddictincr 为每次自增设置 TTL 即可。</p>
<p><code>conn</code> 使用字典计数器统计当前连接数，如果超过了 <code>max + burst</code>，则 reject。否则如果超过了 <code>max</code> 则延迟 <code>unit_delay * floor((conn - 1) / max)</code> 秒。<code>unit_delay</code> 起始为用户给定的值，在之后会按照 <code>unit_delay = (req_latency + unit_delay) / 2</code> 定时调整。</p>
</details>
<p>到达阈值后会发生什么？</p>
<ul>
<li>当请求速率超过阈值，但未超过突发量时，限制器会计算出一个满足阈值条件的最小等待时间。连接会被丢入等待池，到达等待时间后再被处理。</li>
<li>当请求速率超过阈值，且超过突发请求量时，将会在等待 5 秒后返回 HTTP 429 错误。</li>
</ul>
<p>限制器之间相互独立，当被触发的所有限制器产生不一致的等待时间时，应用最长的等待时间。</p>
<h3 id="large-files">大文件下载速度限制<a class="headerlink" href="#large-files" title="Permanent link">&para;</a></h3>
<p>代码位于 <a href="https://git.lug.ustc.edu.cn/mirrors/nginx-config/blob/master/lua/header_filter.lua">/etc/nginx/lua/header_filter.lua</a></p>
<p>针对大文件下载，限制每个文件的总带宽为 1 Gbps，以避免大文件流量占满总带宽。</p>
<div class="admonition warning">
<p class="admonition-title">注意事项</p>
<p>如果有多个文件面临高压力访问，总带宽依然可能被占满</p>
</div>
<p>具体做法为，设置下载速度阈值 = 1 Gbps / (该大文件的同时连接数 + 1)</p>
<p>当下载的文件无穷大时，将出现最差情形，即用户被分配到的下载速率服从类调和级数，函数发散。实际情况下，早期用户下载完成后连接释放，最终带宽将收敛到 1 Gbps。</p>
<p>注：大文件定义参照目前的 Lua 脚本配置。</p>
<h3 id="nginx-js-challenge">Nginx JavaScript 挑战<a class="headerlink" href="#nginx-js-challenge" title="Permanent link">&para;</a></h3>
<p>代码位于 <a href="https://git.lug.ustc.edu.cn/mirrors/nginx-config/blob/master/lua/access-with-challenge.lua">/etc/nginx/lua/access-with-challenge.lua</a></p>
<p>为了抵抗“迅雷攻击”。对于特定类型的文件，开启了 JS 挑战。如果客户端 User-Agent 为 Mozilla（即浏览器），则发送一段包含 JS 脚本的页面，检验运行的结果。如果挑战失败，则禁止访问。</p>
<p>被保护的文件类型参见 <a href="https://git.lug.ustc.edu.cn/mirrors/nginx-config/blob/master/conf.d/map_access.conf">/etc/nginx/conf.d/map_access.conf</a>，部分内容节选如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">map</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$access_url_type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="kn">default</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="c1"># 1: large files</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="kn">&quot;~*\.(iso|exe|dmg|run|zip|tar)$&quot;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">}</span>
</code></pre></div>
<h3 id="robots">爬虫限制<a class="headerlink" href="#robots" title="Permanent link">&para;</a></h3>
<p>代码位于 <code>map_access.conf</code>（见上）和 <a href="https://git.lug.ustc.edu.cn/mirrors/nginx-config/blob/master/snippets/robots">/etc/nginx/snippets/robots</a>，利用 nginx 的 <code>map</code> 实现组合逻辑，进行如下限制：</p>
<ul>
<li>如果客户端 User-Agent 包含 Spider、Robot 等关键字，或者符合一些恶意流量的 pattern，则禁止其访问仓库内容。</li>
<li>如果客户端 User-Agent 符合另一些 pattern，则禁止其访问大文件（定义同上）。</li>
</ul>
<h3 id="rsync-connections">Rsync 总连接数限制<a class="headerlink" href="#rsync-connections" title="Permanent link">&para;</a></h3>
<p>Rsync 服务设置了总连接数限制。即：当建立的连接数到达某个阈值后，拒绝之后收到的连接。</p>
<div class="admonition note">
<p class="admonition-title">历史记录</p>
<p>以前 HTTP 和 Rsync 服务由同一台服务器提供，由于白天 HTTP 访问压力较大，夜晚 HTTP 访问量较小，为了实现错峰同步，保证白天 HTTP 的服务质量，因此针对不同时段设置了不同的阈值，具体如下：</p>
<ul>
<li>23:00 ~ 8:00：最多 60 个连接</li>
<li>8:00 ~ 23:00：最多 30 个连接</li>
</ul>
</div>
<p>在 2020 年 8 月 25 日后，由于更换了新服务器，Rsync 由单独机器提供服务，总连接数提升到了全天 60 个连接。</p>
<p>特别的，科大校内 IP 地址受到 rsync 连接数限制。</p>
<h2 id="interface-limit">网络接口级别限制<a class="headerlink" href="#interface-limit" title="Permanent link">&para;</a></h2>
<p>mirrors 常态下没有网络接口限制，但在需要临时对某一接口进行限制时，可以使用 tc 来完成。</p>
<p>例如可以参考这份回答：<a href="https://serverfault.com/questions/452829/limiting-interface-bandwidth-with-tc-under-linux">iptables - Limiting interface bandwidth with tc under Linux - Server Fault</a>，使用如下指令限制某一接口的网络速率为 1.5Gbps：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>tc<span class="w"> </span>qdisc<span class="w"> </span>add<span class="w"> </span>dev<span class="w"> </span>&lt;interface&gt;<span class="w"> </span>root<span class="w"> </span>handle<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>tbf<span class="w"> </span>rate<span class="w"> </span>1500Mbit<span class="w"> </span>burst<span class="w"> </span>750K<span class="w"> </span>latency<span class="w"> </span>14ms
</code></pre></div>
<p>这里使用了 TBF（令牌桶）算法，后面的 burst 和 latency 参数意义可以参见 <code>man tc-tbf</code>。
具体而言，latency 没有推荐值，但 burst 要求至少为 <code>rate / HZ</code>，HZ = 100 时 10Mbps 至少约 10MB。
HZ 的值需要从内核的编译参数中查看：<code>egrep '^CONFIG_HZ_[0-9]+' /boot/config-`uname -r`</code>。现代发行版提供的内核中这个值一般为 250。</p>
<p>参考资料：<a href="https://unix.stackexchange.com/a/100797/211239">Bucket size in tbf</a></p>
<p>目前部署的限制有：</p>
<ul>
<li>unicom 1500Mbit（学校出口带宽 2 Gbps）</li>
<li>telecom 2500Mbit（学校出口带宽 10 Gbps）</li>
</ul>
<p>在 mirrors4 上该配置的开机自启分别位于 <code>tc-unicom.service</code> 和 <code>tc-telecom.service</code> 两个服务中，其中 <code>tc-unicom.service</code> 配置如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">[Unit]</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="na">Description</span><span class="o">=</span><span class="s">Rate Limiting for Unicom Interface</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="k">[Service]</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="na">Type</span><span class="o">=</span><span class="s">oneshot</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="na">RemainAfterExit</span><span class="o">=</span><span class="s">true</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/sbin/tc qdisc replace dev unicom root handle 1: tbf rate 1500Mbit burst 750K latency 14ms</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="na">ExecStop</span><span class="o">=</span><span class="s">/usr/sbin/tc qdisc delete dev unicom root handle 1</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="k">[Install]</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="na">WantedBy</span><span class="o">=</span><span class="s">sys-subsystem-net-devices-unicom.device</span>
</code></pre></div>
<p>Install 部分的 WantedBy 使用这种写法可以使该服务依赖于名为 <code>unicom</code> 的网口，详细回答可以看 <a href="https://serverfault.com/a/869916/450575">What is the systemd-networkd equivalent of post-up?</a>。</p>
<h2 id="blacklists">IP 黑名单限制<a class="headerlink" href="#blacklists" title="Permanent link">&para;</a></h2>
<p>对于滥用的 IP 段，可以使用 ipset 和 iptables 实现黑名单限制。
ipset 将某个 IP 匹配到一个集合中，iptables 再针对某一集合进行限制。</p>
<p>ipset 和 iptables 的使用可以参考：<a href="https://wiki.archlinux.org/title/Ipset_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Ipset - Arch Wiki</a> 。</p>
<p>我们已在 mirrors4 上配置了 <code>blacklist</code> 和 <code>blacklist6</code> 集合，若要封禁某个 IP 或网段，可以直接将该网段加入集合，例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>ipset<span class="w"> </span>add<span class="w"> </span>blacklist<span class="w"> </span><span class="m">192</span>.0.2.0/24
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>ipset<span class="w"> </span>add<span class="w"> </span>blacklist6<span class="w"> </span><span class="m">2001</span>:db8:114:514::/64
</code></pre></div>
<p>与 iptables 类似，ipset 也需要持久化。封禁名单的文件位于（mirrors4）<code>/usr/local/network_config/iptables/blacklist.list</code>，修改此文件增减条目后运行该目录下的 <code>apply.sh</code> 即可。</p>
<p>由于封禁仅对新建立的连接有效，请在修改封禁名单后，使用 <code>ss -K dst 对应的网段</code> 关闭已经建立的连接（例如对于以上两行规则，命令分别为 <code>ss -K dst 192.0.2.0/24</code> 与 <code>ss -K dst 2001:db8:114:514::/64</code>）。</p>
<h3 id="ipset-persistent">ipset 持久化<a class="headerlink" href="#ipset-persistent" title="Permanent link">&para;</a></h3>
<p>我们使用软件源里的 <code>ipset-persistent</code> 包来帮助 ipset 在开机时自动恢复，该软件包会在开机加载 iptables 前先从 <code>/etc/iptables/ipsets</code> 中恢复 ipset 以确保 iptables 中的引用能正确处理。</p>
<p>因为 ipset-persistent 在开机时自动加载，我们选择仅加载一个较小的子集，包含必要配置（create set）和较少发生变化的内容（如 ustcnet 的网段）。目前 <code>/etc/iptables/ipsets</code> 包含以下内容：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>create<span class="w"> </span>ustcnet<span class="w"> </span>hash:net<span class="w"> </span>family<span class="w"> </span>inet<span class="w"> </span>hashsize<span class="w"> </span><span class="m">1024</span><span class="w"> </span>maxelem<span class="w"> </span><span class="m">65536</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>create<span class="w"> </span>f2b-sshd<span class="w"> </span>hash:ip<span class="w"> </span>family<span class="w"> </span>inet<span class="w"> </span>hashsize<span class="w"> </span><span class="m">1024</span><span class="w"> </span>maxelem<span class="w"> </span><span class="m">65536</span><span class="w"> </span>timeout<span class="w"> </span><span class="m">3600</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>create<span class="w"> </span>blacklist<span class="w"> </span>hash:net<span class="w"> </span>family<span class="w"> </span>inet<span class="w"> </span>hashsize<span class="w"> </span><span class="m">1024</span><span class="w"> </span>maxelem<span class="w"> </span><span class="m">65536</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>create<span class="w"> </span>blacklist6<span class="w"> </span>hash:net<span class="w"> </span>family<span class="w"> </span>inet6<span class="w"> </span>hashsize<span class="w"> </span><span class="m">1024</span><span class="w"> </span>maxelem<span class="w"> </span><span class="m">65536</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>add<span class="w"> </span>ustcnet<span class="w"> </span><span class="m">202</span>.38.64.0/19
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1"># more ustcnet entries...</span>
</code></pre></div>
<h3 id="403" page="page">403 页面<a class="headerlink" href="#403" title="Permanent link">&para;</a></h3>
<p>目前 mirrors4 将来源 IP 属于 <code>blacklist</code> 或 <code>blacklist6</code> 集合且目标端口为 80 或 443 的连接重定向至 403 端口。403 页面位于 <code>/var/www/html/403.html</code>。</p>
<p>相关 nginx 配置位于 <a href="https://git.lug.ustc.edu.cn/mirrors/nginx-config/-/blob/master/sites-available/mirrors.ustc.edu.cn-403">/etc/nginx/sites-available/mirrors.ustc.edu.cn-403</a>。</p>
<p>我们使用 <code>ip{,6}tables</code> 将对 80 或 443 端口的访问重定向至 403 端口，在 <code>nat</code> 表的 <code>PREROUTING</code> 链添加规则：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>-A<span class="w"> </span>PREROUTING<span class="w"> </span>-m<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--match-set<span class="w"> </span>blacklist<span class="w"> </span>src<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>multiport<span class="w"> </span>--dports<span class="w"> </span><span class="m">80</span>,443<span class="w"> </span>-j<span class="w"> </span>REDIRECT<span class="w"> </span>--to-port<span class="w"> </span><span class="m">403</span>
</code></pre></div>
<p>并在 <code>filter</code> 表 <code>BLACKLIST</code> 链放行已建立连接，对 403 端口限速：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>-A<span class="w"> </span>BLACKLIST<span class="w"> </span>-m<span class="w"> </span>conntrack<span class="w"> </span>--ctstate<span class="w"> </span>ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>RETURN
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>-A<span class="w"> </span>BLACKLIST<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">403</span><span class="w"> </span>-m<span class="w"> </span>hashlimit<span class="w"> </span>--hashlimit-upto<span class="w"> </span><span class="m">60</span>/min<span class="w"> </span>--hashlimit-burst<span class="w"> </span><span class="m">5</span><span class="w"> </span>--hashlimit-mode<span class="w"> </span>srcip<span class="w"> </span>--hashlimit-srcmask<span class="w"> </span><span class="m">64</span><span class="w"> </span>--hashlimit-name<span class="w"> </span>nginx-403<span class="w"> </span>--hashlimit-htable-expire<span class="w"> </span><span class="m">60000</span><span class="w"> </span>-j<span class="w"> </span>RETURN
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>-A<span class="w"> </span>BLACKLIST<span class="w"> </span>-j<span class="w"> </span>DROP
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2003-2021 USTC Linux User Group. <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://lug.ustc.edu.cn/" target="_blank" rel="noopener" title="lug.ustc.edu.cn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0M5.78 8.75a9.64 9.64 0 0 0 1.363 4.177q.383.64.857 1.215c.245-.296.551-.705.857-1.215A9.64 9.64 0 0 0 10.22 8.75Zm4.44-1.5a9.64 9.64 0 0 0-1.363-4.177c-.307-.51-.612-.919-.857-1.215a10 10 0 0 0-.857 1.215A9.64 9.64 0 0 0 5.78 7.25Zm-5.944 1.5H1.543a6.51 6.51 0 0 0 4.666 5.5q-.184-.271-.352-.552c-.715-1.192-1.437-2.874-1.581-4.948m-2.733-1.5h2.733c.144-2.074.866-3.756 1.58-4.948q.18-.295.353-.552a6.51 6.51 0 0 0-4.666 5.5m10.181 1.5c-.144 2.074-.866 3.756-1.58 4.948q-.18.296-.353.552a6.51 6.51 0 0 0 4.666-5.5Zm2.733-1.5a6.51 6.51 0 0 0-4.666-5.5q.184.272.353.552c.714 1.192 1.436 2.874 1.58 4.948Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/ustclug" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.01 8.01 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27s-1.36.09-2 .27c-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "navigation.indexes", "navigation.sections", "navigation.top"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>