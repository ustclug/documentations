{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"LUG @ USTC Documentation \u00b6 Documentation for LUG @ USTC technical infrastructure. References \u00b6 LUG @ USTC homepage sparanoid/chinese-copywriting-guidelines: Chinese copywriting guidelines for better written communication\uff0f\u4e2d\u6587\u6587\u6848\u6392\u7248\u6307\u5317 Material for MkDocs This repository (click the icon on the top-right)","title":"Index"},{"location":"#lug-ustc-documentation","text":"Documentation for LUG @ USTC technical infrastructure.","title":"LUG @ USTC Documentation"},{"location":"#references","text":"LUG @ USTC homepage sparanoid/chinese-copywriting-guidelines: Chinese copywriting guidelines for better written communication\uff0f\u4e2d\u6587\u6587\u6848\u6392\u7248\u6307\u5317 Material for MkDocs This repository (click the icon on the top-right)","title":"References"},{"location":"faq/dns/","text":"DNS \u57df\u540d\u89e3\u6790\u95ee\u9898 \u00b6 \u9519\u8bef\u7684\u89e3\u6790\u7ed3\u679c \u00b6 \u6211\u4eec\u7684 DNS \u662f\u5206\u6821\u5185\u5916\u3001\u5206 ISP \u89e3\u6790\u7684\u3002\u6709\u65f6\u5019\u4f1a\u9047\u5230\u6821\u5185\u8bbf\u95ee\u89e3\u6790\u5230\u6821\u5916\uff0c\u53ef\u80fd\u7684\u539f\u56e0\u662f /etc/resolv.conf \u987a\u5e8f\u4e0d\u5bf9 iBug \u5728 2020 \u5e74 5 \u6708 21 \u65e5\u4fee\u4e86 gw-el \u548c mirrors2\uff0c\u8fd9\u4e24\u4e2a\u673a\u5668\u4e0a\u539f\u5148\u6392\u5728\u6700\u524d\u9762\u7684 nameserver \u5c31\u662f 8.8.4.4 \u6216\u8005 1.1.1.1 \u4e4b\u7c7b\u7684 \u6211\u4eec\u7684\u6743\u5a01\u670d\u52a1\u5668\u4e24\u4e2a\u5728\u6821\u5185\u4e00\u4e2a\u5728\u56fd\u5185\uff0c\u56e0\u6b64\u6821\u5185\u673a\u5668\u5e94\u8be5\u4f18\u5148\u4ece\u6821\u5185\u89e3\u6790\u3002\u628a 202.38.64.1 / 2001:da8:d800::1\uff08\u5b66\u6821\u7684 DNS\uff09\u653e\u6700\u524d\u9762\u80af\u5b9a\u6ca1\u9519 \u5982\u679c IPv4 \u89e3\u6790\u6b63\u786e\u4f46\u662f IPv6 \u8fd8\u662f\u89e3\u6790\u5230\u6821\u5916\u7684\u8bdd\uff0c /etc/resolv.conf \u7f3a\u5c11 IPv6 \u6761\u76ee taoky \u5728 2020 \u5e74 5 \u6708 29 \u65e5\u53d1\u73b0\u7684\uff0cmirrors2 \u4e0a\u8bbf\u95ee servers.ustclug.org \u8fd4\u56de Cloudflare \u7684 522 \u9519\u8bef\u9875\u9762\uff08\u6b64\u65f6 \u65e5\u672c\u53cd\u4ee3\u6302\u6389\u4e86 \uff09\uff0c\u7ecf\u67e5\u5c3d\u7ba1 IPv4 \u6b63\u786e\u89e3\u6790\u5230\u4e86 gw-el \u4e0a\uff0c\u4f46\u662f IPv6 \u8fd8\u662f\u89e3\u6790\u5230\u4e86 Cloudflare \u4e0a\uff0c\u4e14 nslookup \u548c dig \u7b49\u5de5\u5177\u8f93\u51fa\u770b\u8d77\u6765\u90fd\u662f\u5bf9\u7684\u3002 \u6392\u67e5\u53d1\u73b0 /etc/resolv.conf \u91cc\u6ca1\u6709 IPv6 \u7684\u670d\u52a1\u5668\u6761\u76ee\uff0c\u5728\u9760\u524d\u7684\u4f4d\u7f6e\u63d2\u5165 nameserver 2001:da8:d800::1 \u540e\u89e3\u51b3\u3002 \u624b\u52a8\u6e05\u7a7a\u672c\u673a\u7684 DNS \u7f13\u5b58\uff1a nscd -i hosts \u6709\u65f6\u5019\u53ef\u80fd\u4f1a\u5728 DNS \u66f4\u65b0\u540e\u968f\u673a\u89e3\u6790\u51fa\u65b0\u65e7\u7ed3\u679c\uff0c\u53ef\u80fd\u7684\u539f\u56e0\u662f ns-a \u6ca1\u66f4\u65b0 ns-a \u673a\u5668\u6bd4\u8f83\u8001\u65e7\uff0c\u7f51\u7edc\u53ef\u80fd\u4e0d\u987a\u7545\uff0c\u624b\u52a8\u628a ns-a \u66f4\u65b0\u4e00\u4e0b\u5c31\u884c\u4e86\uff08","title":"DNS"},{"location":"faq/dns/#dns","text":"","title":"DNS \u57df\u540d\u89e3\u6790\u95ee\u9898"},{"location":"faq/dns/#wrong-dns-result","text":"\u6211\u4eec\u7684 DNS \u662f\u5206\u6821\u5185\u5916\u3001\u5206 ISP \u89e3\u6790\u7684\u3002\u6709\u65f6\u5019\u4f1a\u9047\u5230\u6821\u5185\u8bbf\u95ee\u89e3\u6790\u5230\u6821\u5916\uff0c\u53ef\u80fd\u7684\u539f\u56e0\u662f /etc/resolv.conf \u987a\u5e8f\u4e0d\u5bf9 iBug \u5728 2020 \u5e74 5 \u6708 21 \u65e5\u4fee\u4e86 gw-el \u548c mirrors2\uff0c\u8fd9\u4e24\u4e2a\u673a\u5668\u4e0a\u539f\u5148\u6392\u5728\u6700\u524d\u9762\u7684 nameserver \u5c31\u662f 8.8.4.4 \u6216\u8005 1.1.1.1 \u4e4b\u7c7b\u7684 \u6211\u4eec\u7684\u6743\u5a01\u670d\u52a1\u5668\u4e24\u4e2a\u5728\u6821\u5185\u4e00\u4e2a\u5728\u56fd\u5185\uff0c\u56e0\u6b64\u6821\u5185\u673a\u5668\u5e94\u8be5\u4f18\u5148\u4ece\u6821\u5185\u89e3\u6790\u3002\u628a 202.38.64.1 / 2001:da8:d800::1\uff08\u5b66\u6821\u7684 DNS\uff09\u653e\u6700\u524d\u9762\u80af\u5b9a\u6ca1\u9519 \u5982\u679c IPv4 \u89e3\u6790\u6b63\u786e\u4f46\u662f IPv6 \u8fd8\u662f\u89e3\u6790\u5230\u6821\u5916\u7684\u8bdd\uff0c /etc/resolv.conf \u7f3a\u5c11 IPv6 \u6761\u76ee taoky \u5728 2020 \u5e74 5 \u6708 29 \u65e5\u53d1\u73b0\u7684\uff0cmirrors2 \u4e0a\u8bbf\u95ee servers.ustclug.org \u8fd4\u56de Cloudflare \u7684 522 \u9519\u8bef\u9875\u9762\uff08\u6b64\u65f6 \u65e5\u672c\u53cd\u4ee3\u6302\u6389\u4e86 \uff09\uff0c\u7ecf\u67e5\u5c3d\u7ba1 IPv4 \u6b63\u786e\u89e3\u6790\u5230\u4e86 gw-el \u4e0a\uff0c\u4f46\u662f IPv6 \u8fd8\u662f\u89e3\u6790\u5230\u4e86 Cloudflare \u4e0a\uff0c\u4e14 nslookup \u548c dig \u7b49\u5de5\u5177\u8f93\u51fa\u770b\u8d77\u6765\u90fd\u662f\u5bf9\u7684\u3002 \u6392\u67e5\u53d1\u73b0 /etc/resolv.conf \u91cc\u6ca1\u6709 IPv6 \u7684\u670d\u52a1\u5668\u6761\u76ee\uff0c\u5728\u9760\u524d\u7684\u4f4d\u7f6e\u63d2\u5165 nameserver 2001:da8:d800::1 \u540e\u89e3\u51b3\u3002 \u624b\u52a8\u6e05\u7a7a\u672c\u673a\u7684 DNS \u7f13\u5b58\uff1a nscd -i hosts \u6709\u65f6\u5019\u53ef\u80fd\u4f1a\u5728 DNS \u66f4\u65b0\u540e\u968f\u673a\u89e3\u6790\u51fa\u65b0\u65e7\u7ed3\u679c\uff0c\u53ef\u80fd\u7684\u539f\u56e0\u662f ns-a \u6ca1\u66f4\u65b0 ns-a \u673a\u5668\u6bd4\u8f83\u8001\u65e7\uff0c\u7f51\u7edc\u53ef\u80fd\u4e0d\u987a\u7545\uff0c\u624b\u52a8\u628a ns-a \u66f4\u65b0\u4e00\u4e0b\u5c31\u884c\u4e86\uff08","title":"\u9519\u8bef\u7684\u89e3\u6790\u7ed3\u679c"},{"location":"faq/ldap/","text":"LDAP \u5957\u4ef6\u95ee\u9898 \u00b6 GOsa \u95ee\u9898 \u00b6 User \u754c\u9762\u6253\u5f00\u65f6\u62a5\u9519 \u5982\u679c\u5728 GOsa \u4e2d\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7528\u6237\uff0c\u5374\u6ca1\u6709\u5728\u6700\u540e\u4e3a\u4ed6\u8bbe\u7f6e\u5bc6\u7801\uff0c\u5c31\u4f1a\u51fa\u73b0\u6b64\u95ee\u9898\uff0c\u6253\u5f00 User \u754c\u9762\u540e\u4f1a\u6709\u62a5\u9519\uff1a Fatal error: Uncaught ArgumentCountError: Too few arguments to function userManagement::filterLockLabel(), 0 passed in /usr/share/gosa/include/class_listing.inc on line 856 and exactly 1 expected in /usr/share/gosa/plugins/admin/users/class_userManagement.inc:856 Stack trace: #0 /usr/share/gosa/include/class_listing.inc(856): userManagement::filterLockLabel() #1 /usr/share/gosa/include/class_listing.inc(980): listing->processElementFilter('%{filter:lockLa...', Array, 50) #2 /usr/share/gosa/include/class_listing.inc(853): listing->filterActions('cn=...,ou=...', 50, Array) #3 /usr/share/gosa/include/class_listing.inc(764): listing->processElementFilter('%{filter:action...', Array, 50) #4 /usr/share/gosa/include/class_listing.inc(407): listing->renderCell('%{filter:action...', Array, 50) #5 /usr/share/gosa/include/class_management.inc(233): listing->render() #6 /usr/share/gosa/include/class_management.inc(222): management->renderList() #7 /usr/share/gosa/plugins/admin/users/main.inc(44): management->execute() #8 /usr/sh in /usr/share/gosa/plugins/admin/users/class_userManagement.inc on line 856 \u8fd9\u662f\u56e0\u4e3a GOsa \u65e0\u6cd5\u8bfb\u53d6\u5230\u7528\u6237\u5bc6\u7801\u7684 Hash\uff0c\u800c LDAP \u5374\u5141\u8bb8\u7528\u6237\u6ca1\u6709\u5bc6\u7801\u3002 \u53ea\u9700\u4e3a\u65b0\u7684\u7528\u6237\u8bbe\u7f6e\u5bc6\u7801\u6216\u5220\u9664\u65b0\u7684\u7528\u6237\u5373\u53ef\u3002","title":"LDAP"},{"location":"faq/ldap/#ldap","text":"","title":"LDAP \u5957\u4ef6\u95ee\u9898"},{"location":"faq/ldap/#gosa","text":"User \u754c\u9762\u6253\u5f00\u65f6\u62a5\u9519 \u5982\u679c\u5728 GOsa \u4e2d\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7528\u6237\uff0c\u5374\u6ca1\u6709\u5728\u6700\u540e\u4e3a\u4ed6\u8bbe\u7f6e\u5bc6\u7801\uff0c\u5c31\u4f1a\u51fa\u73b0\u6b64\u95ee\u9898\uff0c\u6253\u5f00 User \u754c\u9762\u540e\u4f1a\u6709\u62a5\u9519\uff1a Fatal error: Uncaught ArgumentCountError: Too few arguments to function userManagement::filterLockLabel(), 0 passed in /usr/share/gosa/include/class_listing.inc on line 856 and exactly 1 expected in /usr/share/gosa/plugins/admin/users/class_userManagement.inc:856 Stack trace: #0 /usr/share/gosa/include/class_listing.inc(856): userManagement::filterLockLabel() #1 /usr/share/gosa/include/class_listing.inc(980): listing->processElementFilter('%{filter:lockLa...', Array, 50) #2 /usr/share/gosa/include/class_listing.inc(853): listing->filterActions('cn=...,ou=...', 50, Array) #3 /usr/share/gosa/include/class_listing.inc(764): listing->processElementFilter('%{filter:action...', Array, 50) #4 /usr/share/gosa/include/class_listing.inc(407): listing->renderCell('%{filter:action...', Array, 50) #5 /usr/share/gosa/include/class_management.inc(233): listing->render() #6 /usr/share/gosa/include/class_management.inc(222): management->renderList() #7 /usr/share/gosa/plugins/admin/users/main.inc(44): management->execute() #8 /usr/sh in /usr/share/gosa/plugins/admin/users/class_userManagement.inc on line 856 \u8fd9\u662f\u56e0\u4e3a GOsa \u65e0\u6cd5\u8bfb\u53d6\u5230\u7528\u6237\u5bc6\u7801\u7684 Hash\uff0c\u800c LDAP \u5374\u5141\u8bb8\u7528\u6237\u6ca1\u6709\u5bc6\u7801\u3002 \u53ea\u9700\u4e3a\u65b0\u7684\u7528\u6237\u8bbe\u7f6e\u5bc6\u7801\u6216\u5220\u9664\u65b0\u7684\u7528\u6237\u5373\u53ef\u3002","title":"GOsa \u95ee\u9898"},{"location":"faq/nginx/","text":"Nginx \u76f8\u5173\u914d\u7f6e \u00b6 \u6587\u4ef6\u6253\u5f00\u6570\u5927\u5c0f\u9650\u5236 \u00b6 \u5728\u9ed8\u8ba4\u8bbe\u7f6e\u4e2d\uff0cnginx \u7684\u6700\u5927\u6587\u4ef6\u6253\u5f00\u6570\u4e0a\u9650\u5e76\u4e0d\u5927\u3002\u5f53\u6709\u5927\u91cf\u8bbf\u95ee\u65f6\uff0c\u6587\u4ef6\u6253\u5f00\u6570\u53ef\u80fd\u4f1a\u8d85\u8fc7\u9650\u989d\uff0c\u5bfc\u81f4\u7f51\u7ad9\u54cd\u5e94\u7f13\u6162\u3002\u5728\u65b0\u914d\u7f6e\u670d\u52a1\u5668\u65f6\uff0c\u8fd9\u4e00\u9879\u8bbe\u7f6e\u5f88\u5bb9\u6613\u88ab\u5ffd\u7565\u6389\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a sudo systemctl edit nginx.service \u5728\u6253\u5f00\u7684 override \u6587\u4ef6\u7684 [Service] \u4e0b\u65b9\u6dfb\u52a0 LimitNOFILE=524288 \uff08\u89c6\u60c5\u51b5\u8fd9\u4e2a\u503c\u53ef\u4ee5\u76f8\u5e94\u8c03\u6574\uff09","title":"Nginx"},{"location":"faq/nginx/#nginx","text":"","title":"Nginx \u76f8\u5173\u914d\u7f6e"},{"location":"faq/nginx/#_1","text":"\u5728\u9ed8\u8ba4\u8bbe\u7f6e\u4e2d\uff0cnginx \u7684\u6700\u5927\u6587\u4ef6\u6253\u5f00\u6570\u4e0a\u9650\u5e76\u4e0d\u5927\u3002\u5f53\u6709\u5927\u91cf\u8bbf\u95ee\u65f6\uff0c\u6587\u4ef6\u6253\u5f00\u6570\u53ef\u80fd\u4f1a\u8d85\u8fc7\u9650\u989d\uff0c\u5bfc\u81f4\u7f51\u7ad9\u54cd\u5e94\u7f13\u6162\u3002\u5728\u65b0\u914d\u7f6e\u670d\u52a1\u5668\u65f6\uff0c\u8fd9\u4e00\u9879\u8bbe\u7f6e\u5f88\u5bb9\u6613\u88ab\u5ffd\u7565\u6389\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a sudo systemctl edit nginx.service \u5728\u6253\u5f00\u7684 override \u6587\u4ef6\u7684 [Service] \u4e0b\u65b9\u6dfb\u52a0 LimitNOFILE=524288 \uff08\u89c6\u60c5\u51b5\u8fd9\u4e2a\u503c\u53ef\u4ee5\u76f8\u5e94\u8c03\u6574\uff09","title":"\u6587\u4ef6\u6253\u5f00\u6570\u5927\u5c0f\u9650\u5236"},{"location":"infrastructure/discontinued/","text":"\u4e0d\u518d\u4f7f\u7528\u7684\u57fa\u7840\u8bbe\u65bd \u00b6 SaltStack \u00b6 \u76ee\u524d\u4e0d\u77e5 SaltStack \u4f55\u65f6\u5f00\u59cb\u4f7f\u7528\uff0c\u4f46\u662f\u6211\u4eec\u6ca1\u6709\u4efb\u4f55\u4f9d\u8d56\u4e8e salt \u7684\u914d\u7f6e\u3002\u51fa\u4e8e\u8003\u8651\u5230 salt \u51fa\u73b0\u8fc7\u975e\u5e38\u4e25\u91cd\u7684 CVE\uff0csaltstack \u5df2\u4e0d\u518d\u8003\u8651\u4f7f\u7528\uff0c\u4e14\u5728\u5df2\u77e5\u7684\u673a\u5668\u4e0a\u90fd\u5df2\u5220\u9664\u3002\u5982\u679c\u4f60\u53d1\u73b0\u67d0\u53f0 lug \u7684\u673a\u5668\u4e0a\u5b89\u88c5\u4e86 salt\uff0c\u8bf7\u901a\u77e5 CTO \u4ee5\u5c06\u5176\u5220\u9664\u3002 \u5728\u81ea\u52a8\u5316\u8fd0\u7ef4\u65b9\u9762\uff0c\u672a\u6765\u4f1a\u8c03\u7814 ansible\u3002","title":"Discontinued Infrastructure"},{"location":"infrastructure/discontinued/#_1","text":"","title":"\u4e0d\u518d\u4f7f\u7528\u7684\u57fa\u7840\u8bbe\u65bd"},{"location":"infrastructure/discontinued/#saltstack","text":"\u76ee\u524d\u4e0d\u77e5 SaltStack \u4f55\u65f6\u5f00\u59cb\u4f7f\u7528\uff0c\u4f46\u662f\u6211\u4eec\u6ca1\u6709\u4efb\u4f55\u4f9d\u8d56\u4e8e salt \u7684\u914d\u7f6e\u3002\u51fa\u4e8e\u8003\u8651\u5230 salt \u51fa\u73b0\u8fc7\u975e\u5e38\u4e25\u91cd\u7684 CVE\uff0csaltstack \u5df2\u4e0d\u518d\u8003\u8651\u4f7f\u7528\uff0c\u4e14\u5728\u5df2\u77e5\u7684\u673a\u5668\u4e0a\u90fd\u5df2\u5220\u9664\u3002\u5982\u679c\u4f60\u53d1\u73b0\u67d0\u53f0 lug \u7684\u673a\u5668\u4e0a\u5b89\u88c5\u4e86 salt\uff0c\u8bf7\u901a\u77e5 CTO \u4ee5\u5c06\u5176\u5220\u9664\u3002 \u5728\u81ea\u52a8\u5316\u8fd0\u7ef4\u65b9\u9762\uff0c\u672a\u6765\u4f1a\u8c03\u7814 ansible\u3002","title":"SaltStack"},{"location":"infrastructure/dns/","text":"","title":"DNS"},{"location":"infrastructure/github/","text":"GitHub Organization \u00b6 ustclug GitHub Actions \u00b6 GitHub Actions \u5bf9\u516c\u5f00\u4ed3\u5e93\u514d\u8d39\uff0c\u5bf9\u79c1\u6709\u4ed3\u5e93\u6bcf\u6708\u6709 3000 \u5206\u949f\u7684\u9650\u989d\uff08\u6ce8\uff1a\u6211\u4eec\u662f\u5b66\u6821\u5e2e\u5fd9\u7533\u8bf7\u7684 GitHub Education\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u529f\u80fd\u4e0a\u76f8\u5f53\u4e8e\u4ed8\u8d39\u7684 GitHub Team\uff09\u3002\u76ee\u524d\u6211\u4eec\u6709\u591a\u4e2a\u9879\u76ee\u4f7f\u7528 GitHub Actions \u90e8\u7f72\uff0c\u4f8b\u5982 Linux 101 \u7684\u8bb2\u4e49 \u3002 \u6211\u4eec\u66fe\u7ecf\u4f7f\u7528 Travis CI\uff08\u73b0\u5728\u4e5f\u5728\u90e8\u5206\u516c\u5f00\u4ed3\u5e93\u4e2d\u4f7f\u7528\uff09\uff0c\u56e0\u4e3a\uff08\u4e0d\u9650\u671f\uff09\u6570\u91cf\u9650\u5236\u800c\u5c06\u79c1\u6709\u4ed3\u5e93\u5168\u90e8\u8fc1\u51fa\uff0c\u8ba8\u8bba\u89c1 Discussion #308 .","title":"GitHub"},{"location":"infrastructure/github/#github-organization","text":"ustclug","title":"GitHub Organization"},{"location":"infrastructure/github/#github-actions","text":"GitHub Actions \u5bf9\u516c\u5f00\u4ed3\u5e93\u514d\u8d39\uff0c\u5bf9\u79c1\u6709\u4ed3\u5e93\u6bcf\u6708\u6709 3000 \u5206\u949f\u7684\u9650\u989d\uff08\u6ce8\uff1a\u6211\u4eec\u662f\u5b66\u6821\u5e2e\u5fd9\u7533\u8bf7\u7684 GitHub Education\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u529f\u80fd\u4e0a\u76f8\u5f53\u4e8e\u4ed8\u8d39\u7684 GitHub Team\uff09\u3002\u76ee\u524d\u6211\u4eec\u6709\u591a\u4e2a\u9879\u76ee\u4f7f\u7528 GitHub Actions \u90e8\u7f72\uff0c\u4f8b\u5982 Linux 101 \u7684\u8bb2\u4e49 \u3002 \u6211\u4eec\u66fe\u7ecf\u4f7f\u7528 Travis CI\uff08\u73b0\u5728\u4e5f\u5728\u90e8\u5206\u516c\u5f00\u4ed3\u5e93\u4e2d\u4f7f\u7528\uff09\uff0c\u56e0\u4e3a\uff08\u4e0d\u9650\u671f\uff09\u6570\u91cf\u9650\u5236\u800c\u5c06\u79c1\u6709\u4ed3\u5e93\u5168\u90e8\u8fc1\u51fa\uff0c\u8ba8\u8bba\u89c1 Discussion #308 .","title":"GitHub Actions"},{"location":"infrastructure/google/","text":"Google Apps / G Suite \u00b6 \u7533\u8bf7\u65b9\u5f0f \u00b6 \u7406\u8bba\u4e0a\u4efb\u4f55\u793e\u56e2\u8d1f\u8d23\u4eba\u6216\u8005\u5728\u793e\u56e2\u4e2d\u8d1f\u8d23\u91cd\u8981\u9879\u76ee\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u7533\u8bf7\uff0c\u539f\u5219\u662f\u6309\u9700\u5206\u914d\uff0c\u56e0\u4e3a\u90ae\u7bb1\u662f\u5de5\u4f5c\u5de5\u5177\uff0c\u800c\u4e0d\u662f\u798f\u5229\u8d44\u6e90\u3002 \u540c\u7406\uff0c\u4e0d\u518d\u62c5\u4efb\u8d1f\u8d23\u4eba\u4e14\u4e0d\u518d\u5904\u7406\u4e8b\u52a1\u7684\u540c\u5b66\u4f7f\u7528\u7684\u90ae\u7bb1\u5e94\u8be5\u6536\u56de\uff08\u89c1\u4e0b\u65b9 \u9ed8\u8ba4\u5730\u5740 \u4e00\u8282\uff09\u3002 \u90ae\u4ef6\u793c\u4eea \u00b6 \u4ee5\u4e0b\u539f\u6587\u7531 Hypercube \u7f16\u5199 \u5927\u5bb6\u597d\uff0c \u8bf7\u5404\u4f4d\u9605\u8bfb\u4e0b\u65b9\u5185\u5bb9\uff0c\u5e76\u6309\u6307\u793a\u914d\u7f6e\u81ea\u5df1\u7684\u90ae\u7bb1\uff1a \u767b\u5f55\u7f51\u9875\u7248 Gmail\uff0c\u5728\u53f3\u4e0a\u89d2\u70b9\u5f00\u8bbe\u7f6e\uff0c\u4e8e\u201c\u5e38\u89c4\u201d\u6807\u7b7e\u9875\u4e2d\u8bbe\u7f6e\u201c\u7b7e\u540d\u201d\u4e3a\u7eaf\u6587\u672c\u5982\u4e0b\u5185\u5bb9\uff08\u5171 5 \u884c\uff0c\u5c06\u6700\u540e\u4e00\u884c\u6362\u6210\u81ea\u5df1\u7684\u4fe1\u606f\uff09\uff1a Linux User Group University of Science and Technology of China Homepage: https://lug.ustc.edu.cn/ E-Mail: lug@ustc.edu.cn Zibo Wang (\u738b\u5b50\u535a) < example@ustclug.org > \u4e8e\u201c\u8d26\u53f7\u201d\u6807\u7b7e\u9875\u4e2d\u201c\u7528\u8fd9\u4e2a\u5730\u5740\u53d1\u9001\u90ae\u4ef6\u201d\u5185\u70b9\u201c\u4fee\u6539\u4fe1\u606f\u201d\uff0c\u5728\u5f39\u51fa\u7a97\u53e3\u4e2d\u8f93\u5165\u540d\u79f0\u201cZibo Wang on behalf of USTC LUG\u201d\uff08\u8bf7\u6362\u6210\u81ea\u5df1\u7684\u540d\u5b57\uff09\uff0c\u8f93\u5165\u56de\u590d\u5730\u5740\u201c lug@ustc.edu.cn \u201d\u3002 \u8fd8\u53ef\u4ee5\u89c6\u81ea\u5df1\u9700\u8981\u5728\u201c\u8f6c\u53d1\u548c POP / IMAP\u201d\u6807\u7b7e\u9875\u4e2d\u914d\u7f6e\u81ea\u52a8\u8f6c\u53d1\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u4f60\u914d\u7f6e\u4e86\u8f6c\u53d1\u5230\u81ea\u5df1\u7684\u5e38\u7528\u90ae\u7bb1\uff0c\u8bf7\u4e0d\u8981\u76f4\u63a5\u4ece\u5e38\u7528\u90ae\u7bb1\u56de\u590d\u90ae\u4ef6\uff0c\u800c\u5e94\u8be5\u767b\u5f55 LUG \u90ae\u7bb1\u56de\u590d\u3002 \u56de\u590d\u4efb\u4f55\u90ae\u4ef6\u65f6\uff0c\u8bf7\u6284\u9001 / CC\uff08\u4e0d\u662f\u5bc6\u9001 / BCC\uff09\u7ed9\u539f\u90ae\u4ef6\u7684\u6536\u4ef6\u5730\u5740\uff01\uff08\u6bd4\u5982\u522b\u4eba\u53d1\u5230 lug A ustc.edu.cn \uff0c\u56de\u590d\u65f6\u4e5f\u8bf7 CC \u5230 lug A ustc.edu.cn\uff09 \u8bf7\u4e0d\u8981\u201c\u53ea\u56de\u590d\u90ae\u4ef6\u201d\u3002\u5982\u679c\u5728\u56de\u590d\u4e2d\u8bf4\u201c\u6211\u4eec\u4f1a\u505a\u67d0\u67d0\u4e8b\u201d\uff0c\u8bf7\u6ce8\u610f\u9664\u975e\u4f60\u660e\u786e\u8f6c\u4ea4\u7ed9\u4e86\u522b\u4eba\uff0c\u8fd9\u4ef6\u4e8b\u5e94\u5f53\u7531\u4f60\u6765\u5b8c\u6210\u3002 \u5728\u6dfb\u52a0\u4e86\u7b7e\u540d\u540e\uff0c\u5728\u4e0b\u9762\u7684\u201c\u9ed8\u8ba4\u7b7e\u540d\u8bbe\u7f6e\u201d\u4e2d\uff0c\u5c06\u201c\u7528\u4e8e\u65b0\u7535\u5b50\u90ae\u4ef6\u201d\u4ee5\u53ca\u201c\u7528\u4e8e\u56de\u590d/\u8f6c\u53d1\u201d\u5747\u9009\u62e9\u4e3a\u4e0a\u9762\u6dfb\u52a0\u7684\u7b7e\u540d\u3002 \u8bb0\u5f97\u6eda\u52a8\u5230\u9875\u9762\u6700\u4e0b\u65b9\u70b9\u51fb\u201c\u4fdd\u5b58\u9875\u9762\u201d\uff01 \u6211\u4eec\u52a0\u5165\u4e86\u5f88\u591a\u90ae\u4ef6\u5217\u8868\uff0c\u5176\u4e2d\u7ecf\u5e38\u6709\u5404\u79cd\u5f80\u6765\u90ae\u4ef6\uff08\u7279\u522b\u662f CentOS mirror announcement \u8fd9\u4e2a\u5217\u8868\uff0c\u5df2\u9000\uff09\uff0c\u5b83\u4eec\u5927\u591a\u6570\u4e0d\u9700\u8981\u6211\u4eec\u7406\u4f1a\u3002 \u603b\u4e4b\uff0c\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406\u7684\u90ae\u4ef6\u4e0d\u8981\u8d38\u7136\u56de\u590d\u3002\u5982\u679c\u4f60\u8ba4\u4e3a\u67d0\u4e00\u5c01\u90ae\u4ef6\u9700\u8981\u6211\u4eec\u5904\u7406\u4f46\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406\uff0c\u8bf7\u8f6c\u544a\u7ed9\u5176\u4ed6\u76f8\u5173\u540c\u5b66\u3002 \u52a0\u5165 lug @ ustc \u5217\u8868 \u00b6 \u82e5\u8981\u6536\u5230\u53d1\u5f80 lug A ustc.edu.cn \u7684\u90ae\u4ef6\uff0c\u9700\u8981\u5728 \u7fa4\u7ec4\u7ba1\u7406 \u8fd9\u91cc\u5c06\u7528\u6237\u52a0\u5165 USTC LUG Staff \u7ec4\u3002\u8fd9\u4e2a\u7fa4\u7ec4\u5c31\u662f lug \u548c mirrors \u5728\u5b66\u6821\u90ae\u7bb1\u8bbe\u7f6e\u7684\u8f6c\u53d1\u76ee\u6807\u3002 \u8bbe\u7f6e\u9ed8\u8ba4\u5730\u5740 \u00b6 G Suite \u652f\u6301\u5c06\u5355\u4e2a\u5730\u5740\u8bbe\u4e3a\u201c\u9ed8\u8ba4\u5730\u5740\u201d\uff0c\u7528\u4e8e\u63a5\u53d7\u53d1\u5f80\u4e0d\u5b58\u5728\u7684\u5730\u5740\u7684\u90ae\u4ef6\u3002 \u53c2\u8003\u8d44\u6599\uff1a https://support.google.com/a/answer/2368153 \u5bf9\u4e8e\u4e2d\u6587\u754c\u9762\uff0c\u5e94\u8be5\u4ece Google Admin \u63a7\u5236\u53f0\u6309\u987a\u5e8f\u9009\u62e9 \u5e94\u7528 \u2192 G Suite \u2192 Gmail \u2192 \u9ad8\u7ea7\u8bbe\u7f6e \uff0c\u5176\u4e2d\u7684 \u65e0\u9650\u522b\u540d\u5730\u5740 \u5c31\u662f\u8fd9\u4e2a\u9009\u9879\uff0c\u4e00\u822c\u53d1\u7ed9\u4f1a\u957f\u6216 CTO\u3002","title":"Google Apps / G Suite"},{"location":"infrastructure/google/#google-apps-g-suite","text":"","title":"Google Apps / G Suite"},{"location":"infrastructure/google/#application","text":"\u7406\u8bba\u4e0a\u4efb\u4f55\u793e\u56e2\u8d1f\u8d23\u4eba\u6216\u8005\u5728\u793e\u56e2\u4e2d\u8d1f\u8d23\u91cd\u8981\u9879\u76ee\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u7533\u8bf7\uff0c\u539f\u5219\u662f\u6309\u9700\u5206\u914d\uff0c\u56e0\u4e3a\u90ae\u7bb1\u662f\u5de5\u4f5c\u5de5\u5177\uff0c\u800c\u4e0d\u662f\u798f\u5229\u8d44\u6e90\u3002 \u540c\u7406\uff0c\u4e0d\u518d\u62c5\u4efb\u8d1f\u8d23\u4eba\u4e14\u4e0d\u518d\u5904\u7406\u4e8b\u52a1\u7684\u540c\u5b66\u4f7f\u7528\u7684\u90ae\u7bb1\u5e94\u8be5\u6536\u56de\uff08\u89c1\u4e0b\u65b9 \u9ed8\u8ba4\u5730\u5740 \u4e00\u8282\uff09\u3002","title":"\u7533\u8bf7\u65b9\u5f0f"},{"location":"infrastructure/google/#email-etiquette","text":"\u4ee5\u4e0b\u539f\u6587\u7531 Hypercube \u7f16\u5199 \u5927\u5bb6\u597d\uff0c \u8bf7\u5404\u4f4d\u9605\u8bfb\u4e0b\u65b9\u5185\u5bb9\uff0c\u5e76\u6309\u6307\u793a\u914d\u7f6e\u81ea\u5df1\u7684\u90ae\u7bb1\uff1a \u767b\u5f55\u7f51\u9875\u7248 Gmail\uff0c\u5728\u53f3\u4e0a\u89d2\u70b9\u5f00\u8bbe\u7f6e\uff0c\u4e8e\u201c\u5e38\u89c4\u201d\u6807\u7b7e\u9875\u4e2d\u8bbe\u7f6e\u201c\u7b7e\u540d\u201d\u4e3a\u7eaf\u6587\u672c\u5982\u4e0b\u5185\u5bb9\uff08\u5171 5 \u884c\uff0c\u5c06\u6700\u540e\u4e00\u884c\u6362\u6210\u81ea\u5df1\u7684\u4fe1\u606f\uff09\uff1a Linux User Group University of Science and Technology of China Homepage: https://lug.ustc.edu.cn/ E-Mail: lug@ustc.edu.cn Zibo Wang (\u738b\u5b50\u535a) < example@ustclug.org > \u4e8e\u201c\u8d26\u53f7\u201d\u6807\u7b7e\u9875\u4e2d\u201c\u7528\u8fd9\u4e2a\u5730\u5740\u53d1\u9001\u90ae\u4ef6\u201d\u5185\u70b9\u201c\u4fee\u6539\u4fe1\u606f\u201d\uff0c\u5728\u5f39\u51fa\u7a97\u53e3\u4e2d\u8f93\u5165\u540d\u79f0\u201cZibo Wang on behalf of USTC LUG\u201d\uff08\u8bf7\u6362\u6210\u81ea\u5df1\u7684\u540d\u5b57\uff09\uff0c\u8f93\u5165\u56de\u590d\u5730\u5740\u201c lug@ustc.edu.cn \u201d\u3002 \u8fd8\u53ef\u4ee5\u89c6\u81ea\u5df1\u9700\u8981\u5728\u201c\u8f6c\u53d1\u548c POP / IMAP\u201d\u6807\u7b7e\u9875\u4e2d\u914d\u7f6e\u81ea\u52a8\u8f6c\u53d1\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u4f60\u914d\u7f6e\u4e86\u8f6c\u53d1\u5230\u81ea\u5df1\u7684\u5e38\u7528\u90ae\u7bb1\uff0c\u8bf7\u4e0d\u8981\u76f4\u63a5\u4ece\u5e38\u7528\u90ae\u7bb1\u56de\u590d\u90ae\u4ef6\uff0c\u800c\u5e94\u8be5\u767b\u5f55 LUG \u90ae\u7bb1\u56de\u590d\u3002 \u56de\u590d\u4efb\u4f55\u90ae\u4ef6\u65f6\uff0c\u8bf7\u6284\u9001 / CC\uff08\u4e0d\u662f\u5bc6\u9001 / BCC\uff09\u7ed9\u539f\u90ae\u4ef6\u7684\u6536\u4ef6\u5730\u5740\uff01\uff08\u6bd4\u5982\u522b\u4eba\u53d1\u5230 lug A ustc.edu.cn \uff0c\u56de\u590d\u65f6\u4e5f\u8bf7 CC \u5230 lug A ustc.edu.cn\uff09 \u8bf7\u4e0d\u8981\u201c\u53ea\u56de\u590d\u90ae\u4ef6\u201d\u3002\u5982\u679c\u5728\u56de\u590d\u4e2d\u8bf4\u201c\u6211\u4eec\u4f1a\u505a\u67d0\u67d0\u4e8b\u201d\uff0c\u8bf7\u6ce8\u610f\u9664\u975e\u4f60\u660e\u786e\u8f6c\u4ea4\u7ed9\u4e86\u522b\u4eba\uff0c\u8fd9\u4ef6\u4e8b\u5e94\u5f53\u7531\u4f60\u6765\u5b8c\u6210\u3002 \u5728\u6dfb\u52a0\u4e86\u7b7e\u540d\u540e\uff0c\u5728\u4e0b\u9762\u7684\u201c\u9ed8\u8ba4\u7b7e\u540d\u8bbe\u7f6e\u201d\u4e2d\uff0c\u5c06\u201c\u7528\u4e8e\u65b0\u7535\u5b50\u90ae\u4ef6\u201d\u4ee5\u53ca\u201c\u7528\u4e8e\u56de\u590d/\u8f6c\u53d1\u201d\u5747\u9009\u62e9\u4e3a\u4e0a\u9762\u6dfb\u52a0\u7684\u7b7e\u540d\u3002 \u8bb0\u5f97\u6eda\u52a8\u5230\u9875\u9762\u6700\u4e0b\u65b9\u70b9\u51fb\u201c\u4fdd\u5b58\u9875\u9762\u201d\uff01 \u6211\u4eec\u52a0\u5165\u4e86\u5f88\u591a\u90ae\u4ef6\u5217\u8868\uff0c\u5176\u4e2d\u7ecf\u5e38\u6709\u5404\u79cd\u5f80\u6765\u90ae\u4ef6\uff08\u7279\u522b\u662f CentOS mirror announcement \u8fd9\u4e2a\u5217\u8868\uff0c\u5df2\u9000\uff09\uff0c\u5b83\u4eec\u5927\u591a\u6570\u4e0d\u9700\u8981\u6211\u4eec\u7406\u4f1a\u3002 \u603b\u4e4b\uff0c\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406\u7684\u90ae\u4ef6\u4e0d\u8981\u8d38\u7136\u56de\u590d\u3002\u5982\u679c\u4f60\u8ba4\u4e3a\u67d0\u4e00\u5c01\u90ae\u4ef6\u9700\u8981\u6211\u4eec\u5904\u7406\u4f46\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406\uff0c\u8bf7\u8f6c\u544a\u7ed9\u5176\u4ed6\u76f8\u5173\u540c\u5b66\u3002","title":"\u90ae\u4ef6\u793c\u4eea"},{"location":"infrastructure/google/#lug-ustc-mailing-list","text":"\u82e5\u8981\u6536\u5230\u53d1\u5f80 lug A ustc.edu.cn \u7684\u90ae\u4ef6\uff0c\u9700\u8981\u5728 \u7fa4\u7ec4\u7ba1\u7406 \u8fd9\u91cc\u5c06\u7528\u6237\u52a0\u5165 USTC LUG Staff \u7ec4\u3002\u8fd9\u4e2a\u7fa4\u7ec4\u5c31\u662f lug \u548c mirrors \u5728\u5b66\u6821\u90ae\u7bb1\u8bbe\u7f6e\u7684\u8f6c\u53d1\u76ee\u6807\u3002","title":"\u52a0\u5165 lug @ ustc \u5217\u8868"},{"location":"infrastructure/google/#default-route","text":"G Suite \u652f\u6301\u5c06\u5355\u4e2a\u5730\u5740\u8bbe\u4e3a\u201c\u9ed8\u8ba4\u5730\u5740\u201d\uff0c\u7528\u4e8e\u63a5\u53d7\u53d1\u5f80\u4e0d\u5b58\u5728\u7684\u5730\u5740\u7684\u90ae\u4ef6\u3002 \u53c2\u8003\u8d44\u6599\uff1a https://support.google.com/a/answer/2368153 \u5bf9\u4e8e\u4e2d\u6587\u754c\u9762\uff0c\u5e94\u8be5\u4ece Google Admin \u63a7\u5236\u53f0\u6309\u987a\u5e8f\u9009\u62e9 \u5e94\u7528 \u2192 G Suite \u2192 Gmail \u2192 \u9ad8\u7ea7\u8bbe\u7f6e \uff0c\u5176\u4e2d\u7684 \u65e0\u9650\u522b\u540d\u5730\u5740 \u5c31\u662f\u8fd9\u4e2a\u9009\u9879\uff0c\u4e00\u822c\u53d1\u7ed9\u4f1a\u957f\u6216 CTO\u3002","title":"\u8bbe\u7f6e\u9ed8\u8ba4\u5730\u5740"},{"location":"infrastructure/ldap/","text":"LDAP \u670d\u52a1\u4f7f\u7528\u53ca\u914d\u7f6e\u8bf4\u660e \u00b6 LDAP \u662f\u8f7b\u91cf\u76ee\u5f55\u8bbf\u95ee\u534f\u8bae\uff0c\u6211\u4eec\u7528\u7684\u8f6f\u4ef6\u662f OpenLDAP\u3002 LDAP \u7684\u914d\u7f6e\u5f88\u9ebb\u70e6\uff0c\u6240\u4ee5\u88c5\u4e86\u4e00\u4e2a\u7f51\u9875\u524d\u7aef\u6765\u914d\u7f6e\u5b83\uff0c\u7f51\u9875\u524d\u7aef\u662f GOsa\u00b2\u3002 \u5bc6\u7801\u4fee\u6539 \u00b6 \u767b\u5f55\u4efb\u610f\u4e00\u53f0\u670d\u52a1\u5668\u4f7f\u7528 passwd \u5c31\u53ef\u4ee5\u4fee\u6539\u5bc6\u7801\uff0c\u4fee\u6539\u7684\u5bc6\u7801\u5728\u6240\u6709\u673a\u5668\u4e0a\u5b9e\u65f6\u751f\u6548\uff08\u56e0\u4e3a\u5b9e\u9645\u662f\u5b58\u5728 LDAP \u6570\u636e\u5e93\u91cc\u7684\uff09\u3002 GOsa \u4f7f\u7528 \u00b6 \u7f51\u9875\u754c\u9762\u4f4d\u4e8e ldap.lug.ustc.edu.cn \u3002 \u7528\u4f60\u7684\u8d26\u53f7\u767b\u5f55\u8fdb\u53bb\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728\u53f3\u4e0a\u89d2\u9000\u51fa\uff0c\u53f3\u4e0a\u89d2\u8fd8\u6709\u4e24\u4e2a\u6309\u94ae\u5206\u522b\u662f\u4fee\u6539\u8d26\u53f7\u4fe1\u606f\u548c\u4fee\u6539\u5bc6\u7801\u3002\u8d26\u53f7\u4fe1\u606f\u7b2c\u4e00\u9875\u5927\u90e8\u5206\u662f\u6ca1\u7528\u7684\uff0c\u53ea\u6709\u4e00\u4e2a\u767b\u5f55\u540d\u662f\u6709\u7528\u7684\uff0c\u8fd9\u662f\u4f60\u767b\u5f55\u4efb\u4f55\u5730\u65b9\u7684\u7528\u6237\u540d\u3002 Users \u548c Groups \u00b6 Users \u662f\u7528\u6765\u6dfb\u52a0\u548c\u914d\u7f6e\u7528\u6237\u4fe1\u606f\u7684\u5730\u65b9\u3002\u6700\u4e3b\u8981\u7684\u529f\u80fd\u4f4d\u4e8e\u6bcf\u4e2a User \u7684\u7b2c\u4e8c\u9875 POSIX\uff0c\u8fd9\u91cc\u53ef\u4ee5\u8bbe\u7f6e\u7528\u6237\u7684\u5bb6\u76ee\u5f55\uff0cUID\uff0cGID\uff0c\u4ee5\u53ca\u6240\u5c5e\u7684\u7528\u6237\u7ec4\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u5982\u4e0b\uff1a UID\uff0cGID \u4ece 2000 \u5f00\u59cb\u8ba1\u6570\uff0c\u7531\u4e8e gosa \u4e0d\u80fd\u5bf9 UID \u81ea\u52a8\u589e\u957f\uff0c\u6240\u4ee5\u7ba1\u7406\u5458\u9700\u8981\u4eba\u5de5\u589e\u957f\u3002\u65b9\u6cd5\u662f\u767b\u5f55\u4efb\u610f\u4e00\u53f0\u673a\u5668\uff0c\u8fd0\u884c getent passwd \u5e76\u89c2\u5bdf\u8f93\u51fa\uff0c\u53d6\u6700\u5927\u7684 UID + 1 \u5c31\u884c\u4e86\u3002 \u5751 \u5c0f\u5fc3\u8f93\u51fa\u7684\u987a\u5e8f\uff0c\u6700\u5927\u7684 UID \u4e0d\u4e00\u5b9a\u662f\u6700\u540e\u4e00\u4e2a\uff08\u800c\u4e14\u4e8b\u5b9e\u4e0a\u7ecf\u5e38\u4e0d\u662f\uff09\uff0c\u5efa\u8bae\u914d\u5408 sed, awk, sort \u4e4b\u7c7b\u7684\u547d\u4ee4\u59a5\u5584\u5904\u7406\uff0c\u4f8b\u5982 getent passwd | cut -d: -f3 | sort -n \u540c\u65f6\u8fd8\u6709\u82e5\u5e72 UID \u5f88\u5927\u4f46\u662f\u79bb\u6563\u7684\u7279\u6b8a\u8d26\u53f7\uff0c\u5f88\u5bb9\u6613\u5206\u8fa8\u3002\u663e\u7136\u65b0 UID \u662f 2000 \u5f00\u59cb\u8fde\u7eed\u7684\u6700\u5927 UID + 1. GID \u5efa\u8bae\u4e0d\u8981\u6bcf\u4eba\u4e00\u4e2a\uff0c\u6211\u4eec\u5efa\u4e00\u4e2a group\uff0c\u7ed9\u5927\u5bb6\u90fd\u52a0\u8fdb\u6765\uff0c\u8fd9\u6837\u5c31\u53ea\u9700\u8981\u8003\u8651 UID \u7684\u589e\u957f\u4e86\u3002\u76ee\u524d\u8be5 group \u4e3a ldap_users\uff0cGID \u4e3a 2001\u3002 \u5efa\u8d26\u53f7\u4e4b\u524d\u5148\u6ce8\u610f\u4e00\u4e0b\u5404\u4e2a\u670d\u52a1\u5668\u4e0a\u6709\u6ca1\u6709\u76f8\u540c\u7684\u7528\u6237\u540d\uff0c\u6709\u7684\u8bdd\u628a\u539f\u5bb6\u76ee\u5f55 chown \u5230\u65b0\u7684 UID GID\uff0c\u5220\u9664\u540c\u540d\u7528\u6237\u3002 Groups \u4e2d\u4ee5 ssh \u5f00\u5934\u7684\u7ec4\u63a7\u5236\u5bf9\u5e94\u673a\u5668\u7684 ssh \u6743\u9650\uff0csudo \u5f00\u5934\u540c\u7406\u3002super_maneger \u7ec4\u5305\u542b\u6240\u6709\u673a\u5668\u7684\u6743\u9650\uff0c\u4ee5\u53ca LDAP \u7684 admin \u8eab\u4efd\u3002\u52a0\u5165\u5bf9\u5e94\u7684\u7ec4\u5373\u6388\u4e88\u76f8\u5e94\u6743\u9650\u3002 \u5df2\u77e5\u7684 GID Access Control \u00b6 \u8fd9\u91cc\u53ef\u4ee5\u914d\u7f6e GOsa \u7684\u7f16\u8f91\u6743\u9650\uff0c\u73b0\u5728\u8fd9\u91cc\u9762\u53ea\u6709\u4e00\u4e2a\u7ec4\uff0c\u662f\u5b8c\u5168\u6743\u9650\u7684\u3002\u53e6\u5916\uff0c\u6bcf\u4e2a\u9879\u53ef\u4ee5\u8bbe\u7f6e\u4e13\u95e8\u9488\u5bf9\u8fd9\u4e2a\u9879\u7684 ACL\u3002 Sudo rules \u00b6 \u8fd9\u91cc\u914d\u7f6e sudo \u6743\u9650\u3002\u8fd9\u91cc\u7684\u8bed\u6cd5\u548c sudoers \u4e00\u6837\uff08\u8bf7\u65e0\u89c6 System trust\uff09\u3002\u7279\u522b\u8981\u8bf4\u7684\u4e00\u70b9\u662f\u901a\u8fc7\u5728 System \u4e2d\u52a0\u5165\u4e3b\u673a\u540d\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e2a\u4e3b\u673a\u914d\u7f6e\u6743\u9650\uff0c\u8fd9\u91cc\u8981\u586b\u7684\u662f\u4e3b\u673a\u540d\u800c\u4e0d\u662f\u57df\u540d\uff0c\u5177\u4f53\u8303\u4f8b\u8bf7\u770b\u91cc\u9762\u7684 lugsu wikimanager \u7b49\u9879\u3002 \u5176\u5b83\u6211\u6ca1\u63d0\u5230\u7684\u9879\u6211\u4e5f\u6ca1\u641e\u660e\u767d\u600e\u4e48\u7528\u3002\u3002\u3002 gosa \u7684\u914d\u7f6e\u6587\u4ef6\u5728 /etc/gosa/gosa.conf \uff0c\u5b83\u662f\u5728\u7b2c\u4e00\u6b21\u8fd0\u884c gosa \u65f6\u5019\u81ea\u52a8\u751f\u6210\u7684\uff0c\u4f46\u5728\u4e4b\u540e\u5c31\u53ea\u80fd\u901a\u8fc7\u624b\u52a8\u7f16\u8f91\u6765\u4fee\u6539\u3002\u7531\u4e8e\u914d\u7f6e\u6587\u4ef6\u51e0\u4e4e\u6ca1\u6709\u6587\u6863\uff0c\u5b98\u65b9\u7684 FAQ \u6709\u597d\u591a\u662f\u9519\u7684\uff0c\u6240\u4ee5\u6211\u57fa\u672c\u6ca1\u52a8:-D\u3002 \u7ef4\u62a4\u5907\u6ce8 \u00b6 \u5982\u679c\u53d1\u73b0\u66f4\u65b0 GOsa \u4e4b\u540e\uff0c /gosa \u6ca1\u6709\u6b63\u5e38\u5de5\u4f5c\uff08\u6bd4\u5982\u8bf4\u76f4\u63a5\u663e\u793a\u4e86 PHP \u7684\u6e90\u4ee3\u7801\uff09\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5220\u9664 /var/spool/gosa/ \u4e2d\u7684\u6240\u6709\u6587\u4ef6\uff0c\u8be6\u89c1 Gosa broken in Debian stretch \u3002 LDAP \u5ba2\u6237\u7aef\u914d\u7f6e \u00b6 Debian \u914d\u7f6e\u65b9\u6cd5 \u00b6 \u8f6f\u4ef6\u5305\u5b89\u88c5 \u00b6 Debian 7 \u4ee5\u4e0a\u7cfb\u7edf\u5b89\u88c5 libnss-ldapd libpam-ldapd sudo-ldap \u6ce8 \uff1a\u66f4\u65b0\u8fd9\u4e9b\u8f6f\u4ef6\u5305\u65f6\uff0c\u6ce8\u610f\u4fdd\u7559\u4e00\u4e2aroot\u7ec8\u7aef\uff0c\u66f4\u65b0\u540e\u53ef\u80fd\u9700\u8981\u91cd\u542fdaemon\u8fdb\u7a0b \u5728\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4f1a\u88ab\u95ee\u4e00\u4e9b\u95ee\u9898\uff08\u4e0d\u540c\u7248\u672c\u7684 Debian \u7684\u95ee\u9898\u53ef\u80fd\u4e0d\u540c\uff09\uff1a LDAP \u670d\u52a1\u5668\u5730\u5740\u662f ldaps://ldap.lug.ustc.edu.cn Base DN \u4e3a dc=lug,dc=ustc,dc=edu,dc=cn \u534f\u8bae\u4e3a\u7248\u672c 3 \u914d\u7f6e libnss-ldapd \u65f6\u6709\u4e2a\u9009 Name services to configure \u7684\uff0c\u5168\u90e8\u9009\u4e0a /etc/ldap/ldap.conf \u00b6 \u7f16\u8f91 /etc/ldap/ldap.conf \u5185\u5bb9\u5982\u4e0b BASE dc=lug,dc=ustc,dc=edu,dc=cn URI ldaps://ldap.lug.ustc.edu.cn SSL yes TLS_CACERT /etc/ldap/slapd-ca-cert.pem TLS_REQCERT demand SUDOERS_BASE ou=sudoers,dc=lug,dc=ustc,dc=edu,dc=cn \u4e3a\u4e86\u5b89\u5168\u6027\u8003\u8651\uff0c\u8981\u4ee5 ldaps \u7684\u65b9\u5f0f\u8fde\u63a5 ldap \u670d\u52a1\u5668,\u540c\u65f6\u5e94\u914d\u7f6e\u597d\u8bc1\u4e66 ( /etc/ldap/slapd-ca-cert.pem , \u4ece\u5176\u5b83\u670d\u52a1\u5668\u590d\u5236\u4e00\u4e2a) /etc/sudo-ldap.conf \u00b6 \u8fd9\u4e2a\u6587\u4ef6\u5e94\u8be5\u76f4\u63a5\u8f6f\u94fe\u63a5\u5230 /etc/ldap/ldap.conf \uff0c\u901a\u5e38 dpkg \u5df2\u7ecf\u4e3a\u4f60\u521b\u5efa\u597d\u4e86\u3002 /etc/nslcd.conf \u00b6 \u6ce8\u610f\u68c0\u67e5\u4e00\u4e0b\u6b64\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u4e0e /etc/ldap/ldap.conf \u4e0b\u7684\u5185\u5bb9\u76f8\u4e00\u81f4\uff0c\u5982 uid nslcd gid nslcd uri ldaps://ldap.lug.ustc.edu.cn base dc=lug,dc=ustc,dc=edu,dc=cn ssl on tls_reqcert demand tls_cacertfile /etc/ldap/slapd-ca-cert.pem /etc/nsswitch.conf \u00b6 \u5b89\u88c5\u8f6f\u4ef6\u5305\u65f6\uff0c\u5b89\u88c5\u811a\u672c\u5df2\u7ecf\u5904\u7406\u8fc7\u8be5\u6587\u4ef6\u3002\u68c0\u67e5\u4e00\u4e0b\u5185\u5bb9\uff0c\u5927\u81f4\u4e3a\uff1a passwd: compat ldap group: compat ldap shadow: compat ldap ...... sudoers: files ldap \u6ce8\u610f\u6bcf\u4e00\u9879\u540e\u9762\u7684 ldap \uff0c\u5982\u679c\u6ca1\u6709\u8981\u624b\u52a8\u52a0\u4e0a\u3002\u4e0d\u592a\u6e05\u695a\u5177\u4f53\u542b\u4e49\uff0c\u53cd\u6b63\u7ed9\u6bcf\u4e00\u9879\u90fd\u52a0\u4e0a ldap \u662f\u6ca1\u6709\u95ee\u9898\u7684\u3002 Debian 10 \u8981\u6539\u4e00\u4e0b sudoers \u90a3\u4e00\u884c \u628a ldap \u653e\u524d\u9762\uff0c\u540c\u65f6\u52a0\u4e0a [SUCCESS=return] \u5e94\u8be5\u50cf\u4e0b\u9762\u8fd9\u6837\uff1a sudoers: ldap [SUCCESS=return] files \u91cd\u542f\u4e00\u4e0b nscd \u548c nslcd \u670d\u52a1\uff0c\u6b64\u65f6\u8fd0\u884c getent passwd \uff0c\u5e94\u8be5\u53ef\u4ee5\u770b\u5230\u6bd4 /etc/passwd \u66f4\u591a\u7684\u5185\u5bb9\uff0c\u8fd9\u5c31\u8bf4\u660e\u914d\u7f6e\u6b63\u786e\u4e86\u3002 PAM \u914d\u7f6e \u00b6 \u5982\u679c PAM \u914d\u7f6e\u9519\u8bef\uff0c\u53ef\u80fd\u5bfc\u81f4\u7528\u6237\u65e0\u6cd5\u4f7f\u7528 SSH \u767b\u5f55\uff0c\u751a\u81f3\u8fde sudo \u4e5f\u53ef\u80fd\u6302\u6389\u3002\u6240\u4ee5\u4fee\u6539 PAM \u914d\u7f6e\u65f6\uff1a \u8bf7\u505a\u597d\u6587\u4ef6\u5907\u4efd\uff1b \u8bf7\u53e6\u5f00\u4e00\u4e2a root \u7ec8\u7aef\u4ee5\u9632\u4e07\u4e00\u3002 \u5bf9\u4e8e Debian 7+\uff0c\u53ea\u9700\u8bbe\u7f6e\u4e00\u5904\u3002\u4e3a\u4e86\u767b\u5f55\u65f6\u81ea\u52a8\u521b\u5efa\u5bb6\u76ee\u5f55\uff0c\u5728 /etc/pam.d/common-session \u4e2d\u6dfb\u52a0\u4e0b\u9762\u8fd9\u53e5\uff1a session required pam_mkhomedir.so skel=/etc/skel umask=0022 \u5bf9\u4e8e Debian 5\uff0c\u8bf7\u67e5\u9605\u672c\u6587\u6863\u7684 Git \u8bb0\u5f55\u3002 CentOS \u914d\u7f6e\u65b9\u6cd5 \u00b6 \u901a\u8fc7 yum \u5b89\u88c5 openldap openldap-clients nss_ldap nss-pam-ldap \u4ee5 root \u8eab\u4efd\u6267\u884c authconfig --enablecache \\ --enableldap \\ --enableldapauth \\ --ldapserver = \"ldaps://ldap.lug.ustc.edu.cn/\" \\ --ldapbasedn = \"dc=lug,dc=ustc,dc=edu,dc=cn\" \\ --enableshadow \\ --enablemkhomedir \\ --enablelocauthorize \\ --update \u6ce8\u610f\uff0c\u7531\u4e8e authconfig \u7684 bug\uff0c\u4e0a\u4e00\u6761\u547d\u4ee4\u7684\u6267\u884c\u73af\u5883\u5fc5\u987b\u662f LC_ALL=en_US.UTF-8 Sudo \u7684\u914d\u7f6e\u662f\u901a\u8fc7 sssd \u5b9e\u73b0\u7684\uff0c\u53c2\u8003 https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/sssd-ldap-sudo.html \u5b89\u88c5 sssd libsss_sudo \u5c06 /usr/share/doc/sssd-common/sssd-example.conf \u590d\u5236\u5230 /etc/sssd/sssd.conf \u5e76\u4fee\u6539\u6743\u9650\u4e3a 600\u3002 [taoky@gateway-nic ~]$ sudo diff /usr/share/doc/sssd-common/sssd-example.conf /etc/sssd/sssd.conf 3c3 < services = nss, pam --- > services = nss, pam, sudo 8c8 < ; domains = LDAP --- > domains = LDAP 13a14,15 > [sudo] > 15,17c17,19 < ; [domain/LDAP] < ; id_provider = ldap < ; auth_provider = ldap --- > [domain/LDAP] > id_provider = ldap > auth_provider = ldap 22,24c24,27 < ; ldap_schema = rfc2307 < ; ldap_uri = ldap://ldap.mydomain.org < ; ldap_search_base = dc=mydomain,dc=org --- > ldap_schema = rfc2307 > ldap_uri = ldaps://ldap.lug.ustc.edu.cn > ldap_search_base = dc=lug,dc=ustc,dc=edu,dc=cn > ldap_sudo_search_base = ou=sudoers,dc=lug,dc=ustc,dc=edu,dc=cn 30c33 < ; cache_credentials = true --- > cache_credentials = true 35c38 < # you must install Microsoft Services For UNIX and map LDAP attributes onto --- > # you must install Microsoft Services For Unix and map LDAP attributes onto \u5751 \u9700\u8981\u52a0\u4e0a [sudo] \uff0c\u5426\u5219 sudo \u914d\u7f6e\u4f3c\u4e4e\u4e0d\u4f1a\u751f\u6548\uff0c\u8fd9\u4e2a\u914d\u7f6e\u95ee\u9898\u5bfc\u81f4\u4e86\u4fee\u6539\u524d\u5728 gateway-nic \u4e0a\u7528\u6237\u65e0\u6cd5\u4f7f\u7528 sudo\u3002 \u53e6\u5916\u8bb0\u5f97\u50cf\u524d\u9762\u5728 Debian \u4e2d\u5b89\u88c5\u4ecb\u7ecd\u5230\u7684\u90a3\u6837\u4fee\u6539 /etc/nsswitch.conf \u4ee5\u53ca /etc/nslcd.conf . NSCD \u4f7f\u7528\u8bf4\u660e \u00b6 NSCD \u662f\u7528\u4e8e LDAP \u7f13\u5b58\u7684\u670d\u52a1\uff0c\u76ee\u524d\u5728 mirrors \u4e0a\u7684\u914d\u7f6e\u662f\u4fdd\u6301 30 \u5929\u3002\u8fd9\u5bfc\u81f4\u7684\u95ee\u9898\u662f\u6bcf\u5f53 ldap \u670d\u52a1\u5668\u4e0a\u505a\u51fa\u4fee\u6539\u7684\u65f6\u5019\u9700\u8981\u5728 mirrors \u4e0a\u6267\u884c (\u76ee\u524d mirrors \u670d\u52a1\u5668\u6682\u672a\u914d\u7f6e LDAP \u8ba4\u8bc1\u3002) nscd -i passwd nscd -i group \u53c2\u8003\uff1a https://wiki.debian.org/LDAP/NSS LDAP CLI \u5de5\u5177\u4f7f\u7528\u8bf4\u660e \u00b6 \u8fd9\u91cc\u4ee5 ldappasswd \u4e3a\u4f8b\uff0c\u5176\u4f59 ladp-series \u6307\u4ee4\u4e0e\u5176\u5927\u81f4\u76f8\u540c\uff1a LDAP \u5229\u7528 dn \u6765\u5b9a\u4f4d\u4e00\u4e2a\u7528\u6237\uff0c\u4ee5\u4e0b\u6307\u4ee4\u53ef\u4ee5\u5217\u51fa\u6240\u6709\u7528\u6237\u53ca\u5176 dn\uff1a ldapsearch -x -LLL uid = * uid -x \u6307\u5b9a\u4f7f\u7528 Simple authentication\uff0c\u5373\u4f7f\u7528\u5bc6\u7801\u8ba4\u8bc1\u3002 \u5982\u679c\u8981\u4fee\u6539\u4e00\u4e2a\u7528\u6237\u7684\u5bc6\u7801\uff0c\u4f7f\u7528\uff1a ldappasswd -x -D '<executor dn>' -W -S '<target user dn>' -D '<executor dn>' \u6307\u5b9a\u4e86\u6267\u884c\u8005\u7684\u8eab\u4efd\uff0c -W / -S \u6307\u5b9a\u4e86\u63a5\u4e0b\u6765\u8be2\u95ee\u6267\u884c\u8005/\u76ee\u6807\u7528\u6237\u7684\u5bc6\u7801/\u65e7\u5bc6\u7801\u3002 \u9700\u8981\u989d\u5916\u6ce8\u610f\u7684\u662f\uff0c\u5728 CLI \u4e2d\u6dfb\u52a0/\u5220\u9664\u7528\u6237\u6216\u66f4\u6539\u7528\u6237\u5bc6\u7801\u65f6\u9700\u8981\u4ee5 LDAP admin \u6267\u884c\uff0c\u5426\u5219\u4f1a\u6709\u62a5\u9519\uff1a Insufficient access (50) additional info: no write access to parent \u6216\u662f\u5176\u4ed6\u7684\u6743\u9650\u4e0d\u8db3\u7684\u9519\u8bef\u3002 \u90e8\u7f72\u60c5\u51b5 \u00b6 \u76ee\u524d\u6240\u6709\u670d\u52a1\u5668\u5747\u5df2\u90e8\u7f72 LDAP \u5df2\u77e5\u7684 GID \u00b6 GID \u4fe1\u606f\u5df2\u8fc7\u65f6\uff0c\u4ee5 LDAP \u5b9e\u9645\u914d\u7f6e\u4e3a\u51c6\u3002 GID \u540d\u79f0 \u8bf4\u660e 2001 ldap_users \u6240\u6709\u7528\u6237\u90fd\u5728\u8fd9\u4e2a\u7ec4\u91cc 1001 ssh_docker2 - 2013 ssh_bbs - 2014 ssh_linode - 2101 ssh_ldap - 2102 ssh_blog - 2103 ssh_dns - 2104 ssh_gitlab - 2105 ssh_lug - 2106 ssh_vpn - 2107 ssh_mirrors - 2108 ssh_pxe - 2109 ssh_freeshell - 2110 ssh_backup - 2112 ssh_vmnfs - 2113 ssh_homepage - 2201 sudo_ldap - 2202 sudo_blog - 2203 sudo_dns - 2204 sudo_gitlab - 2205 sudo_lug - 2206 sudo_vpn - 2207 sudo_mirrors - 2208 sudo_pxe - 2209 sudo_freeshell - 2210 sudo_backup - 2212 sudo_vmnfs - 2213 sudo_homepage - 2000 super_manager - 2999 nologin \u4e0d\u786e\u5b9a\u8fd9\u4e2a\u7ec4\u6709\u6ca1\u6709\u7528 \u4ece\u4e0a\u6587\u7684\u89c4\u8303\u6765\u8bb2\uff0c\u5e94\u8be5\u4ece 2000 \u5f00\u59cb\u7f16\u53f7 GID\uff0c\u4f46\u6709\u4e9b\u7ec4\u53ef\u80fd\u521b\u5efa\u8005\u6ca1\u6ce8\u610f\uff0c\u4e0d\u8fc7\u540e\u671f\u518d\u6539\u5c31\u4e0d\u65b9\u4fbf\u4e86\u3002 ssh_* \u8fd9\u4e9b\u7ec4\uff0c\u662f\u5728\u6bcf\u4e2a\u4e3b\u673a\u7684 sshd_config \u91cc\u53ea\u5141\u8bb8\u76f8\u5e94\u7684\u7ec4\u767b\u9646\u3002 sudo_* \u8fd9\u4e9b\u7ec4\uff0c\u662f\u5728 LDAP sudo rules \u91cc\u5141\u8bb8\u4e86\u76f8\u5e94\u7684\u7ec4\u3002 \u6ce8\u610f\u4e8b\u9879 LDAP \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u52a1\u5fc5\u786e\u8ba4 sshd_config \u5df2\u7ecf\u9650\u5236\u4e86\u516c\u7f51\u767b\u5f55\u3002 \u672c\u6587\u6863\u539f\u59cb\u7248\u672c\u590d\u5236\u81ea LUG wiki\uff0c\u7531\u5f20\u5149\u5b87\u3001\u5d14\u704f\u3001\u6731\u665f\u83c1\u3001\u5de6\u683c\u975e\u64b0\u5199\u3002","title":"Servers Unified Authentication (LDAP)"},{"location":"infrastructure/ldap/#ldap","text":"LDAP \u662f\u8f7b\u91cf\u76ee\u5f55\u8bbf\u95ee\u534f\u8bae\uff0c\u6211\u4eec\u7528\u7684\u8f6f\u4ef6\u662f OpenLDAP\u3002 LDAP \u7684\u914d\u7f6e\u5f88\u9ebb\u70e6\uff0c\u6240\u4ee5\u88c5\u4e86\u4e00\u4e2a\u7f51\u9875\u524d\u7aef\u6765\u914d\u7f6e\u5b83\uff0c\u7f51\u9875\u524d\u7aef\u662f GOsa\u00b2\u3002","title":"LDAP \u670d\u52a1\u4f7f\u7528\u53ca\u914d\u7f6e\u8bf4\u660e"},{"location":"infrastructure/ldap/#_1","text":"\u767b\u5f55\u4efb\u610f\u4e00\u53f0\u670d\u52a1\u5668\u4f7f\u7528 passwd \u5c31\u53ef\u4ee5\u4fee\u6539\u5bc6\u7801\uff0c\u4fee\u6539\u7684\u5bc6\u7801\u5728\u6240\u6709\u673a\u5668\u4e0a\u5b9e\u65f6\u751f\u6548\uff08\u56e0\u4e3a\u5b9e\u9645\u662f\u5b58\u5728 LDAP \u6570\u636e\u5e93\u91cc\u7684\uff09\u3002","title":"\u5bc6\u7801\u4fee\u6539"},{"location":"infrastructure/ldap/#gosa","text":"\u7f51\u9875\u754c\u9762\u4f4d\u4e8e ldap.lug.ustc.edu.cn \u3002 \u7528\u4f60\u7684\u8d26\u53f7\u767b\u5f55\u8fdb\u53bb\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728\u53f3\u4e0a\u89d2\u9000\u51fa\uff0c\u53f3\u4e0a\u89d2\u8fd8\u6709\u4e24\u4e2a\u6309\u94ae\u5206\u522b\u662f\u4fee\u6539\u8d26\u53f7\u4fe1\u606f\u548c\u4fee\u6539\u5bc6\u7801\u3002\u8d26\u53f7\u4fe1\u606f\u7b2c\u4e00\u9875\u5927\u90e8\u5206\u662f\u6ca1\u7528\u7684\uff0c\u53ea\u6709\u4e00\u4e2a\u767b\u5f55\u540d\u662f\u6709\u7528\u7684\uff0c\u8fd9\u662f\u4f60\u767b\u5f55\u4efb\u4f55\u5730\u65b9\u7684\u7528\u6237\u540d\u3002","title":"GOsa \u4f7f\u7528"},{"location":"infrastructure/ldap/#ldap-users-and-groups","text":"Users \u662f\u7528\u6765\u6dfb\u52a0\u548c\u914d\u7f6e\u7528\u6237\u4fe1\u606f\u7684\u5730\u65b9\u3002\u6700\u4e3b\u8981\u7684\u529f\u80fd\u4f4d\u4e8e\u6bcf\u4e2a User \u7684\u7b2c\u4e8c\u9875 POSIX\uff0c\u8fd9\u91cc\u53ef\u4ee5\u8bbe\u7f6e\u7528\u6237\u7684\u5bb6\u76ee\u5f55\uff0cUID\uff0cGID\uff0c\u4ee5\u53ca\u6240\u5c5e\u7684\u7528\u6237\u7ec4\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u5982\u4e0b\uff1a UID\uff0cGID \u4ece 2000 \u5f00\u59cb\u8ba1\u6570\uff0c\u7531\u4e8e gosa \u4e0d\u80fd\u5bf9 UID \u81ea\u52a8\u589e\u957f\uff0c\u6240\u4ee5\u7ba1\u7406\u5458\u9700\u8981\u4eba\u5de5\u589e\u957f\u3002\u65b9\u6cd5\u662f\u767b\u5f55\u4efb\u610f\u4e00\u53f0\u673a\u5668\uff0c\u8fd0\u884c getent passwd \u5e76\u89c2\u5bdf\u8f93\u51fa\uff0c\u53d6\u6700\u5927\u7684 UID + 1 \u5c31\u884c\u4e86\u3002 \u5751 \u5c0f\u5fc3\u8f93\u51fa\u7684\u987a\u5e8f\uff0c\u6700\u5927\u7684 UID \u4e0d\u4e00\u5b9a\u662f\u6700\u540e\u4e00\u4e2a\uff08\u800c\u4e14\u4e8b\u5b9e\u4e0a\u7ecf\u5e38\u4e0d\u662f\uff09\uff0c\u5efa\u8bae\u914d\u5408 sed, awk, sort \u4e4b\u7c7b\u7684\u547d\u4ee4\u59a5\u5584\u5904\u7406\uff0c\u4f8b\u5982 getent passwd | cut -d: -f3 | sort -n \u540c\u65f6\u8fd8\u6709\u82e5\u5e72 UID \u5f88\u5927\u4f46\u662f\u79bb\u6563\u7684\u7279\u6b8a\u8d26\u53f7\uff0c\u5f88\u5bb9\u6613\u5206\u8fa8\u3002\u663e\u7136\u65b0 UID \u662f 2000 \u5f00\u59cb\u8fde\u7eed\u7684\u6700\u5927 UID + 1. GID \u5efa\u8bae\u4e0d\u8981\u6bcf\u4eba\u4e00\u4e2a\uff0c\u6211\u4eec\u5efa\u4e00\u4e2a group\uff0c\u7ed9\u5927\u5bb6\u90fd\u52a0\u8fdb\u6765\uff0c\u8fd9\u6837\u5c31\u53ea\u9700\u8981\u8003\u8651 UID \u7684\u589e\u957f\u4e86\u3002\u76ee\u524d\u8be5 group \u4e3a ldap_users\uff0cGID \u4e3a 2001\u3002 \u5efa\u8d26\u53f7\u4e4b\u524d\u5148\u6ce8\u610f\u4e00\u4e0b\u5404\u4e2a\u670d\u52a1\u5668\u4e0a\u6709\u6ca1\u6709\u76f8\u540c\u7684\u7528\u6237\u540d\uff0c\u6709\u7684\u8bdd\u628a\u539f\u5bb6\u76ee\u5f55 chown \u5230\u65b0\u7684 UID GID\uff0c\u5220\u9664\u540c\u540d\u7528\u6237\u3002 Groups \u4e2d\u4ee5 ssh \u5f00\u5934\u7684\u7ec4\u63a7\u5236\u5bf9\u5e94\u673a\u5668\u7684 ssh \u6743\u9650\uff0csudo \u5f00\u5934\u540c\u7406\u3002super_maneger \u7ec4\u5305\u542b\u6240\u6709\u673a\u5668\u7684\u6743\u9650\uff0c\u4ee5\u53ca LDAP \u7684 admin \u8eab\u4efd\u3002\u52a0\u5165\u5bf9\u5e94\u7684\u7ec4\u5373\u6388\u4e88\u76f8\u5e94\u6743\u9650\u3002 \u5df2\u77e5\u7684 GID","title":"Users \u548c Groups"},{"location":"infrastructure/ldap/#access-control","text":"\u8fd9\u91cc\u53ef\u4ee5\u914d\u7f6e GOsa \u7684\u7f16\u8f91\u6743\u9650\uff0c\u73b0\u5728\u8fd9\u91cc\u9762\u53ea\u6709\u4e00\u4e2a\u7ec4\uff0c\u662f\u5b8c\u5168\u6743\u9650\u7684\u3002\u53e6\u5916\uff0c\u6bcf\u4e2a\u9879\u53ef\u4ee5\u8bbe\u7f6e\u4e13\u95e8\u9488\u5bf9\u8fd9\u4e2a\u9879\u7684 ACL\u3002","title":"Access Control"},{"location":"infrastructure/ldap/#sudo-rules","text":"\u8fd9\u91cc\u914d\u7f6e sudo \u6743\u9650\u3002\u8fd9\u91cc\u7684\u8bed\u6cd5\u548c sudoers \u4e00\u6837\uff08\u8bf7\u65e0\u89c6 System trust\uff09\u3002\u7279\u522b\u8981\u8bf4\u7684\u4e00\u70b9\u662f\u901a\u8fc7\u5728 System \u4e2d\u52a0\u5165\u4e3b\u673a\u540d\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e2a\u4e3b\u673a\u914d\u7f6e\u6743\u9650\uff0c\u8fd9\u91cc\u8981\u586b\u7684\u662f\u4e3b\u673a\u540d\u800c\u4e0d\u662f\u57df\u540d\uff0c\u5177\u4f53\u8303\u4f8b\u8bf7\u770b\u91cc\u9762\u7684 lugsu wikimanager \u7b49\u9879\u3002 \u5176\u5b83\u6211\u6ca1\u63d0\u5230\u7684\u9879\u6211\u4e5f\u6ca1\u641e\u660e\u767d\u600e\u4e48\u7528\u3002\u3002\u3002 gosa \u7684\u914d\u7f6e\u6587\u4ef6\u5728 /etc/gosa/gosa.conf \uff0c\u5b83\u662f\u5728\u7b2c\u4e00\u6b21\u8fd0\u884c gosa \u65f6\u5019\u81ea\u52a8\u751f\u6210\u7684\uff0c\u4f46\u5728\u4e4b\u540e\u5c31\u53ea\u80fd\u901a\u8fc7\u624b\u52a8\u7f16\u8f91\u6765\u4fee\u6539\u3002\u7531\u4e8e\u914d\u7f6e\u6587\u4ef6\u51e0\u4e4e\u6ca1\u6709\u6587\u6863\uff0c\u5b98\u65b9\u7684 FAQ \u6709\u597d\u591a\u662f\u9519\u7684\uff0c\u6240\u4ee5\u6211\u57fa\u672c\u6ca1\u52a8:-D\u3002","title":"Sudo rules"},{"location":"infrastructure/ldap/#_2","text":"\u5982\u679c\u53d1\u73b0\u66f4\u65b0 GOsa \u4e4b\u540e\uff0c /gosa \u6ca1\u6709\u6b63\u5e38\u5de5\u4f5c\uff08\u6bd4\u5982\u8bf4\u76f4\u63a5\u663e\u793a\u4e86 PHP \u7684\u6e90\u4ee3\u7801\uff09\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5220\u9664 /var/spool/gosa/ \u4e2d\u7684\u6240\u6709\u6587\u4ef6\uff0c\u8be6\u89c1 Gosa broken in Debian stretch \u3002","title":"\u7ef4\u62a4\u5907\u6ce8"},{"location":"infrastructure/ldap/#ldap_1","text":"","title":"LDAP \u5ba2\u6237\u7aef\u914d\u7f6e"},{"location":"infrastructure/ldap/#debian","text":"","title":"Debian \u914d\u7f6e\u65b9\u6cd5"},{"location":"infrastructure/ldap/#_3","text":"Debian 7 \u4ee5\u4e0a\u7cfb\u7edf\u5b89\u88c5 libnss-ldapd libpam-ldapd sudo-ldap \u6ce8 \uff1a\u66f4\u65b0\u8fd9\u4e9b\u8f6f\u4ef6\u5305\u65f6\uff0c\u6ce8\u610f\u4fdd\u7559\u4e00\u4e2aroot\u7ec8\u7aef\uff0c\u66f4\u65b0\u540e\u53ef\u80fd\u9700\u8981\u91cd\u542fdaemon\u8fdb\u7a0b \u5728\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4f1a\u88ab\u95ee\u4e00\u4e9b\u95ee\u9898\uff08\u4e0d\u540c\u7248\u672c\u7684 Debian \u7684\u95ee\u9898\u53ef\u80fd\u4e0d\u540c\uff09\uff1a LDAP \u670d\u52a1\u5668\u5730\u5740\u662f ldaps://ldap.lug.ustc.edu.cn Base DN \u4e3a dc=lug,dc=ustc,dc=edu,dc=cn \u534f\u8bae\u4e3a\u7248\u672c 3 \u914d\u7f6e libnss-ldapd \u65f6\u6709\u4e2a\u9009 Name services to configure \u7684\uff0c\u5168\u90e8\u9009\u4e0a","title":"\u8f6f\u4ef6\u5305\u5b89\u88c5"},{"location":"infrastructure/ldap/#etcldapldapconf","text":"\u7f16\u8f91 /etc/ldap/ldap.conf \u5185\u5bb9\u5982\u4e0b BASE dc=lug,dc=ustc,dc=edu,dc=cn URI ldaps://ldap.lug.ustc.edu.cn SSL yes TLS_CACERT /etc/ldap/slapd-ca-cert.pem TLS_REQCERT demand SUDOERS_BASE ou=sudoers,dc=lug,dc=ustc,dc=edu,dc=cn \u4e3a\u4e86\u5b89\u5168\u6027\u8003\u8651\uff0c\u8981\u4ee5 ldaps \u7684\u65b9\u5f0f\u8fde\u63a5 ldap \u670d\u52a1\u5668,\u540c\u65f6\u5e94\u914d\u7f6e\u597d\u8bc1\u4e66 ( /etc/ldap/slapd-ca-cert.pem , \u4ece\u5176\u5b83\u670d\u52a1\u5668\u590d\u5236\u4e00\u4e2a)","title":"/etc/ldap/ldap.conf"},{"location":"infrastructure/ldap/#etcsudo-ldapconf","text":"\u8fd9\u4e2a\u6587\u4ef6\u5e94\u8be5\u76f4\u63a5\u8f6f\u94fe\u63a5\u5230 /etc/ldap/ldap.conf \uff0c\u901a\u5e38 dpkg \u5df2\u7ecf\u4e3a\u4f60\u521b\u5efa\u597d\u4e86\u3002","title":"/etc/sudo-ldap.conf"},{"location":"infrastructure/ldap/#etcnslcdconf","text":"\u6ce8\u610f\u68c0\u67e5\u4e00\u4e0b\u6b64\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u4e0e /etc/ldap/ldap.conf \u4e0b\u7684\u5185\u5bb9\u76f8\u4e00\u81f4\uff0c\u5982 uid nslcd gid nslcd uri ldaps://ldap.lug.ustc.edu.cn base dc=lug,dc=ustc,dc=edu,dc=cn ssl on tls_reqcert demand tls_cacertfile /etc/ldap/slapd-ca-cert.pem","title":"/etc/nslcd.conf"},{"location":"infrastructure/ldap/#etcnsswitchconf","text":"\u5b89\u88c5\u8f6f\u4ef6\u5305\u65f6\uff0c\u5b89\u88c5\u811a\u672c\u5df2\u7ecf\u5904\u7406\u8fc7\u8be5\u6587\u4ef6\u3002\u68c0\u67e5\u4e00\u4e0b\u5185\u5bb9\uff0c\u5927\u81f4\u4e3a\uff1a passwd: compat ldap group: compat ldap shadow: compat ldap ...... sudoers: files ldap \u6ce8\u610f\u6bcf\u4e00\u9879\u540e\u9762\u7684 ldap \uff0c\u5982\u679c\u6ca1\u6709\u8981\u624b\u52a8\u52a0\u4e0a\u3002\u4e0d\u592a\u6e05\u695a\u5177\u4f53\u542b\u4e49\uff0c\u53cd\u6b63\u7ed9\u6bcf\u4e00\u9879\u90fd\u52a0\u4e0a ldap \u662f\u6ca1\u6709\u95ee\u9898\u7684\u3002 Debian 10 \u8981\u6539\u4e00\u4e0b sudoers \u90a3\u4e00\u884c \u628a ldap \u653e\u524d\u9762\uff0c\u540c\u65f6\u52a0\u4e0a [SUCCESS=return] \u5e94\u8be5\u50cf\u4e0b\u9762\u8fd9\u6837\uff1a sudoers: ldap [SUCCESS=return] files \u91cd\u542f\u4e00\u4e0b nscd \u548c nslcd \u670d\u52a1\uff0c\u6b64\u65f6\u8fd0\u884c getent passwd \uff0c\u5e94\u8be5\u53ef\u4ee5\u770b\u5230\u6bd4 /etc/passwd \u66f4\u591a\u7684\u5185\u5bb9\uff0c\u8fd9\u5c31\u8bf4\u660e\u914d\u7f6e\u6b63\u786e\u4e86\u3002","title":"/etc/nsswitch.conf"},{"location":"infrastructure/ldap/#pam","text":"\u5982\u679c PAM \u914d\u7f6e\u9519\u8bef\uff0c\u53ef\u80fd\u5bfc\u81f4\u7528\u6237\u65e0\u6cd5\u4f7f\u7528 SSH \u767b\u5f55\uff0c\u751a\u81f3\u8fde sudo \u4e5f\u53ef\u80fd\u6302\u6389\u3002\u6240\u4ee5\u4fee\u6539 PAM \u914d\u7f6e\u65f6\uff1a \u8bf7\u505a\u597d\u6587\u4ef6\u5907\u4efd\uff1b \u8bf7\u53e6\u5f00\u4e00\u4e2a root \u7ec8\u7aef\u4ee5\u9632\u4e07\u4e00\u3002 \u5bf9\u4e8e Debian 7+\uff0c\u53ea\u9700\u8bbe\u7f6e\u4e00\u5904\u3002\u4e3a\u4e86\u767b\u5f55\u65f6\u81ea\u52a8\u521b\u5efa\u5bb6\u76ee\u5f55\uff0c\u5728 /etc/pam.d/common-session \u4e2d\u6dfb\u52a0\u4e0b\u9762\u8fd9\u53e5\uff1a session required pam_mkhomedir.so skel=/etc/skel umask=0022 \u5bf9\u4e8e Debian 5\uff0c\u8bf7\u67e5\u9605\u672c\u6587\u6863\u7684 Git \u8bb0\u5f55\u3002","title":"PAM \u914d\u7f6e"},{"location":"infrastructure/ldap/#centos","text":"\u901a\u8fc7 yum \u5b89\u88c5 openldap openldap-clients nss_ldap nss-pam-ldap \u4ee5 root \u8eab\u4efd\u6267\u884c authconfig --enablecache \\ --enableldap \\ --enableldapauth \\ --ldapserver = \"ldaps://ldap.lug.ustc.edu.cn/\" \\ --ldapbasedn = \"dc=lug,dc=ustc,dc=edu,dc=cn\" \\ --enableshadow \\ --enablemkhomedir \\ --enablelocauthorize \\ --update \u6ce8\u610f\uff0c\u7531\u4e8e authconfig \u7684 bug\uff0c\u4e0a\u4e00\u6761\u547d\u4ee4\u7684\u6267\u884c\u73af\u5883\u5fc5\u987b\u662f LC_ALL=en_US.UTF-8 Sudo \u7684\u914d\u7f6e\u662f\u901a\u8fc7 sssd \u5b9e\u73b0\u7684\uff0c\u53c2\u8003 https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/sssd-ldap-sudo.html \u5b89\u88c5 sssd libsss_sudo \u5c06 /usr/share/doc/sssd-common/sssd-example.conf \u590d\u5236\u5230 /etc/sssd/sssd.conf \u5e76\u4fee\u6539\u6743\u9650\u4e3a 600\u3002 [taoky@gateway-nic ~]$ sudo diff /usr/share/doc/sssd-common/sssd-example.conf /etc/sssd/sssd.conf 3c3 < services = nss, pam --- > services = nss, pam, sudo 8c8 < ; domains = LDAP --- > domains = LDAP 13a14,15 > [sudo] > 15,17c17,19 < ; [domain/LDAP] < ; id_provider = ldap < ; auth_provider = ldap --- > [domain/LDAP] > id_provider = ldap > auth_provider = ldap 22,24c24,27 < ; ldap_schema = rfc2307 < ; ldap_uri = ldap://ldap.mydomain.org < ; ldap_search_base = dc=mydomain,dc=org --- > ldap_schema = rfc2307 > ldap_uri = ldaps://ldap.lug.ustc.edu.cn > ldap_search_base = dc=lug,dc=ustc,dc=edu,dc=cn > ldap_sudo_search_base = ou=sudoers,dc=lug,dc=ustc,dc=edu,dc=cn 30c33 < ; cache_credentials = true --- > cache_credentials = true 35c38 < # you must install Microsoft Services For UNIX and map LDAP attributes onto --- > # you must install Microsoft Services For Unix and map LDAP attributes onto \u5751 \u9700\u8981\u52a0\u4e0a [sudo] \uff0c\u5426\u5219 sudo \u914d\u7f6e\u4f3c\u4e4e\u4e0d\u4f1a\u751f\u6548\uff0c\u8fd9\u4e2a\u914d\u7f6e\u95ee\u9898\u5bfc\u81f4\u4e86\u4fee\u6539\u524d\u5728 gateway-nic \u4e0a\u7528\u6237\u65e0\u6cd5\u4f7f\u7528 sudo\u3002 \u53e6\u5916\u8bb0\u5f97\u50cf\u524d\u9762\u5728 Debian \u4e2d\u5b89\u88c5\u4ecb\u7ecd\u5230\u7684\u90a3\u6837\u4fee\u6539 /etc/nsswitch.conf \u4ee5\u53ca /etc/nslcd.conf .","title":"CentOS \u914d\u7f6e\u65b9\u6cd5"},{"location":"infrastructure/ldap/#nscd","text":"NSCD \u662f\u7528\u4e8e LDAP \u7f13\u5b58\u7684\u670d\u52a1\uff0c\u76ee\u524d\u5728 mirrors \u4e0a\u7684\u914d\u7f6e\u662f\u4fdd\u6301 30 \u5929\u3002\u8fd9\u5bfc\u81f4\u7684\u95ee\u9898\u662f\u6bcf\u5f53 ldap \u670d\u52a1\u5668\u4e0a\u505a\u51fa\u4fee\u6539\u7684\u65f6\u5019\u9700\u8981\u5728 mirrors \u4e0a\u6267\u884c (\u76ee\u524d mirrors \u670d\u52a1\u5668\u6682\u672a\u914d\u7f6e LDAP \u8ba4\u8bc1\u3002) nscd -i passwd nscd -i group \u53c2\u8003\uff1a https://wiki.debian.org/LDAP/NSS","title":"NSCD \u4f7f\u7528\u8bf4\u660e"},{"location":"infrastructure/ldap/#ldap-cli","text":"\u8fd9\u91cc\u4ee5 ldappasswd \u4e3a\u4f8b\uff0c\u5176\u4f59 ladp-series \u6307\u4ee4\u4e0e\u5176\u5927\u81f4\u76f8\u540c\uff1a LDAP \u5229\u7528 dn \u6765\u5b9a\u4f4d\u4e00\u4e2a\u7528\u6237\uff0c\u4ee5\u4e0b\u6307\u4ee4\u53ef\u4ee5\u5217\u51fa\u6240\u6709\u7528\u6237\u53ca\u5176 dn\uff1a ldapsearch -x -LLL uid = * uid -x \u6307\u5b9a\u4f7f\u7528 Simple authentication\uff0c\u5373\u4f7f\u7528\u5bc6\u7801\u8ba4\u8bc1\u3002 \u5982\u679c\u8981\u4fee\u6539\u4e00\u4e2a\u7528\u6237\u7684\u5bc6\u7801\uff0c\u4f7f\u7528\uff1a ldappasswd -x -D '<executor dn>' -W -S '<target user dn>' -D '<executor dn>' \u6307\u5b9a\u4e86\u6267\u884c\u8005\u7684\u8eab\u4efd\uff0c -W / -S \u6307\u5b9a\u4e86\u63a5\u4e0b\u6765\u8be2\u95ee\u6267\u884c\u8005/\u76ee\u6807\u7528\u6237\u7684\u5bc6\u7801/\u65e7\u5bc6\u7801\u3002 \u9700\u8981\u989d\u5916\u6ce8\u610f\u7684\u662f\uff0c\u5728 CLI \u4e2d\u6dfb\u52a0/\u5220\u9664\u7528\u6237\u6216\u66f4\u6539\u7528\u6237\u5bc6\u7801\u65f6\u9700\u8981\u4ee5 LDAP admin \u6267\u884c\uff0c\u5426\u5219\u4f1a\u6709\u62a5\u9519\uff1a Insufficient access (50) additional info: no write access to parent \u6216\u662f\u5176\u4ed6\u7684\u6743\u9650\u4e0d\u8db3\u7684\u9519\u8bef\u3002","title":"LDAP CLI \u5de5\u5177\u4f7f\u7528\u8bf4\u660e"},{"location":"infrastructure/ldap/#_4","text":"\u76ee\u524d\u6240\u6709\u670d\u52a1\u5668\u5747\u5df2\u90e8\u7f72 LDAP","title":"\u90e8\u7f72\u60c5\u51b5"},{"location":"infrastructure/ldap/#ldap-known-gids","text":"GID \u4fe1\u606f\u5df2\u8fc7\u65f6\uff0c\u4ee5 LDAP \u5b9e\u9645\u914d\u7f6e\u4e3a\u51c6\u3002 GID \u540d\u79f0 \u8bf4\u660e 2001 ldap_users \u6240\u6709\u7528\u6237\u90fd\u5728\u8fd9\u4e2a\u7ec4\u91cc 1001 ssh_docker2 - 2013 ssh_bbs - 2014 ssh_linode - 2101 ssh_ldap - 2102 ssh_blog - 2103 ssh_dns - 2104 ssh_gitlab - 2105 ssh_lug - 2106 ssh_vpn - 2107 ssh_mirrors - 2108 ssh_pxe - 2109 ssh_freeshell - 2110 ssh_backup - 2112 ssh_vmnfs - 2113 ssh_homepage - 2201 sudo_ldap - 2202 sudo_blog - 2203 sudo_dns - 2204 sudo_gitlab - 2205 sudo_lug - 2206 sudo_vpn - 2207 sudo_mirrors - 2208 sudo_pxe - 2209 sudo_freeshell - 2210 sudo_backup - 2212 sudo_vmnfs - 2213 sudo_homepage - 2000 super_manager - 2999 nologin \u4e0d\u786e\u5b9a\u8fd9\u4e2a\u7ec4\u6709\u6ca1\u6709\u7528 \u4ece\u4e0a\u6587\u7684\u89c4\u8303\u6765\u8bb2\uff0c\u5e94\u8be5\u4ece 2000 \u5f00\u59cb\u7f16\u53f7 GID\uff0c\u4f46\u6709\u4e9b\u7ec4\u53ef\u80fd\u521b\u5efa\u8005\u6ca1\u6ce8\u610f\uff0c\u4e0d\u8fc7\u540e\u671f\u518d\u6539\u5c31\u4e0d\u65b9\u4fbf\u4e86\u3002 ssh_* \u8fd9\u4e9b\u7ec4\uff0c\u662f\u5728\u6bcf\u4e2a\u4e3b\u673a\u7684 sshd_config \u91cc\u53ea\u5141\u8bb8\u76f8\u5e94\u7684\u7ec4\u767b\u9646\u3002 sudo_* \u8fd9\u4e9b\u7ec4\uff0c\u662f\u5728 LDAP sudo rules \u91cc\u5141\u8bb8\u4e86\u76f8\u5e94\u7684\u7ec4\u3002 \u6ce8\u610f\u4e8b\u9879 LDAP \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u52a1\u5fc5\u786e\u8ba4 sshd_config \u5df2\u7ecf\u9650\u5236\u4e86\u516c\u7f51\u767b\u5f55\u3002 \u672c\u6587\u6863\u539f\u59cb\u7248\u672c\u590d\u5236\u81ea LUG wiki\uff0c\u7531\u5f20\u5149\u5b87\u3001\u5d14\u704f\u3001\u6731\u665f\u83c1\u3001\u5de6\u683c\u975e\u64b0\u5199\u3002","title":"\u5df2\u77e5\u7684 GID"},{"location":"infrastructure/mail/","text":"Mail Agent \u00b6 \u53ef\u4ee5\u914d\u7f6e\u673a\u5668\u901a\u8fc7 mail.ustclug.org \u53d1\u4ef6\uff0c\u5b9e\u73b0\u8b66\u62a5\u7684\u90ae\u4ef6\u63d0\u9192\uff08\u6536\u4ef6\u4eba\u8bbe\u7f6e\u4e3a alert AT ustclug DOT org\uff09\u3002\u914d\u7f6e\u65f6\u9700\u8981\u5728 mail.s.ustclug.org \u4e0a\u8bbe\u7f6e postfix \u767d\u540d\u5355\u3002 \u5e38\u7528\u547d\u4ee4 \u00b6 \u4ece\u961f\u5217\u4e2d\u5220\u9664\u90ae\u4ef6\uff1a sudo postsuper -d <\u90ae\u4ef6 ID> \uff08\u90ae\u4ef6 ID \u53ef\u4ee5\u65e5\u5fd7\u4e2d\u770b\u5230\uff09 \u66f4\u65b0 virtual \u8868\u6620\u5c04\uff1a sudo postmap /etc/postfix/virtual \u540e\u91cd\u542f postfix \u670d\u52a1\u3002","title":"Mail Agent"},{"location":"infrastructure/mail/#mail-agent","text":"\u53ef\u4ee5\u914d\u7f6e\u673a\u5668\u901a\u8fc7 mail.ustclug.org \u53d1\u4ef6\uff0c\u5b9e\u73b0\u8b66\u62a5\u7684\u90ae\u4ef6\u63d0\u9192\uff08\u6536\u4ef6\u4eba\u8bbe\u7f6e\u4e3a alert AT ustclug DOT org\uff09\u3002\u914d\u7f6e\u65f6\u9700\u8981\u5728 mail.s.ustclug.org \u4e0a\u8bbe\u7f6e postfix \u767d\u540d\u5355\u3002","title":"Mail Agent"},{"location":"infrastructure/mail/#_1","text":"\u4ece\u961f\u5217\u4e2d\u5220\u9664\u90ae\u4ef6\uff1a sudo postsuper -d <\u90ae\u4ef6 ID> \uff08\u90ae\u4ef6 ID \u53ef\u4ee5\u65e5\u5fd7\u4e2d\u770b\u5230\uff09 \u66f4\u65b0 virtual \u8868\u6620\u5c04\uff1a sudo postmap /etc/postfix/virtual \u540e\u91cd\u542f postfix \u670d\u52a1\u3002","title":"\u5e38\u7528\u547d\u4ee4"},{"location":"infrastructure/monitor/","text":"\u76d1\u63a7\u7cfb\u7edf\u4f7f\u7528\u53ca\u914d\u7f6e\u8bf4\u660e \u00b6 \u76d1\u63a7\u7cfb\u7edf\u7531\u4ee5\u4e0b\u51e0\u4e2a\u7ec4\u4ef6\u7ec4\u6210\uff1a Telegraf: agent\uff0c\u8fd0\u884c\u5728\u6bcf\u4e2a\u88ab\u76d1\u63a7\u7684\u673a\u5668\u4e0a InfluxDB: \u6570\u636e\u5e93\uff0c\u8fd0\u884c\u5728 influxdb.ustclug.org (docker2.s.ustclug.org) Grafana: \u53ef\u89c6\u5316\u5de5\u5177\uff0c\u76d1\u63a7\u62a5\u8b66\uff0c\u5730\u5740\uff1amonitor.ustclug.org (docker2.s.ustclug.org) Configure InfluxDB \u00b6 \u7279\u522b\u6ce8\u610f \uff1aInfluxDB \u9ed8\u8ba4\u6ca1\u6709\u5f00\u542f\u8ba4\u8bc1\u3002 \u9996\u6b21\u8fd0\u884c\u65f6\uff0c\u521b\u5efa\u597d\u7ba1\u7406\u8d26\u53f7\uff08 admin \uff09\uff0c\u53ea\u8bfb\u8d26\u53f7\uff08 grafana \uff09\u548c\u5199\u5165\u8d26\u53f7\uff08 telegraf \uff09\u3002 \u7136\u540e\u4fee\u6539\u4f4d\u4e8e /srv/docker/influxdb/conf/influxdb.conf \u7684\u914d\u7f6e\uff0c\u4fee\u6539\u4ee5\u542f\u7528\u8ba4\u8bc1\uff1a [ http ] # ... # Determines whether HTTP authentication is enabled. auth-enabled = true Install telegraf \u00b6 \u5b89\u88c5\u65b9\u6cd5\u89c1 https://docs.influxdata.com/telegraf/v1.6/introduction/installation \u4e00\u4e2a\u5178\u578b\u7684\u5b89\u88c5\u547d\u4ee4\u662f\uff1a wget https://dl.influxdata.com/telegraf/releases/telegraf_1.6.1-1_amd64.deb sudo dpkg -i telegraf_1.6.1-1_amd64.deb \u6216\u8005 curl -sL https://repos.influxdata.com/influxdb.key | sudo apt-key add - echo \"deb https://mirrors.ustc.edu.cn/influxdata/debian buster stable\" | sudo tee /etc/apt/sources.list.d/influxdb.list sudo apt-get update && sudo apt-get install telegraf Configure telegraf \u00b6 \u914d\u7f6e\u6587\u4ef6\u5728 /etc/telegraf/ \u76ee\u5f55\u4e0b\uff0c\u7528 root \u6743\u9650\u4fee\u6539\uff1a \u5728 /etc/telegraf/telegraf.d/ \u4e0b\u589e\u52a0 net.conf \u7528\u6765\u5f00\u542f\u7f51\u7edc\u76d1\u63a7\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a # /etc/telegraf/telegraf.d/net.conf [[ inputs.net ]] \u5728 /etc/telegraf/telegraf.conf \u4e2d\u7684 [[outputs.influxdb]] \u4e2d \u589e\u52a0 influxdb \u7684\u5730\u5740\uff1a [[ outputs.influxdb ]] urls = [ \"http://influxdb.ustclug.org:8086\" ] username = \" ${ INFLUX_USERNAME } \" password = \" ${ INFLUXDB_PASSWORD } \" \u5176\u4e2d INFLUX_USERNAME \u548c INFLUXDB_PASSWORD \u5e94\u4f7f\u7528\u5bf9 telegraf \u6570\u636e\u5e93\u5199\u6743\u9650\u7684\u8d26\u53f7\uff0c\u5426\u5219\u65e0\u6cd5\u5199\u5165\u6570\u636e\u3002 \u914d\u7f6e\u5b8c\u6210\u4e4b\u540e\uff0c\u91cd\u542f telegraf \u670d\u52a1\uff0c\u5e76\u786e\u4fdd\u670d\u52a1\u8fd0\u884c\u6b63\u5e38\u3002 sudo systemctl restart telegraf sudo systemctl status telegraf \u5efa\u8bae\u5728\u88ab\u76d1\u63a7\u673a\u5668\u4e0a\u914d\u7f6e NTP\uff08\u53ef\u4ee5\u4f7f\u7528 systemd-timesyncd \uff0c\u8bbe\u7f6e NTP \u670d\u52a1\u5668\u4e3a time.ustc.edu.cn\uff09\uff0c\u4ee5\u907f\u514d\u65f6\u95f4\u4e0d\u540c\u6b65\u53ef\u80fd\u5e26\u6765\u7684\u95ee\u9898\u3002 Web \u00b6 Web \u7aef\u76d1\u63a7\u4f4d\u4e8e https://monitor.ustclug.org \uff0c\u8d26\u53f7\u7cfb\u7edf\u4f7f\u7528 LDAP\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u8bbe\u7f6e\u9884\u8b66\u63d0\u793a\u7b49\u3002 \u6ce8\u610f \uff1a \u914d\u7f6e InfluxDB \u6570\u636e\u6e90\u65f6\uff0c\u53ea\u80fd\u4f7f\u7528\u53ea\u8bfb\u8d26\u53f7\uff0c\u5426\u5219\u4f1a\u5e26\u6765\u4e25\u91cd\u7684\u5b89\u5168\u95ee\u9898\u3002","title":"Monitor"},{"location":"infrastructure/monitor/#_1","text":"\u76d1\u63a7\u7cfb\u7edf\u7531\u4ee5\u4e0b\u51e0\u4e2a\u7ec4\u4ef6\u7ec4\u6210\uff1a Telegraf: agent\uff0c\u8fd0\u884c\u5728\u6bcf\u4e2a\u88ab\u76d1\u63a7\u7684\u673a\u5668\u4e0a InfluxDB: \u6570\u636e\u5e93\uff0c\u8fd0\u884c\u5728 influxdb.ustclug.org (docker2.s.ustclug.org) Grafana: \u53ef\u89c6\u5316\u5de5\u5177\uff0c\u76d1\u63a7\u62a5\u8b66\uff0c\u5730\u5740\uff1amonitor.ustclug.org (docker2.s.ustclug.org)","title":"\u76d1\u63a7\u7cfb\u7edf\u4f7f\u7528\u53ca\u914d\u7f6e\u8bf4\u660e"},{"location":"infrastructure/monitor/#configure-influxdb","text":"\u7279\u522b\u6ce8\u610f \uff1aInfluxDB \u9ed8\u8ba4\u6ca1\u6709\u5f00\u542f\u8ba4\u8bc1\u3002 \u9996\u6b21\u8fd0\u884c\u65f6\uff0c\u521b\u5efa\u597d\u7ba1\u7406\u8d26\u53f7\uff08 admin \uff09\uff0c\u53ea\u8bfb\u8d26\u53f7\uff08 grafana \uff09\u548c\u5199\u5165\u8d26\u53f7\uff08 telegraf \uff09\u3002 \u7136\u540e\u4fee\u6539\u4f4d\u4e8e /srv/docker/influxdb/conf/influxdb.conf \u7684\u914d\u7f6e\uff0c\u4fee\u6539\u4ee5\u542f\u7528\u8ba4\u8bc1\uff1a [ http ] # ... # Determines whether HTTP authentication is enabled. auth-enabled = true","title":"Configure InfluxDB"},{"location":"infrastructure/monitor/#install-telegraf","text":"\u5b89\u88c5\u65b9\u6cd5\u89c1 https://docs.influxdata.com/telegraf/v1.6/introduction/installation \u4e00\u4e2a\u5178\u578b\u7684\u5b89\u88c5\u547d\u4ee4\u662f\uff1a wget https://dl.influxdata.com/telegraf/releases/telegraf_1.6.1-1_amd64.deb sudo dpkg -i telegraf_1.6.1-1_amd64.deb \u6216\u8005 curl -sL https://repos.influxdata.com/influxdb.key | sudo apt-key add - echo \"deb https://mirrors.ustc.edu.cn/influxdata/debian buster stable\" | sudo tee /etc/apt/sources.list.d/influxdb.list sudo apt-get update && sudo apt-get install telegraf","title":"Install telegraf"},{"location":"infrastructure/monitor/#configure-telegraf","text":"\u914d\u7f6e\u6587\u4ef6\u5728 /etc/telegraf/ \u76ee\u5f55\u4e0b\uff0c\u7528 root \u6743\u9650\u4fee\u6539\uff1a \u5728 /etc/telegraf/telegraf.d/ \u4e0b\u589e\u52a0 net.conf \u7528\u6765\u5f00\u542f\u7f51\u7edc\u76d1\u63a7\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a # /etc/telegraf/telegraf.d/net.conf [[ inputs.net ]] \u5728 /etc/telegraf/telegraf.conf \u4e2d\u7684 [[outputs.influxdb]] \u4e2d \u589e\u52a0 influxdb \u7684\u5730\u5740\uff1a [[ outputs.influxdb ]] urls = [ \"http://influxdb.ustclug.org:8086\" ] username = \" ${ INFLUX_USERNAME } \" password = \" ${ INFLUXDB_PASSWORD } \" \u5176\u4e2d INFLUX_USERNAME \u548c INFLUXDB_PASSWORD \u5e94\u4f7f\u7528\u5bf9 telegraf \u6570\u636e\u5e93\u5199\u6743\u9650\u7684\u8d26\u53f7\uff0c\u5426\u5219\u65e0\u6cd5\u5199\u5165\u6570\u636e\u3002 \u914d\u7f6e\u5b8c\u6210\u4e4b\u540e\uff0c\u91cd\u542f telegraf \u670d\u52a1\uff0c\u5e76\u786e\u4fdd\u670d\u52a1\u8fd0\u884c\u6b63\u5e38\u3002 sudo systemctl restart telegraf sudo systemctl status telegraf \u5efa\u8bae\u5728\u88ab\u76d1\u63a7\u673a\u5668\u4e0a\u914d\u7f6e NTP\uff08\u53ef\u4ee5\u4f7f\u7528 systemd-timesyncd \uff0c\u8bbe\u7f6e NTP \u670d\u52a1\u5668\u4e3a time.ustc.edu.cn\uff09\uff0c\u4ee5\u907f\u514d\u65f6\u95f4\u4e0d\u540c\u6b65\u53ef\u80fd\u5e26\u6765\u7684\u95ee\u9898\u3002","title":"Configure telegraf"},{"location":"infrastructure/monitor/#web","text":"Web \u7aef\u76d1\u63a7\u4f4d\u4e8e https://monitor.ustclug.org \uff0c\u8d26\u53f7\u7cfb\u7edf\u4f7f\u7528 LDAP\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u8bbe\u7f6e\u9884\u8b66\u63d0\u793a\u7b49\u3002 \u6ce8\u610f \uff1a \u914d\u7f6e InfluxDB \u6570\u636e\u6e90\u65f6\uff0c\u53ea\u80fd\u4f7f\u7528\u53ea\u8bfb\u8d26\u53f7\uff0c\u5426\u5219\u4f1a\u5e26\u6765\u4e25\u91cd\u7684\u5b89\u5168\u95ee\u9898\u3002","title":"Web"},{"location":"infrastructure/raid/","text":"RAID \u00b6 MegaRAID \u5e38\u7528\u547d\u4ee4 \u00b6 MegaRAID \u6e90\u91cc\u6ca1\u6709\uff0c\u9700\u8981\u4ece\u5b98\u7f51\u4e0b\u8f7d RPM \u5305\u540e\u624b\u52a8\u89e3\u538b\u3002Debian 10 \u5b89\u88c5 libncurses5 \u540e\u53ef\u4f7f\u7528\u3002 sudo /opt/MegaRAID/MegaCli/MegaCli64 -adpallinfo -aAll # \u67e5\u770b\u6240\u6709\u4fe1\u606f sudo /opt/MegaRAID/MegaCli/MegaCli64 -pdlist -aall # \u67e5\u770b\u7269\u7406\u76d8\u4fe1\u606f","title":"RAID"},{"location":"infrastructure/raid/#raid","text":"","title":"RAID"},{"location":"infrastructure/raid/#megaraid","text":"MegaRAID \u6e90\u91cc\u6ca1\u6709\uff0c\u9700\u8981\u4ece\u5b98\u7f51\u4e0b\u8f7d RPM \u5305\u540e\u624b\u52a8\u89e3\u538b\u3002Debian 10 \u5b89\u88c5 libncurses5 \u540e\u53ef\u4f7f\u7528\u3002 sudo /opt/MegaRAID/MegaCli/MegaCli64 -adpallinfo -aAll # \u67e5\u770b\u6240\u6709\u4fe1\u606f sudo /opt/MegaRAID/MegaCli/MegaCli64 -pdlist -aall # \u67e5\u770b\u7269\u7406\u76d8\u4fe1\u606f","title":"MegaRAID \u5e38\u7528\u547d\u4ee4"},{"location":"infrastructure/sshca/","text":"SSH Certificate Authentication \u00b6 discussion: SSH\u5347\u7ea7\u5230\u8bc1\u4e66\u767b\u9646\u65b9\u6848\u8ba8\u8bba usage: SSH\u8bc1\u4e66\u8ba4\u8bc1\u7684\u4f7f\u7528\u65b9\u6cd5 Introduction \u00b6 There are two types of SSH Certificate: Root certificate Host certificate Root certificate can be used to issue a host certificate and has the same format as a regular SSH private-public key pair. Host certificate can be used for authentication on both server side and client side. But host certificate cannot issue a new certificate, it is the very difference from x509 certificate. Trust all LUG servers in one go \u00b6 Add the following line to your known_hosts : @cert-authority * ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1Bxw9AXoZvc9HTe5o4f7/qOROcmzvlcO5oofoF3pewtRnhNpcd/DwmxSblqpj/cjLYkE32mSCzMYY8X0CRFyMJsgSIDC4i4LXDNU0e8PbB2NIQAAeyfJEU5m/Dn1tPw9WvPtPqHCRvgSwnRfzYngMVWROgV2Qe6pOqTTgetEYfb5gkDc2i1M7yfTp3H3ExfrDKwOKPc/9UYOADMFU6u1fJN+4epLETilHC1ubtBeVi23pn1K+LDy06Gwhq1MLljCM7gFBMrmv894HrOHU4WrzLUlfkiDt2cyXLb4qPWYqilBFLUjU92kjmiI/EwB/8pR1WmdU7FoYpdgBHNr3NT53 LUG-CA And when you log in to a LUG server, it is automatically trusted. If you find a machine that does not support this setup, report it to CTO. Issue a server certificate \u00b6 Warning When signing certificates using OpenSSH <= 8.1, add -t rsa-sha2-256 to the ssh-keygen command. More details can be found here: https://ibugone.com/p/35 Warning 2 Some of our servers are still running Debian Jessie, which has OpenSSH version 6.7 that does not support SHA-2 certificate algorithms. Sign with -t ssh-rsa instead if you want to log in to such servers. Copy the file /etc/ssh/ssh_host_rsa_key.pub from target server. (salt is your friend) Then, run ssh-keygen to issue a public key. For example: ssh-keygen -s /path/to/ssh_ca -I blog -h -n blog.s.ustclug.org,blog.p.ustclug.org,10.254.0.15,202.141.176.98,202.141.160.98 ssh_host_rsa_key.pub Then, copy the certificate file ssh_host_rsa_key-cert.pub back to target server. At last, add the following line to /etc/ssh/sshd_config : HostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub Certificate will take effect after SSH daemon is reloaded ( systemctl reload ssh ). Issue a client certificate \u00b6 ssh-keygen -s /path/to/ssh_ca -I certificate_identity -n principals -O option -V validity_interval public_key_file For example: ssh-keygen -s /path/to/ssh_ca -I \"Yifan Gao\" -n yifan -V +365d yifan.pub In general, certificate_identity is user full name, and principals is the user name. In addition, one user can own multiply principals in one certificate, like: ssh-keygen -s /path/to/ssh_ca -I \"Yifan Gao\" -n yifan,root,liims -V +365d yifan.pub It authorizes the certificate owner to login to any server with yifan , root or liims username. tip: \"liims\" principal is used to login to library inquiring machine.","title":"SSH Certificate Authority"},{"location":"infrastructure/sshca/#ssh-certificate-authentication","text":"discussion: SSH\u5347\u7ea7\u5230\u8bc1\u4e66\u767b\u9646\u65b9\u6848\u8ba8\u8bba usage: SSH\u8bc1\u4e66\u8ba4\u8bc1\u7684\u4f7f\u7528\u65b9\u6cd5","title":"SSH Certificate Authentication"},{"location":"infrastructure/sshca/#introduction","text":"There are two types of SSH Certificate: Root certificate Host certificate Root certificate can be used to issue a host certificate and has the same format as a regular SSH private-public key pair. Host certificate can be used for authentication on both server side and client side. But host certificate cannot issue a new certificate, it is the very difference from x509 certificate.","title":"Introduction"},{"location":"infrastructure/sshca/#trust-all-lug-servers-in-one-go","text":"Add the following line to your known_hosts : @cert-authority * ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1Bxw9AXoZvc9HTe5o4f7/qOROcmzvlcO5oofoF3pewtRnhNpcd/DwmxSblqpj/cjLYkE32mSCzMYY8X0CRFyMJsgSIDC4i4LXDNU0e8PbB2NIQAAeyfJEU5m/Dn1tPw9WvPtPqHCRvgSwnRfzYngMVWROgV2Qe6pOqTTgetEYfb5gkDc2i1M7yfTp3H3ExfrDKwOKPc/9UYOADMFU6u1fJN+4epLETilHC1ubtBeVi23pn1K+LDy06Gwhq1MLljCM7gFBMrmv894HrOHU4WrzLUlfkiDt2cyXLb4qPWYqilBFLUjU92kjmiI/EwB/8pR1WmdU7FoYpdgBHNr3NT53 LUG-CA And when you log in to a LUG server, it is automatically trusted. If you find a machine that does not support this setup, report it to CTO.","title":"Trust all LUG servers in one go"},{"location":"infrastructure/sshca/#issue-a-server-certificate","text":"Warning When signing certificates using OpenSSH <= 8.1, add -t rsa-sha2-256 to the ssh-keygen command. More details can be found here: https://ibugone.com/p/35 Warning 2 Some of our servers are still running Debian Jessie, which has OpenSSH version 6.7 that does not support SHA-2 certificate algorithms. Sign with -t ssh-rsa instead if you want to log in to such servers. Copy the file /etc/ssh/ssh_host_rsa_key.pub from target server. (salt is your friend) Then, run ssh-keygen to issue a public key. For example: ssh-keygen -s /path/to/ssh_ca -I blog -h -n blog.s.ustclug.org,blog.p.ustclug.org,10.254.0.15,202.141.176.98,202.141.160.98 ssh_host_rsa_key.pub Then, copy the certificate file ssh_host_rsa_key-cert.pub back to target server. At last, add the following line to /etc/ssh/sshd_config : HostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub Certificate will take effect after SSH daemon is reloaded ( systemctl reload ssh ).","title":"Issue a server certificate"},{"location":"infrastructure/sshca/#issue-a-client-certificate","text":"ssh-keygen -s /path/to/ssh_ca -I certificate_identity -n principals -O option -V validity_interval public_key_file For example: ssh-keygen -s /path/to/ssh_ca -I \"Yifan Gao\" -n yifan -V +365d yifan.pub In general, certificate_identity is user full name, and principals is the user name. In addition, one user can own multiply principals in one certificate, like: ssh-keygen -s /path/to/ssh_ca -I \"Yifan Gao\" -n yifan,root,liims -V +365d yifan.pub It authorizes the certificate owner to login to any server with yifan , root or liims username. tip: \"liims\" principal is used to login to library inquiring machine.","title":"Issue a client certificate"},{"location":"infrastructure/ssl/","text":"SSL Certificates \u00b6 Discussion: #224 Our SSL certificates are automatically renewed on GitHub ustclug/ssl-cert . We delegate the subdomain ssl-digitalocean.ustclug.org to DigitalOcean DNS hosting, and use acme.sh DNS alias mode to issue certificates. For this to work, we have the following CNAME records in place: _acme-challenge.lug.ustc.edu.cn -> lug.ssl-digitalocean.ustclug.org _acme-challenge.ustclug.org -> lug.ssl-digitalocean.ustclug.org _acme-challenge.proxy.ustclug.org -> lug.ssl-digitalocean.ustclug.org _acme-challenge.mirrors.ustc.edu.cn -> mirrors.ssl-digitalocean.ustclug.org Individual machines that use SSL certificates should pull from the said repository (branch cert ). Certificates may be loaded via symbolic links (for processes running on the host system directly), or copied around from within the updater script (when there are path constraints, e.g. in a Docker container). The update task is managed by cron. Update script for reference: #!/bin/sh cd \"/etc/ssl/private\" git fetch -q if [ \" $( git rev-parse HEAD ) \" = \" $( git rev-parse '@{u}' ) \" ] ; then exit 0 fi git reset --hard '@{u}' # Display certificate dates. This section is optional if command -v openssl >/dev/null 2 > & 1 ; then echo \"Cert has been updated. New expiry:\" for f in */cert.pem ; do echo \" $f :\" openssl x509 -in \" $f \" -noout -dates done else echo \"Cert has been updated.\" fi systemctl reload openresty.service # Other `cp -a` or `docker restart` commands, etc. The DigitalOcean account we use is owned by iBug and has nothing else running. Plan B Hurricane Electric provides hosted DNS zones for free , which is also supported by acme.sh . This makes HE DNS a feasible alternative should our current Dependency (DigitalOcean) fails for whatever reason.","title":"SSL Certificates"},{"location":"infrastructure/ssl/#ssl-certificates","text":"Discussion: #224 Our SSL certificates are automatically renewed on GitHub ustclug/ssl-cert . We delegate the subdomain ssl-digitalocean.ustclug.org to DigitalOcean DNS hosting, and use acme.sh DNS alias mode to issue certificates. For this to work, we have the following CNAME records in place: _acme-challenge.lug.ustc.edu.cn -> lug.ssl-digitalocean.ustclug.org _acme-challenge.ustclug.org -> lug.ssl-digitalocean.ustclug.org _acme-challenge.proxy.ustclug.org -> lug.ssl-digitalocean.ustclug.org _acme-challenge.mirrors.ustc.edu.cn -> mirrors.ssl-digitalocean.ustclug.org Individual machines that use SSL certificates should pull from the said repository (branch cert ). Certificates may be loaded via symbolic links (for processes running on the host system directly), or copied around from within the updater script (when there are path constraints, e.g. in a Docker container). The update task is managed by cron. Update script for reference: #!/bin/sh cd \"/etc/ssl/private\" git fetch -q if [ \" $( git rev-parse HEAD ) \" = \" $( git rev-parse '@{u}' ) \" ] ; then exit 0 fi git reset --hard '@{u}' # Display certificate dates. This section is optional if command -v openssl >/dev/null 2 > & 1 ; then echo \"Cert has been updated. New expiry:\" for f in */cert.pem ; do echo \" $f :\" openssl x509 -in \" $f \" -noout -dates done else echo \"Cert has been updated.\" fi systemctl reload openresty.service # Other `cp -a` or `docker restart` commands, etc. The DigitalOcean account we use is owned by iBug and has nothing else running. Plan B Hurricane Electric provides hosted DNS zones for free , which is also supported by acme.sh . This makes HE DNS a feasible alternative should our current Dependency (DigitalOcean) fails for whatever reason.","title":"SSL Certificates"},{"location":"infrastructure/tinc/","text":"Tinc VPN \u914d\u7f6e\u8bf4\u660e \u00b6 Tinc VPN \u662f LUG \u5185\u7f51\u7684\u4e3b\u8981\u6784\u6210\u8f6f\u4ef6\uff0cLDAP \u9700\u8981\u7528\u5230\u5b83\uff08\u56e0\u4e3a ldap \u670d\u52a1\u5668\u662f\u4e2a\u5185\u7f51\u670d\u52a1\u5668\uff09 \u5b89\u88c5 \u00b6 Debian 9+ \u53ef\u4ee5\u76f4\u63a5\u4ece apt \u6e90\u5b89\u88c5 tinc \u5305\u3002 \u4e0d\u65e9\u8bf4\u8fd9\u73a9\u610f\u6709\u4e2a Git \u4ed3\u5e93\uff1f\uff1f https://git.lug.ustc.edu.cn/ustclug/tinc-configure \u65e2\u7136\u6709\u4ed3\u5e93\u6240\u4ee5\u8981\u505a\u7684\u4e8b\u60c5\u6bd4\u8f83\u7b80\u5355\uff0c\u8fdb\u5165 /etc/tinc \u76ee\u5f55\u51c6\u5907\u548c Git \u4ed3\u5e93\u540c\u6b65\u914d\u7f6e\uff1a git init git remote add origin https://git.lug.ustc.edu.cn/ustclug/tinc-configure.git git fetch origin master git reset --hard FETCH_HEAD \u6ce8\u610f git reset \u4f1a\u8986\u76d6\u90e8\u5206\u6587\u4ef6\uff0c\u5efa\u8bae\u5728\u5168\u65b0\u5b89\u88c5 tinc \u4e4b\u540e\u8fdb\u884c\u540c\u6b65\u914d\u7f6e\u3002 \u52a0\u5165\u4e3b\u673a \u00b6 \u9996\u5148\u9700\u8981\u5728\u65b0\u4e3b\u673a\u4e0a\u751f\u6210\u5bc6\u94a5\uff1a tincd -n ustclug -K \u7136\u540e\u5728 /etc/tinc/ustclug/hosts/$HOST \u6700\u540e\u8865\u4e0a\u4e00\u884c\uff1a Address = [\u8fd9\u53f0\u673a\u5668\u7684\u516c\u7f51IP] \u628a\u65b0\u589e\u7684\u8fd9\u4e2a\u6587\u4ef6\u63d0\u4ea4\u8fdb Git \u4ed3\u5e93\uff0c\u5e76\u5728 {ldap,board,gateway-el}.s.ustclug.org \u7b49\u53f0\u673a\u5668\u4e0a\u901a\u8fc7 git pull \u66f4\u65b0\uff0c\u5e76 systemctl reload tinc@ustclug.service \u3002 \u5185\u7f51 IP \u00b6 \u6d4b\u8bd5\u7684\u65f6\u5019 \uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u7528 ifconfig \u6307\u5b9a\u4e00\u4e2a\u4e34\u65f6\u7684 IP\uff0c\u6ce8\u610f\u4e0d\u8981\u4e0e\u5df2\u6709\u7684\u5185\u7f51 IP \u51b2\u7a81\uff1a ifconfig 10 .254.0.xxx/21 ustclug \u8fd9\u65f6\u5019\u5e94\u8be5\u80fd\u4ece\u5176\u4ed6\u673a\u5668 ping \u901a\u8fd9\u4e2a IP\u3002 \u6307\u5b9a\u9759\u6001\u5185\u7f51 IP \u7684\u6b63\u786e\u65b9\u6cd5\u662f\u5728 DNS \u4e2d\u6dfb\u52a0\u4e00\u6761\u8fd9\u6837\u7684\u8bb0\u5f55\uff1a $ORIGIN s.ustclug.org <HOST> 600 IN A <Intranet IP> \u7136\u540e\u5728\u673a\u5668\u4e0a\u91cd\u542f systemctl restart tinc@ustclug.service \u5c31\u80fd\u81ea\u52a8\u83b7\u53d6\u4e86\u3002 \u914d\u7f6e SSH \u4fa6\u542c\u5185\u7f51\u5730\u5740 \u00b6 \u914d\u7f6e\u4f9b\u53c2\u8003\uff1a AddressFamily inet UseDNS no HostKey /etc/ssh/ssh_host_rsa_key HostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub TrustedUserCAKeys /etc/ssh/ssh_user_ca RevokedKeys /etc/ssh/ssh_revoked_keys PasswordAuthentication no PubkeyAuthentication no ChallengeResponseAuthentication no UsePAM yes # LDAP for Debian AcceptEnv LANG LC_* X11Forwarding yes PrintLastLog no PrintMotd no Subsystem sftp /usr/lib/openssh/sftp-server Match LocalAddress 10.254.0.0 AllowGroups ssh_local super_manager ssh_groupname PasswordAuthentication yes PubkeyAuthentication yes # Public IP access = root-only Match LocalAddress 202.38.95.110,202.141.160.110,202.141.176.110,218.104.71.170 AllowUsers root PubkeyAuthentication yes AuthorizedKeysFile /dev/null # \u5c4f\u853d\u516c\u94a5\uff0c\u4ec5\u5141\u8bb8\u8bc1\u4e66\u767b\u5f55 # For SSH Push trigger Match User mirror AllowUsers mirror AuthenticationMethods publickey PermitTTY no PermitTunnel no X11Forwarding no \u6ce8\u610f HostCertificate, TrustedUserCAKeys \u548c RevokedKeys \u8fd9\u4e09\u4e2a\u6587\u4ef6\u5fc5\u987b\u5b58\u5728\uff0c\u5426\u5219 SSH \u4f1a\u51fa\u4e00\u4e9b\u95ee\u9898\uff0c\u4f8b\u5982\u4e0d\u80fd\u5bc6\u94a5\u767b\u5f55\u53ea\u80fd\u5bc6\u7801\u767b\u5f55\u3002 HostCertificate \u9700\u8981\u624b\u52a8\u7b7e\u53d1\u4e00\u4e2a\uff0c\u53e6\u5916\u4e24\u4e2a\u6587\u4ef6\u4ece\u522b\u7684\u673a\u5668\u4e0a\u590d\u5236\u5c31\u884c\u3002","title":"Tinc"},{"location":"infrastructure/tinc/#tinc-vpn","text":"Tinc VPN \u662f LUG \u5185\u7f51\u7684\u4e3b\u8981\u6784\u6210\u8f6f\u4ef6\uff0cLDAP \u9700\u8981\u7528\u5230\u5b83\uff08\u56e0\u4e3a ldap \u670d\u52a1\u5668\u662f\u4e2a\u5185\u7f51\u670d\u52a1\u5668\uff09","title":"Tinc VPN \u914d\u7f6e\u8bf4\u660e"},{"location":"infrastructure/tinc/#_1","text":"Debian 9+ \u53ef\u4ee5\u76f4\u63a5\u4ece apt \u6e90\u5b89\u88c5 tinc \u5305\u3002 \u4e0d\u65e9\u8bf4\u8fd9\u73a9\u610f\u6709\u4e2a Git \u4ed3\u5e93\uff1f\uff1f https://git.lug.ustc.edu.cn/ustclug/tinc-configure \u65e2\u7136\u6709\u4ed3\u5e93\u6240\u4ee5\u8981\u505a\u7684\u4e8b\u60c5\u6bd4\u8f83\u7b80\u5355\uff0c\u8fdb\u5165 /etc/tinc \u76ee\u5f55\u51c6\u5907\u548c Git \u4ed3\u5e93\u540c\u6b65\u914d\u7f6e\uff1a git init git remote add origin https://git.lug.ustc.edu.cn/ustclug/tinc-configure.git git fetch origin master git reset --hard FETCH_HEAD \u6ce8\u610f git reset \u4f1a\u8986\u76d6\u90e8\u5206\u6587\u4ef6\uff0c\u5efa\u8bae\u5728\u5168\u65b0\u5b89\u88c5 tinc \u4e4b\u540e\u8fdb\u884c\u540c\u6b65\u914d\u7f6e\u3002","title":"\u5b89\u88c5"},{"location":"infrastructure/tinc/#_2","text":"\u9996\u5148\u9700\u8981\u5728\u65b0\u4e3b\u673a\u4e0a\u751f\u6210\u5bc6\u94a5\uff1a tincd -n ustclug -K \u7136\u540e\u5728 /etc/tinc/ustclug/hosts/$HOST \u6700\u540e\u8865\u4e0a\u4e00\u884c\uff1a Address = [\u8fd9\u53f0\u673a\u5668\u7684\u516c\u7f51IP] \u628a\u65b0\u589e\u7684\u8fd9\u4e2a\u6587\u4ef6\u63d0\u4ea4\u8fdb Git \u4ed3\u5e93\uff0c\u5e76\u5728 {ldap,board,gateway-el}.s.ustclug.org \u7b49\u53f0\u673a\u5668\u4e0a\u901a\u8fc7 git pull \u66f4\u65b0\uff0c\u5e76 systemctl reload tinc@ustclug.service \u3002","title":"\u52a0\u5165\u4e3b\u673a"},{"location":"infrastructure/tinc/#ip","text":"\u6d4b\u8bd5\u7684\u65f6\u5019 \uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u7528 ifconfig \u6307\u5b9a\u4e00\u4e2a\u4e34\u65f6\u7684 IP\uff0c\u6ce8\u610f\u4e0d\u8981\u4e0e\u5df2\u6709\u7684\u5185\u7f51 IP \u51b2\u7a81\uff1a ifconfig 10 .254.0.xxx/21 ustclug \u8fd9\u65f6\u5019\u5e94\u8be5\u80fd\u4ece\u5176\u4ed6\u673a\u5668 ping \u901a\u8fd9\u4e2a IP\u3002 \u6307\u5b9a\u9759\u6001\u5185\u7f51 IP \u7684\u6b63\u786e\u65b9\u6cd5\u662f\u5728 DNS \u4e2d\u6dfb\u52a0\u4e00\u6761\u8fd9\u6837\u7684\u8bb0\u5f55\uff1a $ORIGIN s.ustclug.org <HOST> 600 IN A <Intranet IP> \u7136\u540e\u5728\u673a\u5668\u4e0a\u91cd\u542f systemctl restart tinc@ustclug.service \u5c31\u80fd\u81ea\u52a8\u83b7\u53d6\u4e86\u3002","title":"\u5185\u7f51 IP"},{"location":"infrastructure/tinc/#ssh","text":"\u914d\u7f6e\u4f9b\u53c2\u8003\uff1a AddressFamily inet UseDNS no HostKey /etc/ssh/ssh_host_rsa_key HostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub TrustedUserCAKeys /etc/ssh/ssh_user_ca RevokedKeys /etc/ssh/ssh_revoked_keys PasswordAuthentication no PubkeyAuthentication no ChallengeResponseAuthentication no UsePAM yes # LDAP for Debian AcceptEnv LANG LC_* X11Forwarding yes PrintLastLog no PrintMotd no Subsystem sftp /usr/lib/openssh/sftp-server Match LocalAddress 10.254.0.0 AllowGroups ssh_local super_manager ssh_groupname PasswordAuthentication yes PubkeyAuthentication yes # Public IP access = root-only Match LocalAddress 202.38.95.110,202.141.160.110,202.141.176.110,218.104.71.170 AllowUsers root PubkeyAuthentication yes AuthorizedKeysFile /dev/null # \u5c4f\u853d\u516c\u94a5\uff0c\u4ec5\u5141\u8bb8\u8bc1\u4e66\u767b\u5f55 # For SSH Push trigger Match User mirror AllowUsers mirror AuthenticationMethods publickey PermitTTY no PermitTunnel no X11Forwarding no \u6ce8\u610f HostCertificate, TrustedUserCAKeys \u548c RevokedKeys \u8fd9\u4e09\u4e2a\u6587\u4ef6\u5fc5\u987b\u5b58\u5728\uff0c\u5426\u5219 SSH \u4f1a\u51fa\u4e00\u4e9b\u95ee\u9898\uff0c\u4f8b\u5982\u4e0d\u80fd\u5bc6\u94a5\u767b\u5f55\u53ea\u80fd\u5bc6\u7801\u767b\u5f55\u3002 HostCertificate \u9700\u8981\u624b\u52a8\u7b7e\u53d1\u4e00\u4e2a\uff0c\u53e6\u5916\u4e24\u4e2a\u6587\u4ef6\u4ece\u522b\u7684\u673a\u5668\u4e0a\u590d\u5236\u5c31\u884c\u3002","title":"\u914d\u7f6e SSH \u4fa6\u542c\u5185\u7f51\u5730\u5740"},{"location":"infrastructure/intranet/intranet/","text":"Servers Intranet \u00b6 Servers Intranet connect all the servers together, including physics servers and virtual machines. Network Topology \u00b6 \u4ee5\u4e0a\u67b6\u6784\u56fe\u7531 Hypercube \u5728 2018 \u5e74 5 \u6708\u66f4\u65b0\u3002\u4ee5\u4e0b\u4fe1\u606f\u662f\u8fc7\u65f6\u7684\uff0c\u4e0d\u8fc7\u6709\u53c2\u8003\u4ef7\u503c\u3002 The network contains three parts: Physical Switch in East Library Data Center Virtual Switch on vSphere host machine tincVPN tincVPN is a mesh VPN, which can be abstructed as a virtual Switch. vm-nfs.s.ustclug.org runs a layer 2 bridge, connecting tincVPN and SRW2024(physical switch). It is obvious that vm-nfs is a single point of failure of communicating between tinc host and vSphere virtual machine. I had tried to add another bridge node, but resulted in a broadcast storm. Maybe we can fix it by MPLS (merged in mainland kernel 4.3). But it isn't a right timing at this time. Network information \u00b6 The network contains two subnets: 10.254.0.0/21 10.254.10.0/24 Every server binds one and only one IP address in 10.254.0.0/21, used to communicate with each other. 10.254.10.0/24 is used for 1to1 IP mapping. At this time, it just used between linode(10.254.10.2) and blog(10.254.10.1). Address planning \u00b6 10.254.0.0/24: physical server and virtual machine 10.254.1.0/24: docker container 10.254.6.0/24: LUGi emergency entrypoint (managed by yzf) 10.254.7.0/24: LUGi entrypoint (via board.s) other address: not used yet.","title":"Overview"},{"location":"infrastructure/intranet/intranet/#servers-intranet","text":"Servers Intranet connect all the servers together, including physics servers and virtual machines.","title":"Servers Intranet"},{"location":"infrastructure/intranet/intranet/#network-topology","text":"\u4ee5\u4e0a\u67b6\u6784\u56fe\u7531 Hypercube \u5728 2018 \u5e74 5 \u6708\u66f4\u65b0\u3002\u4ee5\u4e0b\u4fe1\u606f\u662f\u8fc7\u65f6\u7684\uff0c\u4e0d\u8fc7\u6709\u53c2\u8003\u4ef7\u503c\u3002 The network contains three parts: Physical Switch in East Library Data Center Virtual Switch on vSphere host machine tincVPN tincVPN is a mesh VPN, which can be abstructed as a virtual Switch. vm-nfs.s.ustclug.org runs a layer 2 bridge, connecting tincVPN and SRW2024(physical switch). It is obvious that vm-nfs is a single point of failure of communicating between tinc host and vSphere virtual machine. I had tried to add another bridge node, but resulted in a broadcast storm. Maybe we can fix it by MPLS (merged in mainland kernel 4.3). But it isn't a right timing at this time.","title":"Network Topology"},{"location":"infrastructure/intranet/intranet/#network-information","text":"The network contains two subnets: 10.254.0.0/21 10.254.10.0/24 Every server binds one and only one IP address in 10.254.0.0/21, used to communicate with each other. 10.254.10.0/24 is used for 1to1 IP mapping. At this time, it just used between linode(10.254.10.2) and blog(10.254.10.1).","title":"Network information"},{"location":"infrastructure/intranet/intranet/#address-planning","text":"10.254.0.0/24: physical server and virtual machine 10.254.1.0/24: docker container 10.254.6.0/24: LUGi emergency entrypoint (managed by yzf) 10.254.7.0/24: LUGi entrypoint (via board.s) other address: not used yet.","title":"Address planning"},{"location":"infrastructure/intranet/lugivpn/","text":"LUG Intranet VPN \u00b6 service: intranet.ustclug.org server: board.s.ustclug.org Introduction \u00b6 Server intranet is a closed network, which cannot be accessed from Internet. LUGI VPN helps maintainer get access to intranet temporarily. LUGI VPN is running in Banana Pi, the only ARM architecture device we owned. Using OpenVPN protocal, authorizing via LDAP. Configuration \u00b6 OpenVPN LDAP auth plugin config /etc/openvpn/auth-ldap.conf : <LDAP> URL ldaps://ldap.ustclug.org Timeout 15 FollowReferrals yes TLSCACertFile /etc/ldap/ssl/slapd-ca-cert.pem </LDAP> <Authorization> BaseDN \"ou=people,dc=lug,dc=ustc,dc=edu,dc=cn\" SearchFilter \"(uid=%u)\" RequireGroup false </Authorization> In openvpn configuration: ... plugin /usr/lib/openvpn/openvpn-auth-ldap.so /etc/openvpn/auth-ldap.conf Servers intranet is a layer 2 network without default gateway. So NAT is needed: iptables -t nat -A POSTROUTING -s 10 .254.248.0/22 -d 10 .254.0.0/21 -j MASQUERAD","title":"LUGI VPN"},{"location":"infrastructure/intranet/lugivpn/#lug-intranet-vpn","text":"service: intranet.ustclug.org server: board.s.ustclug.org","title":"LUG Intranet VPN"},{"location":"infrastructure/intranet/lugivpn/#introduction","text":"Server intranet is a closed network, which cannot be accessed from Internet. LUGI VPN helps maintainer get access to intranet temporarily. LUGI VPN is running in Banana Pi, the only ARM architecture device we owned. Using OpenVPN protocal, authorizing via LDAP.","title":"Introduction"},{"location":"infrastructure/intranet/lugivpn/#configuration","text":"OpenVPN LDAP auth plugin config /etc/openvpn/auth-ldap.conf : <LDAP> URL ldaps://ldap.ustclug.org Timeout 15 FollowReferrals yes TLSCACertFile /etc/ldap/ssl/slapd-ca-cert.pem </LDAP> <Authorization> BaseDN \"ou=people,dc=lug,dc=ustc,dc=edu,dc=cn\" SearchFilter \"(uid=%u)\" RequireGroup false </Authorization> In openvpn configuration: ... plugin /usr/lib/openvpn/openvpn-auth-ldap.so /etc/openvpn/auth-ldap.conf Servers intranet is a layer 2 network without default gateway. So NAT is needed: iptables -t nat -A POSTROUTING -s 10 .254.248.0/22 -d 10 .254.0.0/21 -j MASQUERAD","title":"Configuration"},{"location":"infrastructure/vsphere/esxi/","text":"ESXi \u00b6 \u73b0\u5f79\u7684 ESXi \u6709 3 \u53f0\uff1aesxi-2 \u548c esxi-6 \u4f4d\u4e8e\u4e1c\u56fe\u673a\u623f\uff0cesxi-5 \u4f4d\u4e8e\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u673a\u623f\u3002 esxi-2 \u4e0a\u8fd0\u884c\u4e1c\u56fe\u7f51\u5173\u7b49\u670d\u52a1\uff0cesxi-6 \u4e0a\u8fd0\u884c ustclug gitlab\u3002esxi-5 \u4e0a\u8fd0\u884c\u8bf8\u5982 vcenter, \u90ae\u4ef6\u7f51\u5173, ldap, \u5907\u7528\u7f51\u5173, vSphereDataProtection \u5907\u4efd\u670d\u52a1\u7b49\u3002 \u76ee\u524d\uff0c\u6709\u8ba1\u5212\u5c06\u4e1c\u56fe\u865a\u62df\u5316\u65b9\u6848\u66f4\u6539\u4e3a Proxmox Virtual Environment\u3002","title":"ESXi"},{"location":"infrastructure/vsphere/esxi/#esxi","text":"\u73b0\u5f79\u7684 ESXi \u6709 3 \u53f0\uff1aesxi-2 \u548c esxi-6 \u4f4d\u4e8e\u4e1c\u56fe\u673a\u623f\uff0cesxi-5 \u4f4d\u4e8e\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u673a\u623f\u3002 esxi-2 \u4e0a\u8fd0\u884c\u4e1c\u56fe\u7f51\u5173\u7b49\u670d\u52a1\uff0cesxi-6 \u4e0a\u8fd0\u884c ustclug gitlab\u3002esxi-5 \u4e0a\u8fd0\u884c\u8bf8\u5982 vcenter, \u90ae\u4ef6\u7f51\u5173, ldap, \u5907\u7528\u7f51\u5173, vSphereDataProtection \u5907\u4efd\u670d\u52a1\u7b49\u3002 \u76ee\u524d\uff0c\u6709\u8ba1\u5212\u5c06\u4e1c\u56fe\u865a\u62df\u5316\u65b9\u6848\u66f4\u6539\u4e3a Proxmox Virtual Environment\u3002","title":"ESXi"},{"location":"infrastructure/vsphere/nfs/","text":"NFS \u00b6 NFS \u670d\u52a1\u5668\uff08\"vdp\"\uff09\u662f\u4e1c\u56fe\u4e24\u4e2a ESXi \u673a\u5668\u7684\u865a\u62df\u673a\u5b58\u50a8\uff0c\u578b\u53f7\u4e3a DELL PowerEdge R510\u3002\u78c1\u76d8\u9635\u5217\u7531\u4e8e\u5728 2021 \u5e74 3 \u6708\u521d\u635f\u574f\uff0c\u76ee\u524d\u5bb9\u91cf\u7f29\u51cf\u5230 8T\uff084 \u5757 4T \u84dd\u76d8 RAID10\uff09\uff0c\u9664\u865a\u62df\u673a\u5916\uff0c\u4e5f\u5b58\u50a8 LUG \u6210\u5458\u7684\u4e2a\u4eba\u6570\u636e\uff0c\u4ee5\u53ca USTCLUG FTP\u3002 vdp \u7684\u5185\u7f51\u4f9d\u8d56\u4e8e\u4e1c\u56fe\u7f51\u5173\u3002","title":"NFS"},{"location":"infrastructure/vsphere/nfs/#nfs","text":"NFS \u670d\u52a1\u5668\uff08\"vdp\"\uff09\u662f\u4e1c\u56fe\u4e24\u4e2a ESXi \u673a\u5668\u7684\u865a\u62df\u673a\u5b58\u50a8\uff0c\u578b\u53f7\u4e3a DELL PowerEdge R510\u3002\u78c1\u76d8\u9635\u5217\u7531\u4e8e\u5728 2021 \u5e74 3 \u6708\u521d\u635f\u574f\uff0c\u76ee\u524d\u5bb9\u91cf\u7f29\u51cf\u5230 8T\uff084 \u5757 4T \u84dd\u76d8 RAID10\uff09\uff0c\u9664\u865a\u62df\u673a\u5916\uff0c\u4e5f\u5b58\u50a8 LUG \u6210\u5458\u7684\u4e2a\u4eba\u6570\u636e\uff0c\u4ee5\u53ca USTCLUG FTP\u3002 vdp \u7684\u5185\u7f51\u4f9d\u8d56\u4e8e\u4e1c\u56fe\u7f51\u5173\u3002","title":"NFS"},{"location":"infrastructure/vsphere/vcenter/","text":"vCenter \u00b6 vCenter \u4e3a\u7ef4\u62a4\u4eba\u5458\u63d0\u4f9b\u4e86\u65b9\u4fbf\u7684\u7ba1\u7406\u6240\u6709 ESXi \u670d\u52a1\u5668\u7684\u754c\u9762\u3002\u9700\u8981\u6ce8\u610f\uff1a HTML5 \u7248\u53ef\u4ee5\u5b8c\u6210\u5927\u591a\u6570\u4efb\u52a1\uff0c\u4f46\u662f\u8bf8\u5982\u914d\u7f6e\u8b66\u62a5\uff08\u53ef\u914d\u7f6e\u90ae\u4ef6\u8b66\u544a\uff09\u3001\u67e5\u770b VDP \u5907\u4efd\u60c5\u51b5\u7b49\u9700\u8981 Flash \u7248\u672c\u3002 \u5982\u679c\u67d0\u4e2a\u540c\u5b66\u53ea\u6709\u7ba1\u7406\u67d0\u4e2a\u865a\u62df\u673a\u7684\u9700\u6c42\uff0c\u5efa\u8bae\u65b0\u5efa\u8d26\u6237\uff0c\u5355\u72ec\u914d\u7f6e\u6743\u9650\u3002 vCenter \u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u865a\u62df\u673a\uff0c\u76ee\u524d\u8fd0\u884c\u5728 esxi-5 \u4e0a\u3002\u6ce8\u610f\uff0c\u5b83\u7684\u6574\u5408\u78c1\u76d8\u529f\u80fd\u65e0\u6cd5\u5de5\u4f5c\uff0c\u6240\u4ee5\u5907\u4efd\u8df3\u8fc7\u4e86 vcenter\u3002","title":"vCenter"},{"location":"infrastructure/vsphere/vcenter/#vcenter","text":"vCenter \u4e3a\u7ef4\u62a4\u4eba\u5458\u63d0\u4f9b\u4e86\u65b9\u4fbf\u7684\u7ba1\u7406\u6240\u6709 ESXi \u670d\u52a1\u5668\u7684\u754c\u9762\u3002\u9700\u8981\u6ce8\u610f\uff1a HTML5 \u7248\u53ef\u4ee5\u5b8c\u6210\u5927\u591a\u6570\u4efb\u52a1\uff0c\u4f46\u662f\u8bf8\u5982\u914d\u7f6e\u8b66\u62a5\uff08\u53ef\u914d\u7f6e\u90ae\u4ef6\u8b66\u544a\uff09\u3001\u67e5\u770b VDP \u5907\u4efd\u60c5\u51b5\u7b49\u9700\u8981 Flash \u7248\u672c\u3002 \u5982\u679c\u67d0\u4e2a\u540c\u5b66\u53ea\u6709\u7ba1\u7406\u67d0\u4e2a\u865a\u62df\u673a\u7684\u9700\u6c42\uff0c\u5efa\u8bae\u65b0\u5efa\u8d26\u6237\uff0c\u5355\u72ec\u914d\u7f6e\u6743\u9650\u3002 vCenter \u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u865a\u62df\u673a\uff0c\u76ee\u524d\u8fd0\u884c\u5728 esxi-5 \u4e0a\u3002\u6ce8\u610f\uff0c\u5b83\u7684\u6574\u5408\u78c1\u76d8\u529f\u80fd\u65e0\u6cd5\u5de5\u4f5c\uff0c\u6240\u4ee5\u5907\u4efd\u8df3\u8fc7\u4e86 vcenter\u3002","title":"vCenter"},{"location":"infrastructure/vsphere/vdp/","text":"VDP \u00b6 \u5f53\u6211\u4eec\u8bf4\u5230 VDP \u7684\u65f6\u5019\uff0c\u6211\u4eec\u5230\u5e95\u5728\u6307\u4ec0\u4e48\uff1f\u4e3a\u4e86\u907f\u514d\u6b67\u4e49\uff0c\u4ee5\u4e0b\u505a\u4e86\u4e00\u4e9b\u5b9a\u4e49\uff1a vdp -> \u7279\u6307\u4f4d\u4e8e\u4e1c\u56fe\u7684 NFS \u670d\u52a1\u5668\u3002 vdp2 -> \u7279\u6307\u4f4d\u4e8e\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u7684\u865a\u62df\u673a\u5907\u4efd\u9635\u5217\u3002 vdp \u5907\u4efd\u7a0b\u5e8f\u3001vdp \u5907\u4efd\u865a\u62df\u673a\u3001vSphereDataProtection -> \u7279\u6307\u8fd0\u884c\u5728 esxi-5 \u4e0a\u7684 vdp \u5907\u4efd\u670d\u52a1\u3002 vdp2 \u6302\u63a5\u5728 esxi-5 \u4e0a\uff0cesxi-5 \u6e90\u4e8e\u8001 mirrors\uff08mirrors2 \u4e4b\u524d\u7684\u4e00\u4ee3\u673a\u5668\uff09\u3002vSphereDataProtection \u7248\u672c\u4e3a 6.1.5\u3002 \u5f53 vdp \u5907\u4efd\u7a0b\u5e8f\u51fa\u73b0\u5947\u602a\u7684\u95ee\u9898\u7684\u65f6\u5019\uff0c\u91cd\u542f vdp \u5907\u4efd\u865a\u62df\u673a\u7edd\u5927\u591a\u6570\u65f6\u5019\u80fd\u591f\u89e3\u51b3\u95ee\u9898\u3002\u91cd\u542f\u8017\u65f6\u975e\u5e38\u957f\uff0c\u9700\u8981\u505a\u597d\u5fc3\u7406\u51c6\u5907\u3002 \u5907\u4efd\u65f6\uff0cvdp \u5907\u4efd\u7a0b\u5e8f\u4f1a\u4e3a\u865a\u62df\u673a\u65b0\u5efa\u4e00\u4e2a snapshot\uff0c\u4e4b\u540e\u4ece snapshot \u4f20\u8f93\u5907\u4efd\u3002\u5076\u5c14 snapshot \u4e0d\u4f1a\u88ab\u6b63\u5e38\u5220\u9664\uff0c\u800c\u5927\u91cf\u6216\u957f\u65f6\u95f4\u5b58\u653e\u7684 snapshot \u4f1a\u7ed9\u6027\u80fd\u5e26\u6765\u8d1f\u9762\u5f71\u54cd\uff0c\u6240\u4ee5\u5982\u679c\u53d1\u73b0\u6b64\u7c7b\u60c5\u51b5\uff0c\u5728\u786e\u8ba4\u5907\u4efd\u4e0d\u518d\u8fdb\u884c\u540e\uff0c\u9700\u8981\u5220\u9664 snapshot\uff0c\u540c\u65f6\u4fdd\u6301\u673a\u5668\u5728\u7ebf\uff08\u5728\u5173\u673a\u60c5\u51b5\u4e0b\u6574\u5408\u78c1\u76d8\u65f6\u65e0\u6cd5\u5f00\u673a\uff01\uff09\u3002 \u53c2\u8003\u8d44\u6599\uff1a https://docs.vmware.com/en/VMware-vSphere/6.5/rn/data-protection-615-release-notes.html VDP \u5907\u4efd\u865a\u62df\u673a\u5df2\u7ecf EOL\u3002\u8bbf\u95ee vcenter \u4e2d\u7684 VDP \u63d2\u4ef6\u9700\u8981\u4f7f\u7528 Adobe Flash\u3002 \u5907\u4efd\u8ba1\u5212 \u00b6 \u76ee\u524d\u7684\u5907\u4efd\u8ba1\u5212\u5982\u4e0b\uff1a \u4e1c\u56fe\u9664 gitlab \u4ee5\u5916\u7684\u865a\u62df\u673a\uff0cesxi-5 \u6d3b\u8dc3\u7684\u865a\u62df\u673a\uff0c\u4ee5\u53ca hackergame web \u865a\u62df\u673a\u6bcf\u65e5\u5907\u4efd\u4e00\u6b21\u3002 gitlab \u6bcf\u5468\u5907\u4efd\u4e00\u6b21\u3002\uff08\u56e0\u4e3a\u5b83\u592a\u5927\u4e86\uff09 \u9ad8\u7ea7\u547d\u4ee4 \u00b6 \u67e5\u770b\u5f53\u524d\u4efb\u52a1\uff1a # mccli activity show | grep Running \u67e5\u770b\u670d\u52a1\u60c5\u51b5\uff1a # dpnctl status # status.dpn","title":"VDP"},{"location":"infrastructure/vsphere/vdp/#vdp","text":"\u5f53\u6211\u4eec\u8bf4\u5230 VDP \u7684\u65f6\u5019\uff0c\u6211\u4eec\u5230\u5e95\u5728\u6307\u4ec0\u4e48\uff1f\u4e3a\u4e86\u907f\u514d\u6b67\u4e49\uff0c\u4ee5\u4e0b\u505a\u4e86\u4e00\u4e9b\u5b9a\u4e49\uff1a vdp -> \u7279\u6307\u4f4d\u4e8e\u4e1c\u56fe\u7684 NFS \u670d\u52a1\u5668\u3002 vdp2 -> \u7279\u6307\u4f4d\u4e8e\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u7684\u865a\u62df\u673a\u5907\u4efd\u9635\u5217\u3002 vdp \u5907\u4efd\u7a0b\u5e8f\u3001vdp \u5907\u4efd\u865a\u62df\u673a\u3001vSphereDataProtection -> \u7279\u6307\u8fd0\u884c\u5728 esxi-5 \u4e0a\u7684 vdp \u5907\u4efd\u670d\u52a1\u3002 vdp2 \u6302\u63a5\u5728 esxi-5 \u4e0a\uff0cesxi-5 \u6e90\u4e8e\u8001 mirrors\uff08mirrors2 \u4e4b\u524d\u7684\u4e00\u4ee3\u673a\u5668\uff09\u3002vSphereDataProtection \u7248\u672c\u4e3a 6.1.5\u3002 \u5f53 vdp \u5907\u4efd\u7a0b\u5e8f\u51fa\u73b0\u5947\u602a\u7684\u95ee\u9898\u7684\u65f6\u5019\uff0c\u91cd\u542f vdp \u5907\u4efd\u865a\u62df\u673a\u7edd\u5927\u591a\u6570\u65f6\u5019\u80fd\u591f\u89e3\u51b3\u95ee\u9898\u3002\u91cd\u542f\u8017\u65f6\u975e\u5e38\u957f\uff0c\u9700\u8981\u505a\u597d\u5fc3\u7406\u51c6\u5907\u3002 \u5907\u4efd\u65f6\uff0cvdp \u5907\u4efd\u7a0b\u5e8f\u4f1a\u4e3a\u865a\u62df\u673a\u65b0\u5efa\u4e00\u4e2a snapshot\uff0c\u4e4b\u540e\u4ece snapshot \u4f20\u8f93\u5907\u4efd\u3002\u5076\u5c14 snapshot \u4e0d\u4f1a\u88ab\u6b63\u5e38\u5220\u9664\uff0c\u800c\u5927\u91cf\u6216\u957f\u65f6\u95f4\u5b58\u653e\u7684 snapshot \u4f1a\u7ed9\u6027\u80fd\u5e26\u6765\u8d1f\u9762\u5f71\u54cd\uff0c\u6240\u4ee5\u5982\u679c\u53d1\u73b0\u6b64\u7c7b\u60c5\u51b5\uff0c\u5728\u786e\u8ba4\u5907\u4efd\u4e0d\u518d\u8fdb\u884c\u540e\uff0c\u9700\u8981\u5220\u9664 snapshot\uff0c\u540c\u65f6\u4fdd\u6301\u673a\u5668\u5728\u7ebf\uff08\u5728\u5173\u673a\u60c5\u51b5\u4e0b\u6574\u5408\u78c1\u76d8\u65f6\u65e0\u6cd5\u5f00\u673a\uff01\uff09\u3002 \u53c2\u8003\u8d44\u6599\uff1a https://docs.vmware.com/en/VMware-vSphere/6.5/rn/data-protection-615-release-notes.html VDP \u5907\u4efd\u865a\u62df\u673a\u5df2\u7ecf EOL\u3002\u8bbf\u95ee vcenter \u4e2d\u7684 VDP \u63d2\u4ef6\u9700\u8981\u4f7f\u7528 Adobe Flash\u3002","title":"VDP"},{"location":"infrastructure/vsphere/vdp/#_1","text":"\u76ee\u524d\u7684\u5907\u4efd\u8ba1\u5212\u5982\u4e0b\uff1a \u4e1c\u56fe\u9664 gitlab \u4ee5\u5916\u7684\u865a\u62df\u673a\uff0cesxi-5 \u6d3b\u8dc3\u7684\u865a\u62df\u673a\uff0c\u4ee5\u53ca hackergame web \u865a\u62df\u673a\u6bcf\u65e5\u5907\u4efd\u4e00\u6b21\u3002 gitlab \u6bcf\u5468\u5907\u4efd\u4e00\u6b21\u3002\uff08\u56e0\u4e3a\u5b83\u592a\u5927\u4e86\uff09","title":"\u5907\u4efd\u8ba1\u5212"},{"location":"infrastructure/vsphere/vdp/#_2","text":"\u67e5\u770b\u5f53\u524d\u4efb\u52a1\uff1a # mccli activity show | grep Running \u67e5\u770b\u670d\u52a1\u60c5\u51b5\uff1a # dpnctl status # status.dpn","title":"\u9ad8\u7ea7\u547d\u4ee4"},{"location":"projects/linux101/","text":"Linux 101 \u00b6 Someone fill this page...?","title":"Linux 101"},{"location":"projects/linux101/#linux-101","text":"Someone fill this page...?","title":"Linux 101"},{"location":"services/auth-dns/","text":"Authoritative DNS \u00b6 Services: ns-a.ustclug.org ns-b.ustclug.org ns-c.ustclug.org Servers: ns-a.s.ustclug.org ns-b.s.ustclug.org (not ns-c) Deploy \u00b6 Bind configuration: https://github.com/ustclug/auth-dns Bind Dockerfile: https://github.com/zhsj/dockerfile/tree/master/bind9 The bind configuration repository is only visible to admins because private key is included. # copy the ssh key https://git.lug.ustc.edu.cn/ustclug/auth-dns/blob/master/git_pull_key # to ~/.ssh/id_ed25519 # now get the conf git clone git@github.com:ustclug/auth-dns.git /var/lib/bind # delete the ssh key rm ~/.ssh/id_ed25519 docker run --restart=always -v /var/lib/bind/:/etc/bind \\ --net host -it -d --name=auth-dns zhusj/bind9 Update DNS Record \u00b6 Just commit your change to the configuartion repository. More details can be found in the repository. Webhook \u00b6 Please add a webhook in the configuration repository, so that the DNS record can be automatically updated when we commit. The webhook endpoint is http://<server_ip>:9000/hooks/bind, see https://github.com/ustclug/auth-dns/settings/hooks for example.","title":"Authoritative DNS"},{"location":"services/auth-dns/#authoritative-dns","text":"Services: ns-a.ustclug.org ns-b.ustclug.org ns-c.ustclug.org Servers: ns-a.s.ustclug.org ns-b.s.ustclug.org (not ns-c)","title":"Authoritative DNS"},{"location":"services/auth-dns/#deploy","text":"Bind configuration: https://github.com/ustclug/auth-dns Bind Dockerfile: https://github.com/zhsj/dockerfile/tree/master/bind9 The bind configuration repository is only visible to admins because private key is included. # copy the ssh key https://git.lug.ustc.edu.cn/ustclug/auth-dns/blob/master/git_pull_key # to ~/.ssh/id_ed25519 # now get the conf git clone git@github.com:ustclug/auth-dns.git /var/lib/bind # delete the ssh key rm ~/.ssh/id_ed25519 docker run --restart=always -v /var/lib/bind/:/etc/bind \\ --net host -it -d --name=auth-dns zhusj/bind9","title":"Deploy"},{"location":"services/auth-dns/#update-dns-record","text":"Just commit your change to the configuartion repository. More details can be found in the repository.","title":"Update DNS Record"},{"location":"services/auth-dns/#webhook","text":"Please add a webhook in the configuration repository, so that the DNS record can be automatically updated when we commit. The webhook endpoint is http://<server_ip>:9000/hooks/bind, see https://github.com/ustclug/auth-dns/settings/hooks for example.","title":"Webhook"},{"location":"services/discontinued/","text":"Discontinued Services \u00b6 \u672c\u9875\u9762\u8bb0\u8f7d\u66fe\u7ecf\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u4f46\u662f\u7531\u4e8e\u67b6\u6784\u6539\u53d8\u6216\u670d\u52a1\u8fc1\u79fb\uff0c\u8fd9\u4e9b\u670d\u52a1\u4e0d\u518d\u4ee5\u539f\u6765\u7684\u5f62\u5f0f\u63d0\u4f9b\uff0c\u5e76\u53ef\u80fd\u5728\u539f\u5904\u6709\u6b8b\u7559\u7684\u914d\u7f6e\u6587\u4ef6\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\u6b8b\u7559\u7684\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u76f4\u63a5\u5220\u9664\uff0c\u4f46\u662f\u4fdd\u9669\u8d77\u89c1\uff0c\u4ecd\u7136\u5efa\u8bae\u5728 Internals \u7fa4\u91cc\u5148\u8be2\u95ee\u4e00\u4e0b\u518d\u5904\u7406\u3002 Docker Registry \u00b6 \u66fe\u7ecf\u8fd0\u884c\u5728 docker2 \u4e0a\uff0c\u73b0\u5728 LUG \u7684 Docker \u955c\u50cf\u5df2\u8f6c\u79fb\u81f3 Docker Hub\u3002 Freeshell \u00b6 \uff08\u672a\u5b8c\u5f85\u7eed\uff0c\u914d\u7f6e\u6587\u4ef6\u5148\u4fdd\u7559\uff09 USTC Blog \u00b6 Refer to Gitlab Wiki . Telegram Web \u00b6 Service\uff1a telegram.ustclug.org Repository\uff1a github.com/ustclug/telegram-web DockerHub\uff1a ustclug/telegram-web Deployment\uff1a telegram-web.sh Servers\uff1a swarm.s.ustclug.org\uff08Docker Container\uff09 revproxy-el.s.ustclug.org\uff08reverse proxy\uff09 Blog\uff1a add-telegram-web-service USTC Life \u00b6 USTC Life is a navigation page, which included useful sites in USTC. 2020-04-09 \u66f4\u65b0\u4fe1\u606f \u76ee\u524d\uff0cUSTC Life \u670d\u52a1\u6258\u7ba1\u5728 GitHub Pages \u4e0a\u3002\u4ee5\u4e0b\u5185\u5bb9\u4ec5\u4e3a\u5386\u53f2\u8bb0\u5f55\u3002 service: ustc.life Git Repository: github.com/ustclug/ustclife DockerHub: ustclug/ustclife server: docker2.s.ustclug.org deploy: /srv/webhook/ustclife.sh webhook from DockerHub: /srv/webhook/hooks.json","title":"Discontinued Services"},{"location":"services/discontinued/#discontinued-services","text":"\u672c\u9875\u9762\u8bb0\u8f7d\u66fe\u7ecf\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u4f46\u662f\u7531\u4e8e\u67b6\u6784\u6539\u53d8\u6216\u670d\u52a1\u8fc1\u79fb\uff0c\u8fd9\u4e9b\u670d\u52a1\u4e0d\u518d\u4ee5\u539f\u6765\u7684\u5f62\u5f0f\u63d0\u4f9b\uff0c\u5e76\u53ef\u80fd\u5728\u539f\u5904\u6709\u6b8b\u7559\u7684\u914d\u7f6e\u6587\u4ef6\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\u6b8b\u7559\u7684\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u76f4\u63a5\u5220\u9664\uff0c\u4f46\u662f\u4fdd\u9669\u8d77\u89c1\uff0c\u4ecd\u7136\u5efa\u8bae\u5728 Internals \u7fa4\u91cc\u5148\u8be2\u95ee\u4e00\u4e0b\u518d\u5904\u7406\u3002","title":"Discontinued Services"},{"location":"services/discontinued/#docker-registry","text":"\u66fe\u7ecf\u8fd0\u884c\u5728 docker2 \u4e0a\uff0c\u73b0\u5728 LUG \u7684 Docker \u955c\u50cf\u5df2\u8f6c\u79fb\u81f3 Docker Hub\u3002","title":"Docker Registry"},{"location":"services/discontinued/#freeshell","text":"\uff08\u672a\u5b8c\u5f85\u7eed\uff0c\u914d\u7f6e\u6587\u4ef6\u5148\u4fdd\u7559\uff09","title":"Freeshell"},{"location":"services/discontinued/#ustc-blog","text":"Refer to Gitlab Wiki .","title":"USTC Blog"},{"location":"services/discontinued/#telegram-web","text":"Service\uff1a telegram.ustclug.org Repository\uff1a github.com/ustclug/telegram-web DockerHub\uff1a ustclug/telegram-web Deployment\uff1a telegram-web.sh Servers\uff1a swarm.s.ustclug.org\uff08Docker Container\uff09 revproxy-el.s.ustclug.org\uff08reverse proxy\uff09 Blog\uff1a add-telegram-web-service","title":"Telegram Web"},{"location":"services/discontinued/#ustc-life","text":"USTC Life is a navigation page, which included useful sites in USTC. 2020-04-09 \u66f4\u65b0\u4fe1\u606f \u76ee\u524d\uff0cUSTC Life \u670d\u52a1\u6258\u7ba1\u5728 GitHub Pages \u4e0a\u3002\u4ee5\u4e0b\u5185\u5bb9\u4ec5\u4e3a\u5386\u53f2\u8bb0\u5f55\u3002 service: ustc.life Git Repository: github.com/ustclug/ustclife DockerHub: ustclug/ustclife server: docker2.s.ustclug.org deploy: /srv/webhook/ustclife.sh webhook from DockerHub: /srv/webhook/hooks.json","title":"USTC Life"},{"location":"services/docker2/","text":"Docker services \u00b6 Server: docker2.s.ustclug.org Special configurations \u00b6 Docker \"pingd\" \u00b6 \u66f4\u65b0\uff1a\u95ee\u9898\u5df2\u7ecf\u67e5\u660e\u4e3a Debian \u7684 Linux \u5185\u6838 bug ( https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=952660 )\uff0c\u5df2\u7ecf\u901a\u8fc7\u66f4\u65b0\u5185\u6838\u5e76\u91cd\u542f\u800c\u89e3\u51b3\u3002\u4ee5\u4e0b\u5185\u5bb9\u4ec5\u4f5c\u5b58\u6863\u3002 \u51fa\u4e8e\u672a\u77e5\u539f\u56e0\u6709\u65f6\u5019\u5916\u90e8\u4e3b\u673a\u4f1a\u65e0\u6cd5\u4e3b\u52a8\u8fde\u901a Docker \u5bb9\u5668\uff08\u53ef\u80fd\u4e0e ARP \u6709\u5173\uff09\uff0c\u4f46\u662f\u5982\u679c\u67d0\u4e2a\u5bb9\u5668\u5148 ping \u4e86\u4e00\u4e0b\u5916\u90e8\u4e3b\u673a\uff0c\u5c31\u80fd\u53cc\u5411\u8fde\u901a\u4e86\u3002 \u7531\u4e8e\u6211\u4eec\u6682\u672a\u627e\u5230\u6b63\u5e38\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u56e0\u6b64\u4f7f\u7528 \u201cping daemon\u201d \u4f5c\u4e3a\u4e00\u4e2a workaround\uff0c\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c ping \u4fdd\u6301\u5916\u90e8\u4e3b\u673a\u7684\u8fde\u901a\u6027\u3002 Systemd \u670d\u52a1 docker-pingd@.service : [Unit] Description = Docker pingd service %I Documentation = man:ping(8) After = network.target StartLimitIntervalSec = 0 [Service] Type = simple User = root Group = root ExecStart = /bin/sh -c 'IVAR=\"%i\"; exec /usr/bin/docker exec \"$${IVAR%:*}\" ping -q -s 32 \"$${IVAR#*:}\"' ExecStop = /bin/kill -s INT $MAINPID Restart = on-failure RestartSec = 3 [Install] WantedBy = multi-user.target Alias = docker-ping@.service \u4f7f\u7528\u65b9\u5f0f\uff1a systemctl enable docker-pingd@container:host.service \uff0c container \u6362\u6210\u5bb9\u5668\u540d\uff0c host \u6362\u6210 ping \u7684\u76ee\u6807\u3002 Trick \u4ecb\u7ecd\uff1aSystemd service \u914d\u7f6e\u6682\u4e0d\u652f\u6301\u591a\u4e2a\u6a21\u677f\u53c2\u6570 %i \uff0c\u56e0\u6b64\u8c03\u7528 shell \u6765\u89e3\u6790\u53c2\u6570\u3002Ref: https://github.com/systemd/systemd/issues/14895#issuecomment-612270690","title":"Docker2"},{"location":"services/docker2/#docker-services","text":"Server: docker2.s.ustclug.org","title":"Docker services"},{"location":"services/docker2/#special-configurations","text":"","title":"Special configurations"},{"location":"services/docker2/#docker-pingd","text":"\u66f4\u65b0\uff1a\u95ee\u9898\u5df2\u7ecf\u67e5\u660e\u4e3a Debian \u7684 Linux \u5185\u6838 bug ( https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=952660 )\uff0c\u5df2\u7ecf\u901a\u8fc7\u66f4\u65b0\u5185\u6838\u5e76\u91cd\u542f\u800c\u89e3\u51b3\u3002\u4ee5\u4e0b\u5185\u5bb9\u4ec5\u4f5c\u5b58\u6863\u3002 \u51fa\u4e8e\u672a\u77e5\u539f\u56e0\u6709\u65f6\u5019\u5916\u90e8\u4e3b\u673a\u4f1a\u65e0\u6cd5\u4e3b\u52a8\u8fde\u901a Docker \u5bb9\u5668\uff08\u53ef\u80fd\u4e0e ARP \u6709\u5173\uff09\uff0c\u4f46\u662f\u5982\u679c\u67d0\u4e2a\u5bb9\u5668\u5148 ping \u4e86\u4e00\u4e0b\u5916\u90e8\u4e3b\u673a\uff0c\u5c31\u80fd\u53cc\u5411\u8fde\u901a\u4e86\u3002 \u7531\u4e8e\u6211\u4eec\u6682\u672a\u627e\u5230\u6b63\u5e38\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u56e0\u6b64\u4f7f\u7528 \u201cping daemon\u201d \u4f5c\u4e3a\u4e00\u4e2a workaround\uff0c\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c ping \u4fdd\u6301\u5916\u90e8\u4e3b\u673a\u7684\u8fde\u901a\u6027\u3002 Systemd \u670d\u52a1 docker-pingd@.service : [Unit] Description = Docker pingd service %I Documentation = man:ping(8) After = network.target StartLimitIntervalSec = 0 [Service] Type = simple User = root Group = root ExecStart = /bin/sh -c 'IVAR=\"%i\"; exec /usr/bin/docker exec \"$${IVAR%:*}\" ping -q -s 32 \"$${IVAR#*:}\"' ExecStop = /bin/kill -s INT $MAINPID Restart = on-failure RestartSec = 3 [Install] WantedBy = multi-user.target Alias = docker-ping@.service \u4f7f\u7528\u65b9\u5f0f\uff1a systemctl enable docker-pingd@container:host.service \uff0c container \u6362\u6210\u5bb9\u5668\u540d\uff0c host \u6362\u6210 ping \u7684\u76ee\u6807\u3002 Trick \u4ecb\u7ecd\uff1aSystemd service \u914d\u7f6e\u6682\u4e0d\u652f\u6301\u591a\u4e2a\u6a21\u677f\u53c2\u6570 %i \uff0c\u56e0\u6b64\u8c03\u7528 shell \u6765\u89e3\u6790\u53c2\u6570\u3002Ref: https://github.com/systemd/systemd/issues/14895#issuecomment-612270690","title":"Docker \"pingd\""},{"location":"services/ftp/","text":"LUG FTP \u00b6 service: FTP/FTPS , SFTP , HTTP , HTTPS , AFP Git Repository: github.com/ustclug/lugftp DockerHub: ustclug/ftp server: vdp.s.ustclug.org theme: h5ai deploy: ftp.sh Notes \u00b6 SSL cert is required when running lugftp. ssh-keygen -A is required to be manually run when initializing. About directory permission: It is strongly suggested to keep permission & owner metadata when backuping/restoring. Public folder root: set owner to root:root, permission to dr-xr-xr-x Subfolders: set owner to 1000:1000. _h5ai and wp-content needs to be set to a different owner (misconfigured?). And Incoming shall be set to drwxrwxr-x. Do not use Google DNS in host, as mobile network may drop the UDP packet to 8.8.8.8. A misconfigured DNS may lead to LDAP in container broken.","title":"FTP"},{"location":"services/ftp/#lug-ftp","text":"service: FTP/FTPS , SFTP , HTTP , HTTPS , AFP Git Repository: github.com/ustclug/lugftp DockerHub: ustclug/ftp server: vdp.s.ustclug.org theme: h5ai deploy: ftp.sh","title":"LUG FTP"},{"location":"services/ftp/#notes","text":"SSL cert is required when running lugftp. ssh-keygen -A is required to be manually run when initializing. About directory permission: It is strongly suggested to keep permission & owner metadata when backuping/restoring. Public folder root: set owner to root:root, permission to dr-xr-xr-x Subfolders: set owner to 1000:1000. _h5ai and wp-content needs to be set to a different owner (misconfigured?). And Incoming shall be set to drwxrwxr-x. Do not use Google DNS in host, as mobile network may drop the UDP packet to 8.8.8.8. A misconfigured DNS may lead to LDAP in container broken.","title":"Notes"},{"location":"services/generate-204/","text":"Generate 204 \u00b6 Service: 204.ustclug.org Configration: GitLab/nginx-config/sites-available/204.ustclug.org Server: revproxy-el.s.ustclug.org Blog: add-http-204-service","title":"Generate 204"},{"location":"services/generate-204/#generate-204","text":"Service: 204.ustclug.org Configration: GitLab/nginx-config/sites-available/204.ustclug.org Server: revproxy-el.s.ustclug.org Blog: add-http-204-service","title":"Generate 204"},{"location":"services/gitlab/","text":"GitLab \u00b6 Server: gitlab.s.ustclug.org (ssh Port 2222) Git Repository: - gitlab-scripts \u66f4\u65b0 \u00b6 \u7531\u4e8e\u5df2\u7ecf docker \u5316\uff0c\u56e0\u6b64\u6211\u4eec\u7684\u66f4\u65b0\u662f\u901a\u8fc7\u62c9\u53d6 sameersbn/docker-gitlab \u7684 docker image\uff0c\u8fdb\u884c\u6570\u636e\u5e93\u51c6\u5907\u4ee5\u53ca\u542f\u52a8\u955c\u50cf\u5b9e\u4f8b\u6765\u8fdb\u884c\u66f4\u65b0\uff0cZack Zeng \u5b66\u957f\u5df2\u7ecf\u5199\u597d\u4e86\u4e00\u5957\u811a\u672c\u7cfb\u7edf\uff1a gitlab-scripts \uff0c\u56e0\u6b64\u66f4\u65b0\u65f6\u53ea\u8981\u8dd1\u811a\u672c\u5c31\u53ef\u4ee5\u4e86\u3002 \u7531\u4e8e\u66f4\u65b0\u9700\u8981\u505c\u6b62\u670d\u52a1\uff0c\u56e0\u6b64\u8bf7\u4e8e\u66f4\u65b0\u524d\u81f3\u5c11\u51e0\u5c0f\u65f6\u53d1\u5e03\u66f4\u65b0\u516c\u544a\uff08\u5305\u62ec\u5177\u4f53\u65f6\u95f4\u7b49\uff09 \u66f4\u65b0\u524d\u8bf7\u5148\u63d0\u524d\u4e8e VCenter \u4e0a\u5bf9\u865a\u62df\u673a\u6253\u5feb\u7167\uff08\u6253\u5feb\u7167\u65f6\u670d\u52a1\u4f1a\u6682\u65f6\u505c\u6b62\uff09 \u6253\u5b8c\u5feb\u7167\u4e4b\u540e\u4f7f\u7528\u811a\u672c\u8fdb\u884c\u66f4\u65b0\uff0c\u9996\u5148\u4f7f\u7528 ./gitlab.sh db \u8fdb\u884c\u6570\u636e\u5e93\u7684\u51c6\u5907\u5de5\u4f5c\u3002\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7 ./gitlab.sh run <\u7248\u672c\u53f7> \u6765\u8fdb\u884c docker container \u7684\u66ff\u6362\u3002\u66f4\u6362\u524d\u811a\u672c\u4f1a\u81ea\u52a8\u62c9\u53d6\u76f8\u5e94\u7248\u672c\u53f7\u7684 docker \u955c\u50cf\uff0c\u5982\u679c\u62c5\u5fc3\u62c9\u53d6\u65f6\u95f4\u8fc7\u957f\u53ef\u4ee5\u5728\u6253\u5feb\u7167\u524d\u63d0\u524d\u901a\u8fc7 docker pull sameersbn/gitlab:<\u7248\u672c\u53f7> \u6765\u62c9\u53d6\u76f8\u5e94\u7684\u955c\u50cf\u3002 \u4e00\u822c\u60c5\u51b5\u4e0b\u7ecf\u4ee5\u4e0a\u64cd\u4f5c\u540e\u66f4\u65b0\u5c31\u6b63\u5e38\u7ed3\u675f\uff0c\u5982\u679c\u957f\u65f6\u95f4\u65e0\u6cd5\u542f\u52a8\uff0c\u53ef\u4ee5\u901a\u8fc7 docker logs gitlab \u67e5\u770b\u65e5\u5fd7\uff0c\u5982\u679c\u53d1\u73b0\u66f4\u65b0\u540e\u7684\u542f\u52a8\u51fa\u73b0\u95ee\u9898\uff0c\u53ef\u4ee5\u5230 sameersbn/docker-gitlab \u7684 issue \u533a\u7b49\u5730\u67e5\u770b\u76f8\u5173 issue\uff0c\u4ee5\u53ca\u901a\u8fc7\u5bf9\u51fa\u9519\u65e5\u5fd7\u8fdb\u884c Google \u53ef\u80fd\u4f1a\u53d1\u73b0\u662f gitlab \u4e0a\u6e38\u7b49\u51fa\u73b0\u7684\u95ee\u9898\u3002\u5982\u679c\u6709\u89e3\u51b3\u529e\u6cd5\uff0c\u53ef\u4ee5\u6309\u7167\u76f8\u5e94\u89e3\u51b3\u529e\u6cd5\u89e3\u51b3\uff0c\u5982\u679c\u6ca1\u6709\u3002\u53ef\u4ee5\u901a\u8fc7\u627e\u5230\u6709\u76f8\u5e94\u95ee\u9898\u524d\u7684\u6b63\u5e38\u7248\u672c\u53f7\uff0c\u56de\u6eda\u5feb\u7167\uff0c\u4e4b\u540e\u66f4\u5230\u8868\u73b0\u6b63\u5e38\u7684\u7248\u672c\u3002\uff08\u6700\u8fd1\u7684\u66f4\u65b0\u4f1a\u5728\u542f\u52a8\u4e4b\u540e\u77ed\u6682\u51fa\u73b0 502 \u7684\u60c5\u51b5\uff0c\u4f46\u5f88\u5feb\u5c31\u4f1a\u6062\u590d\uff0c\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\u65f6\u4e0d\u8981\u60ca\u614c\uff09\u3002 \u7531\u4e8e\u66f4\u65b0\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\u5bfc\u81f4\u670d\u52a1\u4e0d\u53ef\u7528\uff0c\u56e0\u6b64\u4e0d\u5efa\u8bae\u901a\u8fc7 cron \u7b49\u65b9\u5f0f\u81ea\u52a8\u8fdb\u884c\u66f4\u65b0\u3002 postgresql \u4e0e redis \u7684\u66f4\u65b0 \u00b6 \u7531\u4e8e gitlab \u66f4\u65b0\u540e\u53ef\u80fd\u5bf9 postgresql \u4e0e redis \u7684\u7248\u672c\u6709\u8981\u6c42\uff0c\u56e0\u6b64\u6709\u53ef\u80fd\u9700\u8981\u5b9a\u671f\u66f4\u65b0 redis \u4e0e postgresql\u3002 \u66f4\u65b0\u524d\u8bf7\u5148\u505c\u6b62 gitlab \u7684 container \u66f4\u65b0\u65f6\u53ef\u4ee5\u6309\u7167\u5b98\u7f51\u6559\u7a0b docker-postgresql \u8fdb\u884c\u66f4\u65b0\uff0c\u53ef\u4ee5\u901a\u8fc7\u62c9\u53d6 latest \u6807\u7b7e\u7684\u955c\u50cf\uff0c\u5220\u9664\u539f\u6765\u7684 container\uff0c\u518d\u901a\u8fc7\u811a\u672c ./gitlab.sh db \u81ea\u52a8\u542f\u52a8\uff0c\u6570\u636e\u5e93\u66f4\u65b0\u65f6\u53ef\u80fd\u4f1a\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u6765\u8fc1\u79fb\u6570\u636e\uff0c\u8bf7\u901a\u8fc7 docker logs -f gitlab-postgresql \u547d\u4ee4\u6765\u67e5\u770b\u8fc1\u79fb\u8fdb\u5ea6\uff0c\u5f85\u8fc1\u79fb\u5b8c\u6210\u540e\u518d\u8fd0\u884c GitLab \u7684 container\u3002 \u8bbf\u95ee Rails console \u00b6 Rails console \u53ef\u4ee5\u5b8c\u6210\u4e00\u4e9b\u9ad8\u7ea7\u7684\u7ef4\u62a4\u4efb\u52a1\u3002\u5728 gitlab \u5bb9\u5668\u4e2d\u6267\u884c bin/rails console \u542f\u52a8\u3002\u6ce8\u610f console \u7684\u542f\u52a8\u65f6\u95f4\u5f88\u957f\uff0c\u9700\u8981\u6709\u8010\u5fc3\u3002 \u53ef\u4ee5\u6267\u884c\u7684\u547d\u4ee4\u53ef\u53c2\u8003 https://docs.gitlab.com/ee/administration/troubleshooting/gitlab_rails_cheat_sheet.html \u3002 \u67e5\u8be2 \u00b6 \u67e5\u8be2 Hashed storage \u4e0b\u4ed3\u5e93\u5bf9\u5e94\u7684\u9879\u76ee \u00b6 ProjectRepository . find_by ( disk_path : '@hashed/23/33/2333333333333333333333333333333333333333333333333333333333333333' ) . project \u5982\u679c\u5b58\u5728\uff0c\u4f1a\u8fd4\u56de\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u5185\u5bb9\uff1a => #<Project id:23333 username/project>> \u67e5\u8be2\u65e0\u9879\u76ee\u4e14\u90ae\u7bb1\u6ee1\u8db3\u6761\u4ef6\u7684\u7528\u6237 (SQL like ) \u00b6 users = User . where ( 'id NOT IN (select distinct(user_id) from project_authorizations)' ) users = users . where ( 'email like ?' , '%.ru' ) users . count users . each do | user | puts user . last_activity_on end \u5237\u65b0\u67d0\u4e2a\u9879\u76ee\u7684\u7edf\u8ba1\u4fe1\u606f \u00b6 p = Project . find_by_full_path ( '<namespace>/<project>' ) pp p . statistics p . statistics . refresh! pp p . statistics \u83b7\u53d6\u6240\u6709\u5305\u542b LFS \u7684\u9879\u76ee ID \u00b6 LfsObject . all . each do | lo | puts LfsObjectsProject . find_by_lfs_object_id ( lo . id ) . project_id end \u8f93\u51fa\u8f83\u591a\u3002\u53ef\u4ee5\u4f7f\u7528 rails r xxx.rb \u8fd0\u884c\uff0c\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\uff0c\u53bb\u91cd\u540e\u67e5\u770b\u6240\u6709\u5305\u542b LFS \u7684\u9879\u76ee\u3002 \u4f7f\u7528 Rake tasks \u00b6 \u8be6\u89c1 https://github.com/sameersbn/docker-gitlab#rake-tasks \u3002\u548c Rails console \u4e00\u6837\uff0c\u521d\u59cb\u5316\u5f88\u6162\u3002 \u5f53\u524d\u5b9e\u4f8b\u4fe1\u606f\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:env:info RAILS_ENV = production \u6e05\u7406 \u00b6 \u53c2\u8003 https://github.com/gitlabhq/gitlabhq/blob/master/doc/raketasks/cleanup.md \u3002 \u4e0d\u8fc7\u4f5c\u7528\u6709\u9650\u3002 \u6e05\u7406\u4e0a\u4f20\u76ee\u5f55 \u00b6 \u67e5\u770b\u4f1a\u88ab\u6e05\u7406\u7684\u6587\u4ef6\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:project_uploads RAILS_ENV = production \u6e05\u7406\uff08\u79fb\u52a8\u5230 /-/project-lost-found/\uff09\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:project_uploads RAILS_ENV = production DRY_RUN = false \u6e05\u7406\u672a\u88ab\u5f15\u7528\u7684 artifact \u6587\u4ef6 \u00b6 \u67e5\u770b\u4f1a\u88ab\u6e05\u7406\u7684 artifact \u6570\u91cf\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:orphan_job_artifact_files RAILS_ENV = production \u6e05\u7406\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:orphan_job_artifact_files RAILS_ENV = production DRY_RUN = false \u6ce8\u610f\uff0c\u65b0\u8bbe\u7f6e\u7684 expire \u671f\u9650\u4e0d\u4f1a\u5f71\u54cd\u4ee5\u524d\u7684 artifact\uff0c\u8fd9\u91cc\u7684\u547d\u4ee4\u4e5f\u65e0\u6cd5\u6e05\u7406\u3002 \u6e05\u7406\u65e0\u6548\u7684 LFS reference \u00b6 for i in ` cat projectid_lfs ` ; do sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:orphan_lfs_file_references PROJECT_ID = $i RAILS_ENV = production DRY_RUN = false ; done projectid_lfs \u662f\u4e0a\u6587\u4e2d\u300c\u83b7\u53d6\u6240\u6709\u5305\u542b LFS \u7684\u9879\u76ee ID\u300d\u7684\u53bb\u91cd\u540e\u7684\u8f93\u51fa\u3002 \u65e0 reference \u7684 LFS \u6587\u4ef6\u6bcf\u65e5 GitLab \u4f1a\u81ea\u52a8\u6e05\u9664\u3002\u5982\u679c\u9700\u8981\u7acb\u523b\u5220\u9664\uff0c\u53ef\u4ee5\u4f7f\u7528 gitlab:cleanup:orphan_lfs_files \u3002 \u7d27\u6025\u64cd\u4f5c \u00b6 \u8bbe\u7f6e\u4e3a\u53ea\u8bfb \u00b6 https://docs.gitlab.com/ee/administration/read_only_gitlab.html # docker exec --user git -it gitlab bin/rails console \u4e4b\u540e\u6267\u884c Project . all . find_each { | project | puts project . name ; project . update! ( repository_read_only : true ) } \u5c06\u6240\u6709\u4ed3\u5e93\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\u3002\u5982\u679c\u4e2d\u95f4\u51fa\u73b0\u9519\u8bef\uff08\u7279\u6b8a\u7684\u9879\u76ee\u540d\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fd0\u884c\u4e2d\u65ad\uff09\uff0c\u91cd\u547d\u540d\u6700\u540e\u8f93\u51fa\u5bf9\u5e94\u7684\u9879\u76ee\u3002 \u5728\u8bbe\u7f6e\u524d\uff0c\u9700\u8981\u6dfb\u52a0 Messages \u901a\u77e5\u7528\u6237\u3002 \u6b64\u65f6\u6570\u636e\u5e93\u4ecd\u7136\u53ef\u5199\u5165\u3002\u5982\u679c\u9700\u8981\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u53c2\u8003\u4ee5\u4e0a\u94fe\u63a5\u914d\u7f6e\u3002","title":"GitLab"},{"location":"services/gitlab/#gitlab","text":"Server: gitlab.s.ustclug.org (ssh Port 2222) Git Repository: - gitlab-scripts","title":"GitLab"},{"location":"services/gitlab/#_1","text":"\u7531\u4e8e\u5df2\u7ecf docker \u5316\uff0c\u56e0\u6b64\u6211\u4eec\u7684\u66f4\u65b0\u662f\u901a\u8fc7\u62c9\u53d6 sameersbn/docker-gitlab \u7684 docker image\uff0c\u8fdb\u884c\u6570\u636e\u5e93\u51c6\u5907\u4ee5\u53ca\u542f\u52a8\u955c\u50cf\u5b9e\u4f8b\u6765\u8fdb\u884c\u66f4\u65b0\uff0cZack Zeng \u5b66\u957f\u5df2\u7ecf\u5199\u597d\u4e86\u4e00\u5957\u811a\u672c\u7cfb\u7edf\uff1a gitlab-scripts \uff0c\u56e0\u6b64\u66f4\u65b0\u65f6\u53ea\u8981\u8dd1\u811a\u672c\u5c31\u53ef\u4ee5\u4e86\u3002 \u7531\u4e8e\u66f4\u65b0\u9700\u8981\u505c\u6b62\u670d\u52a1\uff0c\u56e0\u6b64\u8bf7\u4e8e\u66f4\u65b0\u524d\u81f3\u5c11\u51e0\u5c0f\u65f6\u53d1\u5e03\u66f4\u65b0\u516c\u544a\uff08\u5305\u62ec\u5177\u4f53\u65f6\u95f4\u7b49\uff09 \u66f4\u65b0\u524d\u8bf7\u5148\u63d0\u524d\u4e8e VCenter \u4e0a\u5bf9\u865a\u62df\u673a\u6253\u5feb\u7167\uff08\u6253\u5feb\u7167\u65f6\u670d\u52a1\u4f1a\u6682\u65f6\u505c\u6b62\uff09 \u6253\u5b8c\u5feb\u7167\u4e4b\u540e\u4f7f\u7528\u811a\u672c\u8fdb\u884c\u66f4\u65b0\uff0c\u9996\u5148\u4f7f\u7528 ./gitlab.sh db \u8fdb\u884c\u6570\u636e\u5e93\u7684\u51c6\u5907\u5de5\u4f5c\u3002\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7 ./gitlab.sh run <\u7248\u672c\u53f7> \u6765\u8fdb\u884c docker container \u7684\u66ff\u6362\u3002\u66f4\u6362\u524d\u811a\u672c\u4f1a\u81ea\u52a8\u62c9\u53d6\u76f8\u5e94\u7248\u672c\u53f7\u7684 docker \u955c\u50cf\uff0c\u5982\u679c\u62c5\u5fc3\u62c9\u53d6\u65f6\u95f4\u8fc7\u957f\u53ef\u4ee5\u5728\u6253\u5feb\u7167\u524d\u63d0\u524d\u901a\u8fc7 docker pull sameersbn/gitlab:<\u7248\u672c\u53f7> \u6765\u62c9\u53d6\u76f8\u5e94\u7684\u955c\u50cf\u3002 \u4e00\u822c\u60c5\u51b5\u4e0b\u7ecf\u4ee5\u4e0a\u64cd\u4f5c\u540e\u66f4\u65b0\u5c31\u6b63\u5e38\u7ed3\u675f\uff0c\u5982\u679c\u957f\u65f6\u95f4\u65e0\u6cd5\u542f\u52a8\uff0c\u53ef\u4ee5\u901a\u8fc7 docker logs gitlab \u67e5\u770b\u65e5\u5fd7\uff0c\u5982\u679c\u53d1\u73b0\u66f4\u65b0\u540e\u7684\u542f\u52a8\u51fa\u73b0\u95ee\u9898\uff0c\u53ef\u4ee5\u5230 sameersbn/docker-gitlab \u7684 issue \u533a\u7b49\u5730\u67e5\u770b\u76f8\u5173 issue\uff0c\u4ee5\u53ca\u901a\u8fc7\u5bf9\u51fa\u9519\u65e5\u5fd7\u8fdb\u884c Google \u53ef\u80fd\u4f1a\u53d1\u73b0\u662f gitlab \u4e0a\u6e38\u7b49\u51fa\u73b0\u7684\u95ee\u9898\u3002\u5982\u679c\u6709\u89e3\u51b3\u529e\u6cd5\uff0c\u53ef\u4ee5\u6309\u7167\u76f8\u5e94\u89e3\u51b3\u529e\u6cd5\u89e3\u51b3\uff0c\u5982\u679c\u6ca1\u6709\u3002\u53ef\u4ee5\u901a\u8fc7\u627e\u5230\u6709\u76f8\u5e94\u95ee\u9898\u524d\u7684\u6b63\u5e38\u7248\u672c\u53f7\uff0c\u56de\u6eda\u5feb\u7167\uff0c\u4e4b\u540e\u66f4\u5230\u8868\u73b0\u6b63\u5e38\u7684\u7248\u672c\u3002\uff08\u6700\u8fd1\u7684\u66f4\u65b0\u4f1a\u5728\u542f\u52a8\u4e4b\u540e\u77ed\u6682\u51fa\u73b0 502 \u7684\u60c5\u51b5\uff0c\u4f46\u5f88\u5feb\u5c31\u4f1a\u6062\u590d\uff0c\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\u65f6\u4e0d\u8981\u60ca\u614c\uff09\u3002 \u7531\u4e8e\u66f4\u65b0\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\u5bfc\u81f4\u670d\u52a1\u4e0d\u53ef\u7528\uff0c\u56e0\u6b64\u4e0d\u5efa\u8bae\u901a\u8fc7 cron \u7b49\u65b9\u5f0f\u81ea\u52a8\u8fdb\u884c\u66f4\u65b0\u3002","title":"\u66f4\u65b0"},{"location":"services/gitlab/#postgresql-redis","text":"\u7531\u4e8e gitlab \u66f4\u65b0\u540e\u53ef\u80fd\u5bf9 postgresql \u4e0e redis \u7684\u7248\u672c\u6709\u8981\u6c42\uff0c\u56e0\u6b64\u6709\u53ef\u80fd\u9700\u8981\u5b9a\u671f\u66f4\u65b0 redis \u4e0e postgresql\u3002 \u66f4\u65b0\u524d\u8bf7\u5148\u505c\u6b62 gitlab \u7684 container \u66f4\u65b0\u65f6\u53ef\u4ee5\u6309\u7167\u5b98\u7f51\u6559\u7a0b docker-postgresql \u8fdb\u884c\u66f4\u65b0\uff0c\u53ef\u4ee5\u901a\u8fc7\u62c9\u53d6 latest \u6807\u7b7e\u7684\u955c\u50cf\uff0c\u5220\u9664\u539f\u6765\u7684 container\uff0c\u518d\u901a\u8fc7\u811a\u672c ./gitlab.sh db \u81ea\u52a8\u542f\u52a8\uff0c\u6570\u636e\u5e93\u66f4\u65b0\u65f6\u53ef\u80fd\u4f1a\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u6765\u8fc1\u79fb\u6570\u636e\uff0c\u8bf7\u901a\u8fc7 docker logs -f gitlab-postgresql \u547d\u4ee4\u6765\u67e5\u770b\u8fc1\u79fb\u8fdb\u5ea6\uff0c\u5f85\u8fc1\u79fb\u5b8c\u6210\u540e\u518d\u8fd0\u884c GitLab \u7684 container\u3002","title":"postgresql \u4e0e redis \u7684\u66f4\u65b0"},{"location":"services/gitlab/#rails-console","text":"Rails console \u53ef\u4ee5\u5b8c\u6210\u4e00\u4e9b\u9ad8\u7ea7\u7684\u7ef4\u62a4\u4efb\u52a1\u3002\u5728 gitlab \u5bb9\u5668\u4e2d\u6267\u884c bin/rails console \u542f\u52a8\u3002\u6ce8\u610f console \u7684\u542f\u52a8\u65f6\u95f4\u5f88\u957f\uff0c\u9700\u8981\u6709\u8010\u5fc3\u3002 \u53ef\u4ee5\u6267\u884c\u7684\u547d\u4ee4\u53ef\u53c2\u8003 https://docs.gitlab.com/ee/administration/troubleshooting/gitlab_rails_cheat_sheet.html \u3002","title":"\u8bbf\u95ee Rails console"},{"location":"services/gitlab/#_2","text":"","title":"\u67e5\u8be2"},{"location":"services/gitlab/#hashed-storage","text":"ProjectRepository . find_by ( disk_path : '@hashed/23/33/2333333333333333333333333333333333333333333333333333333333333333' ) . project \u5982\u679c\u5b58\u5728\uff0c\u4f1a\u8fd4\u56de\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u5185\u5bb9\uff1a => #<Project id:23333 username/project>>","title":"\u67e5\u8be2 Hashed storage \u4e0b\u4ed3\u5e93\u5bf9\u5e94\u7684\u9879\u76ee"},{"location":"services/gitlab/#sql-like","text":"users = User . where ( 'id NOT IN (select distinct(user_id) from project_authorizations)' ) users = users . where ( 'email like ?' , '%.ru' ) users . count users . each do | user | puts user . last_activity_on end","title":"\u67e5\u8be2\u65e0\u9879\u76ee\u4e14\u90ae\u7bb1\u6ee1\u8db3\u6761\u4ef6\u7684\u7528\u6237 (SQL like)"},{"location":"services/gitlab/#_3","text":"p = Project . find_by_full_path ( '<namespace>/<project>' ) pp p . statistics p . statistics . refresh! pp p . statistics","title":"\u5237\u65b0\u67d0\u4e2a\u9879\u76ee\u7684\u7edf\u8ba1\u4fe1\u606f"},{"location":"services/gitlab/#lfs-id","text":"LfsObject . all . each do | lo | puts LfsObjectsProject . find_by_lfs_object_id ( lo . id ) . project_id end \u8f93\u51fa\u8f83\u591a\u3002\u53ef\u4ee5\u4f7f\u7528 rails r xxx.rb \u8fd0\u884c\uff0c\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\uff0c\u53bb\u91cd\u540e\u67e5\u770b\u6240\u6709\u5305\u542b LFS \u7684\u9879\u76ee\u3002","title":"\u83b7\u53d6\u6240\u6709\u5305\u542b LFS \u7684\u9879\u76ee ID"},{"location":"services/gitlab/#rake-tasks","text":"\u8be6\u89c1 https://github.com/sameersbn/docker-gitlab#rake-tasks \u3002\u548c Rails console \u4e00\u6837\uff0c\u521d\u59cb\u5316\u5f88\u6162\u3002 \u5f53\u524d\u5b9e\u4f8b\u4fe1\u606f\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:env:info RAILS_ENV = production","title":"\u4f7f\u7528 Rake tasks"},{"location":"services/gitlab/#_4","text":"\u53c2\u8003 https://github.com/gitlabhq/gitlabhq/blob/master/doc/raketasks/cleanup.md \u3002 \u4e0d\u8fc7\u4f5c\u7528\u6709\u9650\u3002","title":"\u6e05\u7406"},{"location":"services/gitlab/#_5","text":"\u67e5\u770b\u4f1a\u88ab\u6e05\u7406\u7684\u6587\u4ef6\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:project_uploads RAILS_ENV = production \u6e05\u7406\uff08\u79fb\u52a8\u5230 /-/project-lost-found/\uff09\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:project_uploads RAILS_ENV = production DRY_RUN = false","title":"\u6e05\u7406\u4e0a\u4f20\u76ee\u5f55"},{"location":"services/gitlab/#artifact","text":"\u67e5\u770b\u4f1a\u88ab\u6e05\u7406\u7684 artifact \u6570\u91cf\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:orphan_job_artifact_files RAILS_ENV = production \u6e05\u7406\uff1a sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:orphan_job_artifact_files RAILS_ENV = production DRY_RUN = false \u6ce8\u610f\uff0c\u65b0\u8bbe\u7f6e\u7684 expire \u671f\u9650\u4e0d\u4f1a\u5f71\u54cd\u4ee5\u524d\u7684 artifact\uff0c\u8fd9\u91cc\u7684\u547d\u4ee4\u4e5f\u65e0\u6cd5\u6e05\u7406\u3002","title":"\u6e05\u7406\u672a\u88ab\u5f15\u7528\u7684 artifact \u6587\u4ef6"},{"location":"services/gitlab/#lfs-reference","text":"for i in ` cat projectid_lfs ` ; do sudo docker exec --user git -it gitlab bundle exec rake gitlab:cleanup:orphan_lfs_file_references PROJECT_ID = $i RAILS_ENV = production DRY_RUN = false ; done projectid_lfs \u662f\u4e0a\u6587\u4e2d\u300c\u83b7\u53d6\u6240\u6709\u5305\u542b LFS \u7684\u9879\u76ee ID\u300d\u7684\u53bb\u91cd\u540e\u7684\u8f93\u51fa\u3002 \u65e0 reference \u7684 LFS \u6587\u4ef6\u6bcf\u65e5 GitLab \u4f1a\u81ea\u52a8\u6e05\u9664\u3002\u5982\u679c\u9700\u8981\u7acb\u523b\u5220\u9664\uff0c\u53ef\u4ee5\u4f7f\u7528 gitlab:cleanup:orphan_lfs_files \u3002","title":"\u6e05\u7406\u65e0\u6548\u7684 LFS reference"},{"location":"services/gitlab/#_6","text":"","title":"\u7d27\u6025\u64cd\u4f5c"},{"location":"services/gitlab/#_7","text":"https://docs.gitlab.com/ee/administration/read_only_gitlab.html # docker exec --user git -it gitlab bin/rails console \u4e4b\u540e\u6267\u884c Project . all . find_each { | project | puts project . name ; project . update! ( repository_read_only : true ) } \u5c06\u6240\u6709\u4ed3\u5e93\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\u3002\u5982\u679c\u4e2d\u95f4\u51fa\u73b0\u9519\u8bef\uff08\u7279\u6b8a\u7684\u9879\u76ee\u540d\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fd0\u884c\u4e2d\u65ad\uff09\uff0c\u91cd\u547d\u540d\u6700\u540e\u8f93\u51fa\u5bf9\u5e94\u7684\u9879\u76ee\u3002 \u5728\u8bbe\u7f6e\u524d\uff0c\u9700\u8981\u6dfb\u52a0 Messages \u901a\u77e5\u7528\u6237\u3002 \u6b64\u65f6\u6570\u636e\u5e93\u4ecd\u7136\u53ef\u5199\u5165\u3002\u5982\u679c\u9700\u8981\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u53c2\u8003\u4ee5\u4e0a\u94fe\u63a5\u914d\u7f6e\u3002","title":"\u8bbe\u7f6e\u4e3a\u53ea\u8bfb"},{"location":"services/light/","text":"Light Accelerator \u00b6 service: light.ustclug.org Git Repositry: Server Daemon Web UI Accelerate list Documentation DockerHub: ustclug/light-server ustclug/lug-vpn-web:light mail list: \u8f7b\u91cf\u7ea7\u7f51\u7edc\u52a0\u901f\u670d\u52a1 server: swarm.s.ustclug.org (docker container) light-mysql light-freeradius light-server light-web gateway-el.s.ustclug.org (port mapping) 29979 -> light-server.d.ustclug.org:29979 29980 -> light-server.d.ustclug.org:29980 revproxy-el.s.ustclug.org (reverse proxy) light.ustclug.org -> light-web.d.ustclug.org docker2.s.ustclug.org LUG FTP: http://ftp.ustclug.org/light/ deploy \u00b6 deploy script: docker-run-script/light deploy order: mysql freeradius, light-web squid Add new domain \u00b6 git clone https://git.lug.ustc.edu.cn/lug-light/accelerate-list.git cd accelerate-list ./tools/add-domain.sh accelerate.list www.example.com git commit -v -a git push origin master Travis CI will update PAC files in LUG FTP automatically. Database maintenance \u00b6 Example: select count ( * ) from radacct where acctstoptime < '2021-01-01 00:00:00' ; insert into radacct_backup select * from radacct where acctstoptime < '2021-01-01 00:00:00' ; delete from radacct where acctstoptime < '2021-01-01 00:00:00' ; delete from radacct_backup where acctstoptime < '2020-06-01 00:00:00' ; optimize table radacct ; optimize table radacct_backup ;","title":"Light"},{"location":"services/light/#light-accelerator","text":"service: light.ustclug.org Git Repositry: Server Daemon Web UI Accelerate list Documentation DockerHub: ustclug/light-server ustclug/lug-vpn-web:light mail list: \u8f7b\u91cf\u7ea7\u7f51\u7edc\u52a0\u901f\u670d\u52a1 server: swarm.s.ustclug.org (docker container) light-mysql light-freeradius light-server light-web gateway-el.s.ustclug.org (port mapping) 29979 -> light-server.d.ustclug.org:29979 29980 -> light-server.d.ustclug.org:29980 revproxy-el.s.ustclug.org (reverse proxy) light.ustclug.org -> light-web.d.ustclug.org docker2.s.ustclug.org LUG FTP: http://ftp.ustclug.org/light/","title":"Light Accelerator"},{"location":"services/light/#deploy","text":"deploy script: docker-run-script/light deploy order: mysql freeradius, light-web squid","title":"deploy"},{"location":"services/light/#add-new-domain","text":"git clone https://git.lug.ustc.edu.cn/lug-light/accelerate-list.git cd accelerate-list ./tools/add-domain.sh accelerate.list www.example.com git commit -v -a git push origin master Travis CI will update PAC files in LUG FTP automatically.","title":"Add new domain"},{"location":"services/light/#database-maintenance","text":"Example: select count ( * ) from radacct where acctstoptime < '2021-01-01 00:00:00' ; insert into radacct_backup select * from radacct where acctstoptime < '2021-01-01 00:00:00' ; delete from radacct where acctstoptime < '2021-01-01 00:00:00' ; delete from radacct_backup where acctstoptime < '2020-06-01 00:00:00' ; optimize table radacct ; optimize table radacct_backup ;","title":"Database maintenance"},{"location":"services/mirrors/","text":"\u5f00\u6e90\u955c\u50cf\u7ad9 \u00b6 \u5386\u53f2 \u00b6 debian.ustc.edu.cn \u00b6 2000 \u5e74\u5de6\u53f3\uff0c\u79d1\u5927\u6821\u5185\u7684 Debian \u7231\u597d\u8005\u4f7f\u7528\u81ea\u5df1\u5b9e\u9a8c\u5ba4\u7684\u673a\u5668\u4e3a\u5927\u5bb6\u63d0\u4f9b Debian \u955c\u50cf\u670d\u52a1\u3002\u968f\u7740\u4e00\u5c4a\u5c4a\u5e08\u5144\u7684\u6bd5\u4e1a\uff0c\u670d\u52a1\u5668\u5728\u5404\u5b9e\u9a8c\u5ba4\u95f4\u63a5\u529b\u3002 2002 \u5e74 5 \u6708\uff0cDebian \u955c\u50cf\u7ad9\u6709\u4e86\u81ea\u5df1\u7684\u57df\u540d debian.ustc.edu.cn\uff0c\u4f46\u670d\u52a1\u5668\u4ecd\u5728\u5b9e\u9a8c\u5ba4\u95f4\u8f97\u8f6c\u3002 2002 \u5e74 6 \u6708 23 \u65e5\uff0c\u79d1\u5927Debian\u955c\u50cf\u7ad9\u5f00\u59cb\u63d0\u4f9b\u975e\u5b98\u65b9(UO)\u8f6f\u4ef6\u4ed3\u5e93\u30022004\u5e744\u670823\u65e5\uff0c\u63d0\u4f9b\u65b0\u7684UO\u4ed3\u5e93\u3002 2005 \u5e74 6 \u6708 20 \u65e5\uff0c\u79d1\u5927 LUG \u53d1\u8d77\u4e3a\u79d1\u5927 Debian \u955c\u50cf\u7ad9\u6350\u6b3e\u7684\u5021\u8bae\uff0c\u622a\u81f3 10 \u6708 1 \u65e5\u52df\u6350\u6d3b\u52a8\u505c\u6b62\uff0cLUG \u5171\u6536\u5230 2922.05 \u5143\u6350\u6b3e\u300210 \u6708 6 \u65e5\u65b0\u673a\u5668\u5b89\u88c5\u914d\u7f6e\u5230\u4f4d\u3002\u5728\u5927\u5bb6\u7684\u9f50\u5fc3\u52aa\u529b\u4e4b\u4e0b\uff0c\u79d1\u5927 Debian \u955c\u50cf\u7ad9\u6709\u4e86\u4e00\u4e2a\u76f8\u5bf9\u56fa\u5b9a\u7684\u201c\u5bb6\u201d\u3002 2009\u5e74\u5e95\uff0cdebian.ustc \u843d\u6237\u56fe\u4e66\u9986\u6280\u672f\u90e8\u3002 oss.ustc.edu.cn \u00b6 2008 \u5e74 12 \u6708 25 \u65e5\uff0c\u79d1\u5927\u5f00\u6e90\u8f6f\u4ef6 (OSS) \u955c\u50cf\u7ad9\u6b63\u5f0f\u542f\u7528\u3002\u5176\u670d\u52a1\u5668\u7531\u5434\u5cf0\u5149\u5e08\u5144\u63d0\u4f9b\u3002Novell \u516c\u53f8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u57571.5T \u7684\u786c\u76d8\u3002 2009 \u5e74 12 \u6708\uff0c\u5f20\u6210\u5e08\u5144\u4e3a OSS \u955c\u50cf\u7ad9\u63d0\u4f9b\u6350\u8d60 1T \u786c\u76d8\u3002 2010 \u5e74 6 \u6708\uff0c\u79d1\u5927 LUG \u4f7f\u7528\u51fa\u552e\u7248\u886b\u4f59\u4e0b\u7684\u94b1\u4e3a OSS \u955c\u50cf\u7ad9\u6dfb\u7f6e\u4e86\u4e00\u5757 2T \u786c\u76d8\u3002 mirrors.ustc.edu.cn \u00b6 2011 \u5e74 4 \u6708 8 \u65e5\uff0c\u79d1\u5927 LUG \u4ece\u7f51\u7edc\u4e2d\u5fc3\u5904\u83b7\u5f97\u4e86\u65b0\u7684\u670d\u52a1\u5668\uff0c\u5e76\u7533\u8bf7\u5230\u4e86 mirrors.ustc \u7684\u57df\u540d\u3002debian.ustc \u4e0e oss.ustc \u5f00\u59cb\u5411 mirrors.ustc \u8fc1\u79fb\u3002 \u540c\u5e74 4 \u6708 15 \u65e5\uff0c\u51e0\u5927\u70ed\u95e8\u53d1\u884c\u7248\u955c\u50cf\u540c\u6b65\u5b8c\u6bd5\uff0cmirrors \u5f00\u59cb\u6b63\u5f0f\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u540c\u65f6 debian.ustc \u4e0e oss.ustc \u9000\u51fa\u4e86\u5386\u53f2\u821e\u53f0\u3002 2013 \u5e74 1 \u6708 6 \u65e5\uff0c\u79d1\u5927 LUG \u4ece\u7f51\u7edc\u4e2d\u5fc3\u5904\u83b7\u5f97\u4e86\u65b0\u7684\u78c1\u76d8\u9635\u5217\uff0c\u5927\u5927\u7f13\u89e3\u4e86 mirrors \u56e0\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3\u800c\u5e26\u6765\u7684\u538b\u529b\u3002 2016 \u5e74 12 \u6708 29 \u65e5\uff0c\u79d1\u5927 LUG \u4ece\u7f51\u7edc\u4e2d\u5fc3\u5904\u83b7\u5f97\u4e86\u65b0\u7684\u670d\u52a1\u5668\u3002\u89e3\u51b3\u4e86\u8fd1\u4e00\u5e74\u6765\u7531\u4e8e\u670d\u52a1\u5668\u548c\u9635\u5217\u8001\u5316\u5e26\u6765\u7684\u7a33\u5b9a\u6027\u95ee\u9898\u3002 2019 \u5e74 6 \u6708\uff0c\u79d1\u5927 LUG \u4ece\u56fe\u4e66\u9986\u6280\u672f\u90e8\u83b7\u5f97\u4e86\u4e00\u53f0\u65e7\u670d\u52a1\u5668\uff0c\u7f13\u89e3\u4e86 mirrors \u5bb9\u91cf\u7d27\u5f20\u7684\u95ee\u9898\u3002 2020 \u5e74 3 \u6708 24 \u65e5\uff0c\u79d1\u5927 LUG \u518d\u6b21\u4ece\u7f51\u7edc\u4e2d\u5fc3\u5904\u83b7\u5f97\u4e86\u65b0\u7684\u670d\u52a1\u5668\uff0c\u89e3\u51b3\u4e86\u591a\u5e74\u6765\u7531\u4e8e\u670d\u52a1\u5668\u5bb9\u91cf\u4e0d\u8db3\u548c\u8d1f\u8f7d\u8fc7\u5927\u5e26\u6765\u7684\u538b\u529b\u3002","title":"History"},{"location":"services/mirrors/#_1","text":"","title":"\u5f00\u6e90\u955c\u50cf\u7ad9"},{"location":"services/mirrors/#_2","text":"","title":"\u5386\u53f2"},{"location":"services/mirrors/#debianustceducn","text":"2000 \u5e74\u5de6\u53f3\uff0c\u79d1\u5927\u6821\u5185\u7684 Debian \u7231\u597d\u8005\u4f7f\u7528\u81ea\u5df1\u5b9e\u9a8c\u5ba4\u7684\u673a\u5668\u4e3a\u5927\u5bb6\u63d0\u4f9b Debian \u955c\u50cf\u670d\u52a1\u3002\u968f\u7740\u4e00\u5c4a\u5c4a\u5e08\u5144\u7684\u6bd5\u4e1a\uff0c\u670d\u52a1\u5668\u5728\u5404\u5b9e\u9a8c\u5ba4\u95f4\u63a5\u529b\u3002 2002 \u5e74 5 \u6708\uff0cDebian \u955c\u50cf\u7ad9\u6709\u4e86\u81ea\u5df1\u7684\u57df\u540d debian.ustc.edu.cn\uff0c\u4f46\u670d\u52a1\u5668\u4ecd\u5728\u5b9e\u9a8c\u5ba4\u95f4\u8f97\u8f6c\u3002 2002 \u5e74 6 \u6708 23 \u65e5\uff0c\u79d1\u5927Debian\u955c\u50cf\u7ad9\u5f00\u59cb\u63d0\u4f9b\u975e\u5b98\u65b9(UO)\u8f6f\u4ef6\u4ed3\u5e93\u30022004\u5e744\u670823\u65e5\uff0c\u63d0\u4f9b\u65b0\u7684UO\u4ed3\u5e93\u3002 2005 \u5e74 6 \u6708 20 \u65e5\uff0c\u79d1\u5927 LUG \u53d1\u8d77\u4e3a\u79d1\u5927 Debian \u955c\u50cf\u7ad9\u6350\u6b3e\u7684\u5021\u8bae\uff0c\u622a\u81f3 10 \u6708 1 \u65e5\u52df\u6350\u6d3b\u52a8\u505c\u6b62\uff0cLUG \u5171\u6536\u5230 2922.05 \u5143\u6350\u6b3e\u300210 \u6708 6 \u65e5\u65b0\u673a\u5668\u5b89\u88c5\u914d\u7f6e\u5230\u4f4d\u3002\u5728\u5927\u5bb6\u7684\u9f50\u5fc3\u52aa\u529b\u4e4b\u4e0b\uff0c\u79d1\u5927 Debian \u955c\u50cf\u7ad9\u6709\u4e86\u4e00\u4e2a\u76f8\u5bf9\u56fa\u5b9a\u7684\u201c\u5bb6\u201d\u3002 2009\u5e74\u5e95\uff0cdebian.ustc \u843d\u6237\u56fe\u4e66\u9986\u6280\u672f\u90e8\u3002","title":"debian.ustc.edu.cn"},{"location":"services/mirrors/#ossustceducn","text":"2008 \u5e74 12 \u6708 25 \u65e5\uff0c\u79d1\u5927\u5f00\u6e90\u8f6f\u4ef6 (OSS) \u955c\u50cf\u7ad9\u6b63\u5f0f\u542f\u7528\u3002\u5176\u670d\u52a1\u5668\u7531\u5434\u5cf0\u5149\u5e08\u5144\u63d0\u4f9b\u3002Novell \u516c\u53f8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u57571.5T \u7684\u786c\u76d8\u3002 2009 \u5e74 12 \u6708\uff0c\u5f20\u6210\u5e08\u5144\u4e3a OSS \u955c\u50cf\u7ad9\u63d0\u4f9b\u6350\u8d60 1T \u786c\u76d8\u3002 2010 \u5e74 6 \u6708\uff0c\u79d1\u5927 LUG \u4f7f\u7528\u51fa\u552e\u7248\u886b\u4f59\u4e0b\u7684\u94b1\u4e3a OSS \u955c\u50cf\u7ad9\u6dfb\u7f6e\u4e86\u4e00\u5757 2T \u786c\u76d8\u3002","title":"oss.ustc.edu.cn"},{"location":"services/mirrors/#mirrorsustceducn","text":"2011 \u5e74 4 \u6708 8 \u65e5\uff0c\u79d1\u5927 LUG \u4ece\u7f51\u7edc\u4e2d\u5fc3\u5904\u83b7\u5f97\u4e86\u65b0\u7684\u670d\u52a1\u5668\uff0c\u5e76\u7533\u8bf7\u5230\u4e86 mirrors.ustc \u7684\u57df\u540d\u3002debian.ustc \u4e0e oss.ustc \u5f00\u59cb\u5411 mirrors.ustc \u8fc1\u79fb\u3002 \u540c\u5e74 4 \u6708 15 \u65e5\uff0c\u51e0\u5927\u70ed\u95e8\u53d1\u884c\u7248\u955c\u50cf\u540c\u6b65\u5b8c\u6bd5\uff0cmirrors \u5f00\u59cb\u6b63\u5f0f\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u540c\u65f6 debian.ustc \u4e0e oss.ustc \u9000\u51fa\u4e86\u5386\u53f2\u821e\u53f0\u3002 2013 \u5e74 1 \u6708 6 \u65e5\uff0c\u79d1\u5927 LUG \u4ece\u7f51\u7edc\u4e2d\u5fc3\u5904\u83b7\u5f97\u4e86\u65b0\u7684\u78c1\u76d8\u9635\u5217\uff0c\u5927\u5927\u7f13\u89e3\u4e86 mirrors \u56e0\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3\u800c\u5e26\u6765\u7684\u538b\u529b\u3002 2016 \u5e74 12 \u6708 29 \u65e5\uff0c\u79d1\u5927 LUG \u4ece\u7f51\u7edc\u4e2d\u5fc3\u5904\u83b7\u5f97\u4e86\u65b0\u7684\u670d\u52a1\u5668\u3002\u89e3\u51b3\u4e86\u8fd1\u4e00\u5e74\u6765\u7531\u4e8e\u670d\u52a1\u5668\u548c\u9635\u5217\u8001\u5316\u5e26\u6765\u7684\u7a33\u5b9a\u6027\u95ee\u9898\u3002 2019 \u5e74 6 \u6708\uff0c\u79d1\u5927 LUG \u4ece\u56fe\u4e66\u9986\u6280\u672f\u90e8\u83b7\u5f97\u4e86\u4e00\u53f0\u65e7\u670d\u52a1\u5668\uff0c\u7f13\u89e3\u4e86 mirrors \u5bb9\u91cf\u7d27\u5f20\u7684\u95ee\u9898\u3002 2020 \u5e74 3 \u6708 24 \u65e5\uff0c\u79d1\u5927 LUG \u518d\u6b21\u4ece\u7f51\u7edc\u4e2d\u5fc3\u5904\u83b7\u5f97\u4e86\u65b0\u7684\u670d\u52a1\u5668\uff0c\u89e3\u51b3\u4e86\u591a\u5e74\u6765\u7531\u4e8e\u670d\u52a1\u5668\u5bb9\u91cf\u4e0d\u8db3\u548c\u8d1f\u8f7d\u8fc7\u5927\u5e26\u6765\u7684\u538b\u529b\u3002","title":"mirrors.ustc.edu.cn"},{"location":"services/mirrors/docker/","text":"Docker \u00b6 Networking \u00b6 Docker \u9ed8\u8ba4\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a bridge \u7684\u7f51\u7edc\uff0c\u4e3b\u673a\u754c\u9762\u4e3a docker0 \uff0cIP \u5730\u5740\u6bb5\u4e3a 172.17.0.0/16\u3002 \u6211\u4eec\u5c06 Docker Registry \u7684\u53cd\u4ee3\u6302\u5728\u53e6\u5916\u4e00\u4e2a\u5b50\u7f51\u4e0b\uff0c\u9700\u8981\u5148\u884c\u521b\u5efa\u3002 docker network create \\ --opt com.docker.network.bridge.name = docker1 \\ --subnet = 172 .18.0.0/16 \\ --gateway = 172 .18.0.1 \\ docker-registry","title":"Docker"},{"location":"services/mirrors/docker/#docker","text":"","title":"Docker"},{"location":"services/mirrors/docker/#networking","text":"Docker \u9ed8\u8ba4\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a bridge \u7684\u7f51\u7edc\uff0c\u4e3b\u673a\u754c\u9762\u4e3a docker0 \uff0cIP \u5730\u5740\u6bb5\u4e3a 172.17.0.0/16\u3002 \u6211\u4eec\u5c06 Docker Registry \u7684\u53cd\u4ee3\u6302\u5728\u53e6\u5916\u4e00\u4e2a\u5b50\u7f51\u4e0b\uff0c\u9700\u8981\u5148\u884c\u521b\u5efa\u3002 docker network create \\ --opt com.docker.network.bridge.name = docker1 \\ --subnet = 172 .18.0.0/16 \\ --gateway = 172 .18.0.1 \\ docker-registry","title":"Networking"},{"location":"services/mirrors/hardware/","text":"\u786c\u4ef6\u914d\u7f6e \u00b6 2020 \u5e74\u81f3\u4eca\uff1a mirrors4 2020 \u5e74\u81f3\u4eca\uff1a mirrors3 2016 \u5e74\u81f3\u4eca\uff1a mirrors2 2011 \u5e74 - 2016 \u5e74\uff1a mirrors1","title":"Hardware"},{"location":"services/mirrors/hardware/#_1","text":"2020 \u5e74\u81f3\u4eca\uff1a mirrors4 2020 \u5e74\u81f3\u4eca\uff1a mirrors3 2016 \u5e74\u81f3\u4eca\uff1a mirrors2 2011 \u5e74 - 2016 \u5e74\uff1a mirrors1","title":"\u786c\u4ef6\u914d\u7f6e"},{"location":"services/mirrors/ipmi/","text":"IPMI \u00b6 JDK \u00b6 \u767b\u5f55 IPMI \u540e\uff0c\u4e3a\u4e86\u4f7f\u7528\u8fdc\u7a0b Shell\uff0c\u9700\u8981\u8fd0\u884c\u4e00\u4e2a jnlp \u6587\u4ef6\u3002 \u6b64\u6587\u4ef6\u4e0b\u8f7d\u65f6\u4f1a\u88ab Chrome \u62e6\u622a\uff0c\u9700\u8981\u989d\u5916\u5141\u8bb8\u4e00\u4e0b\u3002 \u6b64 jnlp \u6587\u4ef6\u9700\u8981 Oracle JDK 7 \u8fd0\u884c\uff0cOpenJDK 7 \u65e0\u6cd5\u8fd0\u884c\u3002 \u6307\u4ee4\u7528 javaws a.jnlp \u5373\u53ef\u3002 Java 8 \u53ca\u4e4b\u524d Java \u7684\u5404\u4e2a\u5de5\u5177\u662f\u6253\u5305\u5728 JDK \u4e2d\u7684\uff0c\u5305\u62ec Java Web Starter\uff0c\u5373\u6211\u4eec\u7528\u7684 javaws \u3002 \u6240\u4ee5\u53ea\u9700\u8981\u5b89\u88c5 Oracle JDK 7 \u5373\u53ef\uff0c\u65e0\u9700\u5b89\u88c5\u5176\u4ed6\u7684\u3001\u9488\u5bf9 Java 9 \u53ca\u4e4b\u540e\u7248\u672c\u7684\u5176\u4ed6\u5de5\u5177\u3002","title":"IPMI"},{"location":"services/mirrors/ipmi/#ipmi","text":"","title":"IPMI"},{"location":"services/mirrors/ipmi/#jdk","text":"\u767b\u5f55 IPMI \u540e\uff0c\u4e3a\u4e86\u4f7f\u7528\u8fdc\u7a0b Shell\uff0c\u9700\u8981\u8fd0\u884c\u4e00\u4e2a jnlp \u6587\u4ef6\u3002 \u6b64\u6587\u4ef6\u4e0b\u8f7d\u65f6\u4f1a\u88ab Chrome \u62e6\u622a\uff0c\u9700\u8981\u989d\u5916\u5141\u8bb8\u4e00\u4e0b\u3002 \u6b64 jnlp \u6587\u4ef6\u9700\u8981 Oracle JDK 7 \u8fd0\u884c\uff0cOpenJDK 7 \u65e0\u6cd5\u8fd0\u884c\u3002 \u6307\u4ee4\u7528 javaws a.jnlp \u5373\u53ef\u3002 Java 8 \u53ca\u4e4b\u524d Java \u7684\u5404\u4e2a\u5de5\u5177\u662f\u6253\u5305\u5728 JDK \u4e2d\u7684\uff0c\u5305\u62ec Java Web Starter\uff0c\u5373\u6211\u4eec\u7528\u7684 javaws \u3002 \u6240\u4ee5\u53ea\u9700\u8981\u5b89\u88c5 Oracle JDK 7 \u5373\u53ef\uff0c\u65e0\u9700\u5b89\u88c5\u5176\u4ed6\u7684\u3001\u9488\u5bf9 Java 9 \u53ca\u4e4b\u540e\u7248\u672c\u7684\u5176\u4ed6\u5de5\u5177\u3002","title":"JDK"},{"location":"services/mirrors/limiter/","text":"\u9650\u5236\u7b56\u7565 \u00b6 \u7531\u4e8e mirrors \u5c5e\u4e8e I/O\u3001\u7f51\u7edc\u5bc6\u96c6\u578b\u670d\u52a1\uff0c\u5728\u90e8\u5206\u7684\u8d1f\u8f7d\u573a\u666f\u4e0b\u6781\u6613\u51fa\u73b0 I/O \u6216\u7f51\u7edc\u8fc7\u8f7d\u3002\u9650\u5236\u7b56\u7565\u4e3b\u8981\u662f\u4e3a\u4e86\u51cf\u5f31\u4ee5\u4e0b\u51e0\u7c7b\u8bf7\u6c42\u5bf9 mirrors \u6574\u4f53\u670d\u52a1\u8d28\u91cf\u7684\u5f71\u54cd\uff1a \u7a81\u53d1\u6027\u7684\u9ad8\u5e76\u53d1\u8bf7\u6c42 \u722c\u866b\u7c7b\u6d41\u91cf \u4e0d\u5408\u7406\u7684\u8bf7\u6c42\uff08\u5982\uff1a\u6781\u5c11\u6570\u7528\u6237\u7684\u5927\u91cf\u8bf7\u6c42\uff09 \u767d\u540d\u5355 \u00b6 \u4e00\u822c\u800c\u8a00\uff0c\u79d1\u5927\u6821\u5185\u7684\u5730\u5740\u4f4d\u4e8e\u9650\u5236\u89c4\u5219\u7684\u767d\u540d\u5355\u4e2d\uff0c\u4e0d\u53d7\u5230\u9650\u5236\u7b56\u7565\u7684\u5f71\u54cd\u3002\u5982\u679c\u6ca1\u6709\u7279\u6b8a\u8bf4\u660e\uff0c\u79d1\u5927\u5730\u5740\u9ed8\u8ba4\u4e0d\u53d7\u9650\u5236\u3002 \u767d\u540d\u5355\u4f4d\u4e8e\uff1a /usr/local/network_config/ipset.list /etc/nginx/conf.d/geo-ustcnet.conf \u9632\u706b\u5899\u7ea7\u522b\u9650\u5236 \u00b6 \u9632\u706b\u5899 (iptables) \u76ee\u524d\u53ea\u8d1f\u8d23\u9650\u5236\u5355 IP \u7684\u5e76\u53d1\u94fe\u63a5\u6570\u3002\u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u540c\u65f6\u6d8c\u5165\u5927\u91cf\u5e76\u53d1\u8fde\u63a5\uff0c\u5bfc\u81f4\u540e\u7aef\u5e94\u7528\u8017\u8d39\u5927\u91cf CPU \u548c I/O \u8d44\u6e90\u5904\u7406\u8fd9\u4e9b\u4e0d\u5408\u5e38\u7406\u7684\u8bf7\u6c42\u3002 \u5e8f\u53f7 \u7aef\u53e3 \u670d\u52a1 \u6700\u5927\u8fde\u63a5\u6570 IPv4 CIDR IPv6 CIDR 1 80,443 HTTP/HTTPS 12 29 64 2 20,21,50100:50200 FTP 4* 32 64 3 873 Rsync 5* 32 64 4 9418 Git 10 32 64 \u6ce8\u610f\u4e8b\u9879 \u8fde\u63a5\u6570\u9650\u5236\u4ec5\u9650\u5236\u77ac\u65f6\u5e76\u53d1\uff08connlimit\uff09\u3002 \u8bf7\u6ce8\u610f\uff0c\u540c\u7ec4\u5185\u7684\u8fde\u63a5\u5171\u4eab\u8fde\u63a5\u6570\u914d\u989d\u3002\u5982\uff1a 10.0.0.1 \u4e0e 10.0.0.2 \u5171\u4eab HTTP \u9650\u989d 1.1.1.1 \u53d1\u8d77\u7684 HTTP \u4e0e HTTPS \u8fde\u63a5\u5171\u4eab 12 \u4e2a\u8fde\u63a5\u6570\u9650\u989d \u8d85\u8fc7\u914d\u989d\u7684\u8fde\u63a5\u4f1a\u8fd4\u56de TCP Reset\u3002 * FTP \u670d\u52a1\u5df2\u505c\u6b62\u63d0\u4f9b\uff0cRsync \u4ec5\u4ece mirrors2 \u63d0\u4f9b\uff0cmirrors4 \u4e0a\u7684 Rsync \u7aef\u53e3\u9650\u5236\u53ea\u80fd\u4ece mirrors2 \u4e0a\u8bbf\u95ee\u3002 \u5e94\u7528\u7ea7\u522b\u9650\u5236 \u00b6 \u6b64\u7c7b\u9650\u5236\u89c4\u5219\u4f4d\u4e8e\u5e94\u7528\u7a0b\u5e8f\u5185\u3002\u7531\u4e8e\u5728\u7528\u6237\u6001\u7a0b\u5e8f\u4e2d\u5b9e\u73b0\uff0c\u56e0\u6b64\u66f4\u52a0\u7075\u6d3b\u3002 Nginx LUA\u7ec4\u4ef6 \u00b6 \u4ee3\u7801\u4f4d\u4e8e /etc/nginx/lua/access.lua \u76ee\u524d\u4f7f\u7528\u4e86 Nginx \u7684 lua \u8bed\u8a00\u6269\u5c55\u5b9e\u73b0\u5bf9\u8bf7\u6c42\u7684\u9650\u5236\u3002\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u7c7b\u9650\u5236\u65b9\u5f0f\uff1a \u6309\u8fde\u63a5\u6570\u9650\u5236\uff08\u5373\uff1a\u5e76\u53d1\u8bf7\u6c42\u6570\uff09 \u6309\u8bf7\u6c42\u901f\u7387\u9650\u5236 \u6309\u7d2f\u8ba1\u8bf7\u6c42\u6570\u9650\u5236\uff08\u5468\u671f\u6027\u91cd\u7f6e\u8ba1\u6570\u5668\uff09 \u76ee\u524d\uff0c\u955c\u50cf\u7ad9\u914d\u7f6e\u4e86\u4ee5\u4e0b\u51e0\u79cd\u529f\u80fd\u7684\u9650\u5236\u5668\uff1a \u5168\u5c40\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u6240\u6709\u8bf7\u6c42\uff0c\u9650\u5236\u5355IP\u7684\u8bf7\u6c42\u901f\u7387\u3002 \u5168\u5c40\u8bf7\u6c42\u6570\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u6240\u6709\u8bf7\u6c42\uff0c \u68c0\u6d4b \u5355IP\u5728\u4e00\u5929\u5185\u7684\u7d2f\u8ba1\u8bf7\u6c42\u6570\u3002\u8d85\u8fc7\u9608\u503c\u540e\uff0c\u964d\u4f4e\u8be5IP\u7684 \u5168\u5c40\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u7684\u9608\u503c\u3002 HEAD\u8bf7\u6c42\u6570\u9650\u5236\u5668\uff1a\u5bf9\u4e8e HTTP Method == HEAD \u7c7b\u578b\u7684\u8bf7\u6c42\uff0c \u68c0\u6d4b \u5355 IP \u5728\u4e00\u5929\u5185\u7684\u7d2f\u8ba1\u8bf7\u6c42\u6570\u3002\u8d85\u8fc7\u9608\u503c\u540e\uff0c\u5f00\u542f HEAD\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u3002 HEAD\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u4e8e HTTP Method == HEAD \u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236\u5355 IP \u7684\u8bf7\u6c42\u901f\u7387\u3002 \u8be5\u9650\u5236\u5668\u9ed8\u8ba4\u5173\u95ed\u3002 \u65ad\u70b9\u7eed\u4f20\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u65ad\u70b9\u7eed\u4f20\u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236\u5355 IP \u7684\u8bf7\u6c42\u901f\u7387\u3002 \u65ad\u70b9\u7eed\u4f20\u8fde\u63a5\u6570\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u65ad\u70b9\u7eed\u4f20\u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236\u5355 IP \u5355 URI \u7684\u8fde\u63a5\u6570\u3002 \u76ee\u5f55\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u5217\u76ee\u5f55\u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236\u5355 IP \u8bf7\u6c42\u901f\u7387\u3002 \u6587\u4ef6\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u975e\u76ee\u5f55\u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236 \u5355\u6587\u4ef6 \u8bf7\u6c42\u901f\u7387\u3002\u5373\uff1a\u6240\u6709\u7528\u6237\u4e4b\u95f4\u5171\u4eab\u540c\u4e00\u4e2a\u914d\u989d\u3002 \u4f8b\u5916\uff1aapt/yum \u4ed3\u5e93\u7684\u7d22\u5f15\u6587\u4ef6\u4e0d\u53d7\u9650\u5236\u3002 \u6848\u4f8b\uff1a\u66fe\u9047\u5230\u8fc7\u653b\u51fb\u8005\u5206\u5e03\u5f0f\u8bf7\u6c42\u540c\u4e00\u4e2a\u5927\u6587\u4ef6\uff0c\u5bfc\u81f4 IO\u3001\u7f51\u7edc\u540c\u65f6\u8fc7\u8f7d\u3002 \u57fa\u4e8eIP\u5730\u5740\u7684\u9650\u5236\u63aa\u65bd\u5bf9\u4e8e\u6e90\u5730\u5740\u6c60\u5f88\u5927\u7684\u653b\u51fb\u5f80\u5f80\u6ca1\u6709\u6548\u679c\uff0c\u9650\u5236\u5355\u6587\u4ef6\u7684\u8bf7\u6c42\u901f\u7387\u80fd\u591f\u6709\u6548\u7f13\u89e3\u8fd9\u7c7b\u653b\u51fb\u3002 \u5177\u4f53\u53c2\u6570\u53c2\u8003\u4e0b\u8868\uff1a \u9650\u5236\u5668\u540d\u79f0 \u9608\u503c\u5355\u4f4d \u9608\u503c \u7a81\u53d1\u91cf \u8ba1\u6570\u5668\u91cd\u7f6e\u5468\u671f \u52a8\u4f5c \u5168\u5c40\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 40 100 / \u8fd4\u56de429\u9519\u8bef \u5168\u5c40\u8bf7\u6c42\u6570\u9650\u5236\u5668 \u6b21 15000 / 1\u5929 \u8bbe\u7f6e\u5168\u5c40\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\u9608\u503c\u4e3a 0.2 HEAD\u8bf7\u6c42\u6570\u9650\u5236\u5668 \u6b21 300 / 1\u5929 \u5f00\u542fHEAD\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 HEAD\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 0.05 5 / \u8fd4\u56de429\u9519\u8bef \u65ad\u70b9\u7eed\u4f20\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 1 10 / \u8fd4\u56de429\u9519\u8bef \u65ad\u70b9\u7eed\u4f20\u8fde\u63a5\u6570\u9650\u5236\u5668 \u6761 1 0 / \u8fd4\u56de429\u9519\u8bef \u76ee\u5f55\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 0.5 10 / \u8fd4\u56de429\u9519\u8bef \u6587\u4ef6\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 5 25 / \u8fd4\u56de429\u9519\u8bef \u5230\u8fbe\u9608\u503c\u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f \u5f53\u8bf7\u6c42\u901f\u7387\u8d85\u8fc7\u9608\u503c\uff0c\u4f46\u672a\u8d85\u8fc7\u7a81\u53d1\u91cf\u65f6\uff0c\u9650\u5236\u5668\u4f1a\u8ba1\u7b97\u51fa\u4e00\u4e2a\u6ee1\u8db3\u9608\u503c\u6761\u4ef6\u7684\u6700\u5c0f\u7b49\u5f85\u65f6\u95f4\u3002\u8fde\u63a5\u4f1a\u88ab\u4e22\u5165\u7b49\u5f85\u6c60\uff0c\u5230\u8fbe\u7b49\u5f85\u65f6\u95f4\u540e\u518d\u88ab\u5904\u7406\u3002 \u5f53\u8bf7\u6c42\u901f\u7387\u8d85\u8fc7\u9608\u503c\uff0c\u4e14\u8d85\u8fc7\u7a81\u53d1\u8bf7\u6c42\u91cf\u65f6\uff0c\u5c06\u4f1a\u5728\u7b49\u5f85 5 \u79d2\u540e\u8fd4\u56de HTTP 429 \u9519\u8bef\u3002 \u9650\u5236\u5668\u4e4b\u95f4\u76f8\u4e92\u72ec\u7acb\uff0c\u5f53\u88ab\u89e6\u53d1\u7684\u6240\u6709\u9650\u5236\u5668\u4ea7\u751f\u4e0d\u4e00\u81f4\u7684\u7b49\u5f85\u65f6\u95f4\u65f6\uff0c\u5e94\u7528\u6700\u957f\u7684\u7b49\u5f85\u65f6\u95f4\u3002 NGINX JS \u6311\u6218 \u00b6 \u4ee3\u7801\u4f4d\u4e8e /etc/nginx/sites-available/iso.mirrors.ustc.edu.cn \u4e3a\u4e86\u62b5\u6297\u201c\u8fc5\u96f7\u653b\u51fb\u201d\u3002\u5bf9\u4e8e\u7279\u5b9a\u7c7b\u578b\u7684\u6587\u4ef6\uff0c\u5f00\u542f\u4e86JS\u6311\u6218\u3002 \u5982\u679c\u5ba2\u6237\u7aef User-Agent \u4e3a Mozilla\uff08\u5373\u6d4f\u89c8\u5668\uff09\uff0c\u5219\u53d1\u9001\u4e00\u6bb5\u5305\u542b JS \u811a\u672c\u7684\u9875\u9762\uff0c\u68c0\u9a8c\u8fd0\u884c\u7684\u7ed3\u679c\u3002\u5982\u679c\u6311\u6218\u5931\u8d25\uff0c\u5219\u8fd4\u56de\u9519\u8bef\u3002 \u88ab\u4fdd\u62a4\u7684\u6587\u4ef6\u7c7b\u578b\u6709\uff1a iso exe dmg run zip tar \u722c\u866b\u9650\u5236 \u00b6 \u4ee3\u7801\u4f4d\u4e8e /etc/nginx/snippets/robots \u5982\u679c\u5ba2\u6237\u7aef User-Agent \u5305\u542b Spider\u3001Robot \u5173\u952e\u5b57\uff0c \u5219\u7981\u6b62\u5176\u8bbf\u95ee\u4ed3\u5e93\u5185\u5bb9\u3002\u907f\u514d\u7531\u4e8e\u9891\u7e41\u5217\u76ee\u5f55\u5e26\u6765\u5927\u91cf IO \u8d1f\u8f7d\u3002 Rsync \u603b\u8fde\u63a5\u6570\u9650\u5236 \u00b6 Rsync \u670d\u52a1\u8bbe\u7f6e\u4e86\u603b\u8fde\u63a5\u6570\u9650\u5236\u3002\u5373\uff1a\u5f53\u5efa\u7acb\u7684\u8fde\u63a5\u6570\u5230\u8fbe\u67d0\u4e2a\u9608\u503c\u540e\uff0c\u62d2\u7edd\u4e4b\u540e\u6536\u5230\u7684\u8fde\u63a5\u3002 \u7531\u4e8e\u767d\u5929 HTTP \u8bbf\u95ee\u538b\u529b\u8f83\u5927\uff0c\u591c\u665a HTTP \u8bbf\u95ee\u91cf\u8f83\u5c0f\uff0c\u4e3a\u4e86\u5b9e\u73b0\u9519\u5cf0\u540c\u6b65\uff0c\u56e0\u6b64\u9488\u5bf9\u4e0d\u540c\u65f6\u6bb5\u8bbe\u7f6e\u4e86\u4e0d\u540c\u7684\u9608\u503c\uff0c\u5177\u4f53\u5982\u4e0b\uff1a 23:00 ~ 8:00 \uff1a\u6700\u591a 60 \u4e2a\u8fde\u63a5 8:00 ~ 23:00\uff1a\u6700\u591a 30 \u4e2a\u8fde\u63a5 \u5728 2020 \u5e74 8 \u6708 25 \u65e5\u540e\uff0c\u7531\u4e8e\u66f4\u6362\u4e86\u65b0\u670d\u52a1\u5668\uff0cRsync \u7531\u5355\u72ec\u673a\u5668\u63d0\u4f9b\u670d\u52a1\uff0c\u603b\u8fde\u63a5\u6570\u63d0\u5347\u5230\u4e86\u5168\u5929 60 \u4e2a\u8fde\u63a5\u3002 \u7279\u522b\u7684\uff0c\u79d1\u5927 IP \u5730\u5740\u53d7\u5230 rsync \u8fde\u63a5\u6570\u9650\u5236\u3002","title":"Limiter"},{"location":"services/mirrors/limiter/#_1","text":"\u7531\u4e8e mirrors \u5c5e\u4e8e I/O\u3001\u7f51\u7edc\u5bc6\u96c6\u578b\u670d\u52a1\uff0c\u5728\u90e8\u5206\u7684\u8d1f\u8f7d\u573a\u666f\u4e0b\u6781\u6613\u51fa\u73b0 I/O \u6216\u7f51\u7edc\u8fc7\u8f7d\u3002\u9650\u5236\u7b56\u7565\u4e3b\u8981\u662f\u4e3a\u4e86\u51cf\u5f31\u4ee5\u4e0b\u51e0\u7c7b\u8bf7\u6c42\u5bf9 mirrors \u6574\u4f53\u670d\u52a1\u8d28\u91cf\u7684\u5f71\u54cd\uff1a \u7a81\u53d1\u6027\u7684\u9ad8\u5e76\u53d1\u8bf7\u6c42 \u722c\u866b\u7c7b\u6d41\u91cf \u4e0d\u5408\u7406\u7684\u8bf7\u6c42\uff08\u5982\uff1a\u6781\u5c11\u6570\u7528\u6237\u7684\u5927\u91cf\u8bf7\u6c42\uff09","title":"\u9650\u5236\u7b56\u7565"},{"location":"services/mirrors/limiter/#_2","text":"\u4e00\u822c\u800c\u8a00\uff0c\u79d1\u5927\u6821\u5185\u7684\u5730\u5740\u4f4d\u4e8e\u9650\u5236\u89c4\u5219\u7684\u767d\u540d\u5355\u4e2d\uff0c\u4e0d\u53d7\u5230\u9650\u5236\u7b56\u7565\u7684\u5f71\u54cd\u3002\u5982\u679c\u6ca1\u6709\u7279\u6b8a\u8bf4\u660e\uff0c\u79d1\u5927\u5730\u5740\u9ed8\u8ba4\u4e0d\u53d7\u9650\u5236\u3002 \u767d\u540d\u5355\u4f4d\u4e8e\uff1a /usr/local/network_config/ipset.list /etc/nginx/conf.d/geo-ustcnet.conf","title":"\u767d\u540d\u5355"},{"location":"services/mirrors/limiter/#_3","text":"\u9632\u706b\u5899 (iptables) \u76ee\u524d\u53ea\u8d1f\u8d23\u9650\u5236\u5355 IP \u7684\u5e76\u53d1\u94fe\u63a5\u6570\u3002\u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u540c\u65f6\u6d8c\u5165\u5927\u91cf\u5e76\u53d1\u8fde\u63a5\uff0c\u5bfc\u81f4\u540e\u7aef\u5e94\u7528\u8017\u8d39\u5927\u91cf CPU \u548c I/O \u8d44\u6e90\u5904\u7406\u8fd9\u4e9b\u4e0d\u5408\u5e38\u7406\u7684\u8bf7\u6c42\u3002 \u5e8f\u53f7 \u7aef\u53e3 \u670d\u52a1 \u6700\u5927\u8fde\u63a5\u6570 IPv4 CIDR IPv6 CIDR 1 80,443 HTTP/HTTPS 12 29 64 2 20,21,50100:50200 FTP 4* 32 64 3 873 Rsync 5* 32 64 4 9418 Git 10 32 64 \u6ce8\u610f\u4e8b\u9879 \u8fde\u63a5\u6570\u9650\u5236\u4ec5\u9650\u5236\u77ac\u65f6\u5e76\u53d1\uff08connlimit\uff09\u3002 \u8bf7\u6ce8\u610f\uff0c\u540c\u7ec4\u5185\u7684\u8fde\u63a5\u5171\u4eab\u8fde\u63a5\u6570\u914d\u989d\u3002\u5982\uff1a 10.0.0.1 \u4e0e 10.0.0.2 \u5171\u4eab HTTP \u9650\u989d 1.1.1.1 \u53d1\u8d77\u7684 HTTP \u4e0e HTTPS \u8fde\u63a5\u5171\u4eab 12 \u4e2a\u8fde\u63a5\u6570\u9650\u989d \u8d85\u8fc7\u914d\u989d\u7684\u8fde\u63a5\u4f1a\u8fd4\u56de TCP Reset\u3002 * FTP \u670d\u52a1\u5df2\u505c\u6b62\u63d0\u4f9b\uff0cRsync \u4ec5\u4ece mirrors2 \u63d0\u4f9b\uff0cmirrors4 \u4e0a\u7684 Rsync \u7aef\u53e3\u9650\u5236\u53ea\u80fd\u4ece mirrors2 \u4e0a\u8bbf\u95ee\u3002","title":"\u9632\u706b\u5899\u7ea7\u522b\u9650\u5236"},{"location":"services/mirrors/limiter/#_4","text":"\u6b64\u7c7b\u9650\u5236\u89c4\u5219\u4f4d\u4e8e\u5e94\u7528\u7a0b\u5e8f\u5185\u3002\u7531\u4e8e\u5728\u7528\u6237\u6001\u7a0b\u5e8f\u4e2d\u5b9e\u73b0\uff0c\u56e0\u6b64\u66f4\u52a0\u7075\u6d3b\u3002","title":"\u5e94\u7528\u7ea7\u522b\u9650\u5236"},{"location":"services/mirrors/limiter/#nginx-lua","text":"\u4ee3\u7801\u4f4d\u4e8e /etc/nginx/lua/access.lua \u76ee\u524d\u4f7f\u7528\u4e86 Nginx \u7684 lua \u8bed\u8a00\u6269\u5c55\u5b9e\u73b0\u5bf9\u8bf7\u6c42\u7684\u9650\u5236\u3002\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u7c7b\u9650\u5236\u65b9\u5f0f\uff1a \u6309\u8fde\u63a5\u6570\u9650\u5236\uff08\u5373\uff1a\u5e76\u53d1\u8bf7\u6c42\u6570\uff09 \u6309\u8bf7\u6c42\u901f\u7387\u9650\u5236 \u6309\u7d2f\u8ba1\u8bf7\u6c42\u6570\u9650\u5236\uff08\u5468\u671f\u6027\u91cd\u7f6e\u8ba1\u6570\u5668\uff09 \u76ee\u524d\uff0c\u955c\u50cf\u7ad9\u914d\u7f6e\u4e86\u4ee5\u4e0b\u51e0\u79cd\u529f\u80fd\u7684\u9650\u5236\u5668\uff1a \u5168\u5c40\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u6240\u6709\u8bf7\u6c42\uff0c\u9650\u5236\u5355IP\u7684\u8bf7\u6c42\u901f\u7387\u3002 \u5168\u5c40\u8bf7\u6c42\u6570\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u6240\u6709\u8bf7\u6c42\uff0c \u68c0\u6d4b \u5355IP\u5728\u4e00\u5929\u5185\u7684\u7d2f\u8ba1\u8bf7\u6c42\u6570\u3002\u8d85\u8fc7\u9608\u503c\u540e\uff0c\u964d\u4f4e\u8be5IP\u7684 \u5168\u5c40\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u7684\u9608\u503c\u3002 HEAD\u8bf7\u6c42\u6570\u9650\u5236\u5668\uff1a\u5bf9\u4e8e HTTP Method == HEAD \u7c7b\u578b\u7684\u8bf7\u6c42\uff0c \u68c0\u6d4b \u5355 IP \u5728\u4e00\u5929\u5185\u7684\u7d2f\u8ba1\u8bf7\u6c42\u6570\u3002\u8d85\u8fc7\u9608\u503c\u540e\uff0c\u5f00\u542f HEAD\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u3002 HEAD\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u4e8e HTTP Method == HEAD \u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236\u5355 IP \u7684\u8bf7\u6c42\u901f\u7387\u3002 \u8be5\u9650\u5236\u5668\u9ed8\u8ba4\u5173\u95ed\u3002 \u65ad\u70b9\u7eed\u4f20\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u65ad\u70b9\u7eed\u4f20\u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236\u5355 IP \u7684\u8bf7\u6c42\u901f\u7387\u3002 \u65ad\u70b9\u7eed\u4f20\u8fde\u63a5\u6570\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u65ad\u70b9\u7eed\u4f20\u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236\u5355 IP \u5355 URI \u7684\u8fde\u63a5\u6570\u3002 \u76ee\u5f55\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u5217\u76ee\u5f55\u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236\u5355 IP \u8bf7\u6c42\u901f\u7387\u3002 \u6587\u4ef6\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\uff1a\u5bf9\u4e8e\u975e\u76ee\u5f55\u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u9650\u5236 \u5355\u6587\u4ef6 \u8bf7\u6c42\u901f\u7387\u3002\u5373\uff1a\u6240\u6709\u7528\u6237\u4e4b\u95f4\u5171\u4eab\u540c\u4e00\u4e2a\u914d\u989d\u3002 \u4f8b\u5916\uff1aapt/yum \u4ed3\u5e93\u7684\u7d22\u5f15\u6587\u4ef6\u4e0d\u53d7\u9650\u5236\u3002 \u6848\u4f8b\uff1a\u66fe\u9047\u5230\u8fc7\u653b\u51fb\u8005\u5206\u5e03\u5f0f\u8bf7\u6c42\u540c\u4e00\u4e2a\u5927\u6587\u4ef6\uff0c\u5bfc\u81f4 IO\u3001\u7f51\u7edc\u540c\u65f6\u8fc7\u8f7d\u3002 \u57fa\u4e8eIP\u5730\u5740\u7684\u9650\u5236\u63aa\u65bd\u5bf9\u4e8e\u6e90\u5730\u5740\u6c60\u5f88\u5927\u7684\u653b\u51fb\u5f80\u5f80\u6ca1\u6709\u6548\u679c\uff0c\u9650\u5236\u5355\u6587\u4ef6\u7684\u8bf7\u6c42\u901f\u7387\u80fd\u591f\u6709\u6548\u7f13\u89e3\u8fd9\u7c7b\u653b\u51fb\u3002 \u5177\u4f53\u53c2\u6570\u53c2\u8003\u4e0b\u8868\uff1a \u9650\u5236\u5668\u540d\u79f0 \u9608\u503c\u5355\u4f4d \u9608\u503c \u7a81\u53d1\u91cf \u8ba1\u6570\u5668\u91cd\u7f6e\u5468\u671f \u52a8\u4f5c \u5168\u5c40\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 40 100 / \u8fd4\u56de429\u9519\u8bef \u5168\u5c40\u8bf7\u6c42\u6570\u9650\u5236\u5668 \u6b21 15000 / 1\u5929 \u8bbe\u7f6e\u5168\u5c40\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668\u9608\u503c\u4e3a 0.2 HEAD\u8bf7\u6c42\u6570\u9650\u5236\u5668 \u6b21 300 / 1\u5929 \u5f00\u542fHEAD\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 HEAD\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 0.05 5 / \u8fd4\u56de429\u9519\u8bef \u65ad\u70b9\u7eed\u4f20\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 1 10 / \u8fd4\u56de429\u9519\u8bef \u65ad\u70b9\u7eed\u4f20\u8fde\u63a5\u6570\u9650\u5236\u5668 \u6761 1 0 / \u8fd4\u56de429\u9519\u8bef \u76ee\u5f55\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 0.5 10 / \u8fd4\u56de429\u9519\u8bef \u6587\u4ef6\u8bf7\u6c42\u901f\u7387\u9650\u5236\u5668 \u6b21/\u79d2 5 25 / \u8fd4\u56de429\u9519\u8bef \u5230\u8fbe\u9608\u503c\u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f \u5f53\u8bf7\u6c42\u901f\u7387\u8d85\u8fc7\u9608\u503c\uff0c\u4f46\u672a\u8d85\u8fc7\u7a81\u53d1\u91cf\u65f6\uff0c\u9650\u5236\u5668\u4f1a\u8ba1\u7b97\u51fa\u4e00\u4e2a\u6ee1\u8db3\u9608\u503c\u6761\u4ef6\u7684\u6700\u5c0f\u7b49\u5f85\u65f6\u95f4\u3002\u8fde\u63a5\u4f1a\u88ab\u4e22\u5165\u7b49\u5f85\u6c60\uff0c\u5230\u8fbe\u7b49\u5f85\u65f6\u95f4\u540e\u518d\u88ab\u5904\u7406\u3002 \u5f53\u8bf7\u6c42\u901f\u7387\u8d85\u8fc7\u9608\u503c\uff0c\u4e14\u8d85\u8fc7\u7a81\u53d1\u8bf7\u6c42\u91cf\u65f6\uff0c\u5c06\u4f1a\u5728\u7b49\u5f85 5 \u79d2\u540e\u8fd4\u56de HTTP 429 \u9519\u8bef\u3002 \u9650\u5236\u5668\u4e4b\u95f4\u76f8\u4e92\u72ec\u7acb\uff0c\u5f53\u88ab\u89e6\u53d1\u7684\u6240\u6709\u9650\u5236\u5668\u4ea7\u751f\u4e0d\u4e00\u81f4\u7684\u7b49\u5f85\u65f6\u95f4\u65f6\uff0c\u5e94\u7528\u6700\u957f\u7684\u7b49\u5f85\u65f6\u95f4\u3002","title":"Nginx LUA\u7ec4\u4ef6"},{"location":"services/mirrors/limiter/#nginx-js","text":"\u4ee3\u7801\u4f4d\u4e8e /etc/nginx/sites-available/iso.mirrors.ustc.edu.cn \u4e3a\u4e86\u62b5\u6297\u201c\u8fc5\u96f7\u653b\u51fb\u201d\u3002\u5bf9\u4e8e\u7279\u5b9a\u7c7b\u578b\u7684\u6587\u4ef6\uff0c\u5f00\u542f\u4e86JS\u6311\u6218\u3002 \u5982\u679c\u5ba2\u6237\u7aef User-Agent \u4e3a Mozilla\uff08\u5373\u6d4f\u89c8\u5668\uff09\uff0c\u5219\u53d1\u9001\u4e00\u6bb5\u5305\u542b JS \u811a\u672c\u7684\u9875\u9762\uff0c\u68c0\u9a8c\u8fd0\u884c\u7684\u7ed3\u679c\u3002\u5982\u679c\u6311\u6218\u5931\u8d25\uff0c\u5219\u8fd4\u56de\u9519\u8bef\u3002 \u88ab\u4fdd\u62a4\u7684\u6587\u4ef6\u7c7b\u578b\u6709\uff1a iso exe dmg run zip tar","title":"NGINX JS \u6311\u6218"},{"location":"services/mirrors/limiter/#_5","text":"\u4ee3\u7801\u4f4d\u4e8e /etc/nginx/snippets/robots \u5982\u679c\u5ba2\u6237\u7aef User-Agent \u5305\u542b Spider\u3001Robot \u5173\u952e\u5b57\uff0c \u5219\u7981\u6b62\u5176\u8bbf\u95ee\u4ed3\u5e93\u5185\u5bb9\u3002\u907f\u514d\u7531\u4e8e\u9891\u7e41\u5217\u76ee\u5f55\u5e26\u6765\u5927\u91cf IO \u8d1f\u8f7d\u3002","title":"\u722c\u866b\u9650\u5236"},{"location":"services/mirrors/limiter/#rsync","text":"Rsync \u670d\u52a1\u8bbe\u7f6e\u4e86\u603b\u8fde\u63a5\u6570\u9650\u5236\u3002\u5373\uff1a\u5f53\u5efa\u7acb\u7684\u8fde\u63a5\u6570\u5230\u8fbe\u67d0\u4e2a\u9608\u503c\u540e\uff0c\u62d2\u7edd\u4e4b\u540e\u6536\u5230\u7684\u8fde\u63a5\u3002 \u7531\u4e8e\u767d\u5929 HTTP \u8bbf\u95ee\u538b\u529b\u8f83\u5927\uff0c\u591c\u665a HTTP \u8bbf\u95ee\u91cf\u8f83\u5c0f\uff0c\u4e3a\u4e86\u5b9e\u73b0\u9519\u5cf0\u540c\u6b65\uff0c\u56e0\u6b64\u9488\u5bf9\u4e0d\u540c\u65f6\u6bb5\u8bbe\u7f6e\u4e86\u4e0d\u540c\u7684\u9608\u503c\uff0c\u5177\u4f53\u5982\u4e0b\uff1a 23:00 ~ 8:00 \uff1a\u6700\u591a 60 \u4e2a\u8fde\u63a5 8:00 ~ 23:00\uff1a\u6700\u591a 30 \u4e2a\u8fde\u63a5 \u5728 2020 \u5e74 8 \u6708 25 \u65e5\u540e\uff0c\u7531\u4e8e\u66f4\u6362\u4e86\u65b0\u670d\u52a1\u5668\uff0cRsync \u7531\u5355\u72ec\u673a\u5668\u63d0\u4f9b\u670d\u52a1\uff0c\u603b\u8fde\u63a5\u6570\u63d0\u5347\u5230\u4e86\u5168\u5929 60 \u4e2a\u8fde\u63a5\u3002 \u7279\u522b\u7684\uff0c\u79d1\u5927 IP \u5730\u5740\u53d7\u5230 rsync \u8fde\u63a5\u6570\u9650\u5236\u3002","title":"Rsync \u603b\u8fde\u63a5\u6570\u9650\u5236"},{"location":"services/mirrors/mail-list/","text":"Mail List \u00b6 Plugin Email Subscribers & Newsletters on servers.ustclug.org sends a mail to Google Group when a new article posted on mirrors catalogue. The mails are sent from servers@ustclug.org, which is a member of Google Group with write permission. Google Group: ustc-mirrors@googlegroups.com","title":"Mail list"},{"location":"services/mirrors/mail-list/#mail-list","text":"Plugin Email Subscribers & Newsletters on servers.ustclug.org sends a mail to Google Group when a new article posted on mirrors catalogue. The mails are sent from servers@ustclug.org, which is a member of Google Group with write permission. Google Group: ustc-mirrors@googlegroups.com","title":"Mail List"},{"location":"services/mirrors/zfs/","text":"ZFS \u00b6 Configuration \u00b6 /etc/modprobe.d/zfs.conf options zfs zfs_arc_max=137438953472 options zfs l2arc_write_max=52428800 options zfs zfs_arc_meta_min=17179869184 options zfs l2arc_noprefetch=0 refer to man zfs-module-parameters . Common Operations \u00b6 Get zpool status \u00b6 zpool status Get IO status \u00b6 zpool iostat -v 1 Replace Disk \u00b6 zpool replace pool0 old-disk new-disk New ZFS file system \u00b6 zfs create [ -o mountpoint = $mountpoint ] $filesystem Example: zfs create -o mountpoint = /srv/repo/debian pool0/repo/debian If mountpoint is not specified, then it's inherited from the parent with a subpath appended, e.g. when pool0/example is mounted on /mnt/haha then pool0/example/test will by default mount on /mnt/haha/test . Destory ZFS file system \u00b6 zfs destroy $filesystem Example: zfs destroy pool0/repo/debian Traps \u00b6 Do NOT install zfs-dkms and related packages from Debian backports repositories. They'll easily break when upgrading. As of Debian Buster the ZFS packages from the mainstream repository is stable and new enough for our use. \u4ecd\u7136\u5efa\u8bae\u5b89\u88c5 Backports \u7248\u672c\u7684 ZFS\u3002\u300cStable \u8d8a\u5f80\u540e\uff08\u5bf9 ZFS \u76f8\u5173\u8f6f\u4ef6\u5305\u7684\uff09\u7ef4\u62a4\u8d8a\u5f31\u300d\uff0c\u4ece\u800c\u5bfc\u81f4 stable \u7684 ZFS \u53cd\u800c\u8d28\u91cf\u4e0d\u5982 backports \u7248\u672c\u7684\u3002","title":"ZFS"},{"location":"services/mirrors/zfs/#zfs","text":"","title":"ZFS"},{"location":"services/mirrors/zfs/#configuration","text":"/etc/modprobe.d/zfs.conf options zfs zfs_arc_max=137438953472 options zfs l2arc_write_max=52428800 options zfs zfs_arc_meta_min=17179869184 options zfs l2arc_noprefetch=0 refer to man zfs-module-parameters .","title":"Configuration"},{"location":"services/mirrors/zfs/#common-operations","text":"","title":"Common Operations"},{"location":"services/mirrors/zfs/#get-zpool-status","text":"zpool status","title":"Get zpool status"},{"location":"services/mirrors/zfs/#get-io-status","text":"zpool iostat -v 1","title":"Get IO status"},{"location":"services/mirrors/zfs/#replace-disk","text":"zpool replace pool0 old-disk new-disk","title":"Replace Disk"},{"location":"services/mirrors/zfs/#new-zfs-file-system","text":"zfs create [ -o mountpoint = $mountpoint ] $filesystem Example: zfs create -o mountpoint = /srv/repo/debian pool0/repo/debian If mountpoint is not specified, then it's inherited from the parent with a subpath appended, e.g. when pool0/example is mounted on /mnt/haha then pool0/example/test will by default mount on /mnt/haha/test .","title":"New ZFS file system"},{"location":"services/mirrors/zfs/#destory-zfs-file-system","text":"zfs destroy $filesystem Example: zfs destroy pool0/repo/debian","title":"Destory ZFS file system"},{"location":"services/mirrors/zfs/#traps","text":"Do NOT install zfs-dkms and related packages from Debian backports repositories. They'll easily break when upgrading. As of Debian Buster the ZFS packages from the mainstream repository is stable and new enough for our use. \u4ecd\u7136\u5efa\u8bae\u5b89\u88c5 Backports \u7248\u672c\u7684 ZFS\u3002\u300cStable \u8d8a\u5f80\u540e\uff08\u5bf9 ZFS \u76f8\u5173\u8f6f\u4ef6\u5305\u7684\uff09\u7ef4\u62a4\u8d8a\u5f31\u300d\uff0c\u4ece\u800c\u5bfc\u81f4 stable \u7684 ZFS \u53cd\u800c\u8d28\u91cf\u4e0d\u5982 backports \u7248\u672c\u7684\u3002","title":"Traps"},{"location":"services/mirrors/1/","text":"mirrors1 \u00b6 mirrors1 \u662f 2011 \u5e74\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u63d0\u4f9b\u7ed9 LUG \u7528\u4f5c\u521d\u4ee3 mirrors.ustc.edu.cn \u670d\u52a1\u7684\u673a\u5668\uff0c\u662f\u4e00\u53f0\u66d9\u5149 i620r-G \u53c2\u6570 \u914d\u7f6e CPU Intel(R) Xeon(R) CPU E5620 @ 2.40GHz x 2 \u5185\u5b58 48 GB \u5b58\u50a8 LSI Logic MegaRAID SAS 8708EM2 x 2 DFT RS-3016I-S/D30 \u78c1\u76d8\u9635\u5217 \u7f51\u7edc Ethernet Intel 82574L Gigabit x 2 \u7528\u6237\u624b\u518c \u7531\u4e8e\u672c\u6587\u7f16\u5199\u65f6\uff082020 \u5e74\uff09\u8be5\u670d\u52a1\u5668\u65e9\u5df2\u4e0d\u518d\u7528\u4f5c mirrors\uff08\u73b0\u5728\u662f esxi-5\uff09\uff0c\u56e0\u6b64\u66f4\u591a\u7684\u4fe1\u606f\u6682\u65e0\u4ece\u8003\u5bdf\u3002","title":"Obsolete (1)"},{"location":"services/mirrors/1/#mirrors1","text":"mirrors1 \u662f 2011 \u5e74\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u63d0\u4f9b\u7ed9 LUG \u7528\u4f5c\u521d\u4ee3 mirrors.ustc.edu.cn \u670d\u52a1\u7684\u673a\u5668\uff0c\u662f\u4e00\u53f0\u66d9\u5149 i620r-G \u53c2\u6570 \u914d\u7f6e CPU Intel(R) Xeon(R) CPU E5620 @ 2.40GHz x 2 \u5185\u5b58 48 GB \u5b58\u50a8 LSI Logic MegaRAID SAS 8708EM2 x 2 DFT RS-3016I-S/D30 \u78c1\u76d8\u9635\u5217 \u7f51\u7edc Ethernet Intel 82574L Gigabit x 2 \u7528\u6237\u624b\u518c \u7531\u4e8e\u672c\u6587\u7f16\u5199\u65f6\uff082020 \u5e74\uff09\u8be5\u670d\u52a1\u5668\u65e9\u5df2\u4e0d\u518d\u7528\u4f5c mirrors\uff08\u73b0\u5728\u662f esxi-5\uff09\uff0c\u56e0\u6b64\u66f4\u591a\u7684\u4fe1\u606f\u6682\u65e0\u4ece\u8003\u5bdf\u3002","title":"mirrors1"},{"location":"services/mirrors/2/","text":"mirrors2 \u00b6 2016 \u5e74\u5e95\u4ece\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u83b7\u5f97\u7684\u65b0\u673a\u5668\uff0c\u8fd0\u884c\u81f3\u4eca\uff0c\u627f\u62c5\u4e86\u76ee\u524d mirrors \u7684\u5168\u90e8\u8d1f\u8f7d\u3002 \u53c2\u6570 \u914d\u7f6e CPU \u53cc\u8def E5-2620 v4 \u5185\u5b58 256GB DDR4 \u5b58\u50a8 6T*12(HDD), 250G*2(SSD) \u7f51\u7edc 1 Gbps * 2 \u66d9\u5149I620-G20 \u5bfc\u822a\u5149\u76d8","title":"Overview"},{"location":"services/mirrors/2/#mirrors2","text":"2016 \u5e74\u5e95\u4ece\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u83b7\u5f97\u7684\u65b0\u673a\u5668\uff0c\u8fd0\u884c\u81f3\u4eca\uff0c\u627f\u62c5\u4e86\u76ee\u524d mirrors \u7684\u5168\u90e8\u8d1f\u8f7d\u3002 \u53c2\u6570 \u914d\u7f6e CPU \u53cc\u8def E5-2620 v4 \u5185\u5b58 256GB DDR4 \u5b58\u50a8 6T*12(HDD), 250G*2(SSD) \u7f51\u7edc 1 Gbps * 2 \u66d9\u5149I620-G20 \u5bfc\u822a\u5149\u76d8","title":"mirrors2"},{"location":"services/mirrors/2/networking/","text":"Networking on mirrors2 \u00b6 mirrors2 \u4e0a\u7684\u7f51\u7edc\u4f7f\u7528\u9ed8\u8ba4\u7684 ifupdown \u914d\u7f6e\u3002 \u5728 /etc/network/interfaces.d \u4e2d\u5b58\u653e\u7740\u63a5\u53e3\u914d\u7f6e\uff0c\u4f7f\u7528 ifup / ifdown \u6765\u542f\u7528/\u505c\u7528\u67d0\u4e00\u63a5\u53e3\u3002 \u91cd\u542f\u6240\u6709\u7f51\u7edc\u63a5\u53e3 \u5728\u67d0\u6b21 mirrors2 \u79bb\u7ebf\u6545\u969c\u4e2d\uff0c~~\u8bef\u64cd\u4f5c\u7684 systemctl restart networking \u8fd4\u56de\u4e86\u5931\u8d25\u7684\u7ed3\u679c\uff0c\u4ece\u800c\u5bfc\u81f4\u4e86 mirrors2 \u4ece\u67d0\u4e00\u7f51\u7edc\u63a5\u53e3\u65ad\u5f00\uff08\u731c\u6d4b\uff09~~\uff08\u5b9e\u9645\u539f\u56e0\u89c1\u4e0b\uff09\uff0c\u91cd\u542f\u6240\u6709\u63a5\u53e3\u4fee\u590d\u4e86\u95ee\u9898\uff1a ifdown -a && ifup -a \u5b9e\u9645\u539f\u56e0\u662f bridge interface \u8fde\u63a5\u7684\u90a3\u4e2a interface \u5728 ifupdown \u7684 config \u91cc\u7684\u914d\u7f6e\u65b9\u5f0f\u662f static \u7684\uff0c\u5728\u542f\u7528 bridge interface \u65f6\u4f1a\u81ea\u52a8\u66f4\u6539\u914d\u7f6e\u5bfc\u81f4 offline\u3002\u6539\u6210 manual \u7981\u6b62\u5b83\u7684\u81ea\u52a8\u884c\u4e3a\u4e4b\u540e\u5c31\u6ca1\u4e8b\u4e86\u3002","title":"Networking"},{"location":"services/mirrors/2/networking/#networking-on-mirrors2","text":"mirrors2 \u4e0a\u7684\u7f51\u7edc\u4f7f\u7528\u9ed8\u8ba4\u7684 ifupdown \u914d\u7f6e\u3002 \u5728 /etc/network/interfaces.d \u4e2d\u5b58\u653e\u7740\u63a5\u53e3\u914d\u7f6e\uff0c\u4f7f\u7528 ifup / ifdown \u6765\u542f\u7528/\u505c\u7528\u67d0\u4e00\u63a5\u53e3\u3002 \u91cd\u542f\u6240\u6709\u7f51\u7edc\u63a5\u53e3 \u5728\u67d0\u6b21 mirrors2 \u79bb\u7ebf\u6545\u969c\u4e2d\uff0c~~\u8bef\u64cd\u4f5c\u7684 systemctl restart networking \u8fd4\u56de\u4e86\u5931\u8d25\u7684\u7ed3\u679c\uff0c\u4ece\u800c\u5bfc\u81f4\u4e86 mirrors2 \u4ece\u67d0\u4e00\u7f51\u7edc\u63a5\u53e3\u65ad\u5f00\uff08\u731c\u6d4b\uff09~~\uff08\u5b9e\u9645\u539f\u56e0\u89c1\u4e0b\uff09\uff0c\u91cd\u542f\u6240\u6709\u63a5\u53e3\u4fee\u590d\u4e86\u95ee\u9898\uff1a ifdown -a && ifup -a \u5b9e\u9645\u539f\u56e0\u662f bridge interface \u8fde\u63a5\u7684\u90a3\u4e2a interface \u5728 ifupdown \u7684 config \u91cc\u7684\u914d\u7f6e\u65b9\u5f0f\u662f static \u7684\uff0c\u5728\u542f\u7528 bridge interface \u65f6\u4f1a\u81ea\u52a8\u66f4\u6539\u914d\u7f6e\u5bfc\u81f4 offline\u3002\u6539\u6210 manual \u7981\u6b62\u5b83\u7684\u81ea\u52a8\u884c\u4e3a\u4e4b\u540e\u5c31\u6ca1\u4e8b\u4e86\u3002","title":"Networking on mirrors2"},{"location":"services/mirrors/3/","text":"mirrors3 \u00b6 2020 \u5e74\u521d\u4ece\u56fe\u4e66\u9986\u6280\u672f\u90e8\u83b7\u5f97\u7684\u4e00\u53f0\u65e7\u670d\u52a1\u5668\uff0c\u4e3a\u6234\u5c14 PowerEdge R510\uff0c\u8d1f\u8f7d\u6bd4\u8f83\u6742\u4e71\u3002 \u53c2\u6570 \u914d\u7f6e CPU \u53cc\u8def\u81f3\u5f3a E5620 \u5185\u5b58 32 GB DDR3 \u5b58\u50a8 1 TB*2 (HDD), 2 TB*5 (HDD), 3 TB*1 (HDD) \u540c\u53cb iSCSI \u9635\u5217\uff0c4 TB*16 (HDD) \u7f51\u7edc 1 Gbps * 2 \u5b58\u50a8\u7ed3\u6784\uff1a \u6ce8\u610f\u4e8b\u9879 \u76ee\u524d mirrors3 \u6ca1\u6709\u90e8\u7f72\u4efb\u4f55\u670d\u52a1\uff0c\u4f46\u662f\u6709\u90e8\u5206\u76d8\u635f\u574f/\u63a5\u8fd1\u635f\u574f\uff0c\u9700\u8981\u66f4\u6362\u5e76\u91cd\u5efa\u9635\u5217\u3002 1 TB * 2 \u4f4d\u4e8e\u673a\u8eab\uff0c\u7ec4\u6210 RAID1 \u5b89\u88c5\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6302\u8f7d\u4e3a rootfs 2 TB * 5 + 3 TB * 1 \u540c\u6837\u4f4d\u4e8e\u673a\u8eab\uff0c\u7ec4\u6210 RAID6 \u5b58\u653e\u8d44\u6599\uff08\u6240\u4ee5\u552f\u4e00\u4e00\u5757 3 TB \u7684\u786c\u76d8\u5b9e\u9645\u4e0a\u5f53\u505a 2 TB \u7684\u6765\u7528\uff09 \u5916\u90e8\u9635\u5217\uff0c4 TB * 16 \u901a\u8fc7 SFP+ \u5149\u7ea4\u6302\u8f7d\u4e3a iSCSI \u8bbe\u5907\uff0c\u5206\u4e3a\u4e24\u7ec4 RAID60\uff08\u53ef\u7528\u5bb9\u91cf\u4e3a 12 \u5757\u76d8\uff09\u5b58\u50a8\u8d44\u6599","title":"Auxiliary (3)"},{"location":"services/mirrors/3/#mirrors3","text":"2020 \u5e74\u521d\u4ece\u56fe\u4e66\u9986\u6280\u672f\u90e8\u83b7\u5f97\u7684\u4e00\u53f0\u65e7\u670d\u52a1\u5668\uff0c\u4e3a\u6234\u5c14 PowerEdge R510\uff0c\u8d1f\u8f7d\u6bd4\u8f83\u6742\u4e71\u3002 \u53c2\u6570 \u914d\u7f6e CPU \u53cc\u8def\u81f3\u5f3a E5620 \u5185\u5b58 32 GB DDR3 \u5b58\u50a8 1 TB*2 (HDD), 2 TB*5 (HDD), 3 TB*1 (HDD) \u540c\u53cb iSCSI \u9635\u5217\uff0c4 TB*16 (HDD) \u7f51\u7edc 1 Gbps * 2 \u5b58\u50a8\u7ed3\u6784\uff1a \u6ce8\u610f\u4e8b\u9879 \u76ee\u524d mirrors3 \u6ca1\u6709\u90e8\u7f72\u4efb\u4f55\u670d\u52a1\uff0c\u4f46\u662f\u6709\u90e8\u5206\u76d8\u635f\u574f/\u63a5\u8fd1\u635f\u574f\uff0c\u9700\u8981\u66f4\u6362\u5e76\u91cd\u5efa\u9635\u5217\u3002 1 TB * 2 \u4f4d\u4e8e\u673a\u8eab\uff0c\u7ec4\u6210 RAID1 \u5b89\u88c5\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6302\u8f7d\u4e3a rootfs 2 TB * 5 + 3 TB * 1 \u540c\u6837\u4f4d\u4e8e\u673a\u8eab\uff0c\u7ec4\u6210 RAID6 \u5b58\u653e\u8d44\u6599\uff08\u6240\u4ee5\u552f\u4e00\u4e00\u5757 3 TB \u7684\u786c\u76d8\u5b9e\u9645\u4e0a\u5f53\u505a 2 TB \u7684\u6765\u7528\uff09 \u5916\u90e8\u9635\u5217\uff0c4 TB * 16 \u901a\u8fc7 SFP+ \u5149\u7ea4\u6302\u8f7d\u4e3a iSCSI \u8bbe\u5907\uff0c\u5206\u4e3a\u4e24\u7ec4 RAID60\uff08\u53ef\u7528\u5bb9\u91cf\u4e3a 12 \u5757\u76d8\uff09\u5b58\u50a8\u8d44\u6599","title":"mirrors3"},{"location":"services/mirrors/4/","text":"mirrors4 \u00b6 mirrors4 \u662f 2020 \u5e74 3 \u6708 24 \u65e5\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u63d0\u4f9b\u7ed9 LUG \u7684\u65b0\u673a\u5668\uff0c\u662f\u4e00\u53f0\u6d6a\u6f6e NF5280M5\u3002 \u786c\u4ef6\u914d\u7f6e \u00b6 CPU \u53cc\u8def Intel Xeon Gold 6230 \u5185\u5b58 256 GB DDR4 2933 (8 * 32 GB SKHynix) \u786c\u76d8 \u4e00\u5757\u4e09\u661f PM883 2TB 12 \u5757 HGST HUH721010AL (10 TB) \u4e24\u4e2a\u786c\u76d8\u63a7\u5236\u5668 MegaRAID SAS-3 3108 \u786c\u76d8\u63a7\u5236\u5668 \u7531\u4e8e\u4e0d\u80fd\u8de8\u63a7\u5236\u5668\u7ec4 RAID \u6216 LUN\uff0c\u4e14\u6bcf\u4e2a\u63a7\u5236\u5668\u53ea\u6709 8 \u4e2a\u63d2\u69fd\uff0c\u56e0\u6b64\u5c06 12 \u5757 HDD \u5206\u4e3a 6 \u5757\u4e00\u7ec4\u63d2\u5728\u4e24\u4e2a\u63a7\u5236\u5668\u4e0a\u7ec4\u6210 RAID6\uff0c\u4ee5\u4e24\u4e2a\u903b\u8f91\u5377\u5448\u73b0\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e0a\u5c42\u7528 LVM \u5904\u7406\u3002SSD \u5355\u72ec\u521b\u5efa\u4e00\u4e2a\u903b\u8f91\u5377\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u3002 \u7f51\u5361 \u677f\u8f7d Intel X722 GbE (4 \u4e2a\u5343\u5146\u7f51\u53e3) PCI-e \u6269\u5c55\u5361\uff1aIntel X520 (82599ES) SFP+ (2 \u4e2a\u4e07\u5146\u5149\u53e3)","title":"Overview"},{"location":"services/mirrors/4/#mirrors4","text":"mirrors4 \u662f 2020 \u5e74 3 \u6708 24 \u65e5\u7f51\u7edc\u4fe1\u606f\u4e2d\u5fc3\u63d0\u4f9b\u7ed9 LUG \u7684\u65b0\u673a\u5668\uff0c\u662f\u4e00\u53f0\u6d6a\u6f6e NF5280M5\u3002","title":"mirrors4"},{"location":"services/mirrors/4/#_1","text":"CPU \u53cc\u8def Intel Xeon Gold 6230 \u5185\u5b58 256 GB DDR4 2933 (8 * 32 GB SKHynix) \u786c\u76d8 \u4e00\u5757\u4e09\u661f PM883 2TB 12 \u5757 HGST HUH721010AL (10 TB) \u4e24\u4e2a\u786c\u76d8\u63a7\u5236\u5668 MegaRAID SAS-3 3108 \u786c\u76d8\u63a7\u5236\u5668 \u7531\u4e8e\u4e0d\u80fd\u8de8\u63a7\u5236\u5668\u7ec4 RAID \u6216 LUN\uff0c\u4e14\u6bcf\u4e2a\u63a7\u5236\u5668\u53ea\u6709 8 \u4e2a\u63d2\u69fd\uff0c\u56e0\u6b64\u5c06 12 \u5757 HDD \u5206\u4e3a 6 \u5757\u4e00\u7ec4\u63d2\u5728\u4e24\u4e2a\u63a7\u5236\u5668\u4e0a\u7ec4\u6210 RAID6\uff0c\u4ee5\u4e24\u4e2a\u903b\u8f91\u5377\u5448\u73b0\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e0a\u5c42\u7528 LVM \u5904\u7406\u3002SSD \u5355\u72ec\u521b\u5efa\u4e00\u4e2a\u903b\u8f91\u5377\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u3002 \u7f51\u5361 \u677f\u8f7d Intel X722 GbE (4 \u4e2a\u5343\u5146\u7f51\u53e3) PCI-e \u6269\u5c55\u5361\uff1aIntel X520 (82599ES) SFP+ (2 \u4e2a\u4e07\u5146\u5149\u53e3)","title":"\u786c\u4ef6\u914d\u7f6e"},{"location":"services/mirrors/4/repos/","text":"Repositories \u00b6 mirrors4 \u4e0a\u7684\u4ed3\u5e93\u548c mirrors2/3 \u4e00\u6837\uff0c\u4f4d\u4e8e /srv/repo \u3002\u4ed3\u5e93\u5bb9\u91cf\u4f7f\u7528 XFS \u7684 quota \u529f\u80fd\u76d1\u89c6\u3002 Todo \u9700\u8981\u8865\u5145\uff1a\u5220\u9664\u4ed3\u5e93\u4e0e\u91cd\u547d\u540d\u4ed3\u5e93 (mv \u548c rm \u53ef\u80fd\u592a\u6162\u4e86) \u6dfb\u52a0\u4e00\u4e2a\u65b0\u4ed3\u5e93 \u00b6 \u521b\u5efa XFS project \u00b6 \u4e3a\u65b0\u4ed3\u5e93\u521b\u5efa XFS quota \u4ee5\u4fbf\u4e8e\u76d1\u89c6\u5bb9\u91cf\u3002\u9996\u5148\u68c0\u67e5 /etc/projects \u548c /etc/projid \uff0c\u627e\u5230\u5927\u4e8e 1000 \u7684 ID \u5e8f\u5217\uff0c\u627e\u51fa\u4e0b\u4e00\u4e2a ID\uff08\u4f8b\u5982 1111\uff0c\u4e0b\u9762\u4f7f\u7528\u8fd9\u4e2a\u4f5c\u4e3a\u4f8b\u5b50\uff09\u3002 mkdir /srv/repo/example \u7f16\u8f91 /etc/projects \uff0c\u52a0\u5165\u5982\u4e0b\u4e00\u884c 1111:/srv/repo/example \u7136\u540e\u6267\u884c\uff1a xfs_quota -x -c 'project -s 1111' \u7f16\u8f91 /etc/projid \uff0c\u52a0\u5165\u5982\u4e0b\u4e00\u884c example:1111 \u4fe1\u606f \u6211\u4eec\u7684\u955c\u50cf\u7ba1\u7406\u5668 Yuki \u6839\u636e\u955c\u50cf\u76ee\u5f55\u7684\u6700\u540e\u4e00\u6bb5\u540d\u79f0\uff08\u5373 basename\uff09\u6765\u4ece XFS \u4e2d\u83b7\u53d6\u5bb9\u91cf\u4fe1\u606f\uff0c\u56e0\u6b64 /etc/projid \u6587\u4ef6\u5185\u5bb9\u6b63\u786e\u624d\u80fd\u4f7f Yuki \u5f97\u5230\u6b63\u786e\u7684\u5bb9\u91cf\u3002 \u4fbf\u6377\u914d\u7f6e\u811a\u672c \u00b6 #!/bin/bash # Determine largest project ID next_id () { local PROJID = $( cut -d ':' -f1 /etc/projects | sort -n | tail -1 ) echo $(( ++ PROJID )) } BASE = \"/srv/repo\" readonly BASE if [ \" $1 \" = \"-m\" ] ; then MKDIR = yes shift fi while [ $# -ne 0 ] ; do N = \" ${ 1 // \\/ / } \" shift if grep -q \" $BASE / $N \\$\" /etc/projects ; then echo \"Repo $N exists, skipped.\" > & 2 continue fi if [ ! -e \" $BASE / $N \" ] ; then if [ -n \" $MKDIR \" ] ; then echo \"Path $BASE / $N does not exist, creating directory.\" > & 2 mkdir -p \" $BASE / $N \" else echo \"Path $BASE / $N does not exist, ignored.\" > & 2 continue fi elif [ ! -d \" $BASE / $N \" ] ; then echo \"Path $BASE / $N is not a directory, ignored.\" > & 2 continue fi ID = \" $( next_id ) \" echo \" $ID : $BASE / $N \" >> /etc/projects echo \" $N : $ID \" >> /etc/projid xfs_quota -x -c \"project -s $ID \" & >/dev/null echo \"Added $N (ID $ID )\" done \u6dfb\u52a0\u540c\u6b65\u914d\u7f6e \u00b6 \u7167\u7740 /home/mirror/repos \u4e0b\u7684\u73b0\u6709\u6587\u4ef6\u81ea\u5df1\u7814\u7a76\u4e00\u4e0b\u5427\uff0c\u8fd9\u4e2a\u4e0d\u96be\u3002\u9700\u8981\u6ce8\u610f\u7684\u5c31\u4e00\u70b9\uff0c\u6587\u4ef6\u540d\u7ed3\u5c3e\u5fc5\u987b\u662f .yaml \uff08\u800c\u4e0d\u80fd\u662f .yml \uff09\uff0c\u8fd9\u662f Yuki \u4ee3\u7801\u91cc\u5199\u7684\u3002 \u5199\u597d\u65b0\u4ed3\u5e93\u7684\u914d\u7f6e\u6587\u4ef6\u4e4b\u540e\u8fd0\u884c yuki reload \uff0c\u7136\u540e yuki sync <repo> \u5c31\u53ef\u4ee5\u5f00\u59cb\u521d\u6b21\u540c\u6b65\u4e86\u3002 \u4e3a Git \u7c7b\u578b\u4ed3\u5e93\u6dfb\u52a0\u8f6f\u94fe\u63a5\u81f3 /srv/git \u00b6 git-daemon.service \u6839\u636e /srv/git \u4e0b\u7684\u5185\u5bb9\u5bf9\u5916\u63d0\u4f9b Git \u670d\u52a1\u3002\u6240\u4ee5\u5982\u679c\u662f git \u7c7b\u578b\u7684\u4ed3\u5e93\uff0c\u9700\u8981\u6dfb\u52a0\u8f6f\u94fe\u63a5\uff0c\u5426\u5219\u65e0\u6cd5\u4f7f\u7528 git:// \u7684\u534f\u8bae\u8bbf\u95ee\u3002\uff08 http(s):// \u534f\u8bae\u6ca1\u6709\u95ee\u9898\uff09 \u67e5\u770b quota \u60c5\u51b5 \u00b6 \u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a xfs_quota -c 'df -h'","title":"Repositories"},{"location":"services/mirrors/4/repos/#repositories","text":"mirrors4 \u4e0a\u7684\u4ed3\u5e93\u548c mirrors2/3 \u4e00\u6837\uff0c\u4f4d\u4e8e /srv/repo \u3002\u4ed3\u5e93\u5bb9\u91cf\u4f7f\u7528 XFS \u7684 quota \u529f\u80fd\u76d1\u89c6\u3002 Todo \u9700\u8981\u8865\u5145\uff1a\u5220\u9664\u4ed3\u5e93\u4e0e\u91cd\u547d\u540d\u4ed3\u5e93 (mv \u548c rm \u53ef\u80fd\u592a\u6162\u4e86)","title":"Repositories"},{"location":"services/mirrors/4/repos/#_1","text":"","title":"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u4ed3\u5e93"},{"location":"services/mirrors/4/repos/#xfs-project","text":"\u4e3a\u65b0\u4ed3\u5e93\u521b\u5efa XFS quota \u4ee5\u4fbf\u4e8e\u76d1\u89c6\u5bb9\u91cf\u3002\u9996\u5148\u68c0\u67e5 /etc/projects \u548c /etc/projid \uff0c\u627e\u5230\u5927\u4e8e 1000 \u7684 ID \u5e8f\u5217\uff0c\u627e\u51fa\u4e0b\u4e00\u4e2a ID\uff08\u4f8b\u5982 1111\uff0c\u4e0b\u9762\u4f7f\u7528\u8fd9\u4e2a\u4f5c\u4e3a\u4f8b\u5b50\uff09\u3002 mkdir /srv/repo/example \u7f16\u8f91 /etc/projects \uff0c\u52a0\u5165\u5982\u4e0b\u4e00\u884c 1111:/srv/repo/example \u7136\u540e\u6267\u884c\uff1a xfs_quota -x -c 'project -s 1111' \u7f16\u8f91 /etc/projid \uff0c\u52a0\u5165\u5982\u4e0b\u4e00\u884c example:1111 \u4fe1\u606f \u6211\u4eec\u7684\u955c\u50cf\u7ba1\u7406\u5668 Yuki \u6839\u636e\u955c\u50cf\u76ee\u5f55\u7684\u6700\u540e\u4e00\u6bb5\u540d\u79f0\uff08\u5373 basename\uff09\u6765\u4ece XFS \u4e2d\u83b7\u53d6\u5bb9\u91cf\u4fe1\u606f\uff0c\u56e0\u6b64 /etc/projid \u6587\u4ef6\u5185\u5bb9\u6b63\u786e\u624d\u80fd\u4f7f Yuki \u5f97\u5230\u6b63\u786e\u7684\u5bb9\u91cf\u3002","title":"\u521b\u5efa XFS project"},{"location":"services/mirrors/4/repos/#_2","text":"#!/bin/bash # Determine largest project ID next_id () { local PROJID = $( cut -d ':' -f1 /etc/projects | sort -n | tail -1 ) echo $(( ++ PROJID )) } BASE = \"/srv/repo\" readonly BASE if [ \" $1 \" = \"-m\" ] ; then MKDIR = yes shift fi while [ $# -ne 0 ] ; do N = \" ${ 1 // \\/ / } \" shift if grep -q \" $BASE / $N \\$\" /etc/projects ; then echo \"Repo $N exists, skipped.\" > & 2 continue fi if [ ! -e \" $BASE / $N \" ] ; then if [ -n \" $MKDIR \" ] ; then echo \"Path $BASE / $N does not exist, creating directory.\" > & 2 mkdir -p \" $BASE / $N \" else echo \"Path $BASE / $N does not exist, ignored.\" > & 2 continue fi elif [ ! -d \" $BASE / $N \" ] ; then echo \"Path $BASE / $N is not a directory, ignored.\" > & 2 continue fi ID = \" $( next_id ) \" echo \" $ID : $BASE / $N \" >> /etc/projects echo \" $N : $ID \" >> /etc/projid xfs_quota -x -c \"project -s $ID \" & >/dev/null echo \"Added $N (ID $ID )\" done","title":"\u4fbf\u6377\u914d\u7f6e\u811a\u672c"},{"location":"services/mirrors/4/repos/#_3","text":"\u7167\u7740 /home/mirror/repos \u4e0b\u7684\u73b0\u6709\u6587\u4ef6\u81ea\u5df1\u7814\u7a76\u4e00\u4e0b\u5427\uff0c\u8fd9\u4e2a\u4e0d\u96be\u3002\u9700\u8981\u6ce8\u610f\u7684\u5c31\u4e00\u70b9\uff0c\u6587\u4ef6\u540d\u7ed3\u5c3e\u5fc5\u987b\u662f .yaml \uff08\u800c\u4e0d\u80fd\u662f .yml \uff09\uff0c\u8fd9\u662f Yuki \u4ee3\u7801\u91cc\u5199\u7684\u3002 \u5199\u597d\u65b0\u4ed3\u5e93\u7684\u914d\u7f6e\u6587\u4ef6\u4e4b\u540e\u8fd0\u884c yuki reload \uff0c\u7136\u540e yuki sync <repo> \u5c31\u53ef\u4ee5\u5f00\u59cb\u521d\u6b21\u540c\u6b65\u4e86\u3002","title":"\u6dfb\u52a0\u540c\u6b65\u914d\u7f6e"},{"location":"services/mirrors/4/repos/#git-srvgit","text":"git-daemon.service \u6839\u636e /srv/git \u4e0b\u7684\u5185\u5bb9\u5bf9\u5916\u63d0\u4f9b Git \u670d\u52a1\u3002\u6240\u4ee5\u5982\u679c\u662f git \u7c7b\u578b\u7684\u4ed3\u5e93\uff0c\u9700\u8981\u6dfb\u52a0\u8f6f\u94fe\u63a5\uff0c\u5426\u5219\u65e0\u6cd5\u4f7f\u7528 git:// \u7684\u534f\u8bae\u8bbf\u95ee\u3002\uff08 http(s):// \u534f\u8bae\u6ca1\u6709\u95ee\u9898\uff09","title":"\u4e3a Git \u7c7b\u578b\u4ed3\u5e93\u6dfb\u52a0\u8f6f\u94fe\u63a5\u81f3 /srv/git"},{"location":"services/mirrors/4/repos/#quota","text":"\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a xfs_quota -c 'df -h'","title":"\u67e5\u770b quota \u60c5\u51b5"},{"location":"services/mirrors/4/volumes/","text":"Volumes on mirrors4 \u00b6 \u4ecb\u7ecd\u9875 \u8bb2\u8fc7\u4e86\uff0c\u63a7\u5236\u5668\u7684\u5751\u5bfc\u81f4\u4e0d\u80fd\u76f4\u63a5\u628a 12 \u5757\u786c\u76d8\u7ec4\u6210\u4e00\u4e2a\u903b\u8f91\u78c1\u76d8\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u4e0a\u5c42\u4f7f\u7528 LVM \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 \u78c1\u76d8\u5206\u533a \u00b6 \u6ce8\u610f \u8fd9\u91cc\u7ed9\u51fa\u7684\u547d\u4ee4\u4ec5\u7528\u4e8e\u5c55\u793a\u5206\u533a\uff08\u5377\uff09\u7684\u521b\u5efa\u65b9\u5f0f\uff0c\u9664\u975e\u5b8c\u5168\u91cd\u88c5\uff0c\u5426\u5219 \u4e0d\u5e94\u8be5\u6267\u884c \u5176\u4e2d\u4efb\u4f55\u4e00\u6761\u6709\u526f\u4f5c\u7528\u7684\u547d\u4ee4\u3002 \u64cd\u4f5c\u7cfb\u7edf\u770b\u5230\u4e09\u4e2a\u786c\u76d8\uff1a\u4e24\u4e2a RAID6 \u5927\u76d8\uff0840 TB / 36.4 TiB\uff09\u548c\u4e00\u4e2a SSD\uff082 TB / 1.86 TiB\uff09\u3002\u8bbe\u4e24\u4e2a\u5927\u76d8\u4e3a /dev/sda \u548c /dev/sdb\uff0cSSD \u4e3a /dev/sdc\u3002 \u7531\u4e8e\u542f\u52a8\u5206\u533a\u4e0d\u80fd\u653e\u5728 LVM \u4e0a\uff0c\u56e0\u6b64\u4ee5\u5982\u4e0b\u65b9\u5f0f\u521b\u5efa\u5206\u533a\uff1a root@mirrors4:~# fdisk -l /dev/sda Disk /dev/sda: 36.4 TiB, 40001177911296 bytes, 78127300608 sectors Disk model: MR9361-8i Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 4096 bytes I/O size (minimum/optimal): 262144 bytes / 262144 bytes Disklabel type: gpt Disk identifier: AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA Device Start End Sectors Size Type /dev/sda1 2048 4095 2048 1M BIOS boot /dev/sda2 4096 1052671 1048576 512M EFI System /dev/sda3 1052672 78127300574 78126247903 36.4T Linux LVM sdb \u7684\u53c2\u6570\u5b8c\u5168\u4e00\u6837\u3002 \u5b9e\u9645\u7684\u542f\u52a8\u5206\u533a\u4e3a /dev/sda2\uff0c\u5c06\u5176 dd \u5230 /dev/sdb2 \u505a\u5907\u4efd\u3002 \u7136\u540e\u662f SSD \u7684\u5206\u533a\uff1a Disk /dev/sdc: 1.8 TiB, 1919816826880 bytes, 3749642240 sectors Disk model: MR9361-8i Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 4096 bytes I/O size (minimum/optimal): 65536 bytes / 65536 bytes Disklabel type: gpt Disk identifier: AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA Device Start End Sectors Size Type /dev/sdc1 2048 3749642206 3749640159 1.8T Linux LVM LVM \u00b6 \u628a sda3 \u548c sdb3 \u90fd\u653e\u8fdb LVM\uff1a # fdisk \u5206\u533a\u5b8c\u6bd5\uff0cw \u5199\u5165\u9000\u51fa pvcreate /dev/sda3 /dev/sdb3 vgcreate lug /dev/sda3 /dev/sdb3 \u521b\u5efa rootfs\uff0c\u8fd9\u91cc\u4ee5 RAID1 \u7684\u65b9\u5f0f\uff08 --type mirror \u6216 --type raid1 \uff09\u521b\u5efa\u8fd9\u4e2a\u5206\u533a\uff0c\u8fd9\u6837\u5373\u4f7f sda / sdb \u574f\u6389\u4e00\u6574\u7ec4\u4e4b\u540e\u8fd8\u6709 rootfs \u53ef\u4ee5\u7528\u3002 lvcreate -n root -L 32G --type mirror -m 2 lug mkfs.ext4 /dev/lug/root \u521b\u5efa home\uff0c\u8fd9\u91cc\u53cd\u6b63\u4e0d\u6015\u574f\uff0c\u7528 RAID0\uff08 --type striped \u6216 --type raid0 \uff09\u3002 lvcreate -n root -L 64G --type striped -i 2 lug mkfs.ext4 /dev/lug/home \u521b\u5efa\u653e\u955c\u50cf\u7684\u5206\u533a\uff0c\u8fd9\u6b21\u8981\u7528 xfs XFS \u4e0d\u652f\u6301\u7f29\u5c0f \u56e0\u6b64\u6211\u4eec\u5728\u521d\u88c5\u65f6\u9009\u62e9\u4e3a\u5176\u5206\u914d 48 TiB \u7684\u7a7a\u95f4\uff0c\u800c\u4e0d\u662f VG lug \u7684\u5269\u4f59\u5168\u90e8\u2014\u2014\u8fd9\u6837\u65b9\u4fbf\u4ee5\u540e\u7ef4\u62a4 lvcreate -n repo -L 48T --type striped -i 2 lug mkfs.xfs /dev/lug/repo \u5176\u5b9e\u672c\u6765\u8981\u8c03\u4e00\u4e0b\u53c2\u7684\uff0c\u4e0d\u8fc7\u6839\u636e Arch Wiki \uff0c mkfs.xfs \u7684\u9ed8\u8ba4\u53c2\u6570\u5c31\u662f\u6700\u4f18\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u51b3\u5b9a\u4e0d\u52a8\u4e86\u3002 SSD \u00b6 SSD \u7684\u7528\u9014\u4e3a\u5b58\u653e Docker \u6570\u636e /var/lib/docker \uff088 GiB \u5c31\u591f\u4e86\uff0c\u4f46\u662f overlay2 \u7684\u540e\u7aef\u7528 ext4 \u66f4\u597d\uff09\uff0c\u5269\u4e0b\u7528\u4f5c lvmcache(7)\u3002 iBug \u5907\u6ce8 \u867d\u7136\u4f3c\u4e4e\u6ca1\u6709\u8fd9\u6837\u505a\uff08\u5148\u521b\u5efa\u5355\u72ec\u7684 VG \u518d\u5408\u5e76\uff09\u7684\u5fc5\u8981\uff0c\u4f46\u662f\u8fd9\u4e48\u505a\u4e00\u5b9a\u4e0d\u4f1a\u51fa\u9519\uff0c\u5c31\u8fd9\u6837\u5427\u3002 \u5728 SSD \u4e0a\u65b0\u5efa\u4e00\u4e2a VG\uff1a # fdisk \u521b\u5efa\u552f\u4e00\u4e00\u4e2a\u5206\u533a sdc1\uff0c\u4fdd\u5b58\u9000\u51fa pvcreate /dev/sdc1 vgcreate ssd /dev/sdc1 \u521b\u5efa Docker \u6570\u636e\u76d8\uff1a lvcreate -L 8G -n docker ssd mkfs.ext4 /dev/ssd/docker \u91cd\u8981 \uff1a\u521b\u5efa\u7f13\u5b58\u76d8\u548c\u7f13\u5b58\u5143\u6570\u636e\u76d8\u3002\u6839\u636e Red Hat Documentation \u7684\u4ecb\u7ecd\uff0c\u5148\u624b\u52a8\u521b\u5efa\u6570\u636e\u76d8\u548c\u5143\u6570\u636e\u76d8\uff0c\u7136\u540e\u5c06\u4ed6\u4eec\u5408\u5e76\u4e3a\u4e00\u4e2a cache pool\u3002\u5927\u5c0f\u65b9\u9762\uff0c\u6587\u7ae0\u7684\u53c2\u8003\u662f 2G data \u2194 12M meta\uff0c\u8fd9\u91cc\u6211\u4eec\u6709\u63a5\u8fd1 2 TB \u7684 data\uff0c\u5c31\u5206\u914d 16 GB \u4f5c\u4e3a meta \u5427\u3002 lvcreate -L 16G -n mcache_meta ssd lvcreate -l 100 %FREE -n mcache ssd lvreduce -l -2048 ssd/mcache lvconvert --type cache-pool --poolmetadata ssd/mcache_meta --cachemode writethrough -c 1M --config allocation/cache_pool_max_chunks = 2000000 ssd/mcache \u8fd9\u91cc\u7684\u7f13\u5b58\u6a21\u5f0f\u91c7\u7528 passthrough\uff0c\u5373\u5199\u5165\u52a8\u4f5c\u7ed5\u8fc7\u7f13\u5b58\u76f4\u63a5\u5199\u56de\u539f\u8bbe\u5907\uff08\u5f53\u7136\u5566\uff0c\u5199\u5165\u90fd\u662f\u7531\u4ece\u4e0a\u6e38\u540c\u6b65\u4ea7\u751f\u7684\uff09\uff0c\u53e6\u5916\u4e24\u79cd writeback \u548c writethrough \u90fd\u4f1a\u5199\u5165\u7f13\u5b58\uff0c\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u3002 passthrough \u6a21\u5f0f\u4e2d\uff0c\u8bfb\u5199\u90fd\u4f1a\u7ed5\u8fc7 cache\uff0c\u552f\u4e00\u7684\u4f5c\u7528\u662f write hit \u4f1a\u4f7f\u5f97 cache \u5bf9\u5e94\u7684\u5757\u5931\u6548\u3002 \u8fd9\u91cc\u4f7f\u7528 writeback \u6a21\u5f0f\uff0c\u56e0\u4e3a\u4ed3\u5e93\u6570\u636e\u6ca1\u4e86\u8fd8\u80fd\u518d\u540c\u6b65\uff0c\u4f7f\u7528 writeback \u63d0\u5347\u6027\u80fd\u66f4\u5408\u9002\u3002 \u51fa\u4e8e\u7a33\u5b9a\u8003\u8651\uff0c\u4f7f\u7528 writethrough \u6a21\u5f0f\u3002\uff08\u6211\u4eec\u7684 Cache \u592a\u5927\u4e86\uff0cwriteback \u53ef\u80fd\u4f1a\u5f04\u574f\u4e0d\u5c11\u4e1c\u897f\uff0c\u5982\u679c metadata \u574f\u4e86\u5c31\u66f4\u9ebb\u70e6\u4e86\uff09 \u5751 \u76f4\u63a5\u4f7f\u7528 lvconvert(8) \u5c1d\u8bd5\u5408\u5e76\u4f1a\u5bfc\u81f4\u5410\u69fd\uff0c\u8fd9\u662f\u4e0a\u9762 lvreduce(8) \u7684\u539f\u56e0\u3002 Volume group \"ssd\" has insufficient free space (0 extents): 2048 required. iBug \u5907\u6ce8 LVM \u63a8\u8350\u7684\u662f\u4e00\u4e2a\u7f13\u5b58\u6c60\u91cc\u4e0d\u8d85\u8fc7 100 \u4e07\u4e2a chunk\uff08\u8fd9\u4e5f\u662f allocation/cache_pool_max_chunks \u7684\u9ed8\u8ba4\u503c\uff09\uff0c\u4f46\u662f\u8fd9\u6837\u6bcf\u4e2a chunk \u7684\u6700\u5c0f\u5927\u5c0f\u4e3a 1.84 MiB \u592a\u5927\u4e86\uff0c\u8003\u8651\u5230\u6211\u4eec\u6709\u8db3\u591f\u7684 CPU \u548c\u5185\u5b58\uff0c\u8fd9\u91cc\u5c31 \u94e4\u800c\u8d70\u9669 \u5c1d\u8bd5\u4e00\u4e0b\u8f83\u5927\u7684 chunk count\u3002 \u5751 2 \u7f13\u5b58\u76d8\uff08cache pool\uff09\u548c\u88ab\u7f13\u5b58\u7684\u5377\u5fc5\u987b\u5728\u540c\u4e00\u4e2a VG \u4e2d\u3002 \u5751 3 (taoky \u5907\u6ce8) LVM Cache \u7684\u5e95\u5c42\u662f\u5728\u5185\u6838\u5b9e\u73b0\u7684 dm-cache\u3002\u76ee\u524d\u5df2\u77e5\u7684\u5751\u5982\u4e0b\uff1a \u5f53\u51fa\u73b0 dirty blocks\uff08\u4e14 cache policy \u4e3a cleaner \u65f6\uff09\uff0c\u65e0\u6cd5\u6b63\u5e38 flush\u3002\u7f51\u7edc\u4e0a\u53ef\u4ee5\u627e\u5230\u7684\u8fd9\u4e2a bug \u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u589e\u5927 migration_threshold \u7684\u503c\uff08\u5728\u65b0\u7248\u672c LVM \u4e2d\uff0cmigration_threshold \u9ed8\u8ba4\u81f3\u5c11\u4f1a\u662f chunk size \u7684 8 \u500d\uff0c\u5728\u6211\u4eec\u7684\u914d\u7f6e\u4e0b\u5c31\u662f 16384 = 2048 * 8\u3002\u8fd9\u4e2a\u7248\u672c\u7684 LVM \u6682\u65f6\u4e0d\u5728 Buster \u4e2d\uff09\uff0c\u4f46\u662f\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u5355\u7eaf\u589e\u5927 migration_threshold \u6ca1\u6709\u4efb\u4f55\u6548\u679c\u3002Jiahao \u7ffb\u4e86\u4e00\u4e0b dm-cache \u7684\u6e90\u4ee3\u7801\uff0c\u53d1\u73b0 flush \u7684\u6761\u4ef6\u5728 https://elixir.bootlin.com/linux/latest/source/drivers/md/dm-cache-target.c#L1649 \uff0c\u53ea\u5728\u72b6\u6001\u4e3a IDLE \u65f6\u624d\u4f1a flush\u3002IDLE \u7684\u7b2c\u4e00\u4e2a\u6761\u4ef6\u9700\u8981 inflight io = 0\uff0c\u6bd4\u8f83\u82db\u523b\uff0c\u53ef\u80fd\u662f\u65e0\u6cd5\u6b63\u5e38 flush \u7684\u539f\u56e0\u3002 \u4e00\u4e2a\u626d\u66f2\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\uff1a\u5148\u628a migration_threshold \u8bbe\u7f6e\u5f97\u5f88\u5927\uff08\u8bbe\u5927\u5c0f\u4e3a x\uff09\uff0c\u7136\u540e\u9a6c\u4e0a\u7f29\u5c0f\uff0c\u8fd9\u6837\u5c31\u80fd\u628a x \u90a3\u4e48\u591a\u5927\u5c0f\u7684\u810f\u5757\u5f04\u6389\uff08\u539f\u7406\u6682\u65f6\u4e0d\u660e\uff0c\u9700\u8981\u8865\u5145\uff09\u3002\u57fa\u4e8e\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5199\u4e00\u4e2a\u811a\u672c\u6765\u505a flush \u7684\u5de5\u4f5c\uff1a # dirty hack sudo lvchange --cachepolicy cleaner lug/repo for i in ` seq 1 1500 ` ; do sudo lvchange --cachesettings migration_threshold = 2113536 lug/repo && sudo lvchange --cachesettings migration_threshold = 16384 && echo $i && sleep 15 ; done ; # \u9700\u8981\u786e\u8ba4\u6ca1\u6709\u810f\u5757\u3002\u5982\u679c\u8fd8\u6709\u7684\u8bdd\u7ee7\u7eed\u6267\u884c\uff08\u6b21\u6570\u8c03\u5c0f\u4e00\u4e9b\uff09 # \u5982\u679c\u662f\u4ece writeback \u5207\u6362\uff0c\u9700\u8981\u5148\u628a\u6a21\u5f0f\u5207\u5230 writethrough # \u7136\u540e\u518d\u4fee\u6539 cachepolicy \u5230 smq sudo lvchange --cachepolicy smq lug/repo \u5728\u6267\u884c\u65f6\uff0c\u53ef\u4ee5\u67e5\u770b\uff1a sudo dmsetup status lug-repo # \u5728 \"metadata2\" \u524d\u9762\u7684\u524d\u9762\u7684\u6570\u5b57\u5c31\u662f dirty block \u7684\u6570\u91cf # \u5982\u679c\u4e0d\u5728\u6267\u884c lvchange\uff08\u6ca1\u6709\u8fdb\u7a0b\u62a2\u5360\u4e86 LVM \u7684\u9501\uff09\uff0c\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u786e\u8ba4\u810f\u5757\u6570\u91cf\u4ee5\u53ca\u5176\u4ed6\u4e00\u4e9b\u53c2\u6570\u3002 sudo lvs -o name,cache_policy,cache_settings,chunk_size,cache_used_blocks,cache_dirty_blocks /dev/mapper/lug-repo \u6bcf\u6b21 unclean shutdown \u4e4b\u540e\uff0ccache \u4e2d\u6240\u6709\u5757\u90fd\u4f1a\u88ab\u6807\u8bb0\u4e3a dirty\u3002\u5c3d\u7ba1\u4e0d\u592a\u53ef\u80fd\u963b\u585e\u7cfb\u7edf\u542f\u52a8\uff0c\u8fd9\u53ef\u80fd\u4f1a\u7ed9 HDD \u4e00\u5b9a\u7684\u538b\u529b\u3002 \u6269\u5927 lug/repo \u7684\u5927\u5c0f\u524d\u9700\u8981 uncache\uff0c\u4e14 uncache \u7684\u524d\u63d0\u6761\u4ef6\u662f\u6ca1\u6709\u810f\u5757\u3002 \u5751 4 \u4fee\u6539 migration_threshold \u7b49\u8bbe\u7f6e\u4f1a\u5bfc\u81f4\u76ee\u524d\u7248\u672c\u7684 GRUB \u65e0\u6cd5\u6b63\u786e\u8bc6\u522b LVM \u5143\u6570\u636e\u3002 \u4e34\u65f6\u4fee\u590d\u7248\u672c\uff1a https://github.com/taoky/grub/releases/tag/2.02%2Bdfsg1-20%2Bdeb10u4taoky3_amd64 \u3002\u76ee\u524d\u5df2\u90e8\u7f72\uff0c\u4e14\u8bbe\u7f6e\u4e86 apt hold \u3002 \u6240\u4ee5\u63a5\u4e0b\u6765\u8981\u5408\u5e76 VG\uff0c\u7136\u540e\u624d\u80fd\u4e3a\u4ed3\u5e93\u5377\u52a0\u4e0a\u7f13\u5b58\u3002 lvchange -a n ssd/docker vgmerge lug ssd lvconvert --type cache --cachepool lug/mcache lug/repo \u63a5\u4e0b\u6765\u6302\u4e0a Docker \u5377\uff08\u6ce8\u610f VG \u540d\u5df2\u7ecf\u4ece ssd \u53d8\u6210\u4e86 lug\uff09\uff1a lvchange -a y lug/docker mount /dev/lug/docker /var/lib/docker fstab \u00b6 \u5206\u533a\u5b8c\u6bd5\u540e\u7ed9 /etc/fstab \u8865\u4e0a\u76f8\u5173\u7684\u5185\u5bb9\u5e76\u6302\u8f7d\uff1a /dev/mapper/lug-home /home ext4 defaults 0 2 /dev/mapper/lug-docker /var/lib/docker ext4 defaults 0 2 /dev/mapper/lug-repo /srv xfs defaults,pqnoenforce 0 2 /dev/mapper/lug-log /var/log ext4 defaults 0 2 \uff08\u8fd9\u4e2a log \u5206\u533a\u524d\u9762\u6ca1\u63d0\uff0c\u53cd\u6b63\u50cf\u6a21\u50cf\u6837\u77e5\u9053\u5c31\u884c\u4e86\uff09","title":"Volumes"},{"location":"services/mirrors/4/volumes/#volumes-on-mirrors4","text":"\u4ecb\u7ecd\u9875 \u8bb2\u8fc7\u4e86\uff0c\u63a7\u5236\u5668\u7684\u5751\u5bfc\u81f4\u4e0d\u80fd\u76f4\u63a5\u628a 12 \u5757\u786c\u76d8\u7ec4\u6210\u4e00\u4e2a\u903b\u8f91\u78c1\u76d8\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u4e0a\u5c42\u4f7f\u7528 LVM \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002","title":"Volumes on mirrors4"},{"location":"services/mirrors/4/volumes/#_1","text":"\u6ce8\u610f \u8fd9\u91cc\u7ed9\u51fa\u7684\u547d\u4ee4\u4ec5\u7528\u4e8e\u5c55\u793a\u5206\u533a\uff08\u5377\uff09\u7684\u521b\u5efa\u65b9\u5f0f\uff0c\u9664\u975e\u5b8c\u5168\u91cd\u88c5\uff0c\u5426\u5219 \u4e0d\u5e94\u8be5\u6267\u884c \u5176\u4e2d\u4efb\u4f55\u4e00\u6761\u6709\u526f\u4f5c\u7528\u7684\u547d\u4ee4\u3002 \u64cd\u4f5c\u7cfb\u7edf\u770b\u5230\u4e09\u4e2a\u786c\u76d8\uff1a\u4e24\u4e2a RAID6 \u5927\u76d8\uff0840 TB / 36.4 TiB\uff09\u548c\u4e00\u4e2a SSD\uff082 TB / 1.86 TiB\uff09\u3002\u8bbe\u4e24\u4e2a\u5927\u76d8\u4e3a /dev/sda \u548c /dev/sdb\uff0cSSD \u4e3a /dev/sdc\u3002 \u7531\u4e8e\u542f\u52a8\u5206\u533a\u4e0d\u80fd\u653e\u5728 LVM \u4e0a\uff0c\u56e0\u6b64\u4ee5\u5982\u4e0b\u65b9\u5f0f\u521b\u5efa\u5206\u533a\uff1a root@mirrors4:~# fdisk -l /dev/sda Disk /dev/sda: 36.4 TiB, 40001177911296 bytes, 78127300608 sectors Disk model: MR9361-8i Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 4096 bytes I/O size (minimum/optimal): 262144 bytes / 262144 bytes Disklabel type: gpt Disk identifier: AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA Device Start End Sectors Size Type /dev/sda1 2048 4095 2048 1M BIOS boot /dev/sda2 4096 1052671 1048576 512M EFI System /dev/sda3 1052672 78127300574 78126247903 36.4T Linux LVM sdb \u7684\u53c2\u6570\u5b8c\u5168\u4e00\u6837\u3002 \u5b9e\u9645\u7684\u542f\u52a8\u5206\u533a\u4e3a /dev/sda2\uff0c\u5c06\u5176 dd \u5230 /dev/sdb2 \u505a\u5907\u4efd\u3002 \u7136\u540e\u662f SSD \u7684\u5206\u533a\uff1a Disk /dev/sdc: 1.8 TiB, 1919816826880 bytes, 3749642240 sectors Disk model: MR9361-8i Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 4096 bytes I/O size (minimum/optimal): 65536 bytes / 65536 bytes Disklabel type: gpt Disk identifier: AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA Device Start End Sectors Size Type /dev/sdc1 2048 3749642206 3749640159 1.8T Linux LVM","title":"\u78c1\u76d8\u5206\u533a"},{"location":"services/mirrors/4/volumes/#lvm","text":"\u628a sda3 \u548c sdb3 \u90fd\u653e\u8fdb LVM\uff1a # fdisk \u5206\u533a\u5b8c\u6bd5\uff0cw \u5199\u5165\u9000\u51fa pvcreate /dev/sda3 /dev/sdb3 vgcreate lug /dev/sda3 /dev/sdb3 \u521b\u5efa rootfs\uff0c\u8fd9\u91cc\u4ee5 RAID1 \u7684\u65b9\u5f0f\uff08 --type mirror \u6216 --type raid1 \uff09\u521b\u5efa\u8fd9\u4e2a\u5206\u533a\uff0c\u8fd9\u6837\u5373\u4f7f sda / sdb \u574f\u6389\u4e00\u6574\u7ec4\u4e4b\u540e\u8fd8\u6709 rootfs \u53ef\u4ee5\u7528\u3002 lvcreate -n root -L 32G --type mirror -m 2 lug mkfs.ext4 /dev/lug/root \u521b\u5efa home\uff0c\u8fd9\u91cc\u53cd\u6b63\u4e0d\u6015\u574f\uff0c\u7528 RAID0\uff08 --type striped \u6216 --type raid0 \uff09\u3002 lvcreate -n root -L 64G --type striped -i 2 lug mkfs.ext4 /dev/lug/home \u521b\u5efa\u653e\u955c\u50cf\u7684\u5206\u533a\uff0c\u8fd9\u6b21\u8981\u7528 xfs XFS \u4e0d\u652f\u6301\u7f29\u5c0f \u56e0\u6b64\u6211\u4eec\u5728\u521d\u88c5\u65f6\u9009\u62e9\u4e3a\u5176\u5206\u914d 48 TiB \u7684\u7a7a\u95f4\uff0c\u800c\u4e0d\u662f VG lug \u7684\u5269\u4f59\u5168\u90e8\u2014\u2014\u8fd9\u6837\u65b9\u4fbf\u4ee5\u540e\u7ef4\u62a4 lvcreate -n repo -L 48T --type striped -i 2 lug mkfs.xfs /dev/lug/repo \u5176\u5b9e\u672c\u6765\u8981\u8c03\u4e00\u4e0b\u53c2\u7684\uff0c\u4e0d\u8fc7\u6839\u636e Arch Wiki \uff0c mkfs.xfs \u7684\u9ed8\u8ba4\u53c2\u6570\u5c31\u662f\u6700\u4f18\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u51b3\u5b9a\u4e0d\u52a8\u4e86\u3002","title":"LVM"},{"location":"services/mirrors/4/volumes/#ssd","text":"SSD \u7684\u7528\u9014\u4e3a\u5b58\u653e Docker \u6570\u636e /var/lib/docker \uff088 GiB \u5c31\u591f\u4e86\uff0c\u4f46\u662f overlay2 \u7684\u540e\u7aef\u7528 ext4 \u66f4\u597d\uff09\uff0c\u5269\u4e0b\u7528\u4f5c lvmcache(7)\u3002 iBug \u5907\u6ce8 \u867d\u7136\u4f3c\u4e4e\u6ca1\u6709\u8fd9\u6837\u505a\uff08\u5148\u521b\u5efa\u5355\u72ec\u7684 VG \u518d\u5408\u5e76\uff09\u7684\u5fc5\u8981\uff0c\u4f46\u662f\u8fd9\u4e48\u505a\u4e00\u5b9a\u4e0d\u4f1a\u51fa\u9519\uff0c\u5c31\u8fd9\u6837\u5427\u3002 \u5728 SSD \u4e0a\u65b0\u5efa\u4e00\u4e2a VG\uff1a # fdisk \u521b\u5efa\u552f\u4e00\u4e00\u4e2a\u5206\u533a sdc1\uff0c\u4fdd\u5b58\u9000\u51fa pvcreate /dev/sdc1 vgcreate ssd /dev/sdc1 \u521b\u5efa Docker \u6570\u636e\u76d8\uff1a lvcreate -L 8G -n docker ssd mkfs.ext4 /dev/ssd/docker \u91cd\u8981 \uff1a\u521b\u5efa\u7f13\u5b58\u76d8\u548c\u7f13\u5b58\u5143\u6570\u636e\u76d8\u3002\u6839\u636e Red Hat Documentation \u7684\u4ecb\u7ecd\uff0c\u5148\u624b\u52a8\u521b\u5efa\u6570\u636e\u76d8\u548c\u5143\u6570\u636e\u76d8\uff0c\u7136\u540e\u5c06\u4ed6\u4eec\u5408\u5e76\u4e3a\u4e00\u4e2a cache pool\u3002\u5927\u5c0f\u65b9\u9762\uff0c\u6587\u7ae0\u7684\u53c2\u8003\u662f 2G data \u2194 12M meta\uff0c\u8fd9\u91cc\u6211\u4eec\u6709\u63a5\u8fd1 2 TB \u7684 data\uff0c\u5c31\u5206\u914d 16 GB \u4f5c\u4e3a meta \u5427\u3002 lvcreate -L 16G -n mcache_meta ssd lvcreate -l 100 %FREE -n mcache ssd lvreduce -l -2048 ssd/mcache lvconvert --type cache-pool --poolmetadata ssd/mcache_meta --cachemode writethrough -c 1M --config allocation/cache_pool_max_chunks = 2000000 ssd/mcache \u8fd9\u91cc\u7684\u7f13\u5b58\u6a21\u5f0f\u91c7\u7528 passthrough\uff0c\u5373\u5199\u5165\u52a8\u4f5c\u7ed5\u8fc7\u7f13\u5b58\u76f4\u63a5\u5199\u56de\u539f\u8bbe\u5907\uff08\u5f53\u7136\u5566\uff0c\u5199\u5165\u90fd\u662f\u7531\u4ece\u4e0a\u6e38\u540c\u6b65\u4ea7\u751f\u7684\uff09\uff0c\u53e6\u5916\u4e24\u79cd writeback \u548c writethrough \u90fd\u4f1a\u5199\u5165\u7f13\u5b58\uff0c\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u3002 passthrough \u6a21\u5f0f\u4e2d\uff0c\u8bfb\u5199\u90fd\u4f1a\u7ed5\u8fc7 cache\uff0c\u552f\u4e00\u7684\u4f5c\u7528\u662f write hit \u4f1a\u4f7f\u5f97 cache \u5bf9\u5e94\u7684\u5757\u5931\u6548\u3002 \u8fd9\u91cc\u4f7f\u7528 writeback \u6a21\u5f0f\uff0c\u56e0\u4e3a\u4ed3\u5e93\u6570\u636e\u6ca1\u4e86\u8fd8\u80fd\u518d\u540c\u6b65\uff0c\u4f7f\u7528 writeback \u63d0\u5347\u6027\u80fd\u66f4\u5408\u9002\u3002 \u51fa\u4e8e\u7a33\u5b9a\u8003\u8651\uff0c\u4f7f\u7528 writethrough \u6a21\u5f0f\u3002\uff08\u6211\u4eec\u7684 Cache \u592a\u5927\u4e86\uff0cwriteback \u53ef\u80fd\u4f1a\u5f04\u574f\u4e0d\u5c11\u4e1c\u897f\uff0c\u5982\u679c metadata \u574f\u4e86\u5c31\u66f4\u9ebb\u70e6\u4e86\uff09 \u5751 \u76f4\u63a5\u4f7f\u7528 lvconvert(8) \u5c1d\u8bd5\u5408\u5e76\u4f1a\u5bfc\u81f4\u5410\u69fd\uff0c\u8fd9\u662f\u4e0a\u9762 lvreduce(8) \u7684\u539f\u56e0\u3002 Volume group \"ssd\" has insufficient free space (0 extents): 2048 required. iBug \u5907\u6ce8 LVM \u63a8\u8350\u7684\u662f\u4e00\u4e2a\u7f13\u5b58\u6c60\u91cc\u4e0d\u8d85\u8fc7 100 \u4e07\u4e2a chunk\uff08\u8fd9\u4e5f\u662f allocation/cache_pool_max_chunks \u7684\u9ed8\u8ba4\u503c\uff09\uff0c\u4f46\u662f\u8fd9\u6837\u6bcf\u4e2a chunk \u7684\u6700\u5c0f\u5927\u5c0f\u4e3a 1.84 MiB \u592a\u5927\u4e86\uff0c\u8003\u8651\u5230\u6211\u4eec\u6709\u8db3\u591f\u7684 CPU \u548c\u5185\u5b58\uff0c\u8fd9\u91cc\u5c31 \u94e4\u800c\u8d70\u9669 \u5c1d\u8bd5\u4e00\u4e0b\u8f83\u5927\u7684 chunk count\u3002 \u5751 2 \u7f13\u5b58\u76d8\uff08cache pool\uff09\u548c\u88ab\u7f13\u5b58\u7684\u5377\u5fc5\u987b\u5728\u540c\u4e00\u4e2a VG \u4e2d\u3002 \u5751 3 (taoky \u5907\u6ce8) LVM Cache \u7684\u5e95\u5c42\u662f\u5728\u5185\u6838\u5b9e\u73b0\u7684 dm-cache\u3002\u76ee\u524d\u5df2\u77e5\u7684\u5751\u5982\u4e0b\uff1a \u5f53\u51fa\u73b0 dirty blocks\uff08\u4e14 cache policy \u4e3a cleaner \u65f6\uff09\uff0c\u65e0\u6cd5\u6b63\u5e38 flush\u3002\u7f51\u7edc\u4e0a\u53ef\u4ee5\u627e\u5230\u7684\u8fd9\u4e2a bug \u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u589e\u5927 migration_threshold \u7684\u503c\uff08\u5728\u65b0\u7248\u672c LVM \u4e2d\uff0cmigration_threshold \u9ed8\u8ba4\u81f3\u5c11\u4f1a\u662f chunk size \u7684 8 \u500d\uff0c\u5728\u6211\u4eec\u7684\u914d\u7f6e\u4e0b\u5c31\u662f 16384 = 2048 * 8\u3002\u8fd9\u4e2a\u7248\u672c\u7684 LVM \u6682\u65f6\u4e0d\u5728 Buster \u4e2d\uff09\uff0c\u4f46\u662f\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u5355\u7eaf\u589e\u5927 migration_threshold \u6ca1\u6709\u4efb\u4f55\u6548\u679c\u3002Jiahao \u7ffb\u4e86\u4e00\u4e0b dm-cache \u7684\u6e90\u4ee3\u7801\uff0c\u53d1\u73b0 flush \u7684\u6761\u4ef6\u5728 https://elixir.bootlin.com/linux/latest/source/drivers/md/dm-cache-target.c#L1649 \uff0c\u53ea\u5728\u72b6\u6001\u4e3a IDLE \u65f6\u624d\u4f1a flush\u3002IDLE \u7684\u7b2c\u4e00\u4e2a\u6761\u4ef6\u9700\u8981 inflight io = 0\uff0c\u6bd4\u8f83\u82db\u523b\uff0c\u53ef\u80fd\u662f\u65e0\u6cd5\u6b63\u5e38 flush \u7684\u539f\u56e0\u3002 \u4e00\u4e2a\u626d\u66f2\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\uff1a\u5148\u628a migration_threshold \u8bbe\u7f6e\u5f97\u5f88\u5927\uff08\u8bbe\u5927\u5c0f\u4e3a x\uff09\uff0c\u7136\u540e\u9a6c\u4e0a\u7f29\u5c0f\uff0c\u8fd9\u6837\u5c31\u80fd\u628a x \u90a3\u4e48\u591a\u5927\u5c0f\u7684\u810f\u5757\u5f04\u6389\uff08\u539f\u7406\u6682\u65f6\u4e0d\u660e\uff0c\u9700\u8981\u8865\u5145\uff09\u3002\u57fa\u4e8e\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5199\u4e00\u4e2a\u811a\u672c\u6765\u505a flush \u7684\u5de5\u4f5c\uff1a # dirty hack sudo lvchange --cachepolicy cleaner lug/repo for i in ` seq 1 1500 ` ; do sudo lvchange --cachesettings migration_threshold = 2113536 lug/repo && sudo lvchange --cachesettings migration_threshold = 16384 && echo $i && sleep 15 ; done ; # \u9700\u8981\u786e\u8ba4\u6ca1\u6709\u810f\u5757\u3002\u5982\u679c\u8fd8\u6709\u7684\u8bdd\u7ee7\u7eed\u6267\u884c\uff08\u6b21\u6570\u8c03\u5c0f\u4e00\u4e9b\uff09 # \u5982\u679c\u662f\u4ece writeback \u5207\u6362\uff0c\u9700\u8981\u5148\u628a\u6a21\u5f0f\u5207\u5230 writethrough # \u7136\u540e\u518d\u4fee\u6539 cachepolicy \u5230 smq sudo lvchange --cachepolicy smq lug/repo \u5728\u6267\u884c\u65f6\uff0c\u53ef\u4ee5\u67e5\u770b\uff1a sudo dmsetup status lug-repo # \u5728 \"metadata2\" \u524d\u9762\u7684\u524d\u9762\u7684\u6570\u5b57\u5c31\u662f dirty block \u7684\u6570\u91cf # \u5982\u679c\u4e0d\u5728\u6267\u884c lvchange\uff08\u6ca1\u6709\u8fdb\u7a0b\u62a2\u5360\u4e86 LVM \u7684\u9501\uff09\uff0c\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u786e\u8ba4\u810f\u5757\u6570\u91cf\u4ee5\u53ca\u5176\u4ed6\u4e00\u4e9b\u53c2\u6570\u3002 sudo lvs -o name,cache_policy,cache_settings,chunk_size,cache_used_blocks,cache_dirty_blocks /dev/mapper/lug-repo \u6bcf\u6b21 unclean shutdown \u4e4b\u540e\uff0ccache \u4e2d\u6240\u6709\u5757\u90fd\u4f1a\u88ab\u6807\u8bb0\u4e3a dirty\u3002\u5c3d\u7ba1\u4e0d\u592a\u53ef\u80fd\u963b\u585e\u7cfb\u7edf\u542f\u52a8\uff0c\u8fd9\u53ef\u80fd\u4f1a\u7ed9 HDD \u4e00\u5b9a\u7684\u538b\u529b\u3002 \u6269\u5927 lug/repo \u7684\u5927\u5c0f\u524d\u9700\u8981 uncache\uff0c\u4e14 uncache \u7684\u524d\u63d0\u6761\u4ef6\u662f\u6ca1\u6709\u810f\u5757\u3002 \u5751 4 \u4fee\u6539 migration_threshold \u7b49\u8bbe\u7f6e\u4f1a\u5bfc\u81f4\u76ee\u524d\u7248\u672c\u7684 GRUB \u65e0\u6cd5\u6b63\u786e\u8bc6\u522b LVM \u5143\u6570\u636e\u3002 \u4e34\u65f6\u4fee\u590d\u7248\u672c\uff1a https://github.com/taoky/grub/releases/tag/2.02%2Bdfsg1-20%2Bdeb10u4taoky3_amd64 \u3002\u76ee\u524d\u5df2\u90e8\u7f72\uff0c\u4e14\u8bbe\u7f6e\u4e86 apt hold \u3002 \u6240\u4ee5\u63a5\u4e0b\u6765\u8981\u5408\u5e76 VG\uff0c\u7136\u540e\u624d\u80fd\u4e3a\u4ed3\u5e93\u5377\u52a0\u4e0a\u7f13\u5b58\u3002 lvchange -a n ssd/docker vgmerge lug ssd lvconvert --type cache --cachepool lug/mcache lug/repo \u63a5\u4e0b\u6765\u6302\u4e0a Docker \u5377\uff08\u6ce8\u610f VG \u540d\u5df2\u7ecf\u4ece ssd \u53d8\u6210\u4e86 lug\uff09\uff1a lvchange -a y lug/docker mount /dev/lug/docker /var/lib/docker","title":"SSD"},{"location":"services/mirrors/4/volumes/#fstab","text":"\u5206\u533a\u5b8c\u6bd5\u540e\u7ed9 /etc/fstab \u8865\u4e0a\u76f8\u5173\u7684\u5185\u5bb9\u5e76\u6302\u8f7d\uff1a /dev/mapper/lug-home /home ext4 defaults 0 2 /dev/mapper/lug-docker /var/lib/docker ext4 defaults 0 2 /dev/mapper/lug-repo /srv xfs defaults,pqnoenforce 0 2 /dev/mapper/lug-log /var/log ext4 defaults 0 2 \uff08\u8fd9\u4e2a log \u5206\u533a\u524d\u9762\u6ca1\u63d0\uff0c\u53cd\u6b63\u50cf\u6a21\u50cf\u6837\u77e5\u9053\u5c31\u884c\u4e86\uff09","title":"fstab"},{"location":"services/mirrors/4/networking/","text":"Networking on mirrors4 \u00b6 \u51fa\u4e8e\u597d\u7528\u7684\u8003\u8651 \uff0cmirrors4 \u4e0a\u7684\u7f51\u7edc\u4f7f\u7528 systemd-networkd \u914d\u7f6e\u3002\u4f5c\u4e3a\u5165\u95e8\uff0c\u4e0b\u9762\u662f\u4e24\u4e2a\u53c2\u8003\u94fe\u63a5\uff1a Systemd-networkd - Arch Wiki SystemdNetworkd - Debian Wiki Debian \u9ed8\u8ba4\u7528\u7684\u662f ifupdown\uff0c\u628a\u5b83\u76f4\u63a5\u5378\u6389\u5c31\u884c\u4e86\u3002\u5168\u90e8\u914d\u7f6e\u5b8c\u6bd5\u4e4b\u540e\u9700\u8981 systemctl enable systemd-networkd.service \u5e76\u4e14 start \u4e00\u4e0b\uff08\u6216\u8005\u76f4\u63a5\u91cd\u542f\uff09\u3002 /etc/systemd/network \u76ee\u5f55\u4e0b\u6709\u4e2a Git \u4ed3\u5e93\uff0c\u65b9\u4fbf\u4fdd\u5b58\u4e0e\u6062\u590d Bond \u00b6 Bond \u7528\u4e8e\u5c06\u591a\u4e2a\u7f51\u5361\u805a\u5408\u5f53\u4f5c\u4e00\u4e2a\u4f7f\u7528\u3002 \u5b50\u7f51\u5361 \u00b6 \u5411 /etc/systemd/network/ens41f0.network \u5199\u5165\u5982\u4e0b\u5185\u5bb9\uff1a [Match] Name = ens41f0 [Network] Bond = bond1 [Link] RequiredForOnline = no \u5373\u53ef\u5c06\u5176\u8bbe\u7f6e\u4e3a bond1 \u7684\u4e00\u4e2a\u5b50\u7f51\u5361\u3002\u7528\u540c\u6837\u65b9\u5f0f\u628a ens41f1 \u4e5f\u8bbe\u4e3a\u5b50\u7f51\u5361\u3002 \u4e00\u4e2a\u5c0f\u5751 systemd-networkd \u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684 bond0 \u805a\u5408\u7f51\u5361\uff0c\u6a21\u5f0f\u6c38\u8fdc\u662f round-robin\uff0c\u800c\u4e14\u5c1d\u8bd5\u8bbe\u7f6e\u8fd9\u4e2a\u7f51\u5361\u5f88\u5bb9\u6613\u51fa\u95ee\u9898\uff0c\u6240\u4ee5\u6211\u4eec\u907f\u5f00\u8fd9\u4e2a\u540d\u5b57\uff0c\u7528 bond1\u3002 bond1 \u805a\u5408\u7f51\u5361 \u00b6 \u5199\u5165 /etc/systemd/network/bond1.netdev \uff1a [NetDev] Name = bond1 Kind = bond [Bond] Mode = balance-tlb MIIMonitorSec = 1 \u5173\u4e8e bond \u6a21\u5f0f\uff08 balance-tlb vs balance-alb \uff09\uff0c\u53c2\u8003 \u8fd9\u4e2a Server Fault \u4e0a\u7684\u56de\u7b54 \u3002 \u7136\u540e\u521b\u5efa VLAN\uff0c\u5199\u5165 /etc/systemd/network/bond1.network \uff1a [Match] Name = bond1 [Network] DHCP = no VLAN = cernet VLAN = telecom VLAN = mobile VLAN = unicom VLAN \u00b6 NIC \u673a\u623f\u6709 4 \u4e2a VLAN\uff0c\u5206\u522b\u662f ID 95\uff0c\u6559\u80b2\u7f51 202.38.95.0/25 ID 10\uff0c\u7535\u4fe1 202.141.160.0/25 ID 400\uff0c\u79fb\u52a8 202.141.176.0/25 ID 11\uff0c\u8054\u901a\uff08IP \u6bb5\u6211\u5fd8\u4e86\uff09 \u6ce8\u610f\u8fd9\u51e0\u4e2a\u7f51\u6bb5\u90fd\u6ca1\u6709 DHCP\uff0c\u53ea\u6709\u6559\u80b2\u7f51 VLAN \u6709 IPv6 RA\u3002 \u4e0b\u9762\u4ee5\u6559\u80b2\u7f51 VLAN \u4e3a\u4f8b\u3002 \u56e0\u4e3a VLAN \u5728\u7269\u7406\u4e0a\u5c5e\u4e8e\u4e00\u4e2a\u7f51\u5361\uff0c\u56e0\u6b64\u5411\u5bf9\u5e94\u7f51\u5361\u7684 .network \u6587\u4ef6\u7684 [Network] \u6bb5\u8ffd\u52a0\u4e00\u884c\uff08\u89c1\u4e0a\u9762\u4e00\u8282 bond1.network \u6587\u4ef6\uff09\uff1a VLAN = cernet \u521b\u5efa VLAN \u754c\u9762\uff0c\u521b\u5efa cernet.netdev \u5e76\u5199\u5165 [NetDev] Name = cernet Kind = vlan [VLAN] Id = 95 \u7136\u540e\u5c31\u53ef\u4ee5\u6307\u5b9a IP \u5730\u5740\u7b49\u5177\u4f53\u4fe1\u606f\u4e86\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u5b57\u76f8\u540c\uff0c\u540e\u7f00\u6362\u6210 .network \u7684\u6587\u4ef6\u5e76\u5199\u5165 [Match] Name = cernet [Network] DHCP = no Address = 202.38.95.110/25 #Gateway=202.38.95.126 Address = 2001:da8:d800:95::110/64 #Gateway=2001:da8:d800:95::1 IPv6AcceptRA = false \u4fdd\u5b58\u540e\u91cd\u542f systemd-networkd.service \u5c31\u53ef\u4ee5\u770b\u5230\u6548\u679c\u4e86\u3002 \u4e3a\u4ec0\u4e48 Gateway \u88ab\u6ce8\u91ca\u6389\u4e86 \u6839\u636e systemd \u5b98\u65b9\u6587\u6863 \uff0c\u5728 [Network] \u4e00\u8282\u51fa\u73b0\u7684 Gateway= \u7b49\u4ef7\u4e8e\u4e00\u4e2a\u5355\u72ec\u7684\u3001\u4ec5\u5305\u542b\u4e00\u884c Gateway= \u7684 [Route] \u8282\u3002\u7531\u4e8e\u6211\u4eec\u9700\u8981\u6df1\u5ea6 \u81ea\u5b9a\u4e49\u8def\u7531 \uff0c\u8fd9\u91cc\u4e0d\u65b9\u4fbf\u91c7\u7528\u8fd9\u4e2a\u8fc7\u4e8e\u7b80\u6d01\u7684\u8bbe\u5b9a\uff08\u4f8b\u5982\u5404\u79cd\u9ed8\u8ba4\u503c Table=main \u7b49\uff09\u3002","title":"Interfaces"},{"location":"services/mirrors/4/networking/#networking-on-mirrors4","text":"\u51fa\u4e8e\u597d\u7528\u7684\u8003\u8651 \uff0cmirrors4 \u4e0a\u7684\u7f51\u7edc\u4f7f\u7528 systemd-networkd \u914d\u7f6e\u3002\u4f5c\u4e3a\u5165\u95e8\uff0c\u4e0b\u9762\u662f\u4e24\u4e2a\u53c2\u8003\u94fe\u63a5\uff1a Systemd-networkd - Arch Wiki SystemdNetworkd - Debian Wiki Debian \u9ed8\u8ba4\u7528\u7684\u662f ifupdown\uff0c\u628a\u5b83\u76f4\u63a5\u5378\u6389\u5c31\u884c\u4e86\u3002\u5168\u90e8\u914d\u7f6e\u5b8c\u6bd5\u4e4b\u540e\u9700\u8981 systemctl enable systemd-networkd.service \u5e76\u4e14 start \u4e00\u4e0b\uff08\u6216\u8005\u76f4\u63a5\u91cd\u542f\uff09\u3002 /etc/systemd/network \u76ee\u5f55\u4e0b\u6709\u4e2a Git \u4ed3\u5e93\uff0c\u65b9\u4fbf\u4fdd\u5b58\u4e0e\u6062\u590d","title":"Networking on mirrors4"},{"location":"services/mirrors/4/networking/#bond","text":"Bond \u7528\u4e8e\u5c06\u591a\u4e2a\u7f51\u5361\u805a\u5408\u5f53\u4f5c\u4e00\u4e2a\u4f7f\u7528\u3002","title":"Bond"},{"location":"services/mirrors/4/networking/#_1","text":"\u5411 /etc/systemd/network/ens41f0.network \u5199\u5165\u5982\u4e0b\u5185\u5bb9\uff1a [Match] Name = ens41f0 [Network] Bond = bond1 [Link] RequiredForOnline = no \u5373\u53ef\u5c06\u5176\u8bbe\u7f6e\u4e3a bond1 \u7684\u4e00\u4e2a\u5b50\u7f51\u5361\u3002\u7528\u540c\u6837\u65b9\u5f0f\u628a ens41f1 \u4e5f\u8bbe\u4e3a\u5b50\u7f51\u5361\u3002 \u4e00\u4e2a\u5c0f\u5751 systemd-networkd \u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684 bond0 \u805a\u5408\u7f51\u5361\uff0c\u6a21\u5f0f\u6c38\u8fdc\u662f round-robin\uff0c\u800c\u4e14\u5c1d\u8bd5\u8bbe\u7f6e\u8fd9\u4e2a\u7f51\u5361\u5f88\u5bb9\u6613\u51fa\u95ee\u9898\uff0c\u6240\u4ee5\u6211\u4eec\u907f\u5f00\u8fd9\u4e2a\u540d\u5b57\uff0c\u7528 bond1\u3002","title":"\u5b50\u7f51\u5361"},{"location":"services/mirrors/4/networking/#bond1","text":"\u5199\u5165 /etc/systemd/network/bond1.netdev \uff1a [NetDev] Name = bond1 Kind = bond [Bond] Mode = balance-tlb MIIMonitorSec = 1 \u5173\u4e8e bond \u6a21\u5f0f\uff08 balance-tlb vs balance-alb \uff09\uff0c\u53c2\u8003 \u8fd9\u4e2a Server Fault \u4e0a\u7684\u56de\u7b54 \u3002 \u7136\u540e\u521b\u5efa VLAN\uff0c\u5199\u5165 /etc/systemd/network/bond1.network \uff1a [Match] Name = bond1 [Network] DHCP = no VLAN = cernet VLAN = telecom VLAN = mobile VLAN = unicom","title":"bond1 \u805a\u5408\u7f51\u5361"},{"location":"services/mirrors/4/networking/#vlan","text":"NIC \u673a\u623f\u6709 4 \u4e2a VLAN\uff0c\u5206\u522b\u662f ID 95\uff0c\u6559\u80b2\u7f51 202.38.95.0/25 ID 10\uff0c\u7535\u4fe1 202.141.160.0/25 ID 400\uff0c\u79fb\u52a8 202.141.176.0/25 ID 11\uff0c\u8054\u901a\uff08IP \u6bb5\u6211\u5fd8\u4e86\uff09 \u6ce8\u610f\u8fd9\u51e0\u4e2a\u7f51\u6bb5\u90fd\u6ca1\u6709 DHCP\uff0c\u53ea\u6709\u6559\u80b2\u7f51 VLAN \u6709 IPv6 RA\u3002 \u4e0b\u9762\u4ee5\u6559\u80b2\u7f51 VLAN \u4e3a\u4f8b\u3002 \u56e0\u4e3a VLAN \u5728\u7269\u7406\u4e0a\u5c5e\u4e8e\u4e00\u4e2a\u7f51\u5361\uff0c\u56e0\u6b64\u5411\u5bf9\u5e94\u7f51\u5361\u7684 .network \u6587\u4ef6\u7684 [Network] \u6bb5\u8ffd\u52a0\u4e00\u884c\uff08\u89c1\u4e0a\u9762\u4e00\u8282 bond1.network \u6587\u4ef6\uff09\uff1a VLAN = cernet \u521b\u5efa VLAN \u754c\u9762\uff0c\u521b\u5efa cernet.netdev \u5e76\u5199\u5165 [NetDev] Name = cernet Kind = vlan [VLAN] Id = 95 \u7136\u540e\u5c31\u53ef\u4ee5\u6307\u5b9a IP \u5730\u5740\u7b49\u5177\u4f53\u4fe1\u606f\u4e86\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u5b57\u76f8\u540c\uff0c\u540e\u7f00\u6362\u6210 .network \u7684\u6587\u4ef6\u5e76\u5199\u5165 [Match] Name = cernet [Network] DHCP = no Address = 202.38.95.110/25 #Gateway=202.38.95.126 Address = 2001:da8:d800:95::110/64 #Gateway=2001:da8:d800:95::1 IPv6AcceptRA = false \u4fdd\u5b58\u540e\u91cd\u542f systemd-networkd.service \u5c31\u53ef\u4ee5\u770b\u5230\u6548\u679c\u4e86\u3002 \u4e3a\u4ec0\u4e48 Gateway \u88ab\u6ce8\u91ca\u6389\u4e86 \u6839\u636e systemd \u5b98\u65b9\u6587\u6863 \uff0c\u5728 [Network] \u4e00\u8282\u51fa\u73b0\u7684 Gateway= \u7b49\u4ef7\u4e8e\u4e00\u4e2a\u5355\u72ec\u7684\u3001\u4ec5\u5305\u542b\u4e00\u884c Gateway= \u7684 [Route] \u8282\u3002\u7531\u4e8e\u6211\u4eec\u9700\u8981\u6df1\u5ea6 \u81ea\u5b9a\u4e49\u8def\u7531 \uff0c\u8fd9\u91cc\u4e0d\u65b9\u4fbf\u91c7\u7528\u8fd9\u4e2a\u8fc7\u4e8e\u7b80\u6d01\u7684\u8bbe\u5b9a\uff08\u4f8b\u5982\u5404\u79cd\u9ed8\u8ba4\u503c Table=main \u7b49\uff09\u3002","title":"VLAN"},{"location":"services/mirrors/4/networking/route/","text":"Routing on mirrors4 \u00b6 \u7531\u4e8e mirrors4 \u6ca1\u6709\u4f7f\u7528 ifupdown \u4f5c\u4e3a\u7f51\u7edc\u7ba1\u7406\u7cfb\u7edf\uff0c\u800c\u662f\u91c7\u7528 systemd-networkd\uff0c\u56e0\u6b64\u6211\u4eec\u6ca1\u6709 pre-up , up , down , post-down \u7b49\u8fd0\u884c\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u6240\u4ee5 mirrors2 \u4e0a\u4f7f\u7528\u7684\u90a3\u5957\u811a\u672c\uff08 ip-route.sh \u7b49\uff09\u65e0\u6cd5\u76f4\u63a5\u5728 mirrors4 \u4e0a\u7ee7\u7eed\u4f7f\u7528\u3002 \u597d\u5728\u6211\u4eec\u4f7f\u7528 up \u7b49\u8fd0\u884c\u547d\u4ee4\u53ea\u662f\u4e3a\u4e86\u914d\u7f6e\u8def\u7531\uff0c\u56e0\u6b64\u6362\u4e86\u4e2a\u529e\u6cd5\uff0c\u6574\u4e86\u4e2a\u65b0\u811a\u672c\u628a IP \u5730\u5740\u5217\u8868\uff08\u6765\u81ea gaoyifan/china-operator-ip \uff09\u8f6c\u6362\u6210 networkd \u6240\u4f7f\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f\u3002\u4ee3\u7801\u4e0d\u957f\uff1a #!/bin/bash ROOT_IP_LIST = /usr/local/network_config/iplist ROOT_RT = /run/systemd/network gen_route () { IPLIST = \" $ROOT_IP_LIST / $1 \" GW = \" $2 \" DEV = \" $3 \" # Convert table to number TABLENAME = \" $4 \" TABLE = \" $( awk 'substr($0, 1, 1) != \"#\" && $2 == \"' \" $TABLENAME \" '\" { print $1 }' /etc/iproute2/rt_tables | head -1 ) \" PRIORITY = \" $5 \" F = \" $ROOT_RT / $DEV .network.d\" mkdir -p \" $F \" F = \" $F /route- ${ TABLENAME ,, } .conf\" echo -e \"[RoutingPolicyRule]\\nTable= $TABLE \\nPriority= $PRIORITY \\n\" > \" $F \" awk '{ print \"[Route]\\nDestination=\" $1 \"\\nGateway=' \" $GW \" '\\nTable=' \" $TABLE \" '\\n\" }' \" $IPLIST \" >> \" $F \" } gen_route ustcnet.txt 202 .38.95.126 cernet Ustcnet 5 gen_route cernet.txt 202 .38.95.126 cernet Cernet 6 gen_route telecom.txt 202 .141.160.126 telecom Telecom 6 gen_route mobile.txt 202 .141.176.126 mobile Mobile 6 gen_route unicom.txt 218 .104.71.161 unicom Unicom 6 gen_route china.txt 218 .104.71.161 unicom China 7 \u8fd9\u4e2a\u4ed3\u5e93\u91cc\u6709\u5f88\u591a\u4e2a txt \u6587\u4ef6\uff0c\u6bcf\u4e2a\u6587\u4ef6\u5bf9\u5e94\u4e00\u4e2a ISP \u7684\u5730\u5740\u5217\u8868\uff0c\u6bcf\u884c\u4e00\u4e2a CIDR\u3002\u811a\u672c\u4e2d\u7684 gen_route \u51fd\u6570\u6839\u636e\u53c2\u6570\u8bfb\u53d6\u6587\u4ef6\uff0c\u5e76\u8f6c\u6362\u6210\u4e0b\u9762\u8fd9\u6837\u7684\u683c\u5f0f\uff1a [Route] Destination = 1.0.0.0/24 Gateway = 202.38.95.126 Table = 1011 \u8fd9\u6837\u4e00\u4e2a [Route] \u8282\u5bf9\u5e94 \u4e00\u6761 \u8def\u7531\u89c4\u5219\uff0c\u6574\u4e2a txt \u7684\u8f6c\u6362\u7ed3\u679c\u8f93\u51fa\u5230 /run/systemd/network/cernet.network.d/route-example.conf \u3002\u5176\u4e2d cernet.network.d/*.conf \u7528\u4e8e\u5411\u73b0\u6709\u7684\u914d\u7f6e\u4e2d\u6dfb\u52a0\u5185\u5bb9\uff08\u4e0e systemd service \u7c7b\u4f3c\uff09\uff0c\u800c /run \u76ee\u5f55\uff08\u6309\u7406\u6765\u8bf4\uff09\u91cd\u542f\u4f1a\u6e05\u7a7a\uff0c\u9002\u5408\u653e\u7f6e\u8fd9\u4e9b\u7528\u4e8e\u52a8\u6001\u751f\u6210\u7684\u5185\u5bb9\u3002\u53e6\u5916\u7531\u4e8e\u8def\u7531\u89c4\u5219\uff08 ip rule \uff09\u4e5f\u7531 networkd \u7ba1\u7406\u548c\u751f\u6210\u4e86\uff0c\u56e0\u6b64\u6bcf\u4e2a route-xxx.conf \u5f00\u5934\u4f1a\u5305\u542b\u4e00\u4e2a [RoutingPolicyRule] \u8282\u7528\u4e8e\u751f\u6210\u8def\u7531\u8868\u5bf9\u5e94\u7684\u8def\u7531\u89c4\u5219\u3002 \u6ce8\u610f\u8def\u7531\u8868\u662f\u7528\u540d\u79f0\u6307\u5b9a\u7684\uff0c\u4ece /etc/iproute2/rt_tables \u4e2d\u67e5\u51fa\u5bf9\u5e94\u7684\u6570\u5b57 ID\u3002\u8fd9\u4e2a\u6587\u4ef6\u672c\u6765\u4e5f\u662f ip \u547d\u4ee4\u6240\u4f7f\u7528\u7684\uff08\u6ce8\u610f\u5b83\u7684\u76ee\u5f55\u540d\u53eb iproute2 \uff09\u3002 \u6700\u540e\u7ed9\u8fd9\u4e2a\u811a\u672c\u914d\u4e2a service\uff0c\u8ba9\u5b83\u5728 networkd \u4e4b\u524d\u8fd0\u884c\uff1a [Unit] Description = Generate routes for systemd-networkd Before = systemd-networkd.service [Service] Type = oneshot ExecStart = /bin/bash /usr/local/network_config/route-all.sh ExecStart = -/usr/sbin/ip rule flush RemainAfterExit = true [Install] WantedBy = network.target systemd-networkd.service Wants = systemd-networkd.service \u8fd9\u4e2a\u6587\u4ef6\u5b58\u5230 /etc/systemd/system/route-all.service \uff0creload \u518d enable \u5c31\u53ef\u4ee5\u4e86\u3002 \u4e0d\u8981\u5c1d\u8bd5\u6539 systemd-networkd.service \u8fd9\u4e2a\u81ea\u5e26\u7684\u670d\u52a1\u6709\u4e00\u4e2a User=systemd-networkd \uff0c\u4f60\u65e2\u4e0d\u80fd ip rule \u4e5f\u4e0d\u80fd\u5199\u5165 /run/systemd \u7b49\uff0c\u4f1a\u5bfc\u81f4\u670d\u52a1\u70b8\u6389\uff0c\u7136\u540e\u7f51\u4e5f\u70b8\u4e86\u3002\u3002\u3002 Special routing \u00b6 \u90e8\u5206 IP \u9700\u8981\u914d\u7f6e\u7279\u6b8a\u8def\u7531\u89c4\u5219\u65f6\uff08\u800c\u4e0d\u662f\u4f7f\u7528\u9ed8\u8ba4\uff09\uff0c\u7f16\u8f91 /usr/local/network_config/special.yml \uff0c\u5176\u683c\u5f0f\u5982\u4e0b\uff1a routes : # Root key\uff0c\u4fdd\u7559 lugvpn : # /etc/systemd/network \u4e2d\u5bf9\u5e94\u7684 .network \u6587\u4ef6\u540d # \u4e0b\u9762\u662f\u4e00\u4e2a\u8def\u7531\u6587\u4ef6\u7684\u914d\u7f6e\uff0c\u4e00\u4e2a\u6587\u4ef6\u5171\u4eab\u4e00\u4e2a table \u548c gateway \u8bbe\u7f6e - name : route-special # \u5c06\u8981\u521b\u5efa\u7684 .conf \u6587\u4ef6\u540d\uff0c\u53ef\u4ee5\u968f\u610f table : Special # \u8def\u7531\u8868\uff0c\u5373 ip route add table \u540e\u9762\u7684\u53c2\u6570\uff0c\u6570\u5b57\u6216\u8868\u540d gateway : false # \u662f\u5426\u5305\u542b\u7f51\u5173\uff0c\u6216\u8005 ip route \u7684 via \u53c2\u6570 routes : # \u6240\u6709\u7684\u8def\u7531\u6761\u76ee - 1.2.3.4 - 5.6.7.8/28 - 2001:db8::2333/64 cernet : # \u66f4\u591a\u7684\u914d\u7f6e - ... \u4fee\u6539 special.yml \u4e4b\u540e\u91cd\u542f route-all.service \u3002\u8be5\u670d\u52a1\u4f1a\u81ea\u52a8\u5bfc\u81f4 systemd-networkd.service \u91cd\u542f\u5e76\u8f7d\u5165\u65b0\u7684\u8def\u7531\u914d\u7f6e\u4fe1\u606f\u3002 ??? special.rb \u5904\u7406\u811a\u672c\uff08\u653e\u5728\u8fd9\u5907\u4efd\uff09 ``` ruby #! / usr / bin / ruby require 'fileutils' require 'yaml' BASEDIR = '/run/systemd/network' RT_TABLES = '/etc/iproute2/rt_tables' rt_tables = Hash . new File . readlines ( RT_TABLES ). each do | l | next if l =~ /^ \\ s * # / id , name = l . split rt_tables [ name ] = id end data = YAML . load_file File . join ( __dir__ , 'special.yml' ) data [ 'routes' ] . each do | fn , setups | confdir = File . join ( BASEDIR , \"#{fn}.network.d\" ) FileUtils . mkdir_p confdir setups . each do | config | table = config [ 'table' ] gateway = config [ 'gateway' ] File . open File . join ( confdir , \"#{config['name']}.conf\" ), 'w' do | f | config [ 'routes' ] . each do | dst | t = \"[Route]\\nDestination=#{dst}\\n\" t += \"Table=#{rt_tables.fetch table, table}\\n\" if table t += \"Gateway=#{gateway}\\n\" if gateway f . write t + \"\\n\" end end end end ``` route-all.service \u6709\u5f88\u591a\u6ce8\u610f\u4e8b\u9879 \u4e3a\u4e86\u6e05\u7406\u5f00\u673a\u81ea\u52a8\u4ea7\u751f\u7684 32766 \u548c 32767 \u4e24\u6761\u8def\u7531\u89c4\u5219\uff0c route-all.service \u5305\u62ec\u6267\u884c ip rule flush \uff0c\u56e0\u6b64\u8be5\u670d\u52a1\u91cd\u542f\u4e4b\u540e\u5fc5\u987b\u7acb\u523b\u91cd\u542f systemd-networkd\u3002 \u76ee\u524d\u505a\u6cd5\u662f\u5728 route-all.service \u4e2d\u6dfb\u52a0 RequiredBy=systemd-networkd.service \u5236\u9020\u4f9d\u8d56\u5173\u7cfb\uff0c\u8ba9 systemd \u5b8c\u6210\u201c\u7275\u8fde\u91cd\u542f\u201d\u3002 \u5b8c\u6574 service \u6587\u4ef6\uff1a [Unit] Description = Generate routes for systemd-networkd Before = systemd-networkd.service [Service] Type = oneshot ExecStart = /bin/bash /usr/local/network_config/route-all.sh ExecStart = /usr/local/network_config/special.rb ExecStart = -/usr/sbin/ip rule flush RemainAfterExit = true [Install] WantedBy = network.target systemd-networkd.service RequiredBy = systemd-networkd.service Wants = systemd-networkd.service","title":"Routing"},{"location":"services/mirrors/4/networking/route/#routing-on-mirrors4","text":"\u7531\u4e8e mirrors4 \u6ca1\u6709\u4f7f\u7528 ifupdown \u4f5c\u4e3a\u7f51\u7edc\u7ba1\u7406\u7cfb\u7edf\uff0c\u800c\u662f\u91c7\u7528 systemd-networkd\uff0c\u56e0\u6b64\u6211\u4eec\u6ca1\u6709 pre-up , up , down , post-down \u7b49\u8fd0\u884c\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u6240\u4ee5 mirrors2 \u4e0a\u4f7f\u7528\u7684\u90a3\u5957\u811a\u672c\uff08 ip-route.sh \u7b49\uff09\u65e0\u6cd5\u76f4\u63a5\u5728 mirrors4 \u4e0a\u7ee7\u7eed\u4f7f\u7528\u3002 \u597d\u5728\u6211\u4eec\u4f7f\u7528 up \u7b49\u8fd0\u884c\u547d\u4ee4\u53ea\u662f\u4e3a\u4e86\u914d\u7f6e\u8def\u7531\uff0c\u56e0\u6b64\u6362\u4e86\u4e2a\u529e\u6cd5\uff0c\u6574\u4e86\u4e2a\u65b0\u811a\u672c\u628a IP \u5730\u5740\u5217\u8868\uff08\u6765\u81ea gaoyifan/china-operator-ip \uff09\u8f6c\u6362\u6210 networkd \u6240\u4f7f\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f\u3002\u4ee3\u7801\u4e0d\u957f\uff1a #!/bin/bash ROOT_IP_LIST = /usr/local/network_config/iplist ROOT_RT = /run/systemd/network gen_route () { IPLIST = \" $ROOT_IP_LIST / $1 \" GW = \" $2 \" DEV = \" $3 \" # Convert table to number TABLENAME = \" $4 \" TABLE = \" $( awk 'substr($0, 1, 1) != \"#\" && $2 == \"' \" $TABLENAME \" '\" { print $1 }' /etc/iproute2/rt_tables | head -1 ) \" PRIORITY = \" $5 \" F = \" $ROOT_RT / $DEV .network.d\" mkdir -p \" $F \" F = \" $F /route- ${ TABLENAME ,, } .conf\" echo -e \"[RoutingPolicyRule]\\nTable= $TABLE \\nPriority= $PRIORITY \\n\" > \" $F \" awk '{ print \"[Route]\\nDestination=\" $1 \"\\nGateway=' \" $GW \" '\\nTable=' \" $TABLE \" '\\n\" }' \" $IPLIST \" >> \" $F \" } gen_route ustcnet.txt 202 .38.95.126 cernet Ustcnet 5 gen_route cernet.txt 202 .38.95.126 cernet Cernet 6 gen_route telecom.txt 202 .141.160.126 telecom Telecom 6 gen_route mobile.txt 202 .141.176.126 mobile Mobile 6 gen_route unicom.txt 218 .104.71.161 unicom Unicom 6 gen_route china.txt 218 .104.71.161 unicom China 7 \u8fd9\u4e2a\u4ed3\u5e93\u91cc\u6709\u5f88\u591a\u4e2a txt \u6587\u4ef6\uff0c\u6bcf\u4e2a\u6587\u4ef6\u5bf9\u5e94\u4e00\u4e2a ISP \u7684\u5730\u5740\u5217\u8868\uff0c\u6bcf\u884c\u4e00\u4e2a CIDR\u3002\u811a\u672c\u4e2d\u7684 gen_route \u51fd\u6570\u6839\u636e\u53c2\u6570\u8bfb\u53d6\u6587\u4ef6\uff0c\u5e76\u8f6c\u6362\u6210\u4e0b\u9762\u8fd9\u6837\u7684\u683c\u5f0f\uff1a [Route] Destination = 1.0.0.0/24 Gateway = 202.38.95.126 Table = 1011 \u8fd9\u6837\u4e00\u4e2a [Route] \u8282\u5bf9\u5e94 \u4e00\u6761 \u8def\u7531\u89c4\u5219\uff0c\u6574\u4e2a txt \u7684\u8f6c\u6362\u7ed3\u679c\u8f93\u51fa\u5230 /run/systemd/network/cernet.network.d/route-example.conf \u3002\u5176\u4e2d cernet.network.d/*.conf \u7528\u4e8e\u5411\u73b0\u6709\u7684\u914d\u7f6e\u4e2d\u6dfb\u52a0\u5185\u5bb9\uff08\u4e0e systemd service \u7c7b\u4f3c\uff09\uff0c\u800c /run \u76ee\u5f55\uff08\u6309\u7406\u6765\u8bf4\uff09\u91cd\u542f\u4f1a\u6e05\u7a7a\uff0c\u9002\u5408\u653e\u7f6e\u8fd9\u4e9b\u7528\u4e8e\u52a8\u6001\u751f\u6210\u7684\u5185\u5bb9\u3002\u53e6\u5916\u7531\u4e8e\u8def\u7531\u89c4\u5219\uff08 ip rule \uff09\u4e5f\u7531 networkd \u7ba1\u7406\u548c\u751f\u6210\u4e86\uff0c\u56e0\u6b64\u6bcf\u4e2a route-xxx.conf \u5f00\u5934\u4f1a\u5305\u542b\u4e00\u4e2a [RoutingPolicyRule] \u8282\u7528\u4e8e\u751f\u6210\u8def\u7531\u8868\u5bf9\u5e94\u7684\u8def\u7531\u89c4\u5219\u3002 \u6ce8\u610f\u8def\u7531\u8868\u662f\u7528\u540d\u79f0\u6307\u5b9a\u7684\uff0c\u4ece /etc/iproute2/rt_tables \u4e2d\u67e5\u51fa\u5bf9\u5e94\u7684\u6570\u5b57 ID\u3002\u8fd9\u4e2a\u6587\u4ef6\u672c\u6765\u4e5f\u662f ip \u547d\u4ee4\u6240\u4f7f\u7528\u7684\uff08\u6ce8\u610f\u5b83\u7684\u76ee\u5f55\u540d\u53eb iproute2 \uff09\u3002 \u6700\u540e\u7ed9\u8fd9\u4e2a\u811a\u672c\u914d\u4e2a service\uff0c\u8ba9\u5b83\u5728 networkd \u4e4b\u524d\u8fd0\u884c\uff1a [Unit] Description = Generate routes for systemd-networkd Before = systemd-networkd.service [Service] Type = oneshot ExecStart = /bin/bash /usr/local/network_config/route-all.sh ExecStart = -/usr/sbin/ip rule flush RemainAfterExit = true [Install] WantedBy = network.target systemd-networkd.service Wants = systemd-networkd.service \u8fd9\u4e2a\u6587\u4ef6\u5b58\u5230 /etc/systemd/system/route-all.service \uff0creload \u518d enable \u5c31\u53ef\u4ee5\u4e86\u3002 \u4e0d\u8981\u5c1d\u8bd5\u6539 systemd-networkd.service \u8fd9\u4e2a\u81ea\u5e26\u7684\u670d\u52a1\u6709\u4e00\u4e2a User=systemd-networkd \uff0c\u4f60\u65e2\u4e0d\u80fd ip rule \u4e5f\u4e0d\u80fd\u5199\u5165 /run/systemd \u7b49\uff0c\u4f1a\u5bfc\u81f4\u670d\u52a1\u70b8\u6389\uff0c\u7136\u540e\u7f51\u4e5f\u70b8\u4e86\u3002\u3002\u3002","title":"Routing on mirrors4"},{"location":"services/mirrors/4/networking/route/#special-routing","text":"\u90e8\u5206 IP \u9700\u8981\u914d\u7f6e\u7279\u6b8a\u8def\u7531\u89c4\u5219\u65f6\uff08\u800c\u4e0d\u662f\u4f7f\u7528\u9ed8\u8ba4\uff09\uff0c\u7f16\u8f91 /usr/local/network_config/special.yml \uff0c\u5176\u683c\u5f0f\u5982\u4e0b\uff1a routes : # Root key\uff0c\u4fdd\u7559 lugvpn : # /etc/systemd/network \u4e2d\u5bf9\u5e94\u7684 .network \u6587\u4ef6\u540d # \u4e0b\u9762\u662f\u4e00\u4e2a\u8def\u7531\u6587\u4ef6\u7684\u914d\u7f6e\uff0c\u4e00\u4e2a\u6587\u4ef6\u5171\u4eab\u4e00\u4e2a table \u548c gateway \u8bbe\u7f6e - name : route-special # \u5c06\u8981\u521b\u5efa\u7684 .conf \u6587\u4ef6\u540d\uff0c\u53ef\u4ee5\u968f\u610f table : Special # \u8def\u7531\u8868\uff0c\u5373 ip route add table \u540e\u9762\u7684\u53c2\u6570\uff0c\u6570\u5b57\u6216\u8868\u540d gateway : false # \u662f\u5426\u5305\u542b\u7f51\u5173\uff0c\u6216\u8005 ip route \u7684 via \u53c2\u6570 routes : # \u6240\u6709\u7684\u8def\u7531\u6761\u76ee - 1.2.3.4 - 5.6.7.8/28 - 2001:db8::2333/64 cernet : # \u66f4\u591a\u7684\u914d\u7f6e - ... \u4fee\u6539 special.yml \u4e4b\u540e\u91cd\u542f route-all.service \u3002\u8be5\u670d\u52a1\u4f1a\u81ea\u52a8\u5bfc\u81f4 systemd-networkd.service \u91cd\u542f\u5e76\u8f7d\u5165\u65b0\u7684\u8def\u7531\u914d\u7f6e\u4fe1\u606f\u3002 ??? special.rb \u5904\u7406\u811a\u672c\uff08\u653e\u5728\u8fd9\u5907\u4efd\uff09 ``` ruby #! / usr / bin / ruby require 'fileutils' require 'yaml' BASEDIR = '/run/systemd/network' RT_TABLES = '/etc/iproute2/rt_tables' rt_tables = Hash . new File . readlines ( RT_TABLES ). each do | l | next if l =~ /^ \\ s * # / id , name = l . split rt_tables [ name ] = id end data = YAML . load_file File . join ( __dir__ , 'special.yml' ) data [ 'routes' ] . each do | fn , setups | confdir = File . join ( BASEDIR , \"#{fn}.network.d\" ) FileUtils . mkdir_p confdir setups . each do | config | table = config [ 'table' ] gateway = config [ 'gateway' ] File . open File . join ( confdir , \"#{config['name']}.conf\" ), 'w' do | f | config [ 'routes' ] . each do | dst | t = \"[Route]\\nDestination=#{dst}\\n\" t += \"Table=#{rt_tables.fetch table, table}\\n\" if table t += \"Gateway=#{gateway}\\n\" if gateway f . write t + \"\\n\" end end end end ``` route-all.service \u6709\u5f88\u591a\u6ce8\u610f\u4e8b\u9879 \u4e3a\u4e86\u6e05\u7406\u5f00\u673a\u81ea\u52a8\u4ea7\u751f\u7684 32766 \u548c 32767 \u4e24\u6761\u8def\u7531\u89c4\u5219\uff0c route-all.service \u5305\u62ec\u6267\u884c ip rule flush \uff0c\u56e0\u6b64\u8be5\u670d\u52a1\u91cd\u542f\u4e4b\u540e\u5fc5\u987b\u7acb\u523b\u91cd\u542f systemd-networkd\u3002 \u76ee\u524d\u505a\u6cd5\u662f\u5728 route-all.service \u4e2d\u6dfb\u52a0 RequiredBy=systemd-networkd.service \u5236\u9020\u4f9d\u8d56\u5173\u7cfb\uff0c\u8ba9 systemd \u5b8c\u6210\u201c\u7275\u8fde\u91cd\u542f\u201d\u3002 \u5b8c\u6574 service \u6587\u4ef6\uff1a [Unit] Description = Generate routes for systemd-networkd Before = systemd-networkd.service [Service] Type = oneshot ExecStart = /bin/bash /usr/local/network_config/route-all.sh ExecStart = /usr/local/network_config/special.rb ExecStart = -/usr/sbin/ip rule flush RemainAfterExit = true [Install] WantedBy = network.target systemd-networkd.service RequiredBy = systemd-networkd.service Wants = systemd-networkd.service","title":"Special routing"},{"location":"services/pxe/liims/","text":"LIIMS \u00b6 Short for Libray Independent Inquery Machine System . Server: pxe.s.ustclug.org Git Repository: liimstrap \uff08\u6ce8\u610f\u4ed3\u5e93\u5185\u5bb9\u7684\u66f4\u6539\u65f6\u95f4\uff0c\u53ef\u80fd\u4e25\u91cd\u8fc7\u65f6\u4e86\uff09 \u542f\u52a8\u914d\u7f6e \u00b6 \u914d\u7f6e\u6587\u4ef6\u5728 /home/pxe/tftp/grub/grub.cfg.d \uff0c\u82e5\u8981\u5141\u8bb8\u65b0\u673a\u5668\u542f\u52a8 liims \u955c\u50cf\uff0c\u521b\u5efa\u4e00\u4e2a\u7b26\u53f7\u94fe\u63a5\u5230\u5bf9\u5e94\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u76ee\u524d\u7684\u955c\u50cf\u662f liims160909 \uff09\uff1a ln -s liims160909 01 :23:45:67:89:ab \u542f\u52a8\u955c\u50cf \u00b6 \u4f4d\u4e8e /home/pxe/nfsroot/<category>/<name> \uff0c\u5176\u4e2d <name> \u5c31\u662f\u955c\u50cf\u540d\u79f0\uff08\u4f8b\u5982 liims160909 \uff09\u3002\u8fd9\u662f\u6574\u4e2a rootfs\uff0c\u76f4\u63a5\u4fee\u6539\u8fd9\u91cc\u7684\u6587\u4ef6\uff0c\u673a\u5668\u91cd\u542f\u540e\u5c31\u4f1a\u8f7d\u5165\u3002 IP \u767d\u540d\u5355\u91c7\u7528 iptables \u5b9e\u73b0\uff0c\u4fee\u6539 rootfs \u4e0b\u7684 etc/iptables/*.rules \u53ef\u4fee\u6539\u7b56\u7565\u3002 \u955c\u50cf\u6784\u5efa \u00b6 iBug \u5907\u6ce8 \u6b64\u8282\u53ca\u4ee5\u4e0b\u7684\u5185\u5bb9\u53ef\u80fd\u4e25\u91cd\u8fc7\u65f6\uff0cpxe.s \u4e0a\u7684\u5f88\u591a\u914d\u7f6e\u90fd\u88ab\u624b\u52a8\u66f4\u65b0\u8fc7\u4e86\u3002 \u4f7f\u7528 liimstrap \u5728 ArchLinux \u4e0b\u8fdb\u884c\u6784\u5efa\uff0cliimstrap\u4f7f\u7528\u65b9\u6cd5\u53c2\u8003\u4ed3\u5e93\u4e2d\u7684\u8bf4\u660e\u3002 \u6784\u5efa\u540e\u9700\u8981\u63a8\u9001\u5230\u670d\u52a1\u5668\u4e0a\u7684 /nfsroot/liims \u4e0b\uff0c\u5e76\u8bbe\u7f6e /usr \u7684\u6240\u6709\u8005\u4e3a liims\u3002\u673a\u5668\u7684\u9ed8\u8ba4 pxe \u542f\u52a8\u914d\u7f6e\u5728 /home/pxe/tftp/pxelinux.cfg/ \u4e0b \u793a\u4f8b qemu \u8c03\u8bd5\u65b9\u6cd5 \u00b6 \u521b\u5efa\u5e76\u6302\u8f7d\u4e34\u65f6\u955c\u50cf: dd if = /dev/zero of = liims.img bs = 4k count = 1200000 mkfs.ext4 liims.img mount -o loop liims.img /mnt \u5047\u8bbe\u5f53\u524d\u8def\u5f84\u4e3a liimstrap\uff0c\u4fee\u6539 initcpio/mkinitcpio.conf \uff0c\u53bb\u6389 HOOKS \u4e2d\u7684 liims_root \uff0c\u589e\u52a0 block \uff08\u4ec5\u8c03\u8bd5\u65f6\u9700\u8981\uff09\u3002 \u4f7f\u7528 liimstrap \u5236\u4f5c\u955c\u50cf ./liimstrap /mnt \u3002\u5b8c\u6210\u540e\u4f7f\u7528 qemu \u6253\u5f00\u8c03\u8bd5: qemu -kernel /mnt/boot/vmlinuz-lts \\ -initrd /mnt/boot/initramfs-linux-lts.img \\ -hda liims.img \\ -netdev user,id = mynet0,net = 114 .214.188.0/24,dhcpstart = 114 .214.188.9 \\ -device i82557a,netdev = mynet0 \\ -append \"root=/dev/sda rootflags=rw\" \u6ce8\uff1a\u5176\u4e2d netdev \u4e2d\u7684 ip \u6bb5\u53ef\u4ee5\u81ea\u7531\u9009\u53d6\uff0c device \u4e2d\u7684\u8bbe\u5907\u540d\u901a\u8fc7 qemu -device \\? \u67e5\u770b\u540e\u9009\u62e9\u4efb\u4e00\u7f51\u7edc\u8bbe\u5907\u5373\u53ef","title":"LIIMS"},{"location":"services/pxe/liims/#liims","text":"Short for Libray Independent Inquery Machine System . Server: pxe.s.ustclug.org Git Repository: liimstrap \uff08\u6ce8\u610f\u4ed3\u5e93\u5185\u5bb9\u7684\u66f4\u6539\u65f6\u95f4\uff0c\u53ef\u80fd\u4e25\u91cd\u8fc7\u65f6\u4e86\uff09","title":"LIIMS"},{"location":"services/pxe/liims/#_1","text":"\u914d\u7f6e\u6587\u4ef6\u5728 /home/pxe/tftp/grub/grub.cfg.d \uff0c\u82e5\u8981\u5141\u8bb8\u65b0\u673a\u5668\u542f\u52a8 liims \u955c\u50cf\uff0c\u521b\u5efa\u4e00\u4e2a\u7b26\u53f7\u94fe\u63a5\u5230\u5bf9\u5e94\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u76ee\u524d\u7684\u955c\u50cf\u662f liims160909 \uff09\uff1a ln -s liims160909 01 :23:45:67:89:ab","title":"\u542f\u52a8\u914d\u7f6e"},{"location":"services/pxe/liims/#_2","text":"\u4f4d\u4e8e /home/pxe/nfsroot/<category>/<name> \uff0c\u5176\u4e2d <name> \u5c31\u662f\u955c\u50cf\u540d\u79f0\uff08\u4f8b\u5982 liims160909 \uff09\u3002\u8fd9\u662f\u6574\u4e2a rootfs\uff0c\u76f4\u63a5\u4fee\u6539\u8fd9\u91cc\u7684\u6587\u4ef6\uff0c\u673a\u5668\u91cd\u542f\u540e\u5c31\u4f1a\u8f7d\u5165\u3002 IP \u767d\u540d\u5355\u91c7\u7528 iptables \u5b9e\u73b0\uff0c\u4fee\u6539 rootfs \u4e0b\u7684 etc/iptables/*.rules \u53ef\u4fee\u6539\u7b56\u7565\u3002","title":"\u542f\u52a8\u955c\u50cf"},{"location":"services/pxe/liims/#_3","text":"iBug \u5907\u6ce8 \u6b64\u8282\u53ca\u4ee5\u4e0b\u7684\u5185\u5bb9\u53ef\u80fd\u4e25\u91cd\u8fc7\u65f6\uff0cpxe.s \u4e0a\u7684\u5f88\u591a\u914d\u7f6e\u90fd\u88ab\u624b\u52a8\u66f4\u65b0\u8fc7\u4e86\u3002 \u4f7f\u7528 liimstrap \u5728 ArchLinux \u4e0b\u8fdb\u884c\u6784\u5efa\uff0cliimstrap\u4f7f\u7528\u65b9\u6cd5\u53c2\u8003\u4ed3\u5e93\u4e2d\u7684\u8bf4\u660e\u3002 \u6784\u5efa\u540e\u9700\u8981\u63a8\u9001\u5230\u670d\u52a1\u5668\u4e0a\u7684 /nfsroot/liims \u4e0b\uff0c\u5e76\u8bbe\u7f6e /usr \u7684\u6240\u6709\u8005\u4e3a liims\u3002\u673a\u5668\u7684\u9ed8\u8ba4 pxe \u542f\u52a8\u914d\u7f6e\u5728 /home/pxe/tftp/pxelinux.cfg/ \u4e0b","title":"\u955c\u50cf\u6784\u5efa"},{"location":"services/pxe/liims/#qemu","text":"\u521b\u5efa\u5e76\u6302\u8f7d\u4e34\u65f6\u955c\u50cf: dd if = /dev/zero of = liims.img bs = 4k count = 1200000 mkfs.ext4 liims.img mount -o loop liims.img /mnt \u5047\u8bbe\u5f53\u524d\u8def\u5f84\u4e3a liimstrap\uff0c\u4fee\u6539 initcpio/mkinitcpio.conf \uff0c\u53bb\u6389 HOOKS \u4e2d\u7684 liims_root \uff0c\u589e\u52a0 block \uff08\u4ec5\u8c03\u8bd5\u65f6\u9700\u8981\uff09\u3002 \u4f7f\u7528 liimstrap \u5236\u4f5c\u955c\u50cf ./liimstrap /mnt \u3002\u5b8c\u6210\u540e\u4f7f\u7528 qemu \u6253\u5f00\u8c03\u8bd5: qemu -kernel /mnt/boot/vmlinuz-lts \\ -initrd /mnt/boot/initramfs-linux-lts.img \\ -hda liims.img \\ -netdev user,id = mynet0,net = 114 .214.188.0/24,dhcpstart = 114 .214.188.9 \\ -device i82557a,netdev = mynet0 \\ -append \"root=/dev/sda rootflags=rw\" \u6ce8\uff1a\u5176\u4e2d netdev \u4e2d\u7684 ip \u6bb5\u53ef\u4ee5\u81ea\u7531\u9009\u53d6\uff0c device \u4e2d\u7684\u8bbe\u5907\u540d\u901a\u8fc7 qemu -device \\? \u67e5\u770b\u540e\u9009\u62e9\u4efb\u4e00\u7f51\u7edc\u8bbe\u5907\u5373\u53ef","title":"\u793a\u4f8b qemu \u8c03\u8bd5\u65b9\u6cd5"},{"location":"workflow/ldap/add-new-user/","text":"\u5728 LDAP \u4e2d\u6dfb\u52a0\u65b0\u7528\u6237 \u00b6 \u65b0\u5efa LDAP \u7528\u6237 \u00b6 \u767b\u9646 \u7f51\u9875\u754c\u9762 Users > Actions > Create > User Generic: \u8f93\u5165 Last name\uff0cFirst name\uff0cLogin\uff08\u767b\u5f55\u540d\uff09 POSIX > Generic\uff1a\u8f93\u5165 Home directory\u3002\u4f7f\u7528 Force UID/GID \uff0c\u5177\u4f53\u8bf4\u660e\u8be6\u89c1 LDAP Users \u548c Groups \u6dfb\u52a0 LDAP \u7528\u6237\u6743\u9650 \u00b6 POSIX > Group membership > Add\uff1a\u6839\u636e\u9700\u8981\u6dfb\u52a0\u7684\u6743\u9650\u9009\u62e9\u5bf9\u5e94\u7684\u7ec4\uff0c\u5177\u4f53\u8bf4\u660e\u8be6\u89c1 LDAP Users \u548c Groups","title":"Add New User in LDAP"},{"location":"workflow/ldap/add-new-user/#ldap","text":"","title":"\u5728 LDAP \u4e2d\u6dfb\u52a0\u65b0\u7528\u6237"},{"location":"workflow/ldap/add-new-user/#ldap_1","text":"\u767b\u9646 \u7f51\u9875\u754c\u9762 Users > Actions > Create > User Generic: \u8f93\u5165 Last name\uff0cFirst name\uff0cLogin\uff08\u767b\u5f55\u540d\uff09 POSIX > Generic\uff1a\u8f93\u5165 Home directory\u3002\u4f7f\u7528 Force UID/GID \uff0c\u5177\u4f53\u8bf4\u660e\u8be6\u89c1 LDAP Users \u548c Groups","title":"\u65b0\u5efa LDAP \u7528\u6237"},{"location":"workflow/ldap/add-new-user/#ldap_2","text":"POSIX > Group membership > Add\uff1a\u6839\u636e\u9700\u8981\u6dfb\u52a0\u7684\u6743\u9650\u9009\u62e9\u5bf9\u5e94\u7684\u7ec4\uff0c\u5177\u4f53\u8bf4\u660e\u8be6\u89c1 LDAP Users \u548c Groups","title":"\u6dfb\u52a0 LDAP \u7528\u6237\u6743\u9650"},{"location":"workflow/mirrors/maintenance/","text":"\u5f00\u6e90\u8f6f\u4ef6\u955c\u50cf\u7ad9\u7ef4\u62a4\u65b9\u5f0f \u00b6 \u79d1\u5927\u5f00\u6e90\u8f6f\u4ef6\u955c\u50cf\u7ad9\u662f LUG \u6700\u91cd\u8981\u7684\u670d\u52a1\u4e4b\u4e00 \uff0c\u56e0\u6b64\u7ef4\u62a4\u64cd\u4f5c\u5fc5\u987b\u8c28\u614e\u3002 \u91cd\u542f\u7cfb\u7edf \u00b6 \u7531\u4e8e mirrors \u670d\u52a1\u91cf\u5927\uff0c\u91cd\u542f\u5e94\u63d0\u524d\u5728 LUG \u670d\u52a1\u5668\u65b0\u95fb\u7ad9 \u53d1\u5e03\u516c\u544a\u3002 \u5b89\u88c5\u66f4\u65b0 \u00b6 \u666e\u901a\u66f4\u65b0 \u00b6 \u591a\u6570\u66f4\u65b0\u53ef\u4ee5\u76f4\u63a5\u4ece apt \u6e90\u5b89\u88c5\uff0c\u4f46\u662f\u90e8\u5206\u8f6f\u4ef6\u5e76\u975e\u6765\u81ea Debian \u5b98\u65b9\u4ed3\u5e93\uff08\u4f8b\u5982 OpenResty\uff09\uff0c\u56e0\u6b64\u66f4\u65b0\u7b56\u7565\u53ef\u80fd\u4e0d\u50cf Debian \u90a3\u4e48\u7a33\u5b9a\u3002\u5982\u679c\u9047\u5230\u63d0\u793a\u914d\u7f6e\u6587\u4ef6\u51b2\u7a81\uff0c\u8bf7\u5c3d\u91cf\u9009\u62e9 3-way merge\uff0c\u5982\u679c\u5931\u8d25\u7684\u8bdd\u53ef\u4ee5\u5148 keep local version\uff0c\u7136\u540e\u624b\u52a8\u89e3\u51b3\u5408\u5e76\u51b2\u7a81\u3002 \u5185\u6838\u66f4\u65b0 \u00b6 mirrors \u4f7f\u7528\u4e86\u5185\u6838\u6a21\u5757\u63d0\u4f9b\u4e00\u4e9b\u529f\u80fd\u652f\u6301\uff0c\u5982 ZFS\u3002\u56e0\u6b64\u53ea\u8981\u66f4\u65b0\u4e86\u5185\u6838\uff0c\u5c31\u4e00\u5b9a\u8981\u6ce8\u610f\u5185\u6838\u6a21\u5757\u662f\u5426\u5b89\u88c5\u6210\u529f\uff0c\u5982\u679c apt \u5b89\u88c5\u5931\u8d25\u53ef\u4ee5\u624b\u52a8\u8fd0\u884c dkms autoinstall \uff0c\u4ee5\u786e\u4fdd\u65b0\u5185\u6838\u91cd\u542f\u65f6\u80fd\u6b63\u786e\u52a0\u8f7d\u5fc5\u987b\u7684\u5185\u6838\u6a21\u5757\u3002 IPMI \u00b6 \u5730\u5740 \u6682\u65e0 \uff0c\u4e00\u822c\u7528\u6d4f\u89c8\u5668\u76f4\u63a5\u8bbf\u95ee\u5c31\u884c\u4e86\u3002\u5982\u679c\u9700\u8981\u63a5\u5165\u7ec8\u7aef\uff0cDashboard \u5de6\u8fb9\u7684 Remote Control \u6709 Launch \u6309\u94ae\u3002\u5982\u679c\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 Java \u5c31\u4f1a\u4e0b\u8f7d\u4e00\u4e2a jviewer.jnlp \uff0c\u81ea\u884c\u89e3\u51b3 Java \u7684\u5b89\u5168\u8b66\u544a\u5373\u53ef\u4f7f\u7528\u3002 \u5f53\u7136\u5982\u679c\u4f1a\u7528 ipmitool \u66f4\u597d\uff0c\u90a3\u8fd9\u4e00\u6bb5\u7684\u8bf4\u660e\u5c31\u4ea4\u7ed9\u4f60\u6765\u8865\u5145\u4e86 :) ipmitool \u7b80\u4ecb \u00b6 \u5c3d\u7ba1\u51e0\u4e4e\u6211\u4eec\u673a\u5668\u7684 IPMI \u90fd\u6709 Web \u754c\u9762\uff0c\u4f46\u662f Web \u754c\u9762\u4e0d\u4e00\u5b9a\u9760\u8c31\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u6545\u969c\u3002\u6b64\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ipmitool \u91cd\u7f6e IPMI \u7684\u72b6\u6001\uff08\u7cfb\u7edf\u914d\u7f6e\u4e0d\u4f1a\u6539\u53d8\uff09 \u53c2\u8003\u547d\u4ee4\uff1a ipmitool -I lan -H IPMI\u7684IP -U \u7528\u6237\u540d -a mc reset cold \u5177\u4f53\u8be6\u60c5\u53ef\u4ee5\u770b ipmitool \u7684 manpage\u3002 \u53e6\u5916: \u636e\u8bf4\u8fd8\u53ef\u4ee5\u7528\u5b83\u8bbe\u7f6e\u4e32\u53e3\u8f93\u51fa\u4ece\u800c\u5b9e\u73b0\u7c7b\u4f3c KVM \u7684\u6548\u679c\uff0c\u4f46\u662f\u6ca1\u6709\u6d4b\u8bd5\u8fc7\uff0c\u4e5f\u4e0d\u77e5\u9053\u5982\u4f55\u5b9e\u73b0\u3002 mirrors3 \u7684 IPMI (iDRAC) \u662f broken \u7684\uff0c\u5c31\u7b97 reset cold \u4e86\u4e5f\u6ca1\u7528\u3002","title":"Mirrors maintenance"},{"location":"workflow/mirrors/maintenance/#_1","text":"\u79d1\u5927\u5f00\u6e90\u8f6f\u4ef6\u955c\u50cf\u7ad9\u662f LUG \u6700\u91cd\u8981\u7684\u670d\u52a1\u4e4b\u4e00 \uff0c\u56e0\u6b64\u7ef4\u62a4\u64cd\u4f5c\u5fc5\u987b\u8c28\u614e\u3002","title":"\u5f00\u6e90\u8f6f\u4ef6\u955c\u50cf\u7ad9\u7ef4\u62a4\u65b9\u5f0f"},{"location":"workflow/mirrors/maintenance/#_2","text":"\u7531\u4e8e mirrors \u670d\u52a1\u91cf\u5927\uff0c\u91cd\u542f\u5e94\u63d0\u524d\u5728 LUG \u670d\u52a1\u5668\u65b0\u95fb\u7ad9 \u53d1\u5e03\u516c\u544a\u3002","title":"\u91cd\u542f\u7cfb\u7edf"},{"location":"workflow/mirrors/maintenance/#_3","text":"","title":"\u5b89\u88c5\u66f4\u65b0"},{"location":"workflow/mirrors/maintenance/#_4","text":"\u591a\u6570\u66f4\u65b0\u53ef\u4ee5\u76f4\u63a5\u4ece apt \u6e90\u5b89\u88c5\uff0c\u4f46\u662f\u90e8\u5206\u8f6f\u4ef6\u5e76\u975e\u6765\u81ea Debian \u5b98\u65b9\u4ed3\u5e93\uff08\u4f8b\u5982 OpenResty\uff09\uff0c\u56e0\u6b64\u66f4\u65b0\u7b56\u7565\u53ef\u80fd\u4e0d\u50cf Debian \u90a3\u4e48\u7a33\u5b9a\u3002\u5982\u679c\u9047\u5230\u63d0\u793a\u914d\u7f6e\u6587\u4ef6\u51b2\u7a81\uff0c\u8bf7\u5c3d\u91cf\u9009\u62e9 3-way merge\uff0c\u5982\u679c\u5931\u8d25\u7684\u8bdd\u53ef\u4ee5\u5148 keep local version\uff0c\u7136\u540e\u624b\u52a8\u89e3\u51b3\u5408\u5e76\u51b2\u7a81\u3002","title":"\u666e\u901a\u66f4\u65b0"},{"location":"workflow/mirrors/maintenance/#_5","text":"mirrors \u4f7f\u7528\u4e86\u5185\u6838\u6a21\u5757\u63d0\u4f9b\u4e00\u4e9b\u529f\u80fd\u652f\u6301\uff0c\u5982 ZFS\u3002\u56e0\u6b64\u53ea\u8981\u66f4\u65b0\u4e86\u5185\u6838\uff0c\u5c31\u4e00\u5b9a\u8981\u6ce8\u610f\u5185\u6838\u6a21\u5757\u662f\u5426\u5b89\u88c5\u6210\u529f\uff0c\u5982\u679c apt \u5b89\u88c5\u5931\u8d25\u53ef\u4ee5\u624b\u52a8\u8fd0\u884c dkms autoinstall \uff0c\u4ee5\u786e\u4fdd\u65b0\u5185\u6838\u91cd\u542f\u65f6\u80fd\u6b63\u786e\u52a0\u8f7d\u5fc5\u987b\u7684\u5185\u6838\u6a21\u5757\u3002","title":"\u5185\u6838\u66f4\u65b0"},{"location":"workflow/mirrors/maintenance/#ipmi","text":"\u5730\u5740 \u6682\u65e0 \uff0c\u4e00\u822c\u7528\u6d4f\u89c8\u5668\u76f4\u63a5\u8bbf\u95ee\u5c31\u884c\u4e86\u3002\u5982\u679c\u9700\u8981\u63a5\u5165\u7ec8\u7aef\uff0cDashboard \u5de6\u8fb9\u7684 Remote Control \u6709 Launch \u6309\u94ae\u3002\u5982\u679c\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 Java \u5c31\u4f1a\u4e0b\u8f7d\u4e00\u4e2a jviewer.jnlp \uff0c\u81ea\u884c\u89e3\u51b3 Java \u7684\u5b89\u5168\u8b66\u544a\u5373\u53ef\u4f7f\u7528\u3002 \u5f53\u7136\u5982\u679c\u4f1a\u7528 ipmitool \u66f4\u597d\uff0c\u90a3\u8fd9\u4e00\u6bb5\u7684\u8bf4\u660e\u5c31\u4ea4\u7ed9\u4f60\u6765\u8865\u5145\u4e86 :)","title":"IPMI"},{"location":"workflow/mirrors/maintenance/#ipmitool","text":"\u5c3d\u7ba1\u51e0\u4e4e\u6211\u4eec\u673a\u5668\u7684 IPMI \u90fd\u6709 Web \u754c\u9762\uff0c\u4f46\u662f Web \u754c\u9762\u4e0d\u4e00\u5b9a\u9760\u8c31\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u6545\u969c\u3002\u6b64\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ipmitool \u91cd\u7f6e IPMI \u7684\u72b6\u6001\uff08\u7cfb\u7edf\u914d\u7f6e\u4e0d\u4f1a\u6539\u53d8\uff09 \u53c2\u8003\u547d\u4ee4\uff1a ipmitool -I lan -H IPMI\u7684IP -U \u7528\u6237\u540d -a mc reset cold \u5177\u4f53\u8be6\u60c5\u53ef\u4ee5\u770b ipmitool \u7684 manpage\u3002 \u53e6\u5916: \u636e\u8bf4\u8fd8\u53ef\u4ee5\u7528\u5b83\u8bbe\u7f6e\u4e32\u53e3\u8f93\u51fa\u4ece\u800c\u5b9e\u73b0\u7c7b\u4f3c KVM \u7684\u6548\u679c\uff0c\u4f46\u662f\u6ca1\u6709\u6d4b\u8bd5\u8fc7\uff0c\u4e5f\u4e0d\u77e5\u9053\u5982\u4f55\u5b9e\u73b0\u3002 mirrors3 \u7684 IPMI (iDRAC) \u662f broken \u7684\uff0c\u5c31\u7b97 reset cold \u4e86\u4e5f\u6ca1\u7528\u3002","title":"ipmitool \u7b80\u4ecb"},{"location":"workflow/vSphere/new-vm/","text":"Create new server in LUGi \u00b6 Create VM on vCenter \u00b6 vCenter \u5730\u5740\uff1avcenter2.vm.ustclug.org \u6309\u7167\u63d0\u793a\u521b\u5efa\u865a\u62df\u673a Step 7: Customize hardware Network: ustclug: intranet ustclug-bridge: \u6ca1\u6709 MAC \u6e90\u5730\u5740\u68c0\u67e5 cernet: \u6559\u80b2\u7f51\uff08\u5148\u9009\u8fd9\u4e2a\uff0c\u4ee5\u4fbf\u4e8e\u901a\u8fc7\u7f51\u7edc\u5b89\u88c5\u7cfb\u7edf\uff09 VM options VMware Tools \u6253\u5f00 Sync time with Host Install OS \u00b6 Notes: \u5c06\u7f51\u7edc\u6539\u4e3a cernet\uff0c\u4ee5\u4fbf\u7528 DHCP \u83b7\u5f97 IP \u5730\u5740\uff0c\u7528 PXE \u5b89\u88c5\u7cfb\u7edf\u3002 \u51e0\u4e2a\u5173\u952e\u914d\u7f6e\uff1a hostname: \u4e3b\u673a\u540d\uff0c\u5982 vpnhc domain name: \u641c\u7d22\u57df\uff0c\u4e00\u822c\u8bbe\u4e3a s.ustclug.org \u7528\u6237\u8bbe\u7f6e\uff1a\u5148\u8bbe\u7f6e\u4e00\u4e2a\u4e34\u65f6\u7528\u6237\uff08\u5c3d\u91cf\u4e0d\u4e0e\u4e4b\u540e\u8981\u914d\u7f6e\u7684 ldap \u8d26\u53f7\u51b2\u7a81\uff09\uff0c\u7528\u4e8e\u521d\u59cb\u767b\u9646\u914d\u7f6e\uff0c\u4e4b\u540e\u5220\u9664 \u78c1\u76d8\u8bbe\u7f6e\uff1a\u4f7f\u7528\u6574\u4e2a\u786c\u76d8\uff0c\u53ea\u7559\u4e00\u4e2a\u4e3b\u5206\u533a\uff0c\u4e0d\u7559 swap \u7b49\u5206\u533a\uff0c\u65b9\u4fbf\u6269\u5bb9 Configure network \u00b6 \u589e\u52a0 hostname.s.ustclug.org \u7684 DNS \u89e3\u6790\u3002\uff08ustclug.intranet\uff09 \u5728 vCenter \u4e2d\u66f4\u6539\u7f51\u7edc\u4e3a ustclug \uff08\u5982\u679c\u4e0d\u9700\u8981\u6e90 MAC \u5730\u5740\u68c0\u67e5\uff0c\u9009 ustclug-bridge\uff09 \u5728\u865a\u62df\u673a\u4e2d\u91cd\u542f\u7f51\u7edc\u63a5\u53e3\uff0c\u6539\u4e3a\u9759\u6001 IP\uff0c\u5e76\u66f4\u6539\u7f51\u5173 \uff0810.254.0.254\uff09 ifdown edit interface coonfig files ifup \u66f4\u6539\u865a\u62df\u673a\u7684 DNS \u548c domain/search\uff1a DNS: neat-dns (10.254.0.253) dns backup (202.38.93.94) domain/search: s.ustclug.org Install tools \u00b6 \u6839\u636e\u9700\u8981\u6362\u6e90\uff0c\u52a0\u5165\u5b89\u5168\u66f4\u65b0\u6e90\u7b49 \u5b89\u88c5 open-vm tools \u5b89\u88c5 openssh Configure LDAP \u00b6 \u89c1 LDAP\u670d\u52a1\u4f7f\u7528\u53ca\u914d\u7f6e\u8bf4\u660e","title":"New VM in vSphere"},{"location":"workflow/vSphere/new-vm/#create-new-server-in-lugi","text":"","title":"Create new server in LUGi"},{"location":"workflow/vSphere/new-vm/#create-vm-on-vcenter","text":"vCenter \u5730\u5740\uff1avcenter2.vm.ustclug.org \u6309\u7167\u63d0\u793a\u521b\u5efa\u865a\u62df\u673a Step 7: Customize hardware Network: ustclug: intranet ustclug-bridge: \u6ca1\u6709 MAC \u6e90\u5730\u5740\u68c0\u67e5 cernet: \u6559\u80b2\u7f51\uff08\u5148\u9009\u8fd9\u4e2a\uff0c\u4ee5\u4fbf\u4e8e\u901a\u8fc7\u7f51\u7edc\u5b89\u88c5\u7cfb\u7edf\uff09 VM options VMware Tools \u6253\u5f00 Sync time with Host","title":"Create VM on vCenter"},{"location":"workflow/vSphere/new-vm/#install-os","text":"Notes: \u5c06\u7f51\u7edc\u6539\u4e3a cernet\uff0c\u4ee5\u4fbf\u7528 DHCP \u83b7\u5f97 IP \u5730\u5740\uff0c\u7528 PXE \u5b89\u88c5\u7cfb\u7edf\u3002 \u51e0\u4e2a\u5173\u952e\u914d\u7f6e\uff1a hostname: \u4e3b\u673a\u540d\uff0c\u5982 vpnhc domain name: \u641c\u7d22\u57df\uff0c\u4e00\u822c\u8bbe\u4e3a s.ustclug.org \u7528\u6237\u8bbe\u7f6e\uff1a\u5148\u8bbe\u7f6e\u4e00\u4e2a\u4e34\u65f6\u7528\u6237\uff08\u5c3d\u91cf\u4e0d\u4e0e\u4e4b\u540e\u8981\u914d\u7f6e\u7684 ldap \u8d26\u53f7\u51b2\u7a81\uff09\uff0c\u7528\u4e8e\u521d\u59cb\u767b\u9646\u914d\u7f6e\uff0c\u4e4b\u540e\u5220\u9664 \u78c1\u76d8\u8bbe\u7f6e\uff1a\u4f7f\u7528\u6574\u4e2a\u786c\u76d8\uff0c\u53ea\u7559\u4e00\u4e2a\u4e3b\u5206\u533a\uff0c\u4e0d\u7559 swap \u7b49\u5206\u533a\uff0c\u65b9\u4fbf\u6269\u5bb9","title":"Install OS"},{"location":"workflow/vSphere/new-vm/#configure-network","text":"\u589e\u52a0 hostname.s.ustclug.org \u7684 DNS \u89e3\u6790\u3002\uff08ustclug.intranet\uff09 \u5728 vCenter \u4e2d\u66f4\u6539\u7f51\u7edc\u4e3a ustclug \uff08\u5982\u679c\u4e0d\u9700\u8981\u6e90 MAC \u5730\u5740\u68c0\u67e5\uff0c\u9009 ustclug-bridge\uff09 \u5728\u865a\u62df\u673a\u4e2d\u91cd\u542f\u7f51\u7edc\u63a5\u53e3\uff0c\u6539\u4e3a\u9759\u6001 IP\uff0c\u5e76\u66f4\u6539\u7f51\u5173 \uff0810.254.0.254\uff09 ifdown edit interface coonfig files ifup \u66f4\u6539\u865a\u62df\u673a\u7684 DNS \u548c domain/search\uff1a DNS: neat-dns (10.254.0.253) dns backup (202.38.93.94) domain/search: s.ustclug.org","title":"Configure network"},{"location":"workflow/vSphere/new-vm/#install-tools","text":"\u6839\u636e\u9700\u8981\u6362\u6e90\uff0c\u52a0\u5165\u5b89\u5168\u66f4\u65b0\u6e90\u7b49 \u5b89\u88c5 open-vm tools \u5b89\u88c5 openssh","title":"Install tools"},{"location":"workflow/vSphere/new-vm/#configure-ldap","text":"\u89c1 LDAP\u670d\u52a1\u4f7f\u7528\u53ca\u914d\u7f6e\u8bf4\u660e","title":"Configure LDAP"}]}